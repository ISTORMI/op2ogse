-- -*- mode: lua; coding: windows-1251-dos -*-

function attach( sm )
  sm:subscribe({ signal = "on_first_update", fun = this.on_first_update })
end


function on_first_update()
  local items = {
    [ "streyndzher" ] = this.checking_taken_item58,
  }
  for sect, fun in pairs( items ) do
    local obj = db.actor:object( sect )
    if obj then
      fun( obj )
      break
    end
  end
end


-- отобрать все, что нельзя проносить в МГ
function oruzhie_delet()
  local remove_sects = {}
  local remove_items = dsh_rukzak.get_actor_items(
    function( obj )
      if
        obj:is_scope()
        or spawn_level_changer.teleports[ obj:section() ]
        or ( obj:is_weapon() and get_u32( obj:section(), "slot", 0 ) == 2 )
        or (
          obj:is_weapon_magazined()
          and (
            ogse_wpn_utils.get_scope_status( obj ) == 1
            or (
              ogse_wpn_utils.get_scope_status( obj ) == 2
              and ogse_wpn_utils.get_scope_flag( obj )
            )
          )
          and not (
            obj:section() == "wpn_binoc"
            or obj:section() == "wpn_fot"
          )
        )
        or get_bool( obj:section(), "arhara_dialog.oruzhie_delet", false )
      then
        remove_sects[ obj:section() ] =
          ( remove_sects[ obj:section() ] or 0 ) + 1
        return true
      end
      return false
    end
  )
  if table.getn( remove_items ) > 0 then
    for _, ai in ipairs( remove_items ) do
      if not ai.count then
        ai.count = table.getn( ai.game_objs )
      end
      for _, obj in ipairs( ai.game_objs ) do
        ogse.remove_item_from_inventory( obj )
      end
    end
    local new = alife():create(
      get_string( "treasure_item", "real_item_section" ),
      db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id()
    )
    dsh_rukzak.save_rukzak( new.id, remove_items )
    ogse.save_var( "dsh_rukzak." .. new.id .. ".inv_drop", true )
    ogse.save_var( "dsh_rukzak." .. new.id .. ".zamok",    true )
    for sect, num in pairs( remove_sects ) do
      news_manager.relocate_item( db.actor, "out", sect, num )
    end
  end
end


function bunker_fotik_artu_sms_delayed()
  ogse_st_mgr.start_timer(
    "arhara_dialog.bunker_fotik_artu_sms",
    10, "arhara_dialog.bunker_fotik_artu_sms"
  )
end

function bunker_fotik_artu_sms()
  laba_del_artu()
  laba_spir()
  news_manager.send_tip(
    db.actor, "bunker_fotik_artu_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_17"
  )
  ogse_st_mgr.start_timer(
    "arhara_dialog.bunker_fotik_artu_sms1",
    10, "arhara_dialog.bunker_fotik_artu_sms1"
  )
end

function bunker_fotik_artu_sms1()
  news_manager.send_tip(
    db.actor, "bunker_fotik_artu_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_45"
  )
end


-- убираем Шухера с кордона
function dell_stalk_shuher()
  for _, n in ipairs({
    "esc_father_pant", "esc_pantera_bomba", "esc_stalk_shuher"
  }) do
    local sobj = alife():object( n )
    if sobj then
      dsh.release_mob( sobj )
    end
  end
end


-- заспавним собачек Варлабе
function spawn_dog_to_warlab()
  battle.create_enemies(
    {
      {  "dog_normal", vector():set( 3.371, 1.008, -3.150 ), 4988, 3187  },
      {  "dog_weak", vector():set( 3.371, 1.008, -3.150), 4988, 3187  },
      {  "dog_weak", vector():set( -12.583, -2.960, 0.312), 1942, 3168  },
      {  "dog_normal", vector():set( -12.583, -2.960, 0.312 ), 1942, 3168  },
      {  "pseudodog_normal", vector():set( -4.049, 0.998, 3.772 ), 3607, 3174  },
      {  "dog_strong", vector():set( -4.049, 0.998, 3.772 ), 3607, 3174  },
      {  "dog_strong", vector():set( -4.049, 0.998, 3.772 ), 3607, 3174  },
      {  "dog_weak", vector():set( -6.291, -7.085, 2.363 ), 3064, 3172  },
      {  "dog_weak", vector():set( -6.291, -7.085, 2.363), 3064, 3172  },
      {  "pseudodog_weak", vector():set( -6.291, -7.085, 2.363 ), 3064, 3172  },
      {  "pseudodog_normal", vector():set( -6.291, -7.085, 2.363 ), 3064, 3172  },
      {  "dog_weak", vector():set( -1.689, -3.150, 7.975 ), 4209, 3178  },
      {  "pseudodog_normal", vector():set( -1.689, -3.150, 7.975 ), 4209, 3178  },
      {  "dog_normal", vector():set( -1.689, -3.150, 7.975 ), 4209, 3178  },
      {  "dog_normal", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_normal", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_weak", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_weak", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_weak", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_weak", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "dog_weak", vector():set( 3.961, -11.417, -1.361 ), 5107, 3191  },
      {  "pseudodog_weak", vector():set( -23.483, -15.388, -0.544 ), 581, 3157  },
      {  "dog_normal", vector():set( -23.483, -15.388, -0.544 ), 581, 3157  },
      {  "dog_normal", vector():set( -23.483, -15.388, -0.544 ), 581, 3157  },
      {  "dog_weak", vector():set( -23.483, -15.388, -0.544 ), 581, 3157  },
    }
  )
end


-- получим аптечку нож и бинокль от Зведочёта
function noz_dat( first_speaker, second_speaker )
  sak.create_items_actor( "wpn_pm", 1 )
  sak.create_items_actor( "medkit", 1 )
  sak.create_items_actor( "wpn_binoc", 1 )
  sak.create_items_actor( "wpn_knife", 1 )
end


-- уберём Злобного с МГ
function delete_zlo_and_ko()
  local npc_names = {
    "dcity_last_vhod_1",
    "dcity_last_vhod_2",
    "dcity_last_vhod_3",
    "dcity_last_vhod_4",
    "dead_city_zlobnuy",
  }
  for _, n in ipairs( npc_names ) do
    local sobj = alife():object( n )
    if sobj then
      alife():release( sobj )
    end
  end
end


-- проверим наличие 20 рук зомби для Акима
function have_a_hand()
  return sak.have_item_namber( "mutant_zombie_hand", 20 ) ~= false
end

-- отдадим 40 рук зомби Акиму получим  награду и поднимем репу
function out_hand( first_speaker, second_speaker )
  sak.out_item_namber( "mutant_zombie_hand", 20 )
  dialogs.relocate_money( second_speaker, 10000, "in" )
  sak.create_items_actor( "ammo_7.62x54_ap", 4 )
  second_speaker:set_relation( game_object.friend, first_speaker )
  db.actor:change_character_reputation( 30 )
end


function uhod_iz_mg_have()
  return db.actor:has_info( "uhod_iz_mg_have" )
end


function pant_proschay_sms1()
  local snd = news_manager.send_tip(
    db.actor, "pant_proschay_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_54", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pant_proschay_sms1_2" )
end

function pant_proschay_sms1_2()
  local snd = news_manager.send_tip(
    db.actor, "pant_proschay_sms1_2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_43", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pant_proschay_sms1_3" )
end

function pant_proschay_sms1_3()
  local snd = news_manager.send_tip(
    db.actor, "pant_proschay_sms1_3", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_55", true
  )
  dell_pantera_vertuha_aver()
end


function pant_proschay_sms2()
end

function pant_proschay_sms3()
end


function piligrim_2_sms()
  news_manager.send_tip(
    db.actor, "piligrim_2_sms", nil, nil, 40000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_60"
  )
  dsh_amulet_monolith.on_dialog()
end


-- рюкзачок Химеры на Радаре
function new_inventory19()
  alife():create(
    "m_inventory_box19", vector():set( -17.792, 0.198, -56.856 ), 5019, 1960
  )
  alife():create(
    "kolba_orand_poln",  vector():set( -17.436, 0.198, -56.755 ), 5019, 1960
  )
  alife():create(
    "kolba_orand_poln",  vector():set( -17.310, 0.198, -56.975 ), 5019, 1960
  )
  alife():create(
    "kolba_siniy_poln",  vector():set( -17.374, 0.198, -57.115 ), 5018, 1960
  )
  alife():create(
    "kolba_siniy_poln",  vector():set( -17.354, 0.198, -57.376 ), 5018, 1960
  )
  local sobj = alife():object( "land_sniper_chimaera" )
  if sobj then
    dsh.release_mob( sobj )
  end
end


-- заспавним чёртов гранатомёт скриптом. Теперь он спавнится в ящике
-- через алспаун, поэтому этот спавн не нужен. Ящик нужно спаунить
-- скриптово, что бы он появился только после разговора с Поваром.
function wpnrg_spawn()
  alife():create( 8451 )        -- arm_sklady_rg_box_0033
end


local math_random = math.random

--' спавним рацию Волка на свалке (функция Сяка перестала работать)
function spawn_add_resiver()
local obj = alife():create("sak_resiver",vector():set(-186.264,-3.492,94.656),38921,338)
end


-- проверим наличие пушки для Лиса
function fox_kriss_have()
  return sak.have_item_namber( "fake_wpn_spas12", 1 )
    or sak.have_item_namber( "wpn_spas12", 1 )
end

-- отдадим ствол Лису
function fox_kriss_done()
  if sak.have_item_namber( "fake_wpn_spas12", 1 ) then
    sak.out_item_namber( "fake_wpn_spas12", 1 )
  else
    sak.out_item_namber( "wpn_spas12", 1 )
  end
  aem_manager.manage_money( 11000, "in" )
  sak.create_items_actor( "grenade_f1", 2 )
  sak.create_items_actor( "ammo_12x70_kart", 4 )
  wawka_dialog.create_rnd_nagrad_1( true )
  wawka_dialog.create_rnd_nagrad_1( true )
end


--' эта функция проверяет наличие минигана
function atp_propusk_have() 
return sak.have_item_namber("wpn_m_134_baty",1) ~= false
  end

-- отдадим миниган Адреналину, получим награду и Адреналин - друг
function atp_propusk_done( first_speaker, second_speaker )
  sak.out_item_namber( "wpn_m_134_baty", 1 )
  sak.create_items_actor( "wpn_svd", 1 )
  sak.create_items_actor( "af_spirit_2", 1 )
  second_speaker:set_relation( game_object.friend, first_speaker )
end


--' проверим наличие маскировочной экзы
function arhara_ekza_have()
--return sak.have_item_namber("meceniy_outfit_new",1) ~= false
return meceniy_work.have_meceniy_outfit()
  end 

--' отдадим экзу Воронину и получим награду
function arhara_ekza_done(first_speaker, second_speaker)
--sak.out_item_namber("meceniy_outfit_new",1)
meceniy_work.give_meceniy_outfit()
  sak.create_items_actor( "af_kol_4", 1 )
  sak.create_items_actor( "af_armor_4", 1 )
second_speaker:set_relation(game_object.friend, first_speaker)
end

--' спавним нашу маскировочную экзу
function ekza()
local obj = alife():create("meceniy_outfit_new",vector():set(113.509,0.686,-24.954),539883,2823)
end

--' проверим наличие тисков для Шурупа
function atp_propusk_shurup_have()
return sak.have_item_namber("tisku_arhara",1) ~= false
  end

--' спавним тиски для Шурупа
function spawn_tisku()
local obj = alife():create("tisku_arhara",vector():set(109.575,-9.599,-301.339),535499,2824)
end

--' отдача тисков Шурупу, получим мозг и картечь в награду, Шуруп друг
function atp_propusk_shurup_done(first_speaker, second_speaker)
sak.out_item_namber("tisku_arhara",1)
  sak.create_items_actor( "mozg", 1 )
  sak.create_items_actor( "ammo_12x70_kart", 2 )
second_speaker:set_relation(game_object.friend, first_speaker)
end

--' проверим наличие антизомбина
function chaes_perexod_have()
return sak.have_item_namber("antizombie",1) ~= false
  end

--' отдадим антизомбин
function chaes_perexod_done(first_speaker, second_speaker)
sak.out_item_namber("antizombie",1)
second_speaker:set_relation(game_object.friend, first_speaker)
end

--' спавним нашу маскировочную экзу в саркофаге
--function ekza_sarcofag()
--local obj = alife():create("meceniy_outfit_new",vector():set(37.431,56.184,32.087),4591,2417)
--end


--' спавним наши телепорты в Саркофаге
function arhara_teleport()
  alife():create("arhara_tele",vector():set(37.431,56.184,32.087),4591,2417)
  alife():create("arhara_tele",vector():set(37.431,56.184,32.087),4591,2417)
  alife():create("arhara_tele",vector():set(37.431,56.184,32.087),4591,2417)
  alife():create("arhara_tele",vector():set(37.431,56.184,32.087),4591,2417)
  alife():create("arhara_tele",vector():set(37.431,56.184,32.087),4591,2417)
end


--' спавним наш мозг на ЧАЭС2
function mozg_atp_for_test22()
  alife():create(
    "mozg",
    vector():set( 322.26416015625, -2.5768759250641, -295.98400878906 ),
    838294, 2847
  )
end

function mozg_l12_stancia_2()
  alife():create(
    "mozg", vector():set( 206.574,-0.102,379.099 ), 79782, 2580
  )
  alife():create(
    "mozg", vector():set( 505.838,11.748,352.584 ), 189400, 2619
  )
  alife():create(
    "mozg", vector():set( 1018.527,-0.001,382.414 ), 263677, 2650
  )
  alife():create(
    "mozg", vector():set( 1018.527,-0.001,382.414 ), 263677, 2650
  )
  alife():create(
    "mozg", vector():set( 1018.527,-0.001,382.414 ), 263677, 2650
  )
  alife():create(
    "mozg", vector():set( 505.838,11.748,352.584 ), 189400, 2619
  )
  alife():create(
    "mozg", vector():set( 505.838,11.748,352.584 ), 189400, 2619
  )
  alife():create(
    "mozg", vector():set( 505.838,11.748,352.584 ), 189400, 2619
  )
  alife():create(
    "mozg", vector():set( 206.574,-0.102,379.099 ), 79782, 2580
  )
  alife():create(
    "mozg", vector():set( 206.574,-0.102,379.099 ), 79782, 2580
  )
  alife():create(
    "mozg", vector():set( 1018.527,-0.001,382.414 ), 263677, 2650
  )
end

function mozg()
  mozg_l12_stancia_2()
  mozg_atp_for_test22()
  battle.create_enemies(
    {
      { "tank_spawn_zasada4",vector():set(206.574,-0.102,378.099),79782,2580 },
      { "tank_spawn_zasada6",vector():set(206.574,-0.102,377.099),79782,2580 },
      { "tank_spawn_zasada1",vector():set(504.838,11.748,352.584),189400,2619 },
      { "tank_spawn_zasada7",vector():set(506.838,11.748,352.584),189400,2619 },
      { "tank_spawn_zasada6",vector():set(1018.827,-0.001,382.414),263677,2650 },
      { "tank_spawn_zasada2",vector():set(1018.427,-0.001,382.414),263677,2650 },
      { "tank_spawn_zasada5",vector():set(505.238,11.748,352.584),189400,2619 },
      { "tank_spawn_zasada7",vector():set(505.038,11.748,352.584),189400,2619 },
      { "tank_spawn_zasada1",vector():set(206.274,-0.102,379.099),79782,2580 },
      { "tank_spawn_zasada5",vector():set(206.874,-0.102,379.099),79782,2580 },
      { "tank_spawn_zasada3",vector():set(1018.727,-0.001,382.414),263677,2650 },
      { "tank_spawn_zasada7",vector():set(326.26416015625,-2.5768759250641,-295.98400878906),838294,2847 },
    }
  )
end


--' Раз Ломти не спавнятся, заставим, да ещё и контролёров добавим
function spawn_arts()
  alife():create("gold_art",vector():set(294.396,16.796,68.041),102440,2594)
  alife():create("gold_art",vector():set(69.090,4.981,113.450),54000,2536)
  alife():create("gold_art",vector():set(15.024,4.457,148.660),33501,2525)
  alife():create("gold_art",vector():set(20.866,3.621,209.016),34266,2524)
  alife():create("gold_art",vector():set(82.715,8.726,168.478),57448,2557)
  alife():create("gold_art",vector():set(184.589,21.803,188.475),74473,2569)
  alife():create("gold_art",vector():set(-2.046,17.001,277.747),24758,2541)
  alife():create("gold_art",vector():set(96.206,50.358,79.338),59035,2566)
  alife():create("gold_art",vector():set(294.066,16.822,69.239),102227,2594)
  alife():create("gold_art",vector():set(429.023,8.506,159.034),143946,2599)
  alife():create("gold_art",vector():set(456.191,8.500,158.333),149725,2599)
  alife():create("gold_art",vector():set(573.650,5.041,126.056),170815,2627)
  alife():create("gold_art",vector():set(535.685,-0.085,130.346),169069,2627)
  alife():create("gold_art",vector():set(692.553,-0.117,165.552),194971,2623)
  alife():create("gold_art",vector():set(758.592,-0.085,354.072),203677,2655)
  alife():create("gold_art",vector():set(577.391,9.090,201.674),173475,2631)
  battle.create_enemies(
    {
      { "tank_spawn_zasada4",vector():set(294.896,16.796,68.041),102440,2594 },
      { "tank_spawn_zasada5",vector():set(69.290,4.981,113.450),54000,2536 },
      { "tank_spawn_zasada6",vector():set(15.424,4.457,148.660),33501,2525 },
      { "tank_spawn_zasada7",vector():set(20.466,3.621,209.016),34266,2524 },
      { "tank_spawn_zasada1",vector():set(82.315,8.726,168.478),57448,2557 },
      { "tank_spawn_zasada2",vector():set(184.289,21.803,188.475),74473,2569 },
      { "tank_spawn_zasada3",vector():set(-2.086,17.001,277.747),24758,2541 },
      { "tank_spawn_zasada7",vector():set(96.506,50.358,79.338),59035,2566 },
      -- { "tank_spawn_zasada5",vector():set(294.026,16.822,69.239),102227,2594 },
      { "tank_spawn_zasada3",vector():set(429.063,8.506,159.034),143946,2599 },
      { "tank_spawn_zasada5",vector():set(456.391,8.500,158.333),149725,2599 },
      { "tank_spawn_zasada7",vector():set(573.850,5.041,126.056),170815,2627 },
      { "tank_spawn_zasada2",vector():set(535.625,-0.085,130.346),169069,2627 },
      { "tank_spawn_zasada6",vector():set(692.853,-0.117,165.552),194971,2623 },
      { "tank_spawn_zasada5",vector():set(758.532,-0.085,354.072),203677,2655 },
      { "tank_spawn_zasada6",vector():set(577.341,9.090,201.674),173475,2631 },
      { "tank_spawn_zasada6",vector():set(295.396,16.796,68.041),102440,2594 },
      { "tank_spawn_zasada4",vector():set(82.715,8.726,168.478),57448,2557 },
      { "tank_spawn_zasada6",vector():set(185.589,21.803,188.475),74473,2569 },
      { "tank_spawn_zasada7",vector():set(294.066,16.822,69.239),102227,2594 },
      { "tank_spawn_zasada6",vector():set(456.191,8.500,158.333),149725,2599 },
      { "tank_spawn_zasada2",vector():set(534.685,-0.085,130.346),169069,2627 },
      { "tank_spawn_zasada6",vector():set(691.553,-0.117,165.552),194971,2623 },
      { "tank_spawn_zasada3",vector():set(577.391,9.090,201.674),173475,2631 },
      -- { "m_controller_old",vector():set(294.396,16.796,68.041),102440,2594 },
      -- { "m_controller_old",vector():set(15.024,4.457,148.660),33501,2525 },
      -- { "m_controller_old",vector():set(184.589,21.803,188.475),74473,2569 },
      -- { "m_controller_old",vector():set(535.685,-0.085,130.346),169069,2627 },
      -- { "m_controller_old",vector():set(692.553,-0.117,165.552),194971,2623 },
    }
  )
end

--' спавним наш диск на АТП
--function disk_atp()
--local obj = alife():create("disk_adren",vector():set(319.364,-5.858,-293.894),833281,2847)
--end

--' проверим наличие диска у ГГ
function arh_disk_have()
return sak.have_item_namber("disk_adren",1) ~= false
end


-- отдадим диск Адреналину и получим награду
function arh_disk_done()
  sak.out_item_namber( "disk_adren", 1 )
  sak.create_items_actor( "medkit_scientic", 10 )
  sak.create_items_actor( "grenade_f1", 5 )
  sak.create_items_actor( "ammo_5.45x39_ap", 5 )
end


--' проверим наличие пуддинга для акима
function akim_pudd_have()
 return sak.have_item_namber("af_pudd_4",1) ~= false
end

--' проверим наличие финансов за ФН
function akim_have_money_120000(actor,npc)
    return actor:money() > 120000
end

--' отдадим пудинг Акиму и получим  ФН
function give_akim_pudd(first_speaker, second_speaker)
 sak.out_item_namber("af_pudd_4",1)
dialogs.relocate_item_section(second_speaker, "wpn_fn2000_sniper","in")
end

--' отдадим деньги Акиму за снайперку
function akim_give_money_120000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,120000,"out")
end

--' обмен патронов для минигана у Акима
function akim_obmen6_have(actor,npc)
   return actor:money() > 30000
end
function akim_obmen6(actor,npc)
	dialogs.relocate_money(npc,30000,"out")
	dialogs.relocate_item_section(actor, "ammo_minigun","in")
end


function akim_obmen7_have( actor, npc )
  return actor:money() > 10000 and dsh.has_art_bio_gravi()
end
function akim_obmen7( actor, npc )
  dialogs.relocate_money( npc, 10000, "out" )
  dsh.give_art_bio_gravi()
  dialogs.relocate_item_section( actor, "ammo_minigun", "in" )
end


function akim_obmen8_have( actor, npc )
  return actor:money() > 15000 and dsh.has_art_bio_medusa()
end
function akim_obmen8( actor, npc )
  dialogs.relocate_money( npc, 15000, "out" )
  dsh.give_art_bio_medusa()
  dialogs.relocate_item_section( actor, "ammo_minigun", "in" )
end


-- Сахар дал арт на дорожку 
function sahar_dal_art()
  sak.create_items_actor( "af_pudd_3", 1 )
end


function sahar_sumka_transfer( first_speaker, second_speaker )
  dialogs.relocate_item_section( second_speaker, "sumka_arhara", "in" )
  db.actor:change_character_reputation( 100 )
end

-- проверим наличие сумки для Сахара
function sahar_sumka_have()
  return sak.have_item_namber( "sumka_arhara", 1 ) ~= false
end

-- отдадим сумку Сахару
function sahar_sumka_done()
  sak.out_item_namber( "sumka_arhara", 1 )
  sak.create_items_actor( "medkit_scientic", 20 )
end


--' а это рюкзачок для минигана на припяти
function new_inventory15()
local se_obj = alife():create("m_inventory_box15", vector():set(192.30499267578,28.663299560547,209.28273010254),260026,2219)
end

--' спавним наши патроны и миниган на крыше
function paron_krusha()
local obj = alife():create("ammo_minigun",vector():set(192.304,28.663,209.282),260026,2219)
local obj = alife():create("ammo_minigun",vector():set(192.304,28.663,209.282),260026,2219)
end

--' проверим наличие медальона у ГГ
function med_dok_have()
 return sak.have_item_namber("doc_medal",1) ~= false
end


-- отдадим медальон Доку
function med_dok_done()
  sak.out_item_namber( "doc_medal", 1 )
end


-- удалить переход АТП - Припять
function med_dok_del_lc()
  local sobj = alife():story_object( story_ids.level_changer_na_pripyat )
  if sobj then
    for id, sobj2 in alife():objects() do
      if
        sobj2.level_name == sobj.level_name
        and sobj2.m_level_vertex_id == sobj.m_level_vertex_id
        and sobj2:section_name() == "zone_teleport"
      then
        dsh_alife.release( sobj2 )
        break
      end
    end
    dsh_alife.release( sobj )
  end
end


--' Док вернул медальон
function med_dok_obrat(first_speaker, second_speaker)
  sak.create_items_actor( "doc_medal", 1 )
end

--' проверим наличие финансов на рецепт гусеницы
function sahar_have_money_50000(actor,npc)
    return actor:money() > 50000
end

--' отдадим деньги Сахару
function sahar_give_money_50000(t1,t2)    
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,50000,"out")
end    


-- отдадим выверт Акиму и получим замок
function give_akim_vyvert()
  sak.create_items_actor( "zamok", 1 )
end


--' парочка бюреров на баре
function spawn_burer_bar()
  battle.create_enemies(
    {
      { "burer_strong",vector():set(99.368,1.213,-122.928),45947,1173 },
      { "burer_strong",vector():set(158.990,4.012,-108.175),45947,1173 },
    }
  )
end


-- проверим наличие вороньих яиц у ГГ
function arhara_omlet_have()
 return sak.have_item_namber( "vorona_egg", 10 )
end

-- отдадим яйца повару и получим пушку
function arhara_omlet_done()
  amk_utils.out_items({ "vorona_egg" })
  sak.create_items_actor( "ammo_m209", 5 )
end


-- Akill begin Лекарство теперь на блокпосту + парочка вояк для веселья
--' спавним наши бутылочки с лекарством
function butilka()
  alife():create("lekarstvo",vector():set(-140.25267028809,-28.525129318237,-356.89068603516),110480,19)
  alife():create("lekarstvo",vector():set(-139.74499511719,-28.524593353271,-356.88391113281),110480,19)
  alife():create("lekarstvo",vector():set(-139.23518371582,-28.524532318115,-356.93264770508),111250,19)
  alife():create("lekarstvo",vector():set(-135.88641357422,-28.738632202148,-359.15521240234),114324,19)
  alife():create("lekarstvo",vector():set(-136.90090942383,-28.73921585083,-359.18383789063),113558,18)
  battle.create_enemies(
    {
      { "zasada_tonnel_agro_3",vector():set(-163.62464904785,-25.436117172241,-356.86444091797),85709,31 },
      { "zasada_tonnel_agro_1",vector():set(-168.9747467041,-25.435110092163,-352.73577880859),81063,31 },
      { "zasada_tonnel_agro_2",vector():set(-178.65881347656,-29.065357208252,-364.28756713867),71841,30 },
      { "zasada_blockpost_1",vector():set(-132.80337524414,-25.790529251099,-356.68655395508),118106,19 },
      { "zasada_blockpost_3",vector():set(-135.33158874512,-30.174585342407,-397.16305541992),115787,21 },
      { "agro_elite_soldier",vector():set(-113.38027954102,-30.475996017456,-364.5309753418),142107,24 },
    }
  )
end
-- Akill end

-- проверим наличие лекарства для Акима
function arhara_omlet_akim_have()
  return sak.have_item_namber( "lekarstvo", 3 )
end

-- отдадим лекарство Акиму
function arhara_omlet_akim_done()
  amk_utils.out_items({ "lekarstvo" })
end

--' спавним вороньи яйца
function vorona_egg_spawn()
  alife():create("vorona_egg",vector():set(-34.258,1.229,61.552),159972,2881)
  alife():create("vorona_egg",vector():set(-34.258,1.229,61.552),159972,2881)
  alife():create("vorona_egg",vector():set(-34.258,1.229,61.552),159972,2881)
  alife():create("vorona_egg",vector():set(-34.258,1.229,61.552),159972,2881)
  alife():create("vorona_egg",vector():set(4.979,1.458,117.221),192133,2881)
  alife():create("vorona_egg",vector():set(4.979,1.458,117.221),192133,2881)
  alife():create("vorona_egg",vector():set(4.979,1.458,117.221),192133,2881)
  alife():create("vorona_egg",vector():set(110.141,2.509,131.046),278456,2885)
  alife():create("vorona_egg",vector():set(110.141,2.509,131.046),278456,2885)
  alife():create("vorona_egg",vector():set(110.141,2.509,131.046),278456,2885)
  alife():create("vorona_egg",vector():set(-136.771,-0.184,-148.663),79878,2882)
  alife():create("vorona_egg",vector():set(-136.771,-0.184,-148.663),79878,2882)
  alife():create("vorona_egg",vector():set(-136.771,-0.184,-148.663),79878,2882)
  alife():create("vorona_egg",vector():set(-163.050,2.087,-161.024),58073,2882)
  alife():create("vorona_egg",vector():set(-163.050,2.087,-161.024),58073,2882)
  battle.create_enemies(
    {
      { "controller_senator",vector():set(-123.09496307373,9.1040058135986,101.61030578613),90668,2881 },
      { "controller_senator",vector():set(-199.84088134766,-0.2078532576561,-121.52265167236),29582,2882 },
    }
  )
end

--' а это рюкзачок для минигана в пещере
function new_inventory16()
local se_obj = alife():create("m_inventory_box16", vector():set(-0.047491822391748,-2.4808914661407,-9.304651260376),32285,2880)
end


--' спавним сердце полтергейста и скелеты в пещере
function af_part_monolit_spawn()
  alife():create(
    "af_part_monolit",
    vector():set( 0.101, -2.429, -8.607 ), 32286, 2880
  )
end


-- эта функция проверяет наличие нужных предметов для шахтёра
function arhara_shaxter_have()
  return sak.have_item_namber( "af_part_monolit", 1 )
end

-- отдадим монолит Шахтёру, а заодно и весь скарб
function arhara_shaxter_done()
  sak.out_item_namber( "af_part_monolit", 1 )
  sak.create_items_actor( "shaxter_tele", 1 )
end


--' спавним фонарики
function fonarik_les()
  dsh.create_and_map_treasure(
    game.translate_string( "fonarik_les_0" ),
    game.translate_string( "fonarik_les_1" ),
    "fonarik", vector():set( -42, 11, -198.8 ), 153626, 2882
  )
  alife():create(
    "fonarik", vector():set( -42, 11, -198.8 ), 153626, 2882
  )
end


--' эта функция проверяет наличие 2 фонариков
function shaxter_fonar_dost_have() 
  local res = sak.have_item_namber( "fonarik", 2 ) ~= false
  if res then
    dsh.map_remove_treasure_inv( "fonarik" )
  end
  return res
end


--' отдадим фонарики шахтёру и получим  Сердце полтергейста
function shaxter_fonar_dost_done(first_speaker, second_speaker)
  sak.out_item_namber( "fonarik", 2 )
  sak.create_items_actor( "af_part_monolit", 1 )
end


--' спавним кубик для Акима
function kubik_spawn()
  dsh.create_and_map_treasure(
    game.translate_string( "kubik_spawn_0" ),
    game.translate_string( "kubik_spawn_1" ),
    "kubik",
    vector():set( -6.754, 9.126, -98.030 ),
    165824, 821
  )
end


--' эта функция проверяет наличие кубика
function akim_kubik_nayti_have() 
  local res = sak.have_item_namber( "kubik", 1 ) ~= false
  if res then
    dsh.map_remove_treasure_inv( "kubik" )
  end
  return res
end

  
--' отдадим кубик Акиму
function akim_kubik_nayti_done(first_speaker, second_speaker)
 sak.out_item_namber("kubik",1)
end


--' спавним книгу Шахтёра
function book_xabarych_spawn()
  dsh.create_and_map_treasure(
    game.translate_string( "book_xabarych_spawn_0" ),
    game.translate_string( "book_xabarych_spawn_1" ),
    "book_xabarych",
    vector():set( -218.918, 0.026, -223.327 ),
    14359, 2882
  )
end


--' проверим наличие книги
function shax_kniga_naity_have() 
  local res = sak.have_item_namber( "book_xabarych", 1 ) ~= false
  if res then
    dsh.map_remove_treasure_inv( "book_xabarych" )
  end
  return res
end


-- отдадим книгу шахтёру и получим Ремингтон 
function shax_kniga_naity_done()
  sak.out_item_namber( "book_xabarych", 1 )
  sak.create_items_actor( "bandage", 20 )
  sak.create_items_actor( "medkit_scientic", 5 )
end


-- Akill begin
-- спавним клад и микроба
function klad_spawn()
  alife():create(
    "a_inventory_box56",
    vector():set( -91.53,-2.08,-28.38 ), 18567, 2875
  )
  alife():create("af_eye_voron.af_bio",vector():set(-89.772,-2.490,-21.691),19110,2875)
  battle.create_enemies(
    {
      { "scelet_strong",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "burer_normal",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "burer_normal",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "burer_normal",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "scelet_strong",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "fracture_normal",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "fracture_normal",vector():set(-92.451225280762,2.7269945144653,5.9352955818176),18375,2870 },
      { "bloodsucker_normal",vector():set(-91.327941894531,-2.0939588546753,-28.991931915283),18750,2875 },
    }
  )
end
-- Akill end


--' проверим наличие клада для Лысого
function lysyi_klad_nayti_have() 
return new_dialog.item_much("money",3) ~= false and
new_dialog.item_much("money1",3) ~= false and
new_dialog.item_much("money2",3) ~= false and
new_dialog.item_much("money3",3) ~= false
end

--' заспавним монстриков в пещере и несколько артов
function monstr_spawn_peshera()
  battle.create_enemies(
    {
      { "snork_strong",vector():set(-112.136,2.497,5.440),12551,2870 },
      { "snork_normal",vector():set(-112.136,2.497,5.440),12551,2870 },
      { "snork_strong",vector():set(-112.136,2.497,5.440),12551,2870 },
      { "snork_normal",vector():set(-112.136,2.497,5.440),12551,2870 },
      { "zombie_normal",vector():set(-112.1359,2.497,5.440),12551,2870 },
      { "zombie_normal",vector():set(-112.1359,2.497,5.440),12551,2870 },
      { "zombie_normal",vector():set(-32.242,-2.364,17.576),30991,2878 },
      { "zombie_normal",vector():set(-32.242,-2.364,17.576),30991,2878 },
      { "zombie_normal",vector():set(-32.2419,-2.364,17.576),30991,2878 },
      { "zombie_normal",vector():set(-32.2419,-2.364,17.576),30991,2878 },
      { "zombie_normal",vector():set(-32.2419,-2.364,17.576),30991,2878 },
      { "zombie_normal",vector():set(-32.578,-2.469,19.725),30910,2878 },
      { "zombie_normal",vector():set(-32.578,-2.469,19.725),30910,2878 },
      { "zombie_normal",vector():set(-61.608,2.488,19.820),26067,2870 },
      { "zombie_normal",vector():set(-61.608,2.488,19.820),26067,2870 },
      { "zombie_strong",vector():set(-61.608,2.488,19.820),26067,2870 },
      { "zombie_normal",vector():set(-61.6079,2.488,19.820),26067,2870 },
      { "zombie_normal",vector():set(-61.6079,2.488,19.820),26067,2870 },
      { "zombie_normal",vector():set(-61.6079,2.488,19.820),26067,2870 },
    }
  )
end
-- Akill begin
--' отдадим клад Лысому
function lysyi_klad_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("money",3)
sak.out_item_namber("money1",3)
sak.out_item_namber("money2",3)
sak.out_item_namber("money3",3)
second_speaker:set_relation(game_object.friend, first_speaker)
end
-- Akill end
--' получим бабки и MP-5 PDW от Лысого
function lysyi_babki_vzyt_45000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,45000,"in")
end

--' повторно заспавним монстриков в пещере и несколько артов
function monstr1_spawn1_peshera1()
  battle.create_enemies(
    {
      { "bloodsucker_strong",vector():set(-136.398,2.679,26.343),7031,2866 },
      { "bloodsucker_strong",vector():set(-136.398,2.679,26.343),7031,2866 },
      { "gigant_strong",vector():set(-84.236,-2.719,57.208),20589,2871 },
      { "gigant_strong",vector():set(-84.236,-2.719,57.208),20589,2871 },
    }
  )
end

--' заспавним изум. выверт в Забытом лесу
function spawn_vyvert_green()
local obj = alife():create("af_vyvert_green",vector():set(5.379,-0.00,222.374),192846,2883)
end

--' спавним ПДА Стрелка
function str_pda_spawn()
local obj = alife():create("strelok_pda",vector():set(-98.916,9.947,-122.306),16319,2880)
local obj = alife():create("ammo_9x39_izomorf",vector():set(-98.915,9.947,-122.306),16319,2880)
local obj = alife():create("ammo_9x39_izomorf",vector():set(-98.915,9.947,-122.306),16319,2880)
end


-- проверим наличие арта
function pda_shaxt_strelok_naity_have()
  return dsh.actor_has_art_abs()
end

-- отдадим арт шахтёру и он друг
function pda_shaxt_strelok_naity_done( first_speaker, second_speaker )
  dsh.actor_give_art_abs()
  second_speaker:set_relation( game_object.friend, first_speaker )
end


--' проверим наличие вывертов и микросхем для Долговязого
function dolgovyzui_lentyi_have()
return new_dialog.item_much("af_vyvert",5) ~= false and
new_dialog.item_much("microshema",10) ~= false
end

--' спавним маленькие термосы
function termos_small_spawn()
local obj = alife():create("termos_small",vector():set(-111.933,2.804,101.580),7817,2216)
local obj = alife():create("termos_small",vector():set(-112.624,2.804,101.655),7817,2216)
local obj = alife():create("termos_small",vector():set(-111.933,2.804,101.580),7817,2216)
local obj = alife():create("termos_small",vector():set(-111.933,2.804,101.580),7817,2216)
local obj = alife():create("termos_small",vector():set(-111.933,2.804,101.580),7817,2216)
end

--' эта функция проверяет наличие термосов
function voronin_termos_naity_have() 
return sak.have_item_namber("termos_big",5) ~= false and
new_dialog.item_much("termos_small",5) ~= false
  end

--' отдадим термосы Воронину
function voronin_termos_naity_done(first_speaker, second_speaker)
sak.out_item_namber("termos_big",5)
sak.out_item_namber("termos_small",5)
end

--' спавним подарок Воронина
function voronin_prezent()
local obj = alife():create("acumm",vector():set(39.209,11.182,-100.376),223209,820)
local obj = alife():create("acumm",vector():set(39.209,11.182,-100.376),223209,820)
local obj = alife():create("acumm",vector():set(39.181,11.181,-99.905),223209,820)
local obj = alife():create("acumm",vector():set(39.181,11.181,-99.905),223209,820)
local obj = alife():create("acumm",vector():set(39.162,11.182,-99.467),223211,820)
local obj = alife():create("acumm",vector():set(39.162,11.182,-99.467),223211,820)
local obj = alife():create("ammo_7.62x39_ap",vector():set(39.274,11.184,-98.932),223212,820)
local obj = alife():create("ammo_7.62x39_ap",vector():set(39.287,11.184,-98.445),223212,820)
local obj = alife():create("ammo_7.62x39_ap",vector():set(39.287,11.184,-98.445),223212,820)
local obj = alife():create("ammo_m209",vector():set(39.341,11.184,-100.730),223207,820)
local obj = alife():create("ammo_m209",vector():set(39.341,11.184,-100.730),223207,820)
local obj = alife():create("ammo_m209",vector():set(39.341,11.184,-100.730),223207,820)
local obj = alife():create("ammo_vog-25",vector():set(39.397,11.184,-100.253),223209,820)
local obj = alife():create("ammo_vog-25",vector():set(39.397,11.184,-100.253),223209,820)
local obj = alife():create("ammo_vog-25",vector():set(39.397,11.184,-100.253),223209,820)
local obj = alife():create("ammo_vog-25",vector():set(39.397,11.184,-100.253),223209,820)
local obj = alife():create("ammo_vog-25p",vector():set(39.306,11.184,-99.599),223211,820)
local obj = alife():create("ammo_vog-25p",vector():set(39.306,11.184,-99.599),223211,820)
local obj = alife():create("ammo_vog-25p",vector():set(39.306,11.184,-99.599),223211,820)
end

--' спавним ремкомплекты
function remkomplekt_spawn()
  alife():create("kuvalda",vector():set(138.305,-6.021,13.806),576283,2832)
  alife():create("kuvalda",vector():set(160.75564575195,-5.8302555084229,-54.942893981934),607741,2833)
  alife():create("kluch",vector():set(-55.443,-6.437,-21.472),255385,1605)
  alife():create("kluch",vector():set(-55.471,-6.436,-21.143),255386,1605)
  alife():create("otvertka",vector():set(113.399,-1.398,3.550),540952,2826)
  alife():create("otvertka",vector():set(113.173,-1.398,3.539),540952,2826)
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(-78.585,-5.721,-96.389),264461,2808 },
      { "zombie_normal",vector():set(-80.783,-6.114,-68.725),261420,2808 },
      { "zombie_normal",vector():set(-100.377,-6.11,-43.543),233002,2798 },
      { "zombie_normal",vector():set(-93.483,-6.470,6.115),242276,2809 },
      { "zombie_strong",vector():set(-149.506,-3.846,6.074),160198,2796 },
    }
  )
end

--' проверим наличие ремкомплектов
function petr_sidor_vzyt_have() 
return new_dialog.item_much("kuvalda",2) ~= false and
new_dialog.item_much("kluch",2) ~= false and
new_dialog.item_much("otvertka",2) ~= false
end

--' отдадим ремкомплекты Сидору
function petr_sidor_vzyt_done(first_speaker, second_speaker)
sak.out_item_namber("kuvalda",2)
sak.out_item_namber("kluch",2)
sak.out_item_namber("otvertka",2)
end

--' спавним подарок Петренко а заодно и сюрприз
function nu_nakonez_to()
  alife():create("wpn_pkm_m1",vector():set(214.222,1.027,223.993),359851,2885)
  alife():create("ammo_7.62x54r",vector():set(214.252,1.000,223.430),359850,2885)
  alife():create("ammo_7.62x54r",vector():set(214.252,1.000,223.430),359850,2885)
  alife():create("af_armor_3",vector():set(214.715,0.333,221.231),359849,2885)
  battle.create_enemies(
    {
      { "burer_strong",vector():set(219.972,3.946,195.279),363663,2885 },
      { "burer_normal",vector():set(219.972,3.946,195.279),363663,2885 },
      { "burer_normal",vector():set(219.972,3.946,195.279),363663,2885 },
    }
  )
end


-- раз у Сяка функция не пашет - спавн док дезертира + веселуха
function spawn_rad_document7()
  local sobj = alife():story_object( 9115 )
  ASSERT( sobj, "[%s]: story_object( 9115 ) not found", script_name() )
  alife():create(
    "rad_document7",
    sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id
  )
  -- Отправим тайник в оффлайн
--[=[
  if level.object_by_id( sobj.id ) then
    alife():set_switch_online(  sobj.id, false )
    alife():set_switch_offline( sobj.id, true  )
    -- ставим в очередь на вывод в онлайн
    amk.convert_npc_timer( sobj.id, 1 ):start()
  end
--]=]
  battle.create_enemies(
    {
      { "zasada_tonnel_agro_2",vector():set(-175.85920715332,7.3848404884338,-155.32315063477),61033,560 },
      { "agro_elite_rpg",vector():set(-183.70137023926,5.317928314209,-170.63172912598),53257,667 },
      { "soldier_mines_regular",vector():set(-169.85111999512,5.3175392150879,-170.36421203613),66853,667 },
      { "soldier_mines_regular",vector():set(-195.93034362793,7.3854722976685,-223.88467407227),40564,555 },
      { "soldier_mines_veteran",vector():set(-132.79737854004,-0.20200881361961,-144.02784729004),106301,697 },
      { "soldier_mines_regular",vector():set(-156.57958984375,14.998466491699,-191.31016540527),80447,644 },
      { "soldier_mines_veteran",vector():set(-131.26614379883,14.998692512512,-191.58946228027),107755,642 },
      { "zasada_tonnel_agro_2",vector():set(-153.41352844238,9.9984302520752,-201.50427246094),84277,646 },
      { "agro_elite_soldier",vector():set(-131.84466552734,4.9986295700073,-200.23066711426),107710,621 },
      { "zasada_tonnel_agro_3",vector():set(-145.77922058105,4.9975275993347,-203.05874633789),92503,621 },
    }
  )
end

--' проверим наличие компа и 3д-рации
function voronin_stol_dostat_have() 
return new_dialog.item_much("3d_raziy",1) ~= false and
new_dialog.item_much("pribor",1) ~= false
end

--' отдадим комп и 3д-рацию Воронину
function voronin_stol_dostat_done(first_speaker, second_speaker)
sak.out_item_namber("3d_raziy",1)
sak.out_item_namber("pribor",1)
dialogs.relocate_item_section(second_speaker, "af_dik_3","in")
dialogs.relocate_item_section(second_speaker, "af_vyvert_green","in")
end

--' заспавним рацию, записку и комп
function spawn_stol()
local obj = alife():create("pribor",vector():set(34.830,8.061,-38.123),217765,1054)
local obj = alife():create("3d_raziy",vector():set(-297.263,-18.034,292.275),45228,1833)
local obj = alife():create("malyva",vector():set(32.784,8.062,-36.736),214836,1054)
end

--' проверим наличие рации
function sahar_info_have() 
return sak.have_item_namber("telefon",1) ~= false
  end

--' отдадим телефон Сахару и Сахар друг
function sahar_info_done(first_speaker, second_speaker)
sak.out_item_namber("telefon",1)
second_speaker:set_relation(game_object.friend, first_speaker)
end


-- удаляем ненужных экологов
function delete_nps_ecolog()
  local bad_objects = {
    "bar_ecolog_crush_1",
    "bar_ecolog_crush_2",
    "bar_ecolog_crush_3",
    "bar_ecolog_crush_4",
  }
  for _, name in ipairs( bad_objects ) do
    local sobj = alife():object( name )
    if sobj then
      dsh.release_mob( sobj )
    end
  end
end


--' удаляем труп Корчагина
function delete_korchagin()
  local se_obj = alife():object("dead_korchagin_military")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем труп вояки с УРТ
function delete_voen_urt()
  local se_obj = alife():object("dead_military_qvest_crest")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем труп Андрея
function delete_voen_andrey()
  local se_obj = alife():object("dead_military_esc")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем пленного из Лабиринта
function delete_labirint_shahter()
  local se_obj = alife():object("labirint_monolit_shahter")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем Звездочёта с Кордона
function delete_zvezd()
  local se_obj = alife():object("esc_zvezdochet")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' удаляем первого Болотного Доктора
function delete_doktor1()
  local se_obj = alife():object("doktor1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие артов для Креста
function have_art1()
return new_dialog.item_much("af_medusa",5) ~= false and
new_dialog.item_much("af_cristall_flower",5) ~= false and
new_dialog.item_much("af_fireball",5) ~= false
end

--' отдадим арты Кресту и получим награду
function remove_art()
  sak.out_item_namber( "af_medusa", 5 )
  sak.out_item_namber( "af_cristall_flower", 5 )
  sak.out_item_namber( "af_fireball", 5 )
  sak.create_items_actor( "af_simbion", 1 )
  sak.create_items_actor( "af_armor_3", 1 )
  sak.create_items_actor( "wpn_ak103", 1 )
  sak.create_items_actor( "ammo_7.62x39_ap", 5 )
end


-- проверим аномальных бизонов
function have_bizon()
  if sak.have_item_namber( "wpn_abakan_m2", 6 ) then return true end
  return sak.have_item_namber( "wpn_bizon1", 6 )
end

-- отдадим бизоны Кресту и получим  награду
function delete_bizon(first_speaker, second_speaker)
  if sak.have_item_namber( "wpn_abakan_m2", 6 ) then
    sak.out_item_namber( "wpn_abakan_m2", 6 )
  else
    sak.out_item_namber( "wpn_bizon1", 6 )
  end
  sak.create_items_actor( "arc_art_box_8basic", 1 )
  sak.create_items_actor( "af_dummy_battery", 1 )
  sak.create_items_actor( "wpn_svd_m2", 1 )
end


--' 20 и 40 ПДА у информатора
function inform_20_pda_have()
     return new_dialog.item_much("device_pda_npc",20) ~= false 
end

function inform_40_pda_have()
     return new_dialog.item_much("device_pda_npc",40) ~= false 
end

function inform_20_pda(first_speaker, second_speaker)
    local item = ""
    local count = math_random(2,3)
 local actor, trader
 if db.actor and db.actor:id() == first_speaker:id() then
  actor = first_speaker
  trader = second_speaker
 else
  actor = second_speaker
  trader = first_speaker
 end
 item = nagrad.level_7[math_random(#nagrad.level_7)]
 flamethrower.relocate_n_items_section(trader, "device_pda_npc", "out", 20)
 flamethrower.relocate_n_items_section(actor, item , "in", count)
end

function inform_40_pda(first_speaker, second_speaker)
    local item = ""
    local actor, trader
 if db.actor and db.actor:id() == first_speaker:id() then
  actor = first_speaker
  trader = second_speaker
 else
  actor = second_speaker
  trader = first_speaker
 end 
 flamethrower.relocate_n_items_section(trader, "device_pda_npc", "out", 40)
end


--' спавним 1 документ для Акима
function spawn_dok()
local obj = alife():create("old_doc",vector():set(48.334,3.459,236.598),221779,359) 	 
end

-- отдадим документ и получим награду
function out_doc( first_speaker, second_speaker )
  sak.out_item_namber( "old_doc", 1 )
  dialogs.relocate_money( second_speaker, 6000, "in" )
  sak.create_items_actor( "antizombie", 2 )
  second_speaker:set_relation( game_object.friend, first_speaker )
  db.actor:change_character_reputation( 10 )
end

--' проверим наличие 1 документа
function have_a_doc() 
return sak.have_item_namber("old_doc",1) ~= false
end


--' спавним 2 документ для Акима
function spawn()
  local sobj = alife():create(
    "old_doc_2", vector():set( -40.861, -2.953, -18.630 ), 4669, 732
  )	  
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
end

-- отдадим документ
function doc_otdan_p( first_speaker, second_speaker )
  sak.out_item_namber( "old_doc_2", 1 )
  dialogs.relocate_money( second_speaker, 12000, "in" )
  sak.create_items_actor( "antizombie", 1 )
  sak.create_items_actor( "treasure_item", 1 )
  sak.create_items_actor( "zamok", 1 )
  second_speaker:set_relation( game_object.friend, first_speaker )
  db.actor:change_character_reputation( 10 )
end

--' проверим наличие 2 документа
function have_doc2() 
return sak.have_item_namber("old_doc_2",1) ~= false
end

--' спавним 3 документ для Акима в х18 в рюкзаках, 4 - у Корчагина
function spawn_old()
local se_obj = alife():create("m_inventory_box24", vector():set(-8.440,1.893,11.780),1907,1125)
local se_obj = alife():create("m_inventory_box25", vector():set(-41.247,-10.908,13.351),328,1148)
local se_obj = alife():create("m_inventory_box26", vector():set(-37.379,-13.006,-14.669),315,1153)
--local obj = alife():create ("old_doc_3_3", vector():set(29.782,-10.464,42.185),6521,1161)
end

-- отдадим 3 часть доков и получим  награду АК-104 и патроны
function out_old(first_speaker, second_speaker)
  sak.out_item_namber( "old_doc_3_1", 1 )
  sak.out_item_namber( "old_doc_3_2", 1 )
  sak.out_item_namber( "old_doc_3_3", 1 )
  sak.out_item_namber( "old_doc_3_4", 1 )
  dialogs.relocate_money( second_speaker, 16000, "in" )
  sak.create_items_actor( "antizombie", 1 )
  sak.create_items_actor( "wpn_ak74_m2", 1 )
  sak.create_items_actor( "ammo_5.56x45_ap", 5 )
  wawka_dialog.create_rnd_nagrad_1( true )
  second_speaker:set_relation( game_object.friend, first_speaker )
  db.actor:change_character_reputation( 10 )
end

--' проверим наличие 3 документов для Акима
function have_a_doc_s()
return new_dialog.item_much("old_doc_3_4",1) ~= false and
new_dialog.item_much("old_doc_3_3",1) ~= false and
new_dialog.item_much("old_doc_3_2",1) ~= false and
new_dialog.item_much("old_doc_3_1",1) ~= false
end


--' проверим наличие 4 документов для Акима и броников
function have_a_doc_q()
  return new_dialog.item_much( "gagarin_outfit_m1", 1 ) ~= false
    and new_dialog.item_much( "old_doc_4", 1 ) ~= false
    and new_dialog.item_much( "pda_info",  1 ) ~= false
end


--' отдадим всё Акиму и получим  награду
function out_outfit( first_speaker, second_speaker )
  sak.out_item_namber( "gagarin_outfit_m1", 1 )
  sak.out_item_namber( "old_doc_4", 1 )
  sak.out_item_namber( "pda_info",  1 )
  dialogs.relocate_money( second_speaker, 8000, "in" )
  dialogs.relocate_item_section( first_speaker, "arhara_instruk", "in" )
  db.actor:give_info_portion( "2" )
  db.actor:change_character_reputation( 10 )
end


-- Akill begin Изменены к-ты спавна доков + монстры
-- спавним 4 документ для Акима
function spawn_new_dok()
  alife():create(
    "taynik_old_doc_4",
    vector():set( 109.10995483398, 11.377179145813, -12.646112442017 ),
    6999, 1544
  )
  alife():create(
    "pda_info", vector():set( 55.847, 8.710, -20.499), 250905, 990
  )
  akill.x16_mutant_spawn()
end
-- Akill end


--' спавним суперскат
function spawn_new_exoskeleton()
local obj = alife():create("exo_mil_exoskeleton",vector():set(-12.084,4.879,-43.365),34459,1444)
end


-- проверим наличие запчастей для Акима
function have_doc_tvar()
  return amk_utils.inventory_search_check({
    [ "mutant_boar_leg"          ] = 1,
    [ "mutant_burer_hand"        ] = 1,
    [ "mutant_chimera_kogot"     ] = 1,
    [ "mutant_dog_tail"          ] = 1,
    [ "mutant_face_tushkano"     ] = 1,
    [ "mutant_flesh_eye"         ] = 1,
    [ "mutant_fracture_hand"     ] = 1,
    [ "mutant_hand_kontroler"    ] = 1,
    [ "mutant_krovosos_jaw"      ] = 1,
    [ "mutant_poltergeist_glas"  ] = 1,
    [ "mutant_psevdodog_tail"    ] = 1,
    [ "mutant_psevdogigant_hand" ] = 1,
    [ "mutant_snork_leg"         ] = 1,
    [ "mutant_spleen_rat"        ] = 1,
    [ "mutant_tail_cat"          ] = 1,
    [ "mutant_zombie_teeth"      ] = 1,
    [ "part_tarakan"             ] = 1,
    [ "part_tarakan_strong"      ] = 1,
  })
end


-- отдадим запчасти Акиму
function out_all_tvar()
  amk_utils.out_items_number({
    [ "mutant_boar_leg"          ] = 1,
    [ "mutant_burer_hand"        ] = 1,
    [ "mutant_chimera_kogot"     ] = 1,
    [ "mutant_dog_tail"          ] = 1,
    [ "mutant_face_tushkano"     ] = 1,
    [ "mutant_flesh_eye"         ] = 1,
    [ "mutant_fracture_hand"     ] = 1,
    [ "mutant_hand_kontroler"    ] = 1,
    [ "mutant_krovosos_jaw"      ] = 1,
    [ "mutant_poltergeist_glas"  ] = 1,
    [ "mutant_psevdodog_tail"    ] = 1,
    [ "mutant_psevdogigant_hand" ] = 1,
    [ "mutant_snork_leg"         ] = 1,
    [ "mutant_spleen_rat"        ] = 1,
    [ "mutant_tail_cat"          ] = 1,
    [ "mutant_zombie_teeth"      ] = 1,
    [ "part_tarakan"             ] = 1,
    [ "part_tarakan_strong"      ] = 1,
  })
  sak.create_items_actor( "ammo_7.62x54_izomorf", 4 )
  sak.create_items_actor( "af_armor_4", 1 )
end


--' проверим наличие слом. телепортатора для Креста
function have_true()
return sak.have_item_namber("hand_teleporter_arhara",1) ~= false 
end 

--' отдадим телепортер Кресту и получим награду
function done(first_speaker, second_speaker)
sak.out_item_namber("hand_teleporter_arhara",1) 
dialogs.relocate_money(first_speaker, 14000, "in")
second_speaker:set_relation(game_object.friend, first_speaker)
db.actor:change_character_reputation(10)
end

--' заспавним раб. телепортер на АТП
function teleporter()
local obj = alife():create ("hand_teleporter", vector():set(99.139,-7.145,-5.472),523095,2828)
end

--' проверим наличие Грозы для Воронина
function voronin_infa_gg_have()
return sak.have_item_namber("wpn_groza",1) ~= false
  end


-- получим аптечки
function voronin_infa_gg_done()
  sak.create_items_actor( "medkit", 2 )
  -- а через 30 секунд пусть появятся наемники
  ogse_st_mgr.start_timer(
    "arhara_dialog.naemn_shturm_poluch_start",
    30, "arhara_dialog.naemn_shturm_poluch_start"
  )
end

function naemn_shturm_poluch_start()
  db.actor:give_info_portion( "naemn_shturm_poluch_start" )
end


-- убираем всех монолитовцев на АТП, что бы Шныру не убили
function kalinin_zadan_start()
  if not db.actor:has_info( "svoboda_lukash_start" ) then return end
  for i = 1, 20 do
    local sobj = alife():object( "atp_monolit" .. i )
    if sobj and sobj:alive() then
      alife():release( sobj )
    end
  end
end


-- получим  сыворотку от Калинина
function kalinin_zadan_done( first_speaker, second_speaker )
  dialogs.relocate_item_section( second_speaker, "medkit_scientic", "in" )
  dialogs.relocate_item_section( second_speaker, "medkit_scientic", "in" )
end


-- проверим наличие флэхи для Калинина
function gonets_spasti_have()
  return sak.have_item_namber( "gonets_flash", 1 ) ~= false
end


-- Akill begin
-- отдадим флэху и получим награду от Калинина и Калинин друг
function gonets_spasti_done( first_speaker, second_speaker )
  sak.out_item_namber( "gonets_flash", 1 ) 
  sak.create_items_actor( "ammo_12x70_kart", 4 )
  second_speaker:set_relation( game_object.friend, first_speaker )
end
-- Akill end


-- получим флешку от гонца
function gonets_fleha()
  sak.create_items_actor( "gonets_flash", 1 )
end

-- получим арт от гонца
function gonets_art()
  sak.create_items_actor( "af_dik_3", 1 )
end


--' спавним зомбаков на пути Гонца
function zombari_spawn()
  battle.create_enemies(
    {
      { "zombie_strong",vector():set(378.559,0.236,145.462),919513,2858 },
      { "zombie_strong",vector():set(378.559,0.236,145.462),919513,2858 },
    }
  )
end

--' проверим наличия артов для Калинина
function vuxod_atp_have()
return new_dialog.item_much("af_electra_moonlight",1) ~= false and
new_dialog.item_much("af_dummy_glassbeads",1) ~= false and
new_dialog.item_much("af_electra_flash",1) ~= false
end

--' отдадим арты Калинину
function vuxod_atp_done()
sak.out_item_namber("af_electra_moonlight",1)
sak.out_item_namber("af_dummy_glassbeads",1)
sak.out_item_namber("af_electra_flash",1)
end

--' получим арт от Зведочёта
function podarok(first_speaker, second_speaker) 
dialogs.relocate_item_section(second_speaker, "af_cry_1","in")
end
-- Akill begin
--' проверим наличие РПГ-7 для Калинина
function kalinin_btr_vzyt_have() 
return sak.have_item_namber("wpn_rpg7",1) ~= false
end
-- Akill end
--' получим М249
function btr_ataka_done(first_speaker, second_speaker) 
	dialogs.relocate_item_section(second_speaker, "af_simbion","in")
	new_dialog.create_items(db.actor,"grenade_f1",5)
end

--' заспавним в лабиринте арты во 2 пещере
function spawn_monolit_to_labirint()
end

--' заспавним арты в 3 пещере Лабиринта
function spawn_art_v_3peshere()
end


-- проверим наличие блокнота часового
function shax_plennik_nayti_have() 
  return sak.have_item_namber( "kod_kamera", 1 )
end


-- отдадим блокнот Шахтёру
function shax_plennik_nayti_done()
  sak.out_item_namber( "kod_kamera", 1 )
end


--' спавним мыло в деревне новисов
function spawn_soap()
local obj = alife():create("soap",vector():set(-217.355,-22.056,-159.123),34720,47)
local obj = alife():create("soap",vector():set(-217.420,-22.096,-159.461),34720,47)
local obj = alife():create("soap",vector():set(-217.588,-22.141,-159.401),34720,47)
end

--' проверим наличие вещей для Фимки
function fima_mulo_nayti_have()
return new_dialog.item_much("af_soul",1) ~= false and
new_dialog.item_much("medkit_scientic",10) ~= false and
new_dialog.item_much("bandage",10) ~= false and
new_dialog.item_much("soap",2) ~= false
end

-- отдадим всё Фиме
function fima_mulo_nayti_done()
  sak.out_item_namber( "af_soul", 1 )
  sak.out_item_namber( "medkit_scientic", 10 )
  sak.out_item_namber( "bandage", 10 )
  amk_utils.out_items({ "soap" })
end

--' спавним шкатулку в Лабиринте и монстриков
function spawn_shkatul()
  alife():create("shkatulka",vector():set(-189.002,52.791,269.950),126910,2987)
  battle.create_enemies(
    {
      { "bloodsucker_normal",vector():set(-190.695,56.187,190.873),125416,2987 },
      { "bloodsucker_normal",vector():set(-190.695,56.187,190.873),125416,2987 },
      { "zombie_weak",vector():set(-190.595,56.187,190.873),125416,2987 },
      { "zombie_strong",vector():set(-190.495,56.187,190.873),125416,2987 },
      { "zombie_normal",vector():set(-190.395,56.187,190.873),125416,2987 },
      { "zombie_normal",vector():set(-190.395,56.187,190.873),125416,2987 },
      { "zombie_normal",vector():set(-190.395,56.187,190.873),125416,2987 },
      { "chimera_normal",vector():set(-179.217,52.310,272.398),132753,2987 },
      { "zombie_normal",vector():set(-179.227,52.310,272.398),132753,2987 },
      { "zombie_normal",vector():set(-179.237,52.310,272.398),132753,2987 },
      { "zombie_normal",vector():set(-179.247,52.310,272.398),132753,2987 },
      { "zombie_normal",vector():set(-179.257,52.310,272.398),132753,2987 },
      { "pseudodog_normal",vector():set(-185.462,56.305,212.259),129613,2987 },
      { "pseudodog_normal",vector():set(-185.462,56.305,212.259),129613,2987 },
      { "pseudodog_normal",vector():set(-185.462,56.305,212.259),129613,2987 },
      { "pseudodog_normal",vector():set(-185.462,56.305,212.259),129613,2987 },
    }
  )
end

--' проверим шкатулку
function adr_shkatulka_dost_have() 
return sak.have_item_namber("shkatulka",1) ~= false
end

--' отдадим шкатулку Адреналину
function adr_shkatulka_dost_done(first_speaker, second_speaker)
sak.out_item_namber("shkatulka",1) 
end

--' заспавним арты во 2 пещере
function spawn_art_2peshera()
end

--' проверим наличие сейфа
function tretiy_kod_dost_have() 
return sak.have_item_namber("arhara_seif",1) ~= false
end

--' отдадим сейф Шахтёру
function tretiy_kod_dost_done(first_speaker, second_speaker)
sak.out_item_namber("arhara_seif",1) 
end

--' Сидор дал амулет
function amulet_gg(first_speaker, second_speaker) 
dialogs.relocate_item_section(second_speaker, "amulet","in") 
end

--' проверим ремящики и амулет для Сидора
function sidor_amulet_vzyt_have()
return new_dialog.item_much("amulet",1) ~= false and
new_dialog.item_much("remontnyi_box",2) ~= false
end

--' отдадим всё Сидору и выправим репу у Свободы (почему-то падает)
function sidor_amulet_vzyt_done()
sak.out_item_namber("amulet",1)
sak.out_item_namber("remontnyi_box",2)
kostya_dialog.stealth_fail_task()
end


--' сделаем ГГ нейтралом
function join_stalker()
  db.actor:set_character_community( "stalker", 0, 0 )
  dsh_amulet_monolith.unsubscribe()
end


-- проверим арты для Тени Монолита
function ten_monolita_talk_have()
  return dsh.actor_has_art_abs()
end

-- отдадим арты Тени Монолита
function ten_monolita_talk_done()
  dsh.actor_give_art_abs()
end


--' заспавним арты сейф и ремящики
function spawn_seif_and_art()
local obj = alife():create("arhara_seif",vector():set(-312.919,57.637,201.125),39214,2987)
local obj = alife():create("remontnyi_box",vector():set(-314.837,52.752,201.776),37730,2987)
local obj = alife():create("remontnyi_box",vector():set(-315.607,52.751,201.822),37259,2987)
local obj = alife():create("ammo_gauss",vector():set(-320.896,64.963,202.912),34595,2987)
local obj = alife():create("ammo_5.56x45_ap",vector():set(-320.936,64.972,201.861),34588,2987)
local obj = alife():create("medkit_scientic",vector():set(-320.814,64.967,204.396),34601,2987)
local obj = alife():create("medkit",vector():set(-320.916,64.968,202.351),34592,2987)
local obj = alife():create("medkit",vector():set(-320.916,64.968,202.351),34592,2987)
local obj = alife():create("ammo_9x39_ap",vector():set(-320.949,64.977,201.543),34588,2987)
local obj = alife():create("ammo_5.45x39_ap",vector():set(-320.960,64.996,201.007),34583,2987)
local obj = alife():create("ammo_og-7b",vector():set(-320.963,65.005,200.770),34583,2987)
end


--' спавним ключ для удал телепорта на входе базы
function spawn_kluch_dell_tele()
  local obj = dsh.create_and_map_treasure(
    game.translate_string( "spawn_kluch_dell_tele_0" ),
    game.translate_string( "spawn_kluch_dell_tele_1" ),
    "kluch_dell_teleport",
    vector():set( 326.871, -6.876, -18.849 ), 1450179, 2902
  )
end


-- спавним телепорт на входе в базу
function spawn_teleport_aver_baza_vxod()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_aver_baza_vxod",
    vector():set( 49.718948364258, -12.917119979858, -192.61256408691 ),
    954225, 2908
  )
  alife():assign_story_id( se_obj.id, story_ids.m_teleport_aver_baza_vxod )
end


-- спавним телепорт на выходе с базы
function spawn_teleport_land_baza_vuxod()
  local se_obj = spawn_teleport.create_teleport("m_teleport_land_baza_vuxod",vector():set(-29.902000427246,-26.615087509155,-159.37490844727),816025,2897)
  alife():assign_story_id( se_obj.id, 17001 )
end

-- спавним телепорт на входе в 3 пещеру НЗ
function spawn_teleport_aver_taynik()
  local se_obj = spawn_teleport.create_teleport("m_teleport_aver_taynik",vector():set(-371.09735107422,43.853530883789,386.16714477539),231029,2887)
  alife():assign_story_id( se_obj.id, 17002 )
end

-- спавним телепорт в Старой деревне
function spawn_teleport_village_plen()
  local se_obj = spawn_teleport.create_teleport("m_teleport_village_plen",vector():set(50.373229980469,4.1041889190674,76.716133117676),28807,3331)
  alife():assign_story_id( se_obj.id, 17004 )
end


-- спавним 1телепорт на ЧАЭС2, на кран
function spawn_teleport_1_chaes2()
  local sobj = spawn_teleport.create_teleport(
    "m_teleport_1_chaes2",
    vector():set( 257.06002807617, 11.381983757019, 193.40171813965 ),
    91155, 2577
  )
  alife():assign_story_id( sobj.id, story_ids.m_teleport_1_chaes2 )
end


-- спавним 2телепорт на ЧАЭС2
function spawn_teleport_2_chaes2()
  local se_obj = spawn_teleport.create_teleport("m_teleport_2_chaes2",vector():set(550.289672851563,80.1041946411133,204.157897949219),171515,2628)
  alife():assign_story_id( se_obj.id, 17012 )
end

-- спавним 3телепорт на ЧАЭС2
function spawn_teleport_3_chaes2()
  local se_obj = spawn_teleport.create_teleport("m_teleport_3_chaes2",vector():set(555.68634033203,112.81456756592,197.65130615234),171515,2628)
  alife():assign_story_id( se_obj.id, 17009 )
end

-- спавним 1телепорт на генераторах
function spawn_teleport_1_generators()
  local se_obj = spawn_teleport.create_teleport("m_teleport_1_generators",vector():set(208.74868774414,28.487440109253,-568.76654052734),576778,3143)
  alife():assign_story_id( se_obj.id, 17010 )
end

-- спавним 2телепорт на генераторах
function spawn_teleport_2_generators()
  local se_obj = spawn_teleport.create_teleport("m_teleport_2_generators",vector():set(198.31147766113,35.846240997314,-561.59136962891),564783,3152)
  alife():assign_story_id( se_obj.id, 17011 )
end

-- спавним телепорт в госпитале наверх слева
function spawn_tele_1_hosp_verh1()
  local se_obj = spawn_teleport.create_teleport("m_teleport_1_hosp_verh1",vector():set(-78.431533813477,25.064765930176,608.98791503906),6000,3049)
  alife():assign_story_id( se_obj.id, 17013 )
end

-- спавним телепорт вход в 3 отсек 
function spawn_teleport_vhod_otsek()
  local se_obj = spawn_teleport.create_teleport("m_teleport_vhod_otsek",vector():set(-94.129028320313,25.804735183716,609.15380859375),1168,3039)
  alife():assign_story_id( se_obj.id, 17014 )
end

-- спавним телепорт блока выхода из 3 отсека у входа 
function spawn_tele_blok_vhod_otsek()
  local se_obj = spawn_teleport.create_teleport("m_teleport_blok_vhod_otsek",vector():set(-102.48352813721,25.163656234741,616.11047363281),232,3029)
  alife():assign_story_id( se_obj.id, 17015 )
end


-- спавним телепорт входа дока на Припяти
function spawn_tele_dok_prip_vxod()
  local se_obj = spawn_teleport.create_teleport("m_teleport_prip_dok_vxod",vector():set(-45.148349761963,1.8893185853958,262.46716308594),54164,2164)
  alife():assign_story_id( se_obj.id, story_ids.m_teleport_prip_dok_vxod )
  dsh.start_on_spawn_another_level( script_name() .. ".remove_tele_dok_prip_vxod" )
end

function remove_tele_dok_prip_vxod()
  local sobj = alife():story_object( story_ids.m_teleport_prip_dok_vxod )
  if sobj then
    dsh_alife.release( sobj )
  end
end


-- спавним телепорт на крыше в Лиманске
function spawn_teleport_limansk_krusha()
  local se_obj = spawn_teleport.create_teleport("m_teleport_limansk_krusha",vector():set(64.565872192383,21.843370437622,253.25939941406),58482,3021)
  alife():assign_story_id( se_obj.id, 17020 )
end


-- спавним телепорт-фото в Саркофаге
function spawn_teleport_sarcof_foto()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_sarcofag_foto",
    vector():set( 23.805717468262, -3.8649611473083, 2.8239929676056 ),
    4684,2424
  )
  alife():assign_story_id( se_obj.id, 17021 )
  se_obj = alife():object( "stalk_semetskiy" )
  if se_obj then
    alife():release( se_obj )
  end
end


-- спавним телепорт над мозгом
function spawn_teleport_nad_mozgom()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_nad_mozgom",
    vector():set( -32.13062286377, 22.806690216064, -12.40500831604 ),
    3079, 1530
  )
  alife():assign_story_id( se_obj.id, story_ids.m_teleport_nad_mozgom )
end

-- телепорт блокир. рычаг в лиме
function spawn_teleport_blok_ruchag()
  local se_obj = spawn_teleport.create_teleport("m_teleport_blok_ruchag",vector():set(-48.450138092041,-10.869502067566,-176.26718139648),2894,2993)
  alife():assign_story_id( se_obj.id, 17023 )
end


-- телепорт входа в секретку подвала в лиме
function spawn_teleport_podval_ok()
  xr_effects.x18_gluk( db.actor )
  dsh.story_sms_timer( 7, script_name() .. ".tele_podval_ok" )
end

-- убираем teleport_podval_ok_restrictor
function tele_podval_ok()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_podval_ok",
    vector():set( -48.472511291504, -11.196914672852, -177.02395629883 ),
    2894, 2993
  )
  alife():assign_story_id( se_obj.id, 17024 )
  local sim = alife()
  local se_obj = sim:story_object( 19038 )
  if se_obj then
    sim:release( se_obj, true )
  end
end


-- телепорт выхода из секретки подвала в лиме
function spawn_teleport_podv_vuxod()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_podv_vuxod",
    vector():set( -49.113014221191, -10.754431724548, -178.7958984375 ),
    3051, 2993
  )
  alife():assign_story_id( se_obj.id, 17025 )
end


-- удаляем телепорты
function delete_teleport_baza_vxod()
  local se_obj = alife():story_object( story_ids.m_teleport_aver_baza_vxod )
  if se_obj then
    alife():release( se_obj )
    news_manager.send_tip(
      db.actor, "delete_teleport_baza_vxod", nil, nil, 30000
    )
  end
  ogse_st_mgr.start_on_signal(
    "arhara_dialog.delete_teleport_baza_vxod2",
    "on_spawn_another_level",
    "arhara_dialog.delete_teleport_baza_vxod2"
  )
end

function delete_teleport_baza_vxod2()
  local sobj = alife():object( "aver_schoolbus" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function checking_taken_item45( obj )
  if obj:section() == "kluch_dell_teleport" then
    dsh.map_remove_treasure_inv( "kluch_dell_teleport" )
    delete_teleport_baza_vxod(obj)
    ogse.remove_item_from_inventory( obj )
  end
  if obj:section()=="wpn_pkm_m1" then
    amk.drop_item( db.actor, obj )
    amk.remove_item( obj )
    amk.spawn_item_in_inv( "wpn_pkm" )
  end
end

function delete_teleport_baza_vuxod(story_id)
local se_obj = alife():story_object(17001)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_teleport_baza_vuxod", nil, nil, 30000)
end
end


function checking_taken_item46( obj )
  if obj:section() == "kluch_dell_teleport1" then
    delete_teleport_baza_vuxod( obj )
    ogse.remove_item_from_inventory( obj )
  end
end


function delete_teleport_taynik(story_id)
local se_obj = alife():story_object(17002)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_teleport_taynik", nil, nil, 20000)
end
end

--' отключим отсроченно рестриктором, а лучше дадим смс
--function checking_taken_item47(obj)
--    if obj:section()=="kluch_dell_teleport2" then delete_teleport_taynik(obj)
-- end
--end


function checking_taken_item47( obj )
  if obj:section() == "kluch_dell_teleport2" then
    sms_otkl_teleport( obj )
  end
end


function sms_otkl_teleport()
  news_manager.send_tip( db.actor, "sms_otkl_teleport", nil, nil, 15000 )
  dsh.story_sms_timer( 1, script_name() .. ".sms_otkl_teleport2" )
end

function sms_otkl_teleport2()
  news_manager.send_tip( db.actor, "sms_otkl_teleport2", nil, nil, 30000 )
  dosye_zvez_spawn()
  db.actor:give_info_portion( "spawn_black_trupak" )
  db.actor:give_info_portion( "black_vstrecha_dosye" )
end


function delete_teleport_plen(story_id)
local se_obj = alife():story_object(17004)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_teleport_plen", nil, nil, 30000)
end
end

function delete_teleport_vhod_otsek(story_id)
local se_obj = alife():story_object(17014)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_teleport_vhod_otsek", nil, nil, 30000)
end
end

function delete_tele_blok_vhod_otsek(story_id)
local se_obj = alife():story_object(17015)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_tele_blok_vhod_otsek", nil, nil, 30000)
end
end

--' получим сейф обратно от Шахтёра
function snova_seif(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "arhara_seif","in") 
end

--' заспавним немного артов на НЗ
function spawn_aver_art1()
end

--' заспавним ящик с оружием
function box_with_weapon_spawn()
alife():create ("box_with_weapon", vector():set(74.500,-43.783,241.980),998932,2899)
end

--' получим сумку для Гинеколога
function take_parcel(first_speaker, second_speaker) 
dialogs.relocate_item_section(second_speaker, "parcel","in") 
end

--' проверим наличие ящика с оружием для Отшельника
function otshelnik_yzik_nayti_have() 
return sak.have_item_namber("box_with_weapon",1) ~= false
end

-- отдадим ящик Отшельнику и получим УЗИ с патронами и глушаком
function otshelnik_yzik_nayti_done(first_speaker, second_speaker)
  sak.out_item_namber( "box_with_weapon", 1 )
  sak.create_items_actor( "ammo_5.45x39_ap", 9 )
  ogse_st_mgr.start_on_signal(
    "dsh.free_land_arhara_sniper",
    "on_spawn_another_level", "dsh.free_land_arhara_sniper"
  )
end

--' удаляем Звездочёта с НЗ
function delete_land_zvezdochet()
  local se_obj = alife():object("land_arhara_zvezdochet")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним ещё немного артов на НЗ
function spawn_aver_art2()
end


-- отдадим сумку и сейф медику
function has_parcel()
  return amk_utils.inventory_search_check({
    -- [ "parcel"      ] = 1,
    [ "arhara_seif" ] = 1,
  })
end

function hasnt_parcel()
  return not has_parcel()
end

function aut_parcel()
  -- sak.out_item_namber( "parcel", 1 )
  sak.out_item_namber( "arhara_seif", 1 )
end


--' заспавним лекарства на Кордоне для Гинеколога
function spawn_medik_lekarstvo()
local obj = alife():create("tabletki_1",vector():set(-166.571,-25.436,-355.526),83083,31)
local obj = alife():create("tabletki_1",vector():set(-166.505,-25.436,-355.355),83083,31)
local obj = alife():create("tabletki_1",vector():set(-166.422,-25.436,-355.300),83083,31)
local obj = alife():create("tabletki_1",vector():set(-166.341,-25.436,-355.283),83083,31)
local obj = alife():create("tabletki_2",vector():set(-166.244,-25.436,-355.316),83749,31)
local obj = alife():create("tabletki_2",vector():set(-166.231,-25.436,-355.447),83749,31)
local obj = alife():create("tabletki_2",vector():set(-166.292,-25.436,-355.622),83083,31)
local obj = alife():create("tabletki_2",vector():set(-166.387,-25.436,-355.658),83083,31)
local obj = alife():create("tabletki_3",vector():set(-166.623,-25.436,-355.636),83083,31)
local obj = alife():create("tabletki_3",vector():set(-166.528,-25.436,-355.599),83083,31)
local obj = alife():create("tabletki_3",vector():set(-165.907,-25.442,-355.554),83749,31)
local obj = alife():create("tabletki_3",vector():set(-166.406,-24.904,-356.780),83083,31)
local obj = alife():create("shpriz",vector():set(-166.603,-24.897,-356.939),83083,31)
local obj = alife():create("shpriz",vector():set(-166.925,-24.904,-356.899),83083,31)
local obj = alife():create("shpriz",vector():set(-166.966,-24.899,-356.982),83083,31)
local obj = alife():create("shpriz",vector():set(-166.797,-24.901,-356.916),83083,31)
local obj = alife():create("shpriz",vector():set(-166.639,-24.900,-356.907),83083,31)
local obj = alife():create("shpriz",vector():set(-166.480,-24.899,-356.897),83083,31)
end


--' проверим наличие медикаментов
function ginekolog_lekarstvo_nayti_have()
  return amk_utils.inventory_search_check({
    [ "shpriz"     ] = 5,
    [ "tabletki_1" ] = 3,
    [ "tabletki_2" ] = 3,
    [ "tabletki_3" ] = 3,
  })
end


--' отдадим медхлам Гинекологу
function ginekolog_lekarstvo_nayti_done()
  amk_utils.out_items({ "shpriz", "tabletki_1", "tabletki_2", "tabletki_3" })
end


--' проверим наличие медикаментов для Циклопа если Гинеколог обиделся
function ziklop_proval()
  return ginekolog_lekarstvo_nayti_have()
end


--' отдадим медхлам Циклопу при провале стелса
function ziklop_otdat_vse()
  ginekolog_lekarstvo_nayti_done()
end


--' проверим наличие 2 аккумул для Жоры
function jora_accumul_have() 
return sak.have_item_namber("akkumulytor",2) ~= false
end

--' отдадим аккум Жорке
function jora_accumul_done()
sak.out_item_namber("akkumulytor",2)
end

--' а это рюкзачок тайника Пилигрима
function new_inventory17()
local se_obj = alife():create("m_inventory_box17", vector():set(144.712,-3.956,-313.140),1121536,2900)
end

--' проверим наличие вещей для Пилигрима
function piligrim_britva_nayti_have()
return new_dialog.item_much("akkumulytor",1) ~= false and
new_dialog.item_much("af_dik_1",1) ~= false and
new_dialog.item_much("af_vyvert_green",1) ~= false and
new_dialog.item_much("britva",1) ~= false
end

--' отдадим причитающиеся Пилигриму и получим часы для Старика и новый ствол с патронами
function piligrim_britva_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("britva",1)
sak.out_item_namber("af_vyvert_green",1)
sak.out_item_namber("af_dik_1",1)
sak.out_item_namber("akkumulytor",1)
dialogs.relocate_item_section(second_speaker, "starik_chasy","in")
end

--' проверим наличие вещей для Пилигрима при неудаче стелса
function piligrim_proval_stels()
return new_dialog.item_much("akkumulytor",1) ~= false and
new_dialog.item_much("af_dik_1",1) ~= false and
new_dialog.item_much("af_vyvert_green",1) ~= false and
new_dialog.item_much("britva",1) ~= false
end

--' проверим наличие финансов при неудаче стелса
function piligrim_have_money_70000(actor,npc)
    return actor:money() > 70000
end

--' отдадим деньги Пилигриму
function piligrim_give_money_70000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,70000,"out")
end

--' проверим наличие часов для Старика
function starik_zadanie_vzyt_have() 
return sak.have_item_namber("starik_chasy",1) ~= false
end

--' отдадим часы
function starik_zadanie_vzyt_done()
sak.out_item_namber("starik_chasy",1)
end

--' удаляем бородатого Пилигрима
function delete_land_piligrim()
  local se_obj = alife():object("piligrim")
  if se_obj then
    alife():release(se_obj, true)
  end
end

-- получим аккумул от Пилигрима
function take_pil_akkum() 
  sak.create_items_actor( "akkumulytor", 2 )
end

--' заспавним ещё немного артов на НЗ
function spawn_aver_art3()
end

--' проверим ультрадетектор для Адреналина
function otsh_pda_nayti_have()
return new_dialog.item_much("detector_elite_john",1) ~= false
end

-- отдадим детектор Адреналину
function otsh_pda_nayti_done()
  sak.out_item_namber( "detector_elite_john", 1 )
  sak.create_items_actor( "wpn_mg42", 1 )
  sak.create_items_actor( "ammo_7.62x51box", 1 )
end


-- проверим 2 эл детектора и арт для Голограмы
function golo_detektor_nayti_have()
  return amk_utils.inventory_search( "detector_elite", 2 )
  --  and dsh.actor_has_art_abs()
end

-- отдадим причитающиеся Голограме
function golo_detektor_nayti_done()
  sak.out_item_namber( "detector_elite", 2 )
  -- dsh.actor_give_art_abs()
end


--' рюкзачок тайника вора
function new_inventory18()
local se_obj = alife():create("m_inventory_box18", vector():set(195.210,-1.436,53.253),339324,384)
end

function otshelnik_sms1()
news_manager.send_tip(db.actor, "otshelnik_sms1", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_22")
end

function adrenalin_sms1()
news_manager.send_tip(db.actor, "adrenalin_sms1", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_9")
end

function medik_sms1()
  news_manager.send_tip(
    db.actor, "medik_sms1", nil, nil, 40000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_6" )
end

--' проверим наличие дискетки
function medik_pribor_1_nayti_have()
return new_dialog.item_much("land_disketka",1) ~= false
end

--' отдадим дискету Гинекологу
function medik_pribor_1_nayti_done()
sak.out_item_namber("land_disketka",1)
end

--' спавним карту Клыка
function spawn_karta()
local obj = alife():create("kluk_karta",vector():set(-407.265,0.946,58.977),167526,2889)
end

--' дискету и арты в Лабиринте
function spawn_trup()
local obj = alife():create("land_disketka",vector():set(-77.331,42.754,469.492),153869,2987)
end

function medik_sms2()
news_manager.send_tip(db.actor, "medik_sms2", nil, nil, 60000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_7")
end


function nekto_sms()
  local snd = news_manager.send_tip(
    db.actor, "nekto_sms", nil, nil, 60000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_10"
  )
  dsh.story_sms_timer( snd, script_name() .. ".nekto_sms2" )
end

function nekto_sms2()
  db.actor:give_info_portion( "medik_pribor_1_karta_start" )
end


--' удаляем раненого монолитовца
function delete_dead_mono()
  local se_obj = alife():object("dead_mono_labirint")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' тайник наёмника
function spawn_kolba_pust()
local se_obj = alife():create("kolba_pustay", vector():set(-367.82,0.595,439.103),68300,1851)
local se_obj = alife():create("kolba_pustay", vector():set(-367.82,0.595,439.103),68300,1851)
local se_obj = alife():create("kolba_pustay", vector():set(-367.82,0.595,439.103),68300,1851)
end

--' удаляем бритого Пилигрима
function delete_piligrim_1()
  local se_obj = alife():object("piligrim_1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие пустых колб
function kolba_pust_est()
return new_dialog.item_much("kolba_pustay",3) ~= false
end

function kolba_karta_est()
  return new_dialog.item_much( "kluk_karta", 1 )
end
function kolba_karta_not()
  return not kolba_karta_est()
end


-- отдадим карту Клыка и пустые колбы Гинекологу
function karta_otdat()
  sak.out_item_namber( "kluk_karta", 1 )
end

function kolba_otdat()
  sak.out_item_namber( "kolba_pustay", 3 )
end


--' Проверим наличие блоков питания и микросхем для перфузора
function akkum_and_mikposx_nayti_have()
return new_dialog.item_much("elek_plata",2) ~= false and
new_dialog.item_much("ekza_akkumul",2) ~= false
end

--' получим карту и её копию и отдадим блоки
function akkum_and_mikposx_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("elek_plata",2)
sak.out_item_namber("ekza_akkumul",2)
dialogs.relocate_item_section(second_speaker, "kluk_karta","in")
dialogs.relocate_item_section(second_speaker, "kluk_karta_kopiy","in")
end

--' спавним аккум для экзы, платы и ключ на выход 
function spawn_plata_and_akkum()
local obj = alife():create("ekza_akkumul", vector():set(28.803,-22.934,-178.421),917014,2897)
local obj = alife():create("ekza_akkumul", vector():set(28.845,-22.935,-178.511),917014,2897)
local obj = alife():create("elek_plata", vector():set(47.349,-20.324,-157.622),950498,2897)
local obj = alife():create("elek_plata", vector():set(47.852,-20.341,-157.487),950498,2897)
local obj = alife():create("kluch_dell_teleport1",vector():set(29.081,-22.875,-178.589),918277,2897)
end

--' ГГ друг снайперов
function friend_community(actor, npc)
db.actor:set_character_community("stranger", 0, 0)
end

-- заберём ключи от телепортов
function kluch_tele_otdat()
  amk_utils.out_items({ "kluch_dell_teleport", "kluch_dell_teleport1" })
end

--' проверим голову
function chimaera_zadan_nayti_have()
return new_dialog.item_much("sidor_head",1) ~= false
end

--' отдадим голову и получим арт
function chimaera_zadan_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("sidor_head",1)
dialogs.relocate_item_section(second_speaker, "gold_art","in")
end


-- Гинеколог дал запчастей денег и спавн перфузора
function shura_otdal( first_speaker, second_speaker )
  sak.create_items_actor( "mutant_chimera_kogot", 5 )
  dialogs.relocate_money( second_speaker, 30000, "in" )
end


function medik_sms3()
news_manager.send_tip(db.actor, "medik_sms3", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_8")
end

--' проверим наличие полных колб для Гинеколога
function ginek_vlip_have()
return new_dialog.item_much("kolba_orand_poln",1) ~= false and
new_dialog.item_much("kolba_siniy_poln",1) ~= false
end

--' отдадим колбы Гинекологу и получим нож хирурга и Сайгу "Снайперскую"
function ginek_vlip_done(first_speaker, second_speaker)
sak.out_item_namber("kolba_orand_poln",1)
sak.out_item_namber("kolba_siniy_poln",1)
dialogs.relocate_item_section(second_speaker, "wpn_knife_n","in")
second_speaker:set_relation(game_object.friend, first_speaker)
end

function ziklop_sms1()
news_manager.send_tip(db.actor, "ziklop_sms1", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_11")
end


--' спавним труп контролёра
function spawn_trupak()
  local obj = dsh.create_and_map_treasure(
    game.translate_string( "spawn_trupak_0" ),
    game.translate_string( "spawn_trupak_1" ),
    "trupak", vector():set( 277.781, -49.943, -110.972 ), 57327, 2089
  )
end


-- проверим наличие трупа для Филина
function land_oxot_nayti_have_trupak()
  return sak.have_item_namber( "trupak", 1 )
end


function land_oxot_nayti_have()
  local res = land_oxot_nayti_have_trupak()
  if res then
    dsh.map_remove_treasure_inv( "trupak" )
  end
  return res
end


-- отдадим труп контролёра Филину
function land_oxot_nayti_done()
  sak.out_item_namber( "trupak", 1 )
end


--' проверим наличие вещей для Филина
function filin_skarb()
return sak.have_item_namber("mutant_chimera_kogot",10) ~= false
end

-- проверим наличие финансов за чучело
function filin_have_money_100000()
    return db.actor:money() > 100000
end
function filin_havent_money_100000()
    return not filin_have_money_100000()
end

--' отдадим когти Филину и заспавним голову Сидора
function filin_kogot(first_speaker, second_speaker)
sak.out_item_namber("mutant_chimera_kogot",10)
end


-- отдадим деньги Филину за чучело
function filin_give_money_100000( t1, t2 )
  local npc = t1
  if npc:id() == db.actor:id() then npc = t2 end
  dialogs.relocate_money( npc, 100000, "out" )
  sak.create_items_actor( "sidor_head", 1 )
end


-- Удалим труп контролёра
function delete_trups()
  for id, sobj in alife():objects() do
    if sobj:section_name() == "trupak" then
      alife():release( sobj )
      break
    end
  end
end


-- удалим пустой перфузор
function delete_perfuz()
  for id, sobj in alife():objects() do
    if sobj:section_name() == "perfuzor_pust" then
      alife():release( sobj )
      break
    end
  end
end


--' последний тайник Циклопа и спавн полного перфузора в виде рюкзака
function new_inventory20()
local se_obj = alife():create("m_inventory_box20", vector():set(-261.508,-22.589,211.521),74263,1789)
local se_obj = alife():create("m_inventory_box38", vector():set(-411.602,0.698,62.837),160046,2889)
end

function kluk_sms1()
news_manager.send_tip(db.actor, "kluk_sms1", nil, nil, 60000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_13")
end


-- отдадим карту Клыку
function karta_otdat1( first_speaker, second_speaker )
  sak.out_item_namber( "kluk_karta", 1 )
end


--' проверим наличие блокнота наёмника
function kluk_vstrecha_have()
return sak.have_item_namber("naem_bloknot",1) ~= false
end

--' отдадим блокнот наёмника Клыку
function kluk_vstrecha_done(first_speaker, second_speaker)
sak.out_item_namber("naem_bloknot",1)
end

--' убираем ненужные труп Костолома с Варлаба
function delete_warlab_trups()
local se_obj = alife():object("warlab_kostolom_dead")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' Вступаем в Монолит
function join_monolith()
  if db.actor then
    db.actor:set_character_community( "monolith", 0, 0 )
    local npc      = alife():object( "labirint_shade_monolit" )
    local goodwill = relation_registry.get_personal_goodwill( npc.id, db.actor:id() )
    if goodwill < 0 then
      relation_registry.set_personal_goodwill( npc.id, db.actor:id(), 0 )
    end
  end
end

function checking_taken_item44( obj )
  if obj:section() == "amulet" then
    join_monolith()
  end
end


--' Вступаем в Наёмники
function join_killer (actor, npc)
if db.actor ~= nil then 
db.actor:set_character_community("killer", 0, 0)
local chkgoodwill = relation_registry.community_goodwill("killer", db.actor:id())
if chkgoodwill < 0 then 
chkgoodwill = chkgoodwill + 300
relation_registry.set_community_goodwill ("killer", db.actor:id(), chkgoodwill)
else
relation_registry.set_community_goodwill ("killer", db.actor:id(), 300)
end
end
end
function checking_taken_item48(obj)
local info=nil
if obj:section()=="amul_naemn" then join_killer(obj)
end
end

--' Вступаем в Свободу
function join_freedom (actor, npc)
--    printf ("ACTOR NOW IN FREEDOM COMMUNITY")
    if db.actor then
       db.actor:set_character_community ("freedom", 0, 0)
    end
--end
end
function checking_taken_item50(obj)
local info=nil
--if obj:section()=="bullion_gild" then join_freedom(obj) -- переводим в Свободу только в самом конце игры
if obj:section()=="bullion_gild" and has_alife_info("snp_rings_have") then join_freedom(obj)
   end
end

--' заспавним фанатиков и наёмников на Варлабе
function spawn_nepis_to_warlab()
  local t = {
    { "pri_monolith_respawn_1",vector():set(5.648,0.741,2.091),5363,3210 },
    { "tank_spawn_zasada1",vector():set(5.648,0.741,2.091),5363,3210 },
    { "pri_monolith_respawn_2",vector():set(6.743,1.004,-1.577),5654,3210 },
    { "tank_spawn_zasada2",vector():set(6.743,1.004,-1.577),5654,3210 },
    { "rad_monolith_respawn_3",vector():set(2.688,1.059,-5.867),4873,3187 },
    { "rad_monolith_respawn_3",vector():set(2.688,1.059,-5.867),4873,3187 },
    { "rad_monolith_respawn_1",vector():set(2.688,1.059,-5.867),4873,3187 },
    { "pri_monolith_respawn_1",vector():set(-2.972,0.379,-3.270),3960,3168 },
    { "pri_monolith_respawn_2",vector():set(-2.972,0.379,-3.270),3960,3168 },
    { "tank_spawn_zasada3",vector():set(-13.204,-3.150,1.400),1830,3168 },
    { "rad_monolith_respawn_1",vector():set(-5.634,1.073,9.869),3224,3171 },
    { "rad_monolith_respawn_1",vector():set(-5.634,1.073,9.869),3224,3171 },
    { "tank_spawn_zasada3",vector():set(-16.708,-3.083,-16.421),1196,3158 },
    { "rad_monolith_respawn_2",vector():set(-16.708,-3.083,-16.421),1196,3158 },
    { "rad_monolith_respawn_3",vector():set(-16.708,-3.083,-16.421),1196,3158 },
    { "pri_monolith_respawn_2",vector():set(14.347,-11.473,-8.145),6669,3212 },
    { "pri_monolith_respawn_1",vector():set(14.347,-11.473,-8.145),6669,3212 },
    { "rad_monolith_respawn_3",vector():set(-3.450,-11.413,-6.176),3782,3181 },
    { "tank_spawn_zasada",vector():set(-3.450,-11.413,-6.176),3782,3181 },
    { "pri_monolith_respawn_2",vector():set(2.568,-11.470,2.541),4895,3188 },
    { "pri_monolith_respawn_2",vector():set(2.568,-11.470,2.541),4895,3188 },
    { "tank_spawn_zasada1",vector():set(15.654,-11.415,-0.020),6905,3209 },
    { "rad_monolith_respawn_1",vector():set(0.708,-7.310,-6.948),4524,3182 },
    { "rad_monolith_respawn_2",vector():set(-0.106,-3.150,4.517),4452,3196 },
  }
  dsh.shuffle( t )
  for i = 1, math.floor( table.getn( t ) / 2 ) do
    dsh.create_free_mob( unpack( t[ i ] ) )
  end
  t = {
    { "mil_killer_respawn_2",vector():set(16.459,1.199,-2.748),7009,3216 },
    { "mil_killer_respawn_1",vector():set(16.459,1.199,-2.748),7009,3216 },
    { "mil_killer_respawn_2",vector():set(-1.101,1.010,0.302),4184,3187 },
    { "mil_killer_respawn_3",vector():set(-12.934,1.001,3.860),1956,3162 },
    { "ros_killer_respawn_2",vector():set(-10.352,-7.043,-32.332),2224,3170 },
    { "ros_killer_respawn_1",vector():set(-10.352,-7.043,-32.332),2224,3170 },
    { "ros_killer_respawn_2",vector():set(-10.352,-7.043,-32.332),2224,3170 },
    { "ros_killer_respawn_1",vector():set(-37.230,-11.944,-36.897),143,3155 },
    { "ros_killer_respawn_3",vector():set(-37.265,-12.052,-62.219),107,3153 },
    { "mil_killer_respawn_1",vector():set(-15.675,-1.421,-33.730),1393,3164 },
    { "mil_killer_respawn_2",vector():set(-13.429,-15.390,6.870),1852,3160 },
    { "mil_killer_respawn_3",vector():set(-13.429,-15.390,6.870),1852,3160 },
    { "ros_killer_respawn_3",vector():set(6.449,-15.416,17.305),5580,3189 },
    { "ros_killer_respawn_2",vector():set(9.509,-19.704,10.085),6118,3204 },
    { "ros_killer_respawn_2",vector():set(-3.896,-7.313,0.398),3598,3172 },
    { "ros_killer_respawn_3",vector():set(-3.896,-7.313,0.398),3598,3172 },
    { "ros_killer_respawn_3",vector():set(2.706,-3.150,6.640),4903,3178 },
  }
  dsh.shuffle( t )
  for i = 1, math.floor( table.getn( t ) / 2 ) do
    dsh.create_free_mob( unpack( t[ i ] ) )
  end
end

--' спавним телепорт на входе в секретку Варлаба
function spawn_teleport_warlab_taynik()
  local se_obj = spawn_teleport.create_teleport("m_teleport_warlab_sekret",vector():set(18.836868286133,-3.1513543128967,0.90203523635864),7161,3217)
  alife():assign_story_id( se_obj.id, 17003 )
end

--' удаляем телепорт на входе в секретку Варлаба
function delete_teleport_warlab(story_id)
local se_obj = alife():story_object(17003)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_teleport_warlab", nil, nil, 40000)
end
end

function checking_taken_item49(obj)
    if obj:section()=="kluch_dell_teleport_warlab" then
		delete_teleport_warlab(obj)
 		amk.remove_item_from_inventory_by_name("kluch_dell_teleport_warlab",db.actor)
end
end

--' проверим наличие псевдопечатки
function proverim_pseudo()
	return sak.have_item_namber("pseudopechatka",1) ~= false
end

--' проверим наличие печатки наёмника
function lukash_pechatka_nayti_have()
return sak.have_item_namber("amul_naemn",1) ~= false
  end

--' отдадим псевдопечатку Лукашу
function lukash_pechatka_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("pseudopechatka",1)
end

--' заспавним болотных тварей рестриктором
function spawn_bolot_tv()
  battle.create_enemies(
    {
      { "bloodsucker_normal",vector():set(4.587,-19.703,6.885),5252,3195 },
      { "bloodsucker_normal",vector():set(-0.755,-19.646,16.467),4380,3180 },
    }
  )
  -- news_manager.send_tip(db.actor, "spawn_bolot_tv", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_59")
end

--' Удаляем Клыка и Пилигрима с АС
function delete_stalky_as()
local se_obj = alife():object("kluk_sklad")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("piligrim_sklad")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие рации
function pantera_fone_nayti_have()
	return sak.have_item_namber("telefon",1) ~= false
end

--' отдадим рацию Пантере и получим бабки
function pantera_fone_nayti_done(first_speaker, second_speaker)
sak.out_item_namber("telefon",1)
dialogs.relocate_money(second_speaker, 5000, "in")
end

--' отдадим рацию Пантере при провале квеста
function pantera_fone_nenashel(first_speaker, second_speaker)
sak.out_item_namber("telefon",1)
end

--' проверим наличие диска для Пантеры
function pantera_zadanie2_have()
	return sak.have_item_namber("disk_pantera",1) ~= false
end

--' отдадим диск Пантере и получим бабки
function pantera_zadanie2_done(first_speaker, second_speaker)
sak.out_item_namber("disk_pantera",1)
dialogs.relocate_money(second_speaker, 60000, "in")
end

--' проверим наличие финансов для Пантеры при провале квеста
function pantera_have_money_50000(actor,npc)
    return actor:money() > 250000
end

--' отдадим диск Пантере 
function pantera_disk_proval(first_speaker, second_speaker)
sak.out_item_namber("disk_pantera",1)
end

--' отдадим деньги Пантере при провале квеста
function pantera_give_money_50000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,250000,"out")
end

--' проверим наличие чучела
function body_pantera_talk_have()
	return sak.have_item_namber("chuchelo_body",1) ~= false
end

--' отдадим чучело
function body_pantera_talk_done(first_speaker, second_speaker)
sak.out_item_namber("chuchelo_body",1)
end

-- спавним рюкзачок для задания Пантеры на АС и чучело и возьмём маскхалат
function new_inventory21()
  alife():create( "m_inventory_box21", vector():set(-26.052833557129,-6.3251914978027,-20.990715026855),285446,1593 )
  -- alife():create( "chuchelo_body", vector():set(-24.04415512085,-4.1141719818115,-26.763397216797),283374,1593 )
end

-- проверим наличие маскхалата и суперската
function pantera_zadanie3_have()
  return new_dialog.item_much( "exo_mil_exoskeleton", 1 ) ~= false
end

-- отдадим броники Пантере и получим бабки
function pantera_zadanie3_done( first_speaker, second_speaker )
  sak.out_item_namber( "exo_mil_exoskeleton", 1 )
  dialogs.relocate_money( second_speaker, 10000, "in" )
end

--' Удаляем Пантеру и телохранителей
function delete_pant_warl()
local se_obj = alife():object("pantera")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("bodi_pantera1")
  if se_obj then
    alife():release(se_obj, true)
end
local se_obj = alife():object("bodi_pantera2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' босс забрал печатку и спавн новой и спавн наёмников босса
function zabral_gad_pechatku(first_speaker, second_speaker)
sak.out_item_namber("amul_naemn",1)
dialogs.relocate_item_section(second_speaker, "pseudopechatka","in")
end

--function zvezd_sms_karta()
--news_manager.send_tip(db.actor, "zvezd_sms_karta", nil, nil, 60000)
--end


-- телохран Пантеры дал арт на прощание и свой ствол
function body_dal_art()
  sak.create_items_actor( "af_kol_3", 1 )
  sak.create_items_actor( "ammo_7.62x51_ap", 5 )
end


--' получим Булыжники от Голограмы
function gologr_tehnik_done()
  sak.create_items_actor( "af_buliz.af_bio", 2 )
end


--' тайник Циклопа после Варлаба
function new_inventory22()
local se_obj = alife():create("m_inventory_box22", vector():set(-39.015,10.378,31.830),148276,295)
end

function kanal_sms()
news_manager.send_tip(db.actor, "kanal_sms", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_117")
end

function kanal_sms1()
news_manager.send_tip(db.actor, "kanal_sms1", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_118")
end

--' Удаляем Пантеру-нейтралку телохранителей Голограму и босса
function del_pant_neytral_warl()
local se_obj = alife():object("pantera_new")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("body1_pantera_new")
  if se_obj then
    alife():release(se_obj, true)
end
local se_obj = alife():object("body2_pantera_new")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("warlab_boss")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Удаляем старого Голограму с НЗ
function del_gol_old()
local se_obj = alife():object("land_lazaret_stalker2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Удаляем нового Голограму с НЗ
function del_tehnik_gol()
local se_obj = alife():object("tehnik_golograma")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие булыжников и Сердца полтерг
function klenov_vse_ok_have()
return new_dialog.item_much("af_buliz",10) ~= false and
new_dialog.item_much("af_part_monolit",1) ~= false
end

--' отдадим их Клёнову
function klenov_vse_ok_done(first_speaker, second_speaker)
sak.out_item_namber("af_part_monolit",1)
sak.out_item_namber("af_buliz",10)
end

function pant_zveri_sms()
    news_manager.send_tip(db.actor, "pant_zveri_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_14")
end

--' убираем Витамина со складов
function delete_vitaminsklad()
local se_obj = alife():object("military_vitamin")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Удаляем Клыка и Пилигрима с НЗ рестриктором
function delete_stalky_nz()
local se_obj = alife():object("stalk_kluk")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("piligrim_2")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' получим золото и ключ от телепорта у Витамина
function vitamin_reyd_zadan_done( first_speaker, second_speaker )
  dialogs.relocate_item_section( second_speaker, "bullion_gild", "in" ) 
  dialogs.relocate_item_section(
    second_speaker, "kluch_dell_teleport_warlab", "in"
  )
  second_speaker:set_relation( game_object.friend, first_speaker )
  news_manager.send_tip(
    db.actor, "vitamin_reyd_zadan_done_0", nil, nil, 40000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_136"
  )
  -- news_manager.send_tip(
  --   db.actor, "vitamin_reyd_zadan_done_1", nil, nil, 15000
  -- )
end



--' убираем свободовцев с Радара
function delete_svoboda_radars()
local se_obj = alife():object("radar_vitamin")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd3")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd4")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd5")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd6")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd7")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd8")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd9")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("radar_svoboda_reyd10")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- проверим наличие фальшивой карты Клыка
function zv_kopiy()
  return sak.have_item_namber( "kluk_karta_kopiy", 1 ) ~= false
end

function zv_no_kopiy()
  return not zv_kopiy()
end


-- отдадим фальшифку Звездочёту
function falshivka_otdat()
  sak.out_item_namber( "kluk_karta_kopiy", 1 )
  dsh.story_sms_timer( 10, script_name() .. ".kluk_sms_pili_lovushka" )
end


--' тайник с телефоном Пантеры
function new_inventory23()
local se_obj = alife():create("m_inventory_box23", vector():set(7.256,-6.525,-12.801),5624,3202)
end


-- получим танто и именной АК-74 от Клыка
function tanto_dal()
  sak.create_items_actor( "wpn_knif2", 1 )
end


--' проверим наличие финансов для кидалы
function bablo_razvod(actor,npc)
    return actor:money() > 70000
end

--' отдадим деньги кидале
function kidalovo(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,70000,"out")
end

--' Сидор дал преобразователь артов и дробовик
function apteka_otdal(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker,"det_artefact_indy","in")
dialogs.relocate_item_section(second_speaker,"wpn_usas12","in")
dialogs.relocate_item_section(second_speaker,"ammo_12x70_kart","in")
dialogs.relocate_item_section(second_speaker,"medkit","in")
end

--' убираем кидалу
function delete_kidalo()
local se_obj = alife():object("esc_kidalo")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Рестрикторные СМС
function band_yantar_sms()
    news_manager.send_tip(db.actor, "band_yantar_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_61")
end
function razvod_sms()
    news_manager.send_tip(db.actor, "razvod_sms", nil, nil, 45000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_108")
end
function gar_naemn_grup1_sms()
    news_manager.send_tip(db.actor, "gar_naemn_grup1_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_137")
end


function dark_btr1_sms()
  news_manager.send_tip( db.actor, "dark_btr1_sms", nil, nil, 20000 )
  -- Звуковое сопровождение
  --local snd_obj = xr_sound.get_safe_sound_object("characters_voice\\human_03\\stalker\\talk\\leave\\leave_62")
  --snd_obj:play(db.actor, 0, sound_object.s2d)
end


function dark_sidor_sms()
    news_manager.send_tip(db.actor, "dark_sidor_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_29")
end
function garbage_adren_sms()
    news_manager.send_tip(db.actor, "garbage_adren_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_12")
end
function lysyi_sms()
    news_manager.send_tip(db.actor, "lysyi_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_63")
end
function art_negoden_sms()
    news_manager.send_tip(db.actor, "art_negoden_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_42")
end
function art_negoden_sms1()
    news_manager.send_tip(db.actor, "art_negoden_sms1", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_61")
end
function pant_kord_sms1()
    news_manager.send_tip(db.actor, "pant_kord_sms1", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_51")
end
function dolbannn_sms()
    news_manager.send_tip(db.actor, "dolbannn_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_64")
end
function sidor_piyn_sms()
    news_manager.send_tip(db.actor, "sidor_piyn_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_138")
end


function kluk_sms3()
  news_manager.send_tip(
    db.actor, "kluk_sms3", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_25"
  )
end


function gg_sms1()
  local snd = news_manager.send_tip(
    db.actor, "gg_sms1", nil, nil, 5000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_52", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_sms3" )
end


function kluk_sms2()
    news_manager.send_tip(db.actor, "kluk_sms2", nil, nil, 60000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_26")
end
function yan_sms_barmen()
    news_manager.send_tip(db.actor, "yan_sms_barmen", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_24")
end
function yan_barmen_otvet()
    news_manager.send_tip(db.actor, "yan_barmen_otvet", nil, nil, 40000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_65")
end


function plen_sms()
  dsh.story_sms_timer( 5, script_name() .. ".plen_sms2" )
end

function plen_sms2()
  news_manager.send_tip(
    db.actor, "plen_sms2", nil, nil, 40000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_23"
  )
end


function village_sms_kapitan()
  dsh.story_sms_timer( 5, script_name() .. ".village_sms_kapitan2" )
end

function village_sms_kapitan2()
  news_manager.send_tip(
    db.actor, "village_sms_kapitan2", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_66"
  )
end


function village_sms_pantera()
  news_manager.send_tip(
    db.actor, "village_sms_pantera", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_40"
  )
end


function village_pantera_otvet()
  dsh.story_sms_timer( 10, script_name() .. ".village_pantera_otvet2" )
end

function village_pantera_otvet2()
  news_manager.send_tip(
    db.actor, "village_pantera_otvet2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_52",
    true
  )
  set_pantera()
  delete_chel_village()
  db.actor:give_info_portion( "marsh_pantera_find" )
  dsh.story_sms_timer( 40, script_name() .. ".strelok_kluk_vopros1" )
end

function strelok_kluk_vopros1()
  news_manager.send_tip(
    db.actor, "strelok_kluk_vopros1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_51", true
  )
  dsh.story_sms_timer( 40, script_name() .. ".kluk_perexod_derevny" )
end

function kluk_perexod_derevny()
  news_manager.send_tip(
    db.actor, "kluk_perexod_derevny", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_27"
  )
  db.actor:give_info_portion( "boloto_provod_spawn" )
  metka_marsh_provodnik()
end


function village_sms_obsledovanie()
  news_manager.send_tip(
    db.actor, "village_sms_obsledovanie", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_48"
  )
end


function kolm_stroy_sms()
  news_manager.send_tip(
    db.actor, "kolm_stroy_sms", nil, nil, 30000
    -- , nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_67"
  )
end


function sms_pobeda()
  news_manager.send_tip(
    db.actor, "sms_pobeda", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_68"
  )
end


function kluk_sms_pili_lovushka()
  news_manager.send_tip(
    db.actor, "kluk_sms_pili_lovushka", nil, nil, 40000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_28"
  )
  sak.add_new_military_to_earth()
  db.actor:give_info_portion( "village_piligrim_find" )
end


function vill_klenov_sms()
  dsh.story_sms_timer( 10, script_name() .. ".vill_klenov_sms1" )
end

function vill_klenov_sms1()
  if
    db.actor:has_info( "derevny_zashita_done" )
    and db.actor:has_info( "black_doctor_finish_dialog" )
  then
    local snd = news_manager.send_tip(
      db.actor, "vill_klenov_sms1", nil, nil, 30000, nil,
      "characters_voice\\human_03\\stalker\\talk\\leave\\leave_69", true
    )
    dsh.story_sms_timer( snd, script_name() .. ".vill_klenov_sms2" )
    warl_kolmogor_sms()
  end
end

function vill_klenov_sms2()
  db.actor:give_info_portion( "klenov_antena_find" )
end


function warl_kolmogor_sms()
  ogse_st_mgr.start_on_signal(
    script_name() .. ".warl_kolmogor_sms",
    "on_spawn_another_level_warlab",
    script_name() .. ".warl_kolmogor_sms2"
  )
end

function warl_kolmogor_sms2()
  db.actor:give_info_portion( "village_after_razborka" )
  dsh.story_sms_timer( 10, script_name() .. ".warl_kolmogor_sms3" )
end

function warl_kolmogor_sms3()
  delete_vill_pantera()
  local snd = news_manager.send_tip(
    db.actor, "warl_kolmogor_sms3", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_70", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".warl_gg_pili_sms" )
end

function warl_gg_pili_sms()
  local snd = news_manager.send_tip(
    db.actor, "warl_gg_pili_sms", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_38", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".warl_pili_gg_otvet_sms" )
end

function warl_pili_gg_otvet_sms()
  news_manager.send_tip(
    db.actor, "warl_pili_gg_otvet_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_71"
  )
end


function agro_torgash_sms()
news_manager.send_tip(db.actor, "agro_torgash_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_128")
end


function otsroch_sms()
  local snd = news_manager.send_tip(
    db.actor, "otsroch_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_53", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pili_zayti_after_antenna_sms" )
end

function pili_zayti_after_antenna_sms()
  news_manager.send_tip(
    db.actor, "pili_zayti_after_antenna_sms", nil, nil, 30000
  )
  dsh.story_sms_timer( 10, script_name() .. ".pili_zayti_after_antenna_sms2" )
end

function pili_zayti_after_antenna_sms2()
  news_manager.send_tip(
    db.actor, "pili_zayti_after_antenna_sms2", nil, nil, 30000
  )
  dsh.story_sms_timer( 10, script_name() .. ".pili_zayti_after_antenna_sms3" )
end

function pili_zayti_after_antenna_sms3()
  news_manager.send_tip(
    db.actor, "pili_zayti_after_antenna_sms3", nil, nil, 30000
  )
  dsh.story_sms_timer( 10, script_name() .. ".pili_zayti_after_antenna_sms4" )
end

function pili_zayti_after_antenna_sms4()
  news_manager.send_tip(
    db.actor, "pili_zayti_after_antenna_sms4", nil, nil, 30000
  )
  db.actor:give_info_portion( "sey_after_pobeg_start" )
  dsh.story_sms_timer( 10, script_name() .. ".dell_new_prizrak" )
end


-- убираем Призрака с radara
function dell_new_prizrak()
  db.actor:give_info_portion( "spawn_prizrak_na_chaes1" )
  local se_obj = alife():object( "new_prizrak" )
  if se_obj then
    alife():release( se_obj, true )
  end
  dsh.story_sms_timer( 10, script_name() .. ".gg_black_doc_sms1" )
end

function gg_black_doc_sms1()
  local snd = news_manager.send_tip(
    db.actor, "gg_black_doc_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_26", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".gg_black_doc_sms2" )
end


function gg_black_doc_sms2()
  local snd = news_manager.send_tip(
    db.actor, "gg_black_doc_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_24", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".gg_black_doc_sms3" )
end


function gg_black_doc_sms3()
  local snd = news_manager.send_tip(
    db.actor, "gg_black_doc_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_53", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".gg_black_doc_sms4" )
end


function gg_black_doc_sms4()
  local snd = news_manager.send_tip(
    db.actor, "gg_black_doc_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_29", true
  )
  if db.actor:has_info( "sar_monolith_destroy" ) then
    dsh.story_sms_timer( snd, script_name() .. ".gg_black_doc_sms5" )
  end
end


function gg_black_doc_sms4_1()
  if db.actor:dont_has_info( "spawn_prizrak_na_chaes1" ) then return end
  ogse_st_mgr.start_on_signal(
    script_name() .. ".gg_black_doc_sms4_2",
    "on_spawn_another_level",
    script_name() .. ".gg_black_doc_sms4_2"
  )
end


function gg_black_doc_sms4_2()
  dsh.story_sms_timer( 10, script_name() .. ".gg_black_doc_sms5" )
end


function gg_black_doc_sms5()
  news_manager.send_tip(
    db.actor, "gg_black_doc_sms5", nil, nil, 30000
    --nil, nil, 30000, nil,
    --"characters_voice\\human_03\\stalker\\talk\\leave\\leave_72", true
  )
  dsh.story_sms_timer( 10, script_name() .. ".gg_black_doc_sms6" )
end


function gg_black_doc_sms6()
  local snd = news_manager.send_tip(
    db.actor, "gg_black_doc_sms6", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_62"
  )
  db.actor:give_info_portion( "prizrak_chaes_say_find" )
end


function sms_ubit_glavar_timer()
  ogse_st_mgr.start_timer(
    "arhara_dialog.sms_ubit_glavar",
    230,
    "arhara_dialog.sms_ubit_glavar"
  )
end

function sms_ubit_glavar()
  news_manager.send_tip(db.actor, "sms_ubit_glavar", nil, nil, 35000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_73")
end


function actor_trup_sms()
news_manager.send_tip(db.actor, "actor_trup_sms", nil, nil, 35000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_75")
end
function sms_uchenuy_pobeg()
news_manager.send_tip(db.actor, "sms_uchenuy_pobeg", nil, nil, 35000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_76")
end
function pipets_vert_zadanie_sms()
news_manager.send_tip(db.actor, "pipets_vert_zadanie_sms", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_77")
end
function hit_heli_hit_sms1()
news_manager.send_tip(db.actor, "hit_heli_hit_sms1", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_130")
end
function hit_heli_hit_sms2()
news_manager.send_tip(db.actor, "hit_heli_hit_sms2", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_126")
end
function hit_heli_hit_sms3()
news_manager.send_tip(db.actor, "hit_heli_hit_sms3", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_127")
end
function hit_heli_hit_sms4()
news_manager.send_tip(db.actor, "hit_heli_hit_sms4", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_128")
end
function hit_heli_hit_sms5()
news_manager.send_tip(db.actor, "hit_heli_hit_sms5", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_129")
end
function sms_frits1()
news_manager.send_tip(db.actor, "sms_frits1", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_78")
end
function sms_frits2()
news_manager.send_tip(db.actor, "sms_frits2", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_79")
end
function sms_frits3()
news_manager.send_tip(db.actor, "sms_frits3", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_80")
end
function sms_frits4()
news_manager.send_tip(db.actor, "sms_frits4", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_81")
end
function sms_frits5()
news_manager.send_tip(db.actor, "sms_frits5", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_82")
end
function sms_doc_letit()
news_manager.send_tip(db.actor, "sms_doc_letit", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_134")
end


function dok_ot_andersena_letit()
  dsh.story_sms_timer( 1, script_name() .. ".dok_ot_andersena_letit2" )
end

function dok_ot_andersena_letit2()
  local snd = news_manager.send_tip(
    db.actor, "dok_ot_andersena_letit2", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_121", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_ot_andersena_letit3" )
end

function dok_ot_andersena_letit3()
  db.actor:give_info_portion( "dok_ot_andersena_vuhod" )
end


function sekretnuy_vuhod_sms()
  local snd = news_manager.send_tip(
    db.actor, "sekretnuy_vuhod_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_46", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sekretnuy_vuhod_sms1" )
end

function sekretnuy_vuhod_sms1()
  news_manager.send_tip(
    db.actor, "sekretnuy_vuhod_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_37"
  )
end


function boloto_sms_k_doku()
  local snd = news_manager.send_tip(
    db.actor, "boloto_sms_k_doku", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_58", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_ot_doka_o_verte" )
end

function sms_ot_doka_o_verte()
  news_manager.send_tip(
    db.actor, "sms_ot_doka_o_verte", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_140"
  )
  db.actor:give_info_portion( "mozmo_topat" )
end


function sms_boloto_k_prizraku()
  local snd = news_manager.send_tip(
    db.actor, "sms_boloto_k_prizraku", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_32", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_boloto_ot_prizraka" )
end

function sms_boloto_ot_prizraka()
  news_manager.send_tip(
    db.actor, "sms_boloto_ot_prizraka", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_83"
  )
end


function sms_70m_vert()
  news_manager.send_tip(
    db.actor, "sms_70m_vert", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_131"
  )
end

function letchik_sms1()
  local snd = news_manager.send_tip(
    db.actor, "letchik_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_132", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".rugan_gg_sms" )
end

function rugan_gg_sms()
  news_manager.send_tip(
    db.actor, "rugan_gg_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_65"
  )
  db.actor:give_info_portion( "udav_prytsy" )
end

function letchik_sms2()
  news_manager.send_tip(
    db.actor, "letchik_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_133"
  )
end

function udav_v_vert_sms()
  news_manager.send_tip(
    db.actor, "udav_v_vert_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_25"
  )
end

function sms_udav_sel()
  news_manager.send_tip(
    db.actor, "sms_udav_sel", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_84"
  )
end

function marsh_udav_pogib()
news_manager.send_tip(db.actor, "marsh_udav_pogib", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_59")
end


function udav_antenna_sms1()
  news_manager.send_tip(
    db.actor, "udav_antenna_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_85"
  )
end

function udav_antenna_sms2()
  local snd = news_manager.send_tip(
    db.actor, "udav_antenna_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_86", true
  )
  local t = snd:length() / 1000 + 5
  dsh.story_sms_timer( t, script_name() .. ".udav_antenna_sms3" )
end

function udav_antenna_sms3()
  local snd = news_manager.send_tip(
    db.actor, "udav_antenna_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_87", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".udav_antenna_sms4" )
end

function udav_antenna_sms4()
  db.actor:give_info_portion( "udav_pabota_done" )
  news_manager.send_tip(
    db.actor, "udav_antenna_sms4", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_35"
  )
end


function priz_bomz_sms()
  news_manager.send_tip(
    db.actor, "priz_bomz_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_34"
  )
end


function fritz_shturm_mat()
  local snd = news_manager.send_tip(
    db.actor, "fritz_shturm_mat", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_88", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".fritz_shturm_mat1" )
end

function fritz_shturm_mat1()
  local snd = news_manager.send_tip(
    db.actor, "fritz_shturm_mat1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_33", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".black_heli_sms" )
end

function black_heli_sms()
  local snd = news_manager.send_tip(
    db.actor, "black_heli_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_120"
  )
  db.actor:give_info_portion( "predesant_black_heli" )
end


function solvador_sms1()
  news_manager.send_tip(
    db.actor, "solvador_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_89"
  )
end


function ne_strelyt()
  news_manager.send_tip(
    db.actor, "ne_strelyt", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_45"
  )
end


function mu_opozdaly()
  local snd = news_manager.send_tip(
    db.actor, "mu_opozdaly", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_175", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mu_opozdaly1" )
end

function mu_opozdaly1()
  local snd = news_manager.send_tip(
    db.actor, "mu_opozdaly1", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_122", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mu_opozdaly2" )
end

function mu_opozdaly2()
  news_manager.send_tip(
    db.actor, "mu_opozdaly2", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_123"
  )
  db.actor:give_info_portion( "qwest_priz_shturm_proval" )
end


function boy_sms1()
  local snd = news_manager.send_tip(
    db.actor, "boy_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_90", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".boy_sms2" )
end

function boy_sms2()
  local snd = news_manager.send_tip(
    db.actor, "boy_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_91", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".boy_sms2_1" )
end

function boy_sms2_1()
  local snd = news_manager.send_tip(
    db.actor, "boy_sms2_1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_63", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".boy_sms3" )
end

function boy_sms3()
  local snd = news_manager.send_tip(
    db.actor, "boy_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_92"
  )
end


function plan_zahvata_sms1()
  local snd = news_manager.send_tip(
    db.actor, "plan_zahvata_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_36", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".plan_zahvata_sms2" )
end

function plan_zahvata_sms2()
  news_manager.send_tip(
    db.actor, "plan_zahvata_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_93"
  )
end


function podgotovka_zahvata_sms1()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_57", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms2" )
end

function podgotovka_zahvata_sms2()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_28", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms3" )
end

function podgotovka_zahvata_sms3()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_109", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms4" )
end

function podgotovka_zahvata_sms4()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_94", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms5" )
end

function podgotovka_zahvata_sms5()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_66", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms6" )
end

function podgotovka_zahvata_sms6()
  local snd = news_manager.send_tip(
    db.actor, "podgotovka_zahvata_sms6", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_96", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".podgotovka_zahvata_sms7" )
end

function podgotovka_zahvata_sms7()
  dell_frits()
  del_baza_doza_timer()
  news_manager.send_tip( db.actor, "podgotovka_zahvata_sms7", nil, nil, 30000 )
  db.actor:give_info_portion( "spawn_ubludky" )
  db.actor:give_info_portion( "priz_shturm_say1_start" )
end


function mat_sms1()
news_manager.send_tip(db.actor, "mat_sms1", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_134")
end
function sms_ponyl()
news_manager.send_tip(db.actor, "sms_ponyl", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_97")
end


function sms_spasibo_frits1()
  delete_pebyta_after_proval()
  local snd = news_manager.send_tip(
    db.actor, "sms_spasibo_frits1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_27", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_spasibo_frits2" )
end

function sms_spasibo_frits2()
  local snd = news_manager.send_tip(
    db.actor, "sms_spasibo_frits2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_98", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sapsan_ulet_sms" )
end

function sapsan_ulet_sms()
  db.actor:give_info_portion( "uhozu_na_bazu" )
  news_manager.send_tip(
    db.actor, "sapsan_ulet_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_30"
  )
  db.actor:give_info_portion( "vert_panter_otlet" )
  db.actor:give_info_portion( "spawn_gen_black_gulag" )
  delete_frits2()
end


function dok_podvox_sms1()
  dsh.story_sms_timer( 10, script_name() .. ".dok_podvox_sms1_1" )
end

function dok_podvox_sms1_1()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms1_1", nil, "doctor_black", 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_124", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms2" )
end

function dok_podvox_sms2()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_60", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms3" )
end

function dok_podvox_sms3()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms3", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_125", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms4" )
end

function dok_podvox_sms4()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_49", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms5" )
end

function dok_podvox_sms5()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms5", nil, "doctor_black", 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_126", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms6" )
end

function dok_podvox_sms6()
  local snd = news_manager.send_tip(
    db.actor, "dok_podvox_sms6", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_30", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dok_podvox_sms7" )
end

function dok_podvox_sms7()
  db.actor:give_info_portion( "kluch_dell_teleport2_find" )
end


function dok_trupak_sms()
  news_manager.send_tip(
    db.actor, "dok_trupak_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_56", true
  )
end


function idu_na_nz_sms1()
  dsh.story_sms_timer( 10, script_name() .. ".idu_na_nz_sms1_1" )
end

function idu_na_nz_sms1_1()
  local snd = news_manager.send_tip(
    db.actor, "idu_na_nz_sms1_1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_31", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".idu_na_nz_sms2" )
end

function idu_na_nz_sms2()
  local snd = news_manager.send_tip(
    db.actor, "idu_na_nz_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_99", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".idu_na_nz_sms3" )
end

function idu_na_nz_sms3()
  local snd = news_manager.send_tip(
    db.actor, "idu_na_nz_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_54", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".idu_na_nz_sms4" )
end

function idu_na_nz_sms4()
  db.actor:give_info_portion( "peshera_nz_poisk" )
  news_manager.send_tip(
    db.actor, "idu_na_nz_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_31"
  )
  local sobj = alife():object( "aver_sekret_nashel_restrictor" )
  if sobj then
    local text = "idu_na_nz_sms4_1"
    dsh.map_add_treasure( sobj.id, "treasure", text )
  end
  delete_kluk_bar()
end


function peshera_naydena_sms1()
  local snd = news_manager.send_tip(
    db.actor, "peshera_naydena_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_50", true
  )
  local sobj = alife():object( "aver_sekret_nashel_restrictor" )
  if sobj then
    dsh.map_remove_treasure( sobj.id )
  end
  dsh.story_sms_timer( snd, script_name() .. ".peshera_naydena_sms2" )
end

function peshera_naydena_sms2()
  news_manager.send_tip(
    db.actor, "peshera_naydena_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_32"
  )
end


function kluk_na_meste_sms1()
  news_manager.send_tip(
    db.actor, "kluk_na_meste_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_44"
  )
end


function kluk_shuher_sms1()
  local snd = news_manager.send_tip(
    db.actor, "kluk_shuher_sms1", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_33", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_shuher_sms2" )
end

function kluk_shuher_sms2()
  local snd = news_manager.send_tip(
    db.actor, "kluk_shuher_sms2", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_64", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_shuher_sms3" )
end

function kluk_shuher_sms3()
  news_manager.send_tip(
    db.actor, "kluk_shuher_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_34"
  )
  db.actor:give_info_portion( "vert_aver_pantera" )
end


function na_predesant_sms()
  news_manager.send_tip(
    db.actor, "na_predesant_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_35"
  )
end


function posadka_pant_sms1()
  local snd = news_manager.send_tip(
    db.actor, "posadka_pant_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_36", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".posadka_pant_sms2" )
end

function posadka_pant_sms2()
  local snd = news_manager.send_tip(
    db.actor, "posadka_pant_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_41", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".posadka_pant_sms3" )
end

function posadka_pant_sms3()
  news_manager.send_tip(
    db.actor, "posadka_pant_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_37", true
  )
end


function pant_proschay_sms4()
  local snd = news_manager.send_tip(
    db.actor, "pant_proschay_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_55", true
  )
  ogse_st_mgr.start_on_signal(
    script_name() .. ".muha_bazar_sms_change_level",
    "on_spawn_another_level",
    script_name() .. ".muha_bazar_sms_change_level"
  )
end

function muha_bazar_sms_change_level()
  if db.actor:dont_has_info( "muha_talk_pro_art" ) then
    muha_bazar_sms()
  end
end

function muha_bazar_sms()
  db.actor:give_info_portion( "muha_talk_pro_art" )
  local snd = news_manager.send_tip(
    db.actor, "muha_bazar_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_38", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".muha_bazar_sms1" )
end

function muha_bazar_sms1()
  local snd = news_manager.send_tip(
    db.actor, "muha_bazar_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_67", true
  )
end


function voronin_voen_sms_start()
  dsh.story_sms_timer( 50, script_name() .. ".voronin_voen_sms1" )
end

function voronin_voen_sms1()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_100", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".voronin_voen_sms2" )
end

function voronin_voen_sms2()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_101", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".voronin_voen_sms3" )
end

function voronin_voen_sms3()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_68", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".voronin_voen_sms4" )
end

function voronin_voen_sms4()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_102", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".voronin_voen_sms5" )
end

function voronin_voen_sms5()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_69", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".voronin_voen_sms6" )
end

function voronin_voen_sms6()
  local snd = news_manager.send_tip(
    db.actor, "voronin_voen_sms6", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_39", true
  )
  spawn_chaes_pilot_zapiska()
end


function chaes2_kluk_sms_start()
  db.actor:give_info_portion( "chaes_spawn_vse" )
  spawn_chaes_pilot_zapiska2()
  dsh.story_sms_timer( 1, script_name() .. ".chaes2_kluk_sms1" )
end

function chaes2_kluk_sms1()
  local snd = news_manager.send_tip(
    db.actor, "chaes2_kluk_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_70", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".chaes2_kluk_sms2" )
end

function chaes2_kluk_sms2()
  local snd = news_manager.send_tip(
    db.actor, "chaes2_kluk_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_40", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".chaes2_kluk_sms3" )
end

function chaes2_kluk_sms3()
  local snd = news_manager.send_tip(
    db.actor, "chaes2_kluk_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_71", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".chaes2_kluk_sms4" )
end

function chaes2_kluk_sms4()
  db.actor:give_info_portion( "voronin_samopisez_have2" )
end

function got_af_water_flower()
  return sak.have_item_namber( "af_water_flower", 1 )
end


function iz_moskvy_sms1()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_103", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms2" )
end

function iz_moskvy_sms2()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_72", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms3" )
end

function iz_moskvy_sms3()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_104", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms4" )
end

function iz_moskvy_sms4()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_73", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms5" )
end

function iz_moskvy_sms5()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms5", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_105", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms6" )
end

function iz_moskvy_sms6()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms6", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_115", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".iz_moskvy_sms7" )
end

function iz_moskvy_sms7()
  db.actor:give_info_portion( "muha_vertuha_letit_talk" )
end


function dosvidanie_devchonka()
  local snd = news_manager.send_tip(
    db.actor, "iz_moskvy_sms7", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_142", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dosvidanie_devchonka2" )
end

function dosvidanie_devchonka2()
  db.actor:give_info_portion( "nadoela_start" )
end


function pilot_muhi_sms()
  local snd = news_manager.send_tip(
    db.actor, "pilot_muhi_sms", nil, nil, 23000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_135", true
  )
end


function vzruv_aver_vert_sms1()
  local snd = news_manager.send_tip(
    db.actor, "vzruv_aver_vert_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_137", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vzruv_aver_vert_sms2" )
end

function vzruv_aver_vert_sms2()
  local snd = news_manager.send_tip(
    db.actor, "vzruv_aver_vert_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_136", true
  )
end


function vzruv_aver_vert_sms3()
  local snd = news_manager.send_tip(
    db.actor, "vzruv_aver_vert_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_138", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vzruv_aver_vert_sms4" )
end

function vzruv_aver_vert_sms4()
  local snd = news_manager.send_tip(
    db.actor, "vzruv_aver_vert_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_74", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vzruv_aver_vert_sms5" )
end

function vzruv_aver_vert_sms5()
  db.actor:give_info_portion( "soldier_ranen_find" )
end


-- получим фото от раненого
function dal_foto(first_speaker, second_speaker)
  sak.create_items_actor( "foto_aver_zvezd", 1 )
  sak.create_items_actor( "foto_aver_mono", 1 )
  after_die_muha_sms1()
end

function after_die_muha_sms1()
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_106", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_die_muha_sms2" )
end

function after_die_muha_sms2()
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_75", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_die_muha_sms3" )
end

function after_die_muha_sms3()
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_76", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_die_muha_sms4" )
end

function after_die_muha_sms4()
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms4", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_127", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_die_muha_sms5" )
end

function after_die_muha_sms5()
  dsh.start_on_spawn_another_level( script_name() .. ".dell_muha_die_aver" )
  db.actor:give_info_portion( "vkluchit_generator_start" )
--[=[
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_77", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_die_muha_sms6" )
--]=]
end

function after_die_muha_sms6()
  local snd = news_manager.send_tip(
    db.actor, "after_die_muha_sms6", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_41", true
  )
end

-- убираем тело Мухи и раненого с авера 
function dell_muha_die_aver()
  local se_obj = alife():object( "muha_soldat_ranen" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "muha_die" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
end


function mono_netu_sms1()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_78", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mono_netu_sms2" )
end

function mono_netu_sms2()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_42", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mono_netu_sms3" )
end

function mono_netu_sms3()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms3", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_79", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mono_netu_sms4" )
end

function mono_netu_sms4()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms4", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_80", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mono_netu_sms5" )
end

function mono_netu_sms5()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms5", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_81", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mono_netu_sms6" )
end

function mono_netu_sms6()
  local snd = news_manager.send_tip(
    db.actor, "mono_netu_sms6", nil, nil, 10000
  )
  dell_muha_die_aver()
  db.actor:give_info_portion( "vkluchit_generator_start" )
end


function vitamin_posrednik_sms1()
  local snd = news_manager.send_tip(
    db.actor, "vitamin_posrednik_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_82", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vitamin_posrednik_sms2" )
end

function vitamin_posrednik_sms2()
  local snd = news_manager.send_tip(
    db.actor, "vitamin_posrednik_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_107", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vitamin_posrednik_sms3" )
end

function vitamin_posrednik_sms3()
  local snd = news_manager.send_tip(
    db.actor, "vitamin_posrednik_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_83", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vitamin_posrednik_sms4" )
end

function vitamin_posrednik_sms4()
  local snd = news_manager.send_tip(
    db.actor, "vitamin_posrednik_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_43", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vitamin_posrednik_sms5" )
end

function vitamin_posrednik_sms5()
  local snd = news_manager.send_tip(
    db.actor, "vitamin_posrednik_sms5", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_84", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vitamin_posrednik_sms6" )
end

function vitamin_posrednik_sms6()
  spawn_psevdotele()
  db.actor:give_info_portion( "spawn_svoboda_peregovory" )
  db.actor:give_info_portion( "spawn_sapsanchik_peregovory" )
end

-- заспавним мнимый телепорт на генераторах
function spawn_psevdotele()
  local sobj = alife():create(
    "imitator_tele_final1",
    vector():set( 179.736, 31.259, -454.935 ), 544230, 3133
  )
  alife():assign_story_id( sobj.id, story_ids.gen_imitator_tele_final1 )
end


function sv_chern_peregovor_sms1()
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms1", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_44", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms2" )
end

function sv_chern_peregovor_sms2()
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms2", nil, "freedom", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_50", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms3" )
end

function sv_chern_peregovor_sms3()
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_45", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms4" )
end

function sv_chern_peregovor_sms4()
  db.actor:give_info_portion( "nota_bene" )
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_85", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms5" )
end

function sv_chern_peregovor_sms5()
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_46", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms6" )
end

function sv_chern_peregovor_sms6()
  local snd = news_manager.send_tip(
    db.actor, "sv_chern_peregovor_sms6", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_86", true
  )
  gen_shlag_gigantu()
  dsh.story_sms_timer( snd, script_name() .. ".sv_chern_peregovor_sms7" )
end

function sv_chern_peregovor_sms7()
  db.actor:give_info_portion( "rashod_strelki" )
  db.actor:give_info_portion( "solv_talk_varlab_start" )
  db.actor:give_info_portion( "lomonosovu_na_varlabe" )
end


function u_shlagbauma_sms1()
  local snd = news_manager.send_tip(
    db.actor, "u_shlagbauma_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_87", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_shlagbauma_sms2" )
end

function u_shlagbauma_sms2()
  local snd = news_manager.send_tip(
    db.actor, "u_shlagbauma_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_88", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_shlagbauma_sms3" )
end

function u_shlagbauma_sms3()
  local snd = news_manager.send_tip(
    db.actor, "u_shlagbauma_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_108", true
  )
end


function u_tretego_generatora_sms1()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms1", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_89", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms2" )
end

function u_tretego_generatora_sms2()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms2", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_109", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms3" )
end

function u_tretego_generatora_sms3()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms3", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_90", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms6" )
end

function u_tretego_generatora_sms4()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms4", nil, nil, 15000
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms5" )
end

function u_tretego_generatora_sms5()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms5", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_91", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms6" )
end

function u_tretego_generatora_sms6()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms6", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_110", true
  )
  generator3_vkl()
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms7" )
end

function u_tretego_generatora_sms7()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms7", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_92", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms8" )
end

function u_tretego_generatora_sms8()
  db.actor:give_info_portion( "vkluchit_generator_done" )
  dsh.story_sms_timer( 5, script_name() .. ".u_tretego_generatora_sms9" )
end

function u_tretego_generatora_sms9()
  local snd = news_manager.send_tip(
    db.actor, "u_tretego_generatora_sms9", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_47", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".u_tretego_generatora_sms10" )
end

function u_tretego_generatora_sms10()
  dell_new_kluk_nz()
  set_kluk_chaes2()
  db.actor:give_info_portion( "kluk_chaes2_bazar_talk" )
end


function mesto_gg_na_chaes2_sms()
  local snd = news_manager.send_tip(
    db.actor, "mesto_gg_na_chaes2_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_93", true
  )
end


function kluk_pogib_sms1()
  dell_kluk_chaes2()
  local snd = news_manager.send_tip(
    db.actor, "kluk_pogib_sms1", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_48", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_pogib_sms2" )
end

function kluk_pogib_sms2()
  db.actor:give_info_portion( "neudachnay_pomozch" )
  local sobj = alife():create(
    "vehicle_btr",
    vector():set( 503.57, -0.09, 231.94 ), 153564, 2605
  )
  sobj.angle = vector():set( 0, 1.5900000333786, 0 )
  amk_mod.spawn_military_tech_pack(
    sobj, "vehicle_btr", "scripts\\chaes2\\beter2_kluk.ltx"
  )
  local snd = news_manager.send_tip(
    db.actor, "kluk_pogib_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_94", true
  )
end


function kluk_pogib_sms3()
  db.actor:give_info_portion( "beter_kluk_spawn" )
  local snd = news_manager.send_tip(
    db.actor, "kluk_pogib_sms3", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_95", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_pogib_sms4" )
end

function kluk_pogib_sms4()
  local snd = news_manager.send_tip(
    db.actor, "kluk_pogib_sms4", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_143", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kluk_pogib_sms5" )
end

function kluk_pogib_sms5()
  local snd = news_manager.send_tip(
    db.actor, "kluk_pogib_sms5", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_49", true
  )
end


function bomba_vzruv_sms()
  dsh.story_sms_timer( 5, script_name() .. ".bomba_vzruv_sms2" )
end

function bomba_vzruv_sms2()
  db.actor:give_info_portion( "pomozch_proval" )
  local snd = news_manager.send_tip(
    db.actor, "bomba_vzruv_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_113", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms1" )
  dsh.start_on_spawn_another_level( script_name() .. ".after_kluk_pogib_cleanup" )
end

function after_kluk_pogib_sms1()
  local snd = news_manager.send_tip(
    db.actor, "after_kluk_pogib_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_96", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms2" )
end

function after_kluk_pogib_sms2()
  local snd = news_manager.send_tip(
    db.actor, "after_kluk_pogib_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_111", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms3" )
end

function after_kluk_pogib_sms3()
  local snd = news_manager.send_tip(
    db.actor, "after_kluk_pogib_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_97", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms4" )
end

function after_kluk_pogib_sms4()
  local snd = news_manager.send_tip(
    db.actor, "after_kluk_pogib_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_98", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms5" )
end

function after_kluk_pogib_sms5()
  local snd = news_manager.send_tip(
    db.actor, "after_kluk_pogib_sms5", nil, "doctor_black", 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_118", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_kluk_pogib_sms6" )
end

function after_kluk_pogib_sms6()
  db.actor:give_info_portion( "spawnim_3otsek" )
end

function after_kluk_pogib_cleanup()
  local sobj = alife():object( "chaes2_musik_restrictor" )
  if sobj then
    dsh_alife.release( sobj )
  end
end


function nachalo_bazara_otsek_sms()
  local snd = news_manager.send_tip(
    db.actor, "nachalo_bazara_otsek_sms", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_119", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms1" )
end

function poshel_bazar_otsek_sms1()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_99", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms2" )
end

function poshel_bazar_otsek_sms2()
  db.actor:give_info_portion( "opustit_oruzie" )
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_56", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms3" )
end

function poshel_bazar_otsek_sms3()
  spawn_tele_blok_vhod_otsek()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_100", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms4" )
end

function poshel_bazar_otsek_sms4()
  sp_live_kapsula()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_57", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms5" )
end

function poshel_bazar_otsek_sms5()
  db.actor:give_info_portion( "real_dok_and_father_spawn" )
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms5", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_101", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms6" )
end

function poshel_bazar_otsek_sms6()
  dell_hospital_bl_dok()
  spawn_tele_1_hosp_verh1()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms6", nil, "doctor_black", 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_120", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms7" )
end

function poshel_bazar_otsek_sms7()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms7", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_58", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poshel_bazar_otsek_sms8" )
end

function poshel_bazar_otsek_sms8()
  local snd = news_manager.send_tip(
    db.actor, "poshel_bazar_otsek_sms8", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_112", true
  )
end


function sidor_mina_sms()
news_manager.send_tip(db.actor, "sidor_mina_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_144")
end


function sms_k_generalu()
  sak.add_new_hospital_to_agroprom()
  local snd = news_manager.send_tip(
    db.actor, "sms_k_generalu", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_102", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_k_prizraku" )
end

function sms_k_prizraku()
  local snd = news_manager.send_tip(
    db.actor, "sms_k_prizraku", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_103", true
  )
end


function sms_k_prizraku1()
news_manager.send_tip(db.actor, "sms_k_prizraku1", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_104")
end


function sms_k_muhe()
  local snd = news_manager.send_tip(
    db.actor, "sms_k_muhe", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_105", true
  )
end


function atp_torgovetz_sms()
news_manager.send_tip(db.actor, "atp_torgovetz_sms", nil, nil, 35000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_129")
end
function sedoy_sms_poka()
news_manager.send_tip(db.actor, "sedoy_sms_poka", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_130")
end
function tu_sdurel_sms()
news_manager.send_tip(db.actor, "tu_sdurel_sms", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_131")
end


function agro_muxa_sms1()
  local snd = news_manager.send_tip(
    db.actor, "agro_muxa_sms1", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_106", true
  )
end


function agro_replika1()
  local snd = news_manager.send_tip(
    db.actor, "agro_replika1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_145", true
  )
end


function agro_boltobny_sms1()
  dell_muha_hosp_live()
  dsh.story_sms_timer( 12, script_name() .. ".agro_boltobny_sms1_1" )
end

function agro_boltobny_sms1_1()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms1_1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_146", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms2" )
end

function agro_boltobny_sms2()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_147", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms3" )
end

function agro_boltobny_sms3()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_148", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms4" )
end

function agro_boltobny_sms4()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_149", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms5" )
end

function agro_boltobny_sms5()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_150", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms6" )
end

function agro_boltobny_sms6()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms6", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_151", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms7" )
end

function agro_boltobny_sms7()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms7", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_98", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms8" )
end

function agro_boltobny_sms8()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms8", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_152", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms9" )
end

function agro_boltobny_sms9()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms9", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_107", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms10" )
end

function agro_boltobny_sms10()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms10", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_153", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms11" )
end

function agro_boltobny_sms11()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms11", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_154", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms12" )
end

function agro_boltobny_sms12()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms12", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_155", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms13" )
end

function agro_boltobny_sms13()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms13", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_156", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms14" )
end

function agro_boltobny_sms14()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms14", nil, "ara", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_157", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms16" )
end

function agro_boltobny_sms15()
  news_manager.send_tip( db.actor, "agro_boltobny_sms15", nil, nil, 25000 )
end

function agro_boltobny_sms16()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms16", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_108", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms17" )
end

function agro_boltobny_sms17()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms17", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_119", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms18" )
end

function agro_boltobny_sms18()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms18", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_109", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms19" )
end

function agro_boltobny_sms19()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms19", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_158", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms20" )
end

function agro_boltobny_sms20()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms20", nil, "ara", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_159", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms21" )
end

function agro_boltobny_sms21()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms21", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_160", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms22" )
end

function agro_boltobny_sms22()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms22", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_110", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms24" )
end

function agro_boltobny_sms23()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms23", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_161", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms24" )
end

function agro_boltobny_sms24()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms24", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_177", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms25" )
end

function agro_boltobny_sms25()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms25", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_176", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms26" )
end

function agro_boltobny_sms26()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms26", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_162", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms27" )
end

function agro_boltobny_sms27()
  db.actor:give_info_portion( "komanda_na_posadku1" )
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms27", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_163", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms28" )
end

function agro_boltobny_sms28()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms28", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_164", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms30" )
end

function agro_boltobny_sms29()
  news_manager.send_tip( db.actor, "agro_boltobny_sms29", nil, nil, 25000 )
  dsh_story_agro_final.next_sms_step( "sms30", 10000 )
end

function agro_boltobny_sms30()
  db.actor:give_info_portion( "komanda_gg_posadka" )
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms30", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_165", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms31" )
end

function agro_boltobny_sms31()
  db.actor:give_info_portion( "agro_muxa_way2" )
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms31", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_166", true
  )
end

-- убираем группу стрелка
function delete_gpuppa()
  local se_obj = alife():object( "final_prizrak" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "final_dok_arh" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "final_piligrim" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "final_muxa" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  agro_boltobny_sms32()
end

function proschalnoe_sms1()
  local snd = news_manager.send_tip(
    db.actor, "proschalnoe_sms1", nil, nil, 25000
  )
  dsh.story_sms_timer( 3, script_name() .. ".proschalnoe_sms2" )
end

function proschalnoe_sms2()
  local snd = news_manager.send_tip(
    db.actor, "proschalnoe_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_171", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".proschalnoe_sms3" )
end

function proschalnoe_sms3()
  local snd = news_manager.send_tip(
    db.actor, "proschalnoe_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_172", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms32" )
end

function agro_boltobny_sms32()
  db.actor:give_info_portion( "komanda_na_posadku2" )
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms32", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_167", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms33" )
end

function agro_boltobny_sms33()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms33", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_168", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms34" )
end

function agro_boltobny_sms34()
  local snd = news_manager.send_tip(
    db.actor, "agro_boltobny_sms34", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_169", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".agro_boltobny_sms35" )
end

function agro_boltobny_sms35()
  db.actor:give_info_portion( "final_muzon" )
  db.actor:give_info_portion( "spawn_final_arhara" )
  sp_imit_tele_final1()
  dsh_story_agro_final.restore_actor_state()
end


function arh_finish_sms1()
  final_arhara_dell()
  imitat_tele_final1_dell()
  local snd = news_manager.send_tip(
    db.actor, "arh_finish_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_170", true
  )
  db.actor:give_info_portion( "spawnim_final_kluk" )
  spawn_teleport_final_vorota()
end

function proschalnoe_sms4()
  local snd = news_manager.send_tip(
    db.actor, "proschalnoe_sms4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_173", true
  )
end


-- заспавним имитатор финал Архара
function sp_imit_tele_final1()
  alife():create("imitator_tele_final1",vector():set(249.512,3.124,-257.802),426110,702)
  alife():create("imitator_tele_final1",vector():set(249.448,3.155,-257.985),426110,702)
  alife():create("imitator_tele_final1",vector():set(243.007,3.940,-245.595),424772,702)
  alife():create("imitator_tele_final1",vector():set(242.601,3.811,-245.950),424772,702)
end

-- убираем имитаторы телеп финала
function imitat_tele_final1_dell()
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "imitator_tele_final1"
      and sobj.level_name == level.name()
    then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    alife():release( sobj )
  end
end

-- спавним телепорт выхода ГГ с финала 
function spawn_teleport_final_vorota()
  spawn_teleport.create_teleport("m_teleport_final_vorota",vector():set(193.4518737793,3.6606612205505,-247.07885742188),404687,692)
end


function td_preduprezhdenie1_sms1()
  -- news_manager.send_tip(db.actor, "td_preduprezhdenie1_sms1", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_15")
end
function td_preduprezhdenie2_sms2()
  -- news_manager.send_tip(db.actor, "td_preduprezhdenie2_sms2", nil, nil, 30000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_16")
end
function laba_skan_arts_sms1()
  -- news_manager.send_tip(db.actor, "laba_skan_arts_sms1", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_17")
end
function laba_skan_arts_sms2()
  -- news_manager.send_tip(db.actor, "laba_skan_arts_sms2", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\leave\\leave_18")
end
function von_sms()
news_manager.send_tip(db.actor, "von_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_111")
end
function sark_art_negoden_sms()
--news_manager.send_tip(db.actor, "sark_art_negoden_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_112")
end


function spezdetektor_sms()
news_manager.send_tip(db.actor, "spezdetektor_sms", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_8")
end


function pda_slom_sms1()
  news_manager.send_tip(
    db.actor, "pda_slom_sms1", nil, "nano", 15000, nil,
   "characters_voice\\human_03\\stalker\\talk\\labux\\labux_9"
  )
  dsh_broken_pda.on_spawn()
end


function pda_slom_sms2()
  news_manager.send_tip(
    db.actor, "pda_slom_sms2", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_83"
  )
end


function pda_slom_sms3()
  news_manager.send_tip(
    db.actor, "pda_slom_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_80"
  )
end


function pda_slom_sms4()
  news_manager.send_tip(
    db.actor, "pda_slom_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_10"
  )
end


function pda_slom_sms5()
  news_manager.send_tip(
    db.actor, "pda_slom_sms5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_81"
  )
end


function pda_slom_sms6()
news_manager.send_tip(db.actor, "pda_slom_sms6", nil, "nano", 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_11")
end
function pda_sdelan_sms0()
news_manager.send_tip(db.actor, "pda_sdelan_sms0", nil, "nano", 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_12")
end
function pda_sdelan_sms()
news_manager.send_tip(db.actor, "pda_sdelan_sms", nil, "nano", 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_13")
end


function girl3_nachalo_sms()
  if db.actor:has_info( "naezd_zhuchok" ) then return end
  dell_kluk_final()
  dsh_story_agro_final.story_end()
  local snd = news_manager.send_tip(
    db.actor, "girl3_nachalo_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_117", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".girl3_nachalo_sms1" )
end

function girl3_nachalo_sms1()
  local snd = news_manager.send_tip(
    db.actor, "girl3_nachalo_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_82", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".girl3_nachalo_sms2" )
end

function girl3_nachalo_sms2()
  local snd = news_manager.send_tip(
    db.actor, "girl3_nachalo_sms2", nil, "doctor_black", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_14", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".girl3_nachalo_sms3" )
end

function girl3_nachalo_sms3()
  local snd = news_manager.send_tip(
    db.actor, "girl3_nachalo_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_31", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".girl3_nachalo_sms4" )
end

function girl3_nachalo_sms4()
  db.actor:give_info_portion( "naezd_zhuchok" )
end


function molniy_bar_sms()
  dsh.story_sms_timer( 5, script_name() .. ".molniy_bar_sms1" )
end

function molniy_bar_sms1()
  local snd = news_manager.send_tip(
    db.actor, "molniy_bar_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_32", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_bar_sms2" )
end

function molniy_bar_sms2()
  local snd = news_manager.send_tip(
    db.actor, "molniy_bar_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_118", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_bar_sms3" )
end

function molniy_bar_sms3()
  db.actor:give_info_portion( "podval_sarkofag_nayti" )
end


function strannik_lima_sms()
  local snd = news_manager.send_tip(
    db.actor, "strannik_lima_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_33", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".strannik_lima_sms1" )
end

function strannik_lima_sms1()
  local snd = news_manager.send_tip(
    db.actor, "strannik_lima_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_119", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".strannik_lima_sms2" )
end

function strannik_lima_sms2()
  local snd = news_manager.send_tip(
    db.actor, "strannik_lima_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_34", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".strannik_lima_sms3" )
end

function strannik_lima_sms3()
  spawn_lima_psevdushi()
  db.actor:give_info_portion( "podval_lima_done" )
end


-- спавним изоморфные патроны в Лиме
function spawn_izo_pistonu()
  alife():create( "ammo_5.45x39_izomorf",vector():set(93.017,7.342,244.933),60324,3021 )
  alife():create( "ammo_5.45x39_izomorf",vector():set(93.017,7.342,244.933),60324,3021 )
  alife():create( "ammo_5.45x39_izomorf",vector():set(93.017,7.342,244.933),60324,3021 )
  dsh.story_sms_timer( 1, script_name() .. ".after_semetskiy_sms" )
end

function after_semetskiy_sms()
  local snd = news_manager.send_tip(
    db.actor, "after_semetskiy_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_35", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_semetskiy_sms1" )
end

function after_semetskiy_sms1()
  local snd = news_manager.send_tip(
    db.actor, "after_semetskiy_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_1", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".after_semetskiy_sms2" )
end

function after_semetskiy_sms2()
  db.actor:give_info_portion( "odnonogiy_spawn" )
end


function preduprezhdenie_sms()
  local snd = news_manager.send_tip(
    db.actor, "after_semetskiy_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_112", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".preduprezhdenie_sms1" )
end

function preduprezhdenie_sms1()
  local snd = news_manager.send_tip(
    db.actor, "preduprezhdenie_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_36", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".preduprezhdenie_sms2" )
end

function preduprezhdenie_sms2()
  db.actor:give_info_portion( "preduprezhdenie_1" )
  local snd = news_manager.send_tip(
    db.actor, "preduprezhdenie_sms2", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_111", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".preduprezhdenie_sms3" )
end

function preduprezhdenie_sms3()
  db.actor:give_info_portion( "preduprezhdenie_2" )
  local snd = news_manager.send_tip(
    db.actor, "preduprezhdenie_sms3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_2", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".preduprezhdenie_sms4" )
end

function preduprezhdenie_sms4()
  db.actor:give_info_portion( "preduprezhdenie_3" )
  local snd = news_manager.send_tip(
    db.actor, "preduprezhdenie_sms4", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_37", true
  )
end


function odnon_proval_sms()
  local snd = news_manager.send_tip(
    db.actor, "odnon_proval_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_15", true
  )
end


function foto_ok()
  return news_manager.send_tip(
    db.actor, "foto_ok", nil, nil, 15000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_16", true
  )
end


function vopros_k_prizraku_sms()
  dsh.story_sms_timer( 20, script_name() .. ".vopros_k_prizraku_sms1" )
end

function vopros_k_prizraku_sms1()
  local snd = news_manager.send_tip(
    db.actor, "vopros_k_prizraku_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_38", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".vopros_k_prizraku_sms2" )
end

function vopros_k_prizraku_sms2()
  local snd = news_manager.send_tip(
    db.actor, "vopros_k_prizraku_sms2", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_99"
  )
  dsh.story_sms_timer( snd, script_name() .. ".vopros_k_prizraku_sms3" )
end

function vopros_k_prizraku_sms3()
  db.actor:give_info_portion( "dialog_foto_pili" )
end


function pili_sdelal_psevdofoto_sms()
news_manager.send_tip(db.actor, "pili_sdelal_psevdofoto_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_25")
end


function molniy_posle_foto_sms_launch()
  dsh.story_sms_timer( 5, script_name() .. ".molniy_posle_foto_sms" )
end


function molniy_posle_foto_sms()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_39", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms1" )
end


function molniy_posle_foto_sms1()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms1", nil, nil, 37000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_120", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms2" )
end


function molniy_posle_foto_sms2()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_40", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms3" )
end


function molniy_posle_foto_sms3()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_41", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms4" )
end

function molniy_posle_foto_sms4()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms4", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_100", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms5" )
end

function molniy_posle_foto_sms5()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms5", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_42", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms6" )
end

function molniy_posle_foto_sms6()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms6", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_101", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms7" )
end

function molniy_posle_foto_sms7()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms7", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_43", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms8" )
end

function molniy_posle_foto_sms8()
  local snd = news_manager.send_tip(
    db.actor, "molniy_posle_foto_sms8", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_102"
  )
  dsh.story_sms_timer( snd, script_name() .. ".molniy_posle_foto_sms9" )
end

function molniy_posle_foto_sms9()
  db.actor:give_info_portion( "mesto_v_bunkere_start" )
end


function pozisiy_bunker_gg_sms()
  local snd = news_manager.send_tip(
    db.actor, "pozisiy_bunker_gg_sms", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_44", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pozisiy_bunker_gg_sms1" )
end

function pozisiy_bunker_gg_sms1()
  local snd = news_manager.send_tip(
    db.actor, "pozisiy_bunker_gg_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_103", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pozisiy_bunker_gg_sms2" )
end

function pozisiy_bunker_gg_sms2()
  dsh.story_sms_timer( 10, script_name() .. ".pozisiy_bunker_gg_sms3" )
end

function pozisiy_bunker_gg_sms3()
  db.actor:give_info_portion( "spawn_radist" )
end


function ozhivil_radista_sms()
  dsh.start_on_spawn_another_level(
    script_name() .. ".ozhivil_radista_sms1", "l11_pripyat"
  )
end

function ozhivil_radista_sms1()
  dsh.story_sms_timer( 20, script_name() .. ".ozhivil_radista_sms2" )
end

function ozhivil_radista_sms2()
  local snd = news_manager.send_tip(
    db.actor, "ozhivil_radista_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_104", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".ozhivil_radista_sms3" )
end

function ozhivil_radista_sms3()
  local snd = news_manager.send_tip(
    db.actor, "ozhivil_radista_sms3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_46", true
  )
end


function nashel_sadik_taynik_sms()
  local snd = news_manager.send_tip(
    db.actor, "nashel_sadik_taynik_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_47", true
  )
end


function seif_zakrut_sms()
  local snd = news_manager.send_tip(
    db.actor, "seif_zakrut_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_48", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".seif_zakrut_sms1" )
end

function seif_zakrut_sms1()
  delete_kluk_and_radist()
  local snd = news_manager.send_tip(
    db.actor, "seif_zakrut_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_105", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".seif_zakrut_sms2" )
end

function seif_zakrut_sms2()
  db.actor:give_info_portion( "spawn_kluk_na_pripyti" )
  spawn_gig_sadik()
end


function seif_sadik_otkrut_sms()
  local snd = news_manager.send_tip(
    db.actor, "seif_sadik_otkrut_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_124", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".seif_sadik_otkrut_sms1" )
end

function seif_sadik_otkrut_sms1()
  db.actor:give_info_portion( "to_walk_radist_sadik" )
end


function otkroem_bez_radista_sms()
  local snd = news_manager.send_tip(
    db.actor, "otkroem_bez_radista_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_49", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".otkroem_bez_radista_sms1" )
end

function otkroem_bez_radista_sms1()
  db.actor:give_info_portion( "seif_sadik_done" )
  local snd = news_manager.send_tip(
    db.actor, "otkroem_bez_radista_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_106", true
  )
--[=[
  dsh.start_on_spawn_another_level(
    script_name() .. ".ozhivil2_radista2_sms", "red_forest"
  )
--]=]
end


function forest_pozisiy_na_dome_sms()
news_manager.send_tip(db.actor, "forest_pozisiy_na_dome_sms", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_50")
end
function forest_pozisiy_na_dome_sms1()
news_manager.send_tip(db.actor, "forest_pozisiy_na_dome_sms1", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_125")
end
function pogib_stalk_sms()
news_manager.send_tip(db.actor, "pogib_stalk_sms", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_3")
end
function pogib_stalk_sms1()
news_manager.send_tip(db.actor, "pogib_stalk_sms1", nil, nil, 15000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_51")
end


function ozhivil2_radista2_sms()
  db.actor:give_info_portion( "spawn_radist2_prip" )
  local snd = news_manager.send_tip(
    db.actor, "ozhivil2_radista2_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_107", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".ozhivil2_radista2_sms1" )
end

function ozhivil2_radista2_sms1()
  local snd = news_manager.send_tip(
    db.actor, "ozhivil2_radista2_sms1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_52", true
  )
end


function superzhekan_sms()
  news_manager.send_tip(
    db.actor, "superzhekan_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_18", true
  )
end


function superzhekan_sms1()
  news_manager.send_tip(
    db.actor, "superzhekan_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_53", true
  )
  dsh.start_on_spawn_another_level( script_name() .. ".superzhekan_sms3" )
end

function superzhekan_sms2()
  news_manager.send_tip( db.actor, "superzhekan_sms2", nil, nil, 15000 )
end

function superzhekan_sms3()
  local sobj = alife():object( "forest_psu_perex_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function foto_mozg_ok_sms()
  return news_manager.send_tip(
    db.actor, "foto_mozg_ok_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_19", true
  )
end


function vodka_dly_kepa_sms()
news_manager.send_tip(db.actor, "vodka_dly_kepa_sms", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_4")
end
function vodka_dly_kepa_sms1()
news_manager.send_tip(db.actor, "vodka_dly_kepa_sms1", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_54")
end
function sms_kuznets()
news_manager.send_tip(db.actor, "sms_kuznets", nil, nil, 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_55")
end
function sms_kuznets1()
news_manager.send_tip(db.actor, "sms_kuznets1", nil, nil, 28000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_26")
end
function narod_napilsy_sms()
news_manager.send_tip(db.actor, "narod_napilsy_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_56")
end
function narod_napilsy_sms1()
news_manager.send_tip(db.actor, "narod_napilsy_sms1", nil, nil, 28000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_27")
end


function yntar_sms_k_molnii1()
  local snd = news_manager.send_tip(
    db.actor, "yntar_sms_k_molnii1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_57", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".yntar_sms_k_molnii2" )
end

function yntar_sms_k_molnii2()
  local snd = news_manager.send_tip(
    db.actor, "yntar_sms_k_molnii2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_121", true
  )
end


function mina_pant_sms()
  db.actor:give_info_portion( "remark_otez" )
  local snd = news_manager.send_tip(
    db.actor, "mina_pant_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_58", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mina_pant_sms1" )
end

function mina_pant_sms1()
  db.actor:give_info_portion( "remark_otez_die" )
  local snd = news_manager.send_tip(
    db.actor, "mina_pant_sms1", nil, nil, 23000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_28", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mina_pant_sms2" )
end

function mina_pant_sms2()
  local snd = news_manager.send_tip(
    db.actor, "mina_pant_sms2", nil, nil, 28000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_59", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".mina_pant_sms3" )
end

function mina_pant_sms3()
  db.actor:give_info_portion( "camp_camp_otez" )
  local snd = news_manager.send_tip(
    db.actor, "mina_pant_sms3", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_29", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sound_deaf_pantera" )
end

function sound_deaf_pantera()
  local snd_obj = xr_sound.get_safe_sound_object(
    "characters_voice\\scenario\\arhara_kordon\\po_snegu"
  )
  if snd_obj then
    snd_obj:play_no_feedback(
      db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0
    )
  end
end


function spawn_bomba_i_mina1()
  alife():create(
    "explosive_bomba",
    vector():set( -228.545, -28.910, -223.067 ), 26466, 40
  )
end

function pantera_sms_stop1()
  local snd = news_manager.send_tip(
    db.actor, "pantera_sms_stop1", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_60", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pantera_sms_stop2" )
end

function pantera_sms_stop2()
  local snd = news_manager.send_tip(
    db.actor, "pantera_sms_stop2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_84", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pantera_dinamit_nevid" )
end

function pantera_dinamit_nevid()
  sobj = alife():create( alife():spawn_id( story_ids.esc_dinamit_panera ) )
  level.client_spawn_manager():add(
    sobj.id, -1, function( id, obj )
      obj:explode()
      local pantera = level_object_by_sid( story_ids.esc_pantera_bomba )
      if pantera then pantera:kill( obj ) end
      dsh.timeout( 500, this.spawn_bomba_i_mina2 )
    end
  )
end

function spawn_bomba_i_mina2()
  alife():create(
    "bomba_mina_b",
    vector():set( -227.875, -28.802, -222.302 ), 26467, 40
  )
end


function bazar_s_klenovum1()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_61", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".bazar_s_klenovum2" )
end

function bazar_s_klenovum2()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_30", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".bazar_s_klenovum3" )
end

function bazar_s_klenovum3()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum3", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_62", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".bazar_s_klenovum4" )
end

function bazar_s_klenovum4()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_85", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".bazar_s_klenovum5" )
end

function bazar_s_klenovum5()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum5", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_63", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".bazar_s_klenovum6" )
end

function bazar_s_klenovum6()
  proba_posulki()
  local snd = news_manager.send_tip(
    db.actor, "bazar_s_klenovum6", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_86", true
  )
end


function kl_pos_est_sms()
  local snd = news_manager.send_tip(
    db.actor, "kl_pos_est_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_64", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kl_pos_est_sms1" )
end

function kl_pos_est_sms1()
  local snd = news_manager.send_tip(
    db.actor, "kl_pos_est_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_87", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".kl_pos_est_sms2" )
end

function kl_pos_est_sms2()
  otsek_varka_kamen()
  posulka_nomer_dva()
  dsh.story_sms_timer( 5, script_name() .. ".kl_pos_est_sms3" )
end

function kl_pos_est_sms3()
  local snd = news_manager.send_tip(
    db.actor, "kl_pos_est_sms2", nil, nil, 31000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_65", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".prizrak_ranen_sms" )
end

function prizrak_ranen_sms()
  dell_odnonogiy()
  local snd = news_manager.send_tip(
    db.actor, "prizrak_ranen_sms", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_5", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".prizrak_ranen_sms1" )
end

function prizrak_ranen_sms1()
  local snd = news_manager.send_tip(
    db.actor, "prizrak_ranen_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_66", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".prizrak_ranen_sms2" )
end

function prizrak_ranen_sms2()
  local snd = news_manager.send_tip(
    db.actor, "prizrak_ranen_sms2", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_7", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".prizrak_ranen_sms3" )
end

function prizrak_ranen_sms3()
  local snd = news_manager.send_tip(
    db.actor, "prizrak_ranen_sms3", nil, nil, 35000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_67", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pomosch_ot_chernomora_sms" )
end

function pomosch_ot_chernomora_sms()
  db.actor:give_info_portion( "odnonogiy_proval" )
  local snd = news_manager.send_tip(
    db.actor, "pomosch_ot_chernomora_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_72", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pomosch_ot_chernomora_sms1" )
end

--[=[
function pomosch_ot_chernomora_sms1()
  local snd = news_manager.send_tip(
    db.actor, "pomosch_ot_chernomora_sms1_0", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_90", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pomosch_ot_chernomora_sms2" )
end
--]=]

function pomosch_ot_chernomora_sms1()
  news_manager.send_tip(
    db.actor, "pomosch_ot_chernomora_sms1_1", nil, nil, 5000
  )
  dsh.story_sms_timer( 5, script_name() .. ".pomosch_ot_chernomora_sms2" )
end

function pomosch_ot_chernomora_sms2()
  news_manager.send_tip(
    db.actor, "pomosch_ot_chernomora_sms2", nil, nil, 5000
  )
  dsh.story_sms_timer( 5, script_name() .. ".pomosch_ot_chernomora_sms3" )
end

function pomosch_ot_chernomora_sms3()
  news_manager.send_tip(
    db.actor, "pomosch_ot_chernomora_sms3", nil, nil, 5000
  )
  dsh.story_sms_timer( 5, script_name() .. ".pomosch_ot_chernomora_sms4" )
end

function pomosch_ot_chernomora_sms4()
  db.actor:give_info_portion( "father_after_deaf_start" )
  db.actor:give_info_portion( "chern_foto_dialog_start" )
end


function perehov_na_yantar_sms()
  local snd = news_manager.send_tip(
    db.actor, "perehov_na_yantar_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_68", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".perehov_na_yantar_sms1" )
end

function perehov_na_yantar_sms1()
  local snd = news_manager.send_tip(
    db.actor, "perehov_na_yantar_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_122", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".perehov_na_yantar_sms2" )
end

function perehov_na_yantar_sms2()
  local snd = news_manager.send_tip(
    db.actor, "perehov_na_yantar_sms2", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_69", true
  )
  dsh.story_sms_timer( snd, "braad_test.control_monol_svalka" )
end


function pantera_na_kordone_sms()
  local sobj = alife():object( "perehov_na_yantar_restrictor" )
  if sobj then
    alife():release( sobj )
  end
  dell_gospital_pantera2()
  local snd = news_manager.send_tip(
    db.actor, "pantera_na_kordone_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_88", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pantera_na_kordone_sms1" )
end

function pantera_na_kordone_sms1()
  local snd = news_manager.send_tip(
    db.actor, "pantera_na_kordone_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_70", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".pantera_na_kordone_sms2" )
end

function pantera_na_kordone_sms2()
  db.actor:give_info_portion( "esc_pantera_task" )
  dsh.start_on_spawn_another_level(
    script_name() .. ".poslednie_sms_pantera", "l01_escape"
  )
end


function poslednie_sms_pantera()
  dsh.story_sms_timer( 10, script_name() .. ".poslednie_sms_pantera1" )
end

function poslednie_sms_pantera1()
  local snd = news_manager.send_tip(
    db.actor, "poslednie_sms_pantera1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_71", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".poslednie_sms_pantera2" )
end

function poslednie_sms_pantera2()
  local snd = news_manager.send_tip(
    db.actor, "poslednie_sms_pantera2", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_89", true
  )
end


function moroz_sms()
  local snd = news_manager.send_tip(
    db.actor, "moroz_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_6"
  )
end


function nashel_gada_sms()
news_manager.send_tip(db.actor, "nashel_gada_sms", nil, nil, 25000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_73")
end


function sms_otez_poreshil()
  dsh.start_on_spawn_another_level(
    script_name() .. ".sms_otez_poreshil1", "l07_military"
  )
end

function sms_otez_poreshil1()
  dsh.story_sms_timer( 10, script_name() .. ".sms_otez_poreshil2" )
end

function sms_otez_poreshil2()
  dell_stalk_shuher()
  local snd = news_manager.send_tip(
    db.actor, "sms_otez_poreshil2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_20", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otez_poreshil3" )
end

function sms_otez_poreshil3()
  local snd = news_manager.send_tip(
    db.actor, "sms_otez_poreshil3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_74", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otez_poreshil4" )
end

function sms_otez_poreshil4()
  local snd = news_manager.send_tip(
    db.actor, "sms_otez_poreshil4", nil, nil, 37000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_91", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otez_poreshil5" )
end

function sms_otez_poreshil5()
  local snd = news_manager.send_tip(
    db.actor, "sms_otez_poreshil5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_75", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otez_poreshil6" )
end

function sms_otez_poreshil6()
  local snd = news_manager.send_tip(
    db.actor, "sms_otez_poreshil6", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_92", true
  )
end


function del_stalker_kisluy()
  local sobj = alife():object( "stalker_kisluy" )
  if sobj then
    alife():release( sobj, true )
  end
end


function na_kamne_sms()
  del_stalker_kisluy()
  local snd = news_manager.send_tip(
    db.actor, "na_kamne_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_76", true
  )
  dsh.story_sms_timer( 15, script_name() .. ".na_kamne_sms1" )
end

function na_kamne_sms1()
  db.actor:give_info_portion( "spawn_strelochniki" )
end


function sms_razgovor_sxod_nz()
  db.actor:give_info_portion( "start_pazgovorchik" )
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_93", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz1" )
end

function sms_razgovor_sxod_nz1()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_113", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz2" )
end

function sms_razgovor_sxod_nz2()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_94", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz3" )
end

function sms_razgovor_sxod_nz3()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz3", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_114", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz4" )
end

function sms_razgovor_sxod_nz4()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz4", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_95", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz5" )
end

function sms_razgovor_sxod_nz5()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz5", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_115", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz6" )
end

function sms_razgovor_sxod_nz6()
  if db.actor:has_info( "zlobnuy_othod" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "sms_razgovor_sxod_nz6", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_96", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_razgovor_sxod_nz7" )
end

function sms_razgovor_sxod_nz7()
  db.actor:give_info_portion( "zlobnuy_othod" )
  del_strelka_radius_restr()
end


function preplastilin_sms()
  local snd = news_manager.send_tip(
    db.actor, "preplastilin_sms", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_21", true
  )
  delete_saxar_perex()
  dsh.story_sms_timer(
    snd:length() / 1000 + 5, script_name() .. ".ynt_after_perexod_sms"
  )
end

function ynt_after_perexod_sms()
  local snd = news_manager.send_tip(
    db.actor, "ynt_after_perexod_sms", nil, nil, 20000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_77", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".ynt_after_perexod_sms1" )
end

function ynt_after_perexod_sms1()
  db.actor:give_info_portion( "kvest_saxar_teleport_done" )
  local snd = news_manager.send_tip(
    db.actor, "ynt_after_perexod_sms1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_123", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".ynt_after_perexod_sms2" )
end

function ynt_after_perexod_sms2()
  local snd = news_manager.send_tip(
    db.actor, "ynt_after_perexod_sms2", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_78", true
  )
end


function dialog_oborvan_sms()
  local snd = news_manager.send_tip(
    db.actor, "dialog_oborvan_sms", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_79"
  )
end


function poluchenie_klucha_sms()
  local snd = news_manager.send_tip(
    db.actor, "poluchenie_klucha_sms", nil, "nano", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_22", true
  )
end


function del_blok_and_restr_sms()
  local snd = news_manager.send_tip(
    db.actor, "del_blok_and_restr_sms", nil, "nano", 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_24", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".delete_blok_and_restr" )
end

-- убираем блок-телепорт и рестриктор ключа в подвале Лимы
function delete_blok_and_restr()
  local se_obj = alife():story_object( 17023 )
  if se_obj then
    alife():release( se_obj )
  end
  news_manager.send_tip( db.actor, "delete_blok_and_restr", nil, "nano", 25000 )
end


function sms_zaschita_portal()
  -- news_manager.send_tip(db.actor, "sms_zaschita_portal", nil, "nano", 20000, nil, "characters_voice\\human_03\\stalker\\talk\\labux\\labux_23")
end


function pervoe_sms_dsity()
  -- friend_community()
  dell_video_finish_restr()
  del_pereod_lima_dcity()
  local snd = news_manager.send_tip(
    db.actor, "pervoe_sms_dsity", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\zlobniy_meat", true
  )
end


function sms_parfumer1()
  dsh.story_sms_timer( 10, script_name() .. ".sms_parfumer2" )
end

function sms_parfumer2()
  metka_city_parfumer()
  local snd = news_manager.send_tip(
    db.actor, "sms_parfumer2", nil, nil, 30000, nil,
    "characters_voice\\ozvuchka\\parfuym_vstrecha", true
  )
  dsh.story_sms_timer( 40, script_name() .. ".join_stalker" )
end


function sms_zaschita_mg()
  news_manager.send_tip(
    db.actor, "sms_zaschita_mg", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_chuzhak"
  )
end


function parfum_sms_kontrik1()
  dsh.story_sms_timer( 10, script_name() .. ".parfum_sms_kontrik2" )
end

function parfum_sms_kontrik2()
  local snd = news_manager.send_tip(
    db.actor, "parfum_sms_kontrik2", nil, nil, 15000
  )
  dsh.story_sms_timer( 8, script_name() .. ".parfum_sms_kontrik3" )
end

function parfum_sms_kontrik3()
  local snd = news_manager.send_tip(
    db.actor, "parfum_sms_kontrik3", nil, nil, 15000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity15", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".parfum_sms_kontrik4" )
end

function parfum_sms_kontrik4()
  local snd = news_manager.send_tip(
    db.actor, "parfum_sms_kontrik4", nil, nil, 45000, nil,
    "characters_voice\\ozvuchka\\parfuym_norman", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".parfum_sms_kontrik5" )
end

function parfum_sms_kontrik5()
  db.actor:give_info_portion( "dcity_kontrik_start" )
  artu_spawn_dsity_hutor()
  metka_norman()
end


function netu_kontrolera_sms()
  db.actor:give_info_portion( "dcity_spawn_ludi_hutor" )
  remove_norman_metka()
  dsh.story_sms_timer( 40, script_name() .. ".netu_kontrolera_sms1" )
end

function netu_kontrolera_sms1()
  local snd = news_manager.send_tip(
    db.actor, "netu_kontrolera_sms1", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\norman_vstrecha", true
  )
end


function sms_obmorok1()
  local snd = news_manager.send_tip(
    db.actor, "sms_obmorok1", nil, nil, 15000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity14", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_obmorok2" )
end

function sms_obmorok2()
  local snd = news_manager.send_tip(
    db.actor, "sms_obmorok2", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\obmorok_vstrecha1", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_obmorok3" )
end

function sms_obmorok3()
  local snd = news_manager.send_tip(
    db.actor, "sms_obmorok3", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity13", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_obmorok4" )
end

function sms_obmorok4()
  local snd = news_manager.send_tip(
    db.actor, "sms_obmorok4", nil, nil, 30000, nil,
    "characters_voice\\ozvuchka\\obmorok_vstrecha2", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_obmorok5" )
end

function sms_obmorok5()
  db.actor:give_info_portion( "uhod_iz_mg_start" )
end


function strelka_obmorok_sms1()
  if db.actor:has_info( "dcity_obmorok_enemy" ) then return end
  local snd = news_manager.send_tip(
    db.actor, "strelka_obmorok_sms1", nil, nil, 15000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity12", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".strelka_obmorok_sms2" )
end

function strelka_obmorok_sms2()
  if db.actor:has_info( "dcity_obmorok_enemy" ) then return end
  db.actor:give_info_portion( "dcity_spawn_obmorok" )
  local snd = news_manager.send_tip(
    db.actor, "strelka_obmorok_sms2", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\obmorok_vstrecha3", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".strelka_obmorok_sms3" )
end

function strelka_obmorok_sms3()
  if db.actor:has_info( "dcity_obmorok_enemy" ) then return end
end


function sms_dcity_zenter_doza()
  news_manager.send_tip(
    db.actor, "sms_dcity_zenter_doza", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_vxod_zona_a", true
  )
end


function sms_dcity_zenter_doza_otkl()
  return news_manager.send_tip(
    db.actor, "sms_dcity_zenter_doza_otkl", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_trevoga"
  )
end


function sms_dcity_gorod2_doza2()
  news_manager.send_tip(
    db.actor, "sms_dcity_gorod2_doza2", nil, nil, 30000, nil,
    "characters_voice\\ozvuchka\\system_10min"
  )
end


function sms_dcity_gorod_doza()
  news_manager.send_tip(
    db.actor, "sms_dcity_gorod_doza", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_4sek"
  )
end


function poziciy_cherdak_zanyta_sms()
  local snd = news_manager.send_tip(
    db.actor, "poziciy_cherdak_zanyta_sms", nil, nil, 15000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity11", true
  )
  disabl_weapon()
  friend_community()
  dsh.story_sms_timer( snd, script_name() .. ".poziciy_cherdak_zanyta_sms1" )
end

function poziciy_cherdak_zanyta_sms1()
  db.actor:give_info_portion( "spawn_rasstrel_scena" )
  dsh_story_agro_final.on_spawn()
  dsh.story_sms_timer( 1.5, script_name() .. ".poziciy_cherdak_zanyta_sms2" )
end

function poziciy_cherdak_zanyta_sms2()
  db.actor:give_info_portion( "spawn_rasstrel_scena1" )
end


function hand_hoh_sms()
  db.actor:give_info_portion( "podnyat_oruzhie" )
  news_manager.send_tip( db.actor, "hand_hoh_sms", nil, nil, 20000 )
  dsh.story_sms_timer( 6, script_name() .. ".rasstrel_zvuk_ochered" )
end

-- звук расстрела очередь
function rasstrel_zvuk_ochered()
  local snd_obj = xr_sound.get_safe_sound_object(
    "weapons\\ak47\\kalash_ochered"
  )
  if snd_obj then
    snd_obj:play_no_feedback(
      db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0
    )
  end
  dsh.story_sms_timer( 1, script_name() .. ".kill_dsity_rasstrel1" )
end

function kill_dsity_rasstrel1()
  db.actor:give_info_portion( "dsity_rasstrel1_umer" )
  local obj = level_object_by_sid( 19041 )
  if obj and IAmAStalker[ obj:clsid() ] and obj:alive() then
    obj:kill( obj )
  end
  dsh.story_sms_timer( 1.5, script_name() .. ".rasstrel_zvuk_odinochka" )
end

-- звук расстрела одиночка
function rasstrel_zvuk_odinochka()
  local snd_obj = xr_sound.get_safe_sound_object(
    "weapons\\ak47\\kalash_odinoch"
  )
  if snd_obj then
    snd_obj:play_no_feedback(
      db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0
    )
  end
  dsh.story_sms_timer( 0.5, script_name() .. ".kill_dsity_rasstrel2" )
end

function kill_dsity_rasstrel2()
  db.actor:give_info_portion( "dsity_rasstrel2_umer" )
  local obj = level_object_by_sid(19042)
  if obj and IAmAStalker[ obj:clsid() ] and obj:alive() then
    obj:kill( obj )
  end
  dsh.story_sms_timer( 2, script_name() .. ".suki_rasstrel_sms" )
end

function suki_rasstrel_sms()
  db.actor:give_info_portion( "dsity_rasstrel_end" )
  local snd = news_manager.send_tip(
    db.actor, "suki_rasstrel_sms", nil, nil, 10000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity10", true
  )
  enabl_weapon()
  join_stalker()
  dsh_story_agro_final.story_end()
  dsh.story_sms_timer( snd, script_name() .. ".suki_rasstrel_sms1" )
end

function suki_rasstrel_sms1()
  db.actor:give_info_portion( "spawn_oxranniki" )
  dsh.story_sms_timer( 5, script_name() .. ".suki_rasstrel_sms2" )
end

function suki_rasstrel_sms2()
  db.actor:give_info_portion( "spawn_nach_oxran" )
end


function sms_zlobnomu_rasstrel_start()
  dsh.story_sms_timer( 35, script_name() .. ".sms_zlobnomu_rasstrel" )
end


function sms_zlobnomu_rasstrel()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity9", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel1" )
end


function sms_zlobnomu_rasstrel1()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel1", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\obmorok_zlobnuy1", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel2" )
end


function sms_zlobnomu_rasstrel2()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel2", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\zlobniy_fak", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel3" )
end


function sms_zlobnomu_rasstrel3()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel3", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\obmorok_zlobnuy2", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel4" )
end


function sms_zlobnomu_rasstrel4()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel4", nil, nil, 10000, nil,
    "characters_voice\\ozvuchka\\zlobniy_proehali", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel4_1" )
end


function sms_zlobnomu_rasstrel4_1()
  braad_test.dead_city_atpeshka()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel4_1", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\zlobniy_gruppa", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel5" )
end


function sms_zlobnomu_rasstrel5()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel5", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\norman_perexod", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_zlobnomu_rasstrel6" )
end


function sms_zlobnomu_rasstrel6()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel6", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_port_open", true
  )
  dsh.story_sms_timer( 600, script_name() .. ".sms_zlobnomu_rasstrel7" )
end


function sms_zlobnomu_rasstrel7()
  if level.name() ~= "dead_city" then return end
  del_perexodik()
  local snd = news_manager.send_tip(
    db.actor, "sms_zlobnomu_rasstrel7", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\system_port_close", true
  )
end


function agro_tainik_norman_sms()
  local snd = news_manager.send_tip(
    db.actor, "agro_tainik_norman_sms", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\norman_taynik1", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".spawn_teleport_agro_norm_taynik" )
end


function sms_k_normany1()
  db.actor:give_info_portion( "agro_tainik_norman_done" )
  dsh.story_sms_timer( 10, script_name() .. ".sms_k_normany2" )
end

function sms_k_normany2()
  sak.add_new_dcity()
  spawn_yzik_3gulag()
  local snd = news_manager.send_tip(
    db.actor, "sms_k_normany2", nil, nil, 30000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity8", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_k_normany3" )
end

function sms_k_normany3()
  local snd = news_manager.send_tip(
    db.actor, "sms_k_normany3", nil, nil, 45000, nil,
    "characters_voice\\ozvuchka\\norman_taynik2", true
  )
  metka_city_parfumer()
  dsh.start_on_spawn_another_level(
    script_name() .. ".dcity_otvet_ok_obmor1", "dead_city"
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_k_normany4" )
end

function sms_k_normany4()
  db.actor:give_info_portion( "parfumer_say_two_task" )
end


function dcity_otvet_ok_obmor1()
  dsh.story_sms_timer( 10, script_name() .. ".dcity_otvet_ok_obmor2" )
end

function dcity_otvet_ok_obmor2()
  local snd = news_manager.send_tip(
    db.actor, "dcity_otvet_ok_obmor2", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity7", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_otvet_ok_obmor3" )
end

function dcity_otvet_ok_obmor3()
  local snd = news_manager.send_tip(
    db.actor, "dcity_otvet_ok_obmor3", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\obmorok_perexodu_open", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_otvet_ok_obmor4" )
end

function dcity_otvet_ok_obmor4()
  local snd = news_manager.send_tip(
    db.actor, "dcity_otvet_ok_obmor4", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\saxar_zhena", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_otvet_ok_obmor5" )
end

function dcity_otvet_ok_obmor5()
  local snd = news_manager.send_tip(
    db.actor, "dcity_otvet_ok_obmor5", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity6", true
  )
end


function dcity_duda_zvonok_sms1()
  db.actor:give_info_portion( "nachlo_zvonka" )
  dsh.story_sms_timer( 5, script_name() .. ".dcity_duda_zvonok_sms2" )
end

function dcity_duda_zvonok_sms2()
  local snd = news_manager.send_tip(
    db.actor, "dcity_duda_zvonok_sms2", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\parfuym_duda1", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_duda_zvonok_sms3" )
end

function dcity_duda_zvonok_sms3()
  dell_obmorok()
  local snd = news_manager.send_tip(
    db.actor, "dcity_duda_zvonok_sms3", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\duda_odekolon", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_duda_zvonok_sms4" )
end

function dcity_duda_zvonok_sms4()
  local snd = news_manager.send_tip(
    db.actor, "dcity_duda_zvonok_sms4", nil, nil, 40000, nil,
    "characters_voice\\ozvuchka\\parfuym_duda2", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_duda_zvonok_sms5" )
end

function dcity_duda_zvonok_sms5()
  local snd = news_manager.send_tip(
    db.actor, "dcity_duda_zvonok_sms5", nil, nil, 40000, nil,
    "characters_voice\\ozvuchka\\duda_babki", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_duda_zvonok_sms6" )
end

function dcity_duda_zvonok_sms6()
  db.actor:give_info_portion( "finish_zvonka" )
end


function dcity_iskra_zvonok_sms1()
  local snd = news_manager.send_tip(
    db.actor, "dcity_iskra_zvonok_sms1", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\parfuym_iskra", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_iskra_zvonok_sms2" )
end

function dcity_iskra_zvonok_sms2()
  local snd = news_manager.send_tip(
    db.actor, "dcity_iskra_zvonok_sms2", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\iskra_privet", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".dcity_iskra_zvonok_sms3" )
end

function dcity_iskra_zvonok_sms3()
  local snd = news_manager.send_tip(
    db.actor, "dcity_iskra_zvonok_sms3", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\parfum_risk", true
  )
end


function sms_otkl_zona1()
  dsh.story_sms_timer( 10, script_name() .. ".sms_otkl_zona1_1" )
end

function sms_otkl_zona1_1()
  local snd = news_manager.send_tip(
    db.actor, "sms_otkl_zona1_1", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\iskra_poluchilos", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otkl_zona2" )
end

function sms_otkl_zona2()
  local snd = news_manager.send_tip(
    db.actor, "sms_otkl_zona2", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\parfuym_musli", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otkl_zona3" )
end

function sms_otkl_zona3()
  db.actor:give_info_portion( "spawn_city_last_zentr" )
  delete_zaschita_zenter_gorod()
  dsh.story_sms_timer(
    sms_dcity_zenter_doza_otkl(), script_name() .. ".sms_otkl_zona3_1"
  )
end

function sms_otkl_zona3_1()
  dell_dok_nevidim()
  dell_dcity_dok_vidim()
  local snd = news_manager.send_tip(
    db.actor, "sms_otkl_zona3_1", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\iskra_vse_ploxo", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otkl_zona4" )
end

function sms_otkl_zona4()
  local snd = news_manager.send_tip(
    db.actor, "sms_otkl_zona4", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\parfuym_fak", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otkl_zona5" )
end

function sms_otkl_zona5()
  local snd = news_manager.send_tip(
    db.actor, "sms_otkl_zona5", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\molniy_chmok", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_otkl_zona6" )
end

function sms_otkl_zona6()
  db.actor:give_info_portion( "spasty_doka_done" )
end


function vylozhit_oruzhie_sms()
  local snd = news_manager.send_tip(
    db.actor, "vylozhit_oruzhie_sms", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\system_vulozhit_oruzhie", true
  )
end


function remen_dialog_sms1()
  db.actor:give_info_portion( "spawn_dead_city_molniy" )
  local snd = news_manager.send_tip(
    db.actor, "remen_dialog_sms1", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\molniy_zaxodi", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".remen_dialog_sms2" )
end

function remen_dialog_sms2()
  local snd = news_manager.send_tip(
    db.actor, "remen_dialog_sms2", nil, nil, 35000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity5", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".remen_dialog_sms3" )
end

function remen_dialog_sms3()
  local snd = news_manager.send_tip(
    db.actor, "remen_dialog_sms3", nil, nil, 40000, nil,
    "characters_voice\\ozvuchka\\molniy_sex", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".remen_dialog_sms4" )
end

function remen_dialog_sms4()
  local snd = news_manager.send_tip(
    db.actor, "remen_dialog_sms4", nil, nil, 25000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity4", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".remen_dialog_sms5" )
end

function remen_dialog_sms5()
  local snd = news_manager.send_tip(
    db.actor, "remen_dialog_sms5", nil, nil, 40000, nil,
    "characters_voice\\ozvuchka\\molniy_ne_staraysy", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".remen_dialog_sms6" )
end

function remen_dialog_sms6()
  otsek_varka_kamen()
  dell_dcity_molniy()
  dsh.story_sms_timer( 5, script_name() .. ".remen_dialog_sms7" )
end

function remen_dialog_sms7()
  news_manager.send_tip( db.actor, "remen_dialog_sms7", nil, nil, 35000 )
  iskra_listok_spawn()
  db.actor:give_info_portion( "spawn_after_molniy" )
end


function otkr_perex_zaton_sms1()
  sak.add_new_dcity_to_zaton()
  local snd = news_manager.send_tip(
    db.actor, "otkr_perex_zaton_sms1", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity3", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".otkr_perex_zaton_sms2" )
end

function otkr_perex_zaton_sms2()
  news_manager.send_tip( db.actor, "otkr_perex_zaton_sms2", nil, nil, 15000 )
  dell_dcity_norman()
  dsh.start_on_spawn_another_level( script_name() .. ".acv_sol", "zaton" )
end


function acv_sol()
  dsh.story_sms_timer( 10, script_name() .. ".acv_sol1" )
end

function acv_sol1()
  db.actor:give_info_portion( "acv_sol" )
  dsh.black_doc_exo_start_sms_delayed()
end


function nashel_listok_sms1()
  dell_parfuym1()
  local snd = news_manager.send_tip(
    db.actor, "nashel_listok_sms1", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\strelok_dcity2", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".nashel_listok_sms2" )
end

function nashel_listok_sms2()
  news_manager.send_tip( db.actor, "nashel_listok_sms2", nil, nil, 25000 )
  db.actor:give_info_portion( "parfumer_shtab_spawn" )
end


function operator_babki_otdat_sms()
news_manager.send_tip(db.actor, "operator_babki_otdat_sms", nil, nil, 25000, nil, "characters_voice\\ozvuchka\\babki_za_svyz1")
end
function operator_babki_otdat_sms1()
news_manager.send_tip(db.actor, "operator_babki_otdat_sms1", nil, nil, 20000, nil, "characters_voice\\ozvuchka\\lukash_operator_svyzi")
end
function operator_babki_otdat_sms2()
news_manager.send_tip(db.actor, "operator_babki_otdat_sms2", nil, nil, 20000, nil, "characters_voice\\ozvuchka\\kuzy_operator_svyzi")
end
function operator_babki_otdat_sms3()
news_manager.send_tip(db.actor, "operator_babki_otdat_sms3", nil, nil, 20000, nil, "characters_voice\\ozvuchka\\lusuy_operator_svyzi")
end
function operator_babki_otdat_sms4()
news_manager.send_tip(db.actor, "operator_babki_otdat_sms4", nil, nil, 25000, nil, "characters_voice\\ozvuchka\\babki_za_svyz2")
end
function bland_sms()
news_manager.send_tip(db.actor, "bland_sms", nil, nil, 30000, nil, "characters_voice\\ozvuchka\\blend_samoskoki")
end
function bland_sms1()
news_manager.send_tip(db.actor, "bland_sms1", nil, nil, 25000, nil, "characters_voice\\ozvuchka\\blend_pochudil")
end


function sborr_sms()
  local snd = news_manager.send_tip(
    db.actor, "sborr_sms", nil, nil, 25000
    -- , nil, "characters_voice\\ozvuchka\\strelok_dcity1", true
  )
end


function nachalnik_zvonok_sms1()
  dsh.story_sms_timer( 5, script_name() .. ".nachalnik_zvonok_sms2" )
end

function nachalnik_zvonok_sms2()
  db.actor:give_info_portion( "duda_zvonit" )
  local snd = news_manager.send_tip(
    db.actor, "nachalnik_zvonok_sms2", nil, nil, 30000, nil,
    "characters_voice\\ozvuchka\\duda_chasovoy", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".nachalnik_zvonok_sms3" )
end

function nachalnik_zvonok_sms3()
  local snd = news_manager.send_tip(
    db.actor, "nachalnik_zvonok_sms3", nil, nil, 20000, nil,
    "characters_voice\\ozvuchka\\chasovoy_xokkey", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".nachalnik_zvonok_sms4" )
end

function nachalnik_zvonok_sms4()
  db.actor:give_info_portion( "duda_finish_zvonka" )
end


--' заспавним изломов в деревне рестриктором
function spawn_village_izlom()
  battle.create_enemies(
    {
      { "fracture_strong",vector():set(77.537,10.171,26.215),37126,3333 },
      { "fracture_strong",vector():set(75.063,10.069,26.122),36278,3333 },
    }
  )
end

function set_pantera()
  for a, obj in alife():objects() do
    if obj:name() == "marsh_pantera" then 
      amk.add_spot_on_map(obj.id,"crlc_big","set_pantera") 
      break
    end
  end
end

function remove_pantera_metka()
  for a, obj in alife():objects() do
    if obj:name() == "marsh_pantera" then 
      level.map_remove_object_spot(obj.id,"crlc_big")
      break
    end
  end
end

--' спавним пару кабанов у Пантеры на болотах
function spawn_boar1_marsh()
  battle.create_enemies(
    {
      { "boar_strong",vector():set(-297.283,-0.292,113.592),1496,3378 },
      { "boar_strong",vector():set(-297.283,-0.292,113.592),1496,3378 },
      { "boar_strong",vector():set(-297.282,-0.292,113.592),1496,3378 },
    }
  )
end

--' убираем людишек из Деревни
function delete_chel_village()
local se_obj = alife():object("village_kapatel3")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_stalk_dead1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_stalk_dead2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_stalk_dead3")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_brat_dead")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_kapatel1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_kapatel2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_magazin_kapatel1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_magazin_kapatel2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_magazin_kapatel3")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_xolm_kapatel1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_xolm_kapatel2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_xolm_kapatel3")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("village_xolm_kapatel4")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function metka_marsh_provodnik()
  local obj = alife():object( "boloto_provodnik" )
  if obj then 
    amk.add_spot_on_map(
      obj.id, "crlc_big", "metka_marsh_provodnik"
    )
  end
end

function remove_metka_marsh_provodnik()
  local obj = alife():object( "boloto_provodnik" )
  if obj then 
    level.map_remove_object_spot( obj.id, "crlc_big" )
  end
end


--' монстры на болотах
function marsh_many_monster()
  battle.create_enemies(
    {
      { "fracture_normal",vector():set(-220.359,0.839,232.703),32366,3378 },
      { "fracture_normal",vector():set(-220.359,0.839,232.703),32366,3378 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
end

--' Удаляем трупы сталков с Болот
function delete_stalky_marsh()
local se_obj = alife():object("marsh_stalker_burer1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("marsh_stalker_burer2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("marsh_stalker_burer3")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие финансов для проводника
function sorok_shtuk(actor,npc)
    return actor:money() > 40000
end

--' отдадим деньги проводнику за переход
function bolloto_prov_take_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,40000,"out")
end

--' убираем проводника, Пантеру с болот 
function delete_bol_provodnik()
local se_obj = alife():object("boloto_provodnik")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("marsh_pantera")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Пилигрима с бара
function delete_pili_bar()
local se_obj = alife():object("piligrim_bar")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Пантеру из Деревни
function delete_vill_pantera()
local se_obj = alife():object("village_pantera")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' убираем мобильного торгаша с Агры
function delete_agro_mobil_torgash()
  local se_obj = alife():object( "agro_mobil_torgash" )
  if se_obj then
    -- сначала прерываем диалог
    local obj = level.object_by_id( se_obj.id )
    if obj and obj:is_talking() then
      obj:stop_talk()
      db.actor:stop_talk()
    end
    -- затем удаляем
    ogse_st_mgr.start_timer(
      nil, 0.2, "arhara_dialog.delete_agro_mobil_torgash2"
    )
  end
end

function delete_agro_mobil_torgash2()
  local se_obj = alife():object( "agro_mobil_torgash" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


-- спавним пси-антенну на Кордоне
function x_ray_antenna_spawn()
  local sobj = alife():create(
    "x_ray_antenna", vector():set( 109.698, 4.617, 459.677 ), 411976, 223
  )
  amk.add_spot_on_map(
    sobj.id, "crlc_big", "x_ray_antenna_spawn"
  )
  sak.create_items_actor( "af_spirit_3", 1 )
end

function remove_metka_psi_antenna() end

-- проверим наличие пси-антенны
function klenov_antena_have()
  return sak.have_item_namber( "x_ray_antenna", 1 )
end


-- отдадим антенну Клёнову
function klenov_antena_done()
  sak.out_item_namber( "x_ray_antenna", 1 )
  dsh.story_sms_timer( 10, script_name() .. ".otsroch_sms" )
end


-- пси-спавн на Кордоне рестриктором1
function spawn_psi_one_one()
  battle.create_enemies(
    {
      { "fracture_normal",vector():set(107.289,1.650,457.066),408582,223 },
      { "fracture_normal",vector():set(108.022,1.703,456.664),409435,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
  level.add_pp_effector("psi.ppe", 2008, false)
  dsh.story_sms_timer( 8, script_name() .. ".spawn_psi_one_two" )
end

function spawn_psi_one_two()
  battle.create_enemies(
    {
      { "chimera_normal",vector():set(106.582,1.580,458.101),407745,223 },
      { "chimera_normal",vector():set(105.914,1.565,457.573),406900,199 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
  level.add_pp_effector("amk_shoot.ppe", 2011, false)
  level.add_pp_effector("snd_shock.ppe", 2008, false) 
  dsh.story_sms_timer( 8, script_name() .. ".spawn_psi_one_tri" )
end

function spawn_psi_one_tri()
  battle.create_enemies(
    {
      { "pseudodog_normal",vector():set(105.313,1.533,457.661),406045,199 },
      { "pseudodog_normal",vector():set(106.582,1.580,458.101),407745,223 },
      { "dog_normal",vector():set(106.582,1.580,458.101),407745,223 },
      { "dog_normal",vector():set(107.289,1.650,457.066),408582,223 },
      { "dog_normal",vector():set(107.289,1.650,457.066),408582,223 },
      { "dog_weak",vector():set(107.289,1.650,457.066),408582,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false) 
  level.add_pp_effector("alcohol.ppe", 3000, false)
  level.add_pp_effector("psi.ppe", 2008, false)
  level.add_pp_effector("snd_shock.ppe", 2008, false)
  dsh.story_sms_timer( 10, script_name() .. ".spawn_psi_one_four" )
end

function spawn_psi_one_four()
  battle.create_enemies(
    {
      { "m_controller_old",vector():set(107.289,1.650,457.066),408582,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false) 
  level.add_pp_effector("alcohol.ppe", 3000, false)
  dsh.story_sms_timer( 10, script_name() .. ".spawn_psi_one_five" )
end

function spawn_psi_one_five()
  battle.create_enemies(
    {
      { "tushkano_normal",vector():set(105.914,1.565,457.573),406900,199 },
      { "tushkano_strong",vector():set(105.914,1.565,457.573),406900,199 },
      { "tushkano_normal",vector():set(105.914,1.565,457.573),406900,199 },
      { "tushkano_strong",vector():set(105.313,1.533,457.661),406045,199 },
      { "tushkano_normal",vector():set(105.313,1.533,457.661),406045,199 },
      { "tushkano_strong",vector():set(105.313,1.533,457.661),406045,199 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false) 
  level.add_pp_effector("psychic.ppe", 2008, false)
  level.add_pp_effector("snd_shock.ppe", 2008, false)
  dsh.story_sms_timer( 10, script_name() .. ".spawn_psi_one_six" )
end

function spawn_psi_one_six()
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(105.313,1.533,457.661),406045,199 },
      { "zombie_normal",vector():set(106.582,1.580,458.101),407745,223 },
      { "zombie_normal",vector():set(106.582,1.580,458.101),407745,223 },
      { "zombie_normal",vector():set(106.582,1.580,458.101),407745,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false) 
  level.add_pp_effector("teleport.ppe", 2006, false)
  dsh.story_sms_timer( 10, script_name() .. ".spawn_psi_one_seven" )
end

function spawn_psi_one_seven()
  battle.create_enemies(
    {
      { "bloodsucker_normal",vector():set(107.289,1.650,457.066),408582,223 },
      { "bloodsucker_normal",vector():set(107.289,1.650,457.066),408582,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
  level.add_pp_effector("amk_shoot.ppe", 2011, false)
  level.add_pp_effector("psi.ppe", 2008, false)
  level.add_pp_effector("alcohol.ppe", 3000, false) 
end

-- пси-спавн на Кордоне рестриктором2
function spawn_psi_two_one()
  battle.create_enemies(
    {
      { "snork_normal",vector():set(108.022,1.703,456.664),409435,223 },
      { "snork_normal",vector():set(107.289,1.650,457.066),408582,223 },
      { "snork_normal",vector():set(108.022,1.703,456.664),409435,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false) 
  level.add_pp_effector("psi.ppe", 2008, false)
  level.add_pp_effector("amk_shoot.ppe", 2011, false)
  dsh.story_sms_timer( 10, script_name() .. ".spawn_psi_two_two" )
end

function spawn_psi_two_two()
  battle.create_enemies(
    {
      { "boar_strong",vector():set(106.582,1.580,458.101),407745,223 },
      { "boar_strong",vector():set(105.914,1.565,457.573),406900,199 },
      { "boar_strong",vector():set(105.313,1.533,457.661),406045,199 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
  level.add_pp_effector("amk_shoot.ppe", 2011, false)
  level.add_pp_effector("snd_shock.ppe", 2008, false) 
  dsh.story_sms_timer( 9, script_name() .. ".spawn_psi_two_tri" )
end

function spawn_psi_two_tri()
  battle.create_enemies(
    {
      { "gigant_normal",vector():set(105.313,1.533,457.661),406045,199 },
      { "gigant_normal",vector():set(107.289,1.650,457.066),408582,223 },
    }
  )
  level.add_pp_effector ("blink.ppe", 234, false)
  level.add_pp_effector("alcohol.ppe", 3000, false) 
  level.add_pp_effector("teleport.ppe", 2006, false)
  level.add_pp_effector("snd_shock.ppe", 2008, false)
end


function to_limansk()
	if not has_alife_info("black_doctor_finish_dialog") then
	    news_manager.send_tip(db.actor, "sms_to_limansk", nil, nil, 30000)
		-- Звуковое сопровождение
		local snd_obj = xr_sound.get_safe_sound_object("device\\pda\\pda_tip")
		snd_obj:play(db.actor, 0, sound_object.s2d)
	end
end

--' убираем 1 дес вертуху с Агры
function dell_arhara_desant_heli1()
local se_obj = alife():object("agr_arhara_desant_heli1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем 2 дес вертуху с Агры
function dell_arhara_desant_heli2()
local se_obj = alife():object("agr_arhara_desant_heli2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем вертуху торгаша с Агры
function dell_torgash_heli()
local se_obj = alife():object("agro_torgash_heli")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем 2 дес вертуху с Кордона
function dell_esc_desant_heli_2()
local se_obj = alife():object("esc_arhara_desant_heli_2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем 1 дес вертуху с Кордона
function dell_esc_desant_heli_1()
local se_obj = alife():object("esc_arhara_desant_heli_1")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- убираем 1 дес вертуху из деревни
function dell_village_heli1()
  local se_obj = alife():object( "lost_village_heli_1" )
  if se_obj then
    alife():release( se_obj, true )
  end
end

function spawn_village_heli1()
  alife():create( 12970 )
  alife():create( 12972 )
end

-- убираем 2 дес вертуху из деревни
function dell_village_heli2()
  local se_obj = alife():object( "lost_village_heli_2" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


--' убираем Звездочёта из лагеря новисов
function dell_zvezd_novise()
local se_obj = alife():object("zvezd_after_warl")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' спавним тайники с эмбрионами на болотах
function spawn_embrion_taynik()
  dsh.create_and_map_treasure(
    game.translate_string( "spawn_embrion_taynik_0" ),
    game.translate_string( "spawn_embrion_taynik_1" ),
    "m_inventory_box27",
    vector():set( -210.150, -0.397, 392.077 ), 29502, 3361
  )
  dsh.create_and_map_treasure(
    game.translate_string( "spawn_embrion_taynik_0" ),
    game.translate_string( "spawn_embrion_taynik_1" ),
    "m_inventory_box28",
    vector():set( -176.410, 0.787, 390.441 ), 53178, 3361
  )
  dsh.create_and_map_treasure(
    game.translate_string( "spawn_embrion_taynik_0" ),
    game.translate_string( "spawn_embrion_taynik_1" ),
    "m_inventory_box29",
    vector():set( -216.538, -0.381, 385.430 ), 39492, 3361
  )
end


-- проверим наличие эмбрионов
function boloto_provod_vstrecha_have()
 return sak.have_item_namber( "mutant_zombie_cocoon", 2 ) ~= false
end

-- оставим эмбрионы, а лучше дадим СМС
function boloto_provod_vstrecha_done()
  sak.out_item_namber( "mutant_zombie_cocoon", 2 )
  news_manager.send_tip(
    db.actor, "boloto_provod_vstrecha_done", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_114"
  )
end	


function village_kap_pda()
  dsh.story_sms_timer( 5, script_name() .. ".village_kap_pda1")
end

function village_kap_pda1()
  local snd = news_manager.send_tip(
    db.actor, "village_kap_pda1", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_132"
  )
  dsh.story_sms_timer( snd, script_name() .. ".village_kap_pda2" )
end

function village_kap_pda2()
  local snd = news_manager.send_tip(
    db.actor, "village_kap_pda2", nil, nil, 10000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_133"
  )
  dsh.story_sms_timer( snd, script_name() .. ".village_kap_pda3" )
end

function village_kap_pda3()
  news_manager.send_tip( db.actor, "village_kap_pda3", nil, nil, 10000 )
  dsh.story_sms_timer( 5, script_name() .. ".village_kap_pda4" )
end

function village_kap_pda4()
  db.actor:give_info_portion( "derevny_zashita_have" )
end


-- отдадим ПДА Колмогору
function derevny_zashita_done()
  sak.out_item_namber( "kapitan_pda", 1 )
end


function delete_pereod_gen_bol()
  for _, name in ipairs({
    "gener_dok_stalk2", "generators_black_dok", "esc_trupak_antenna"
  }) do
    local sobj = alife():object( name )
    if sobj then
      dsh.release_mob( sobj )
    end
  end
end


--' проверим наличие 100000 для Земляка
function sto_shtuk(actor,npc)
    return actor:money() > 100000
end

--' отдадим 100000 Земляку
function zemlyk_take_money(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,100000,"out")
end

--' проверим наличие 50000 для Земляка
function pytdesyt_shtuk(actor,npc)
    return actor:money() > 50000
end

--' отдадим 50000 Земляку
function zemlyk_take_pytdesyt(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,50000,"out")
end

--' убираем квестовую вертуху с Генераторов
function dell_gen_heli_hit()
local se_obj = alife():object("generators_heli_hit")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' спавним джойстик Андерсена
function spawn_joystik()
  dsh.create_and_map_treasure(
    game.translate_string( "spawn_joystik_0" ),
    game.translate_string( "spawn_joystik_1" ),
    "pult_anders",
    vector():set( 77.743, 37.345, -268.534 ), 428006, 3114
  )
end


--' спавним немного артов на Генераторах
function spawn_generators_art1()
end

--' спавним ещё немного артов на Генераторах
function spawn_generators_art2()
local obj = alife():create("af_phantom",vector():set(-204.805,29.777,-103.302),101471,3085)
end

--' заводим третий генератор
function generator3_vkl()
local obj = alife():create("imitator",vector():set(-36.434,45.577,-257.662),295045,3105)
local obj = alife():create("imitator",vector():set(-36.434,45.577,-257.662),295045,3105)
local obj = alife():create("imitator",vector():set(-36.807,45.471,-257.168),291121,3105)
local obj = alife():create("imitator",vector():set(-36.807,45.471,-257.168),291121,3105)
local obj = alife():create("imitator",vector():set(-32.598,40.993,-255.071),296678,3105)
local obj = alife():create("imitator",vector():set(-33.763,40.597,-260.812),295852,3105)
local obj = alife():create("imitator",vector():set(-39.815,39.999,-258.828),291121,3105)
local obj = alife():create("imitator",vector():set(-36.467,44.480,-254.494),291121,3105)
local obj = alife():create("imitator",vector():set(-36.467,44.480,-254.494),291121,3105)
end

--' убираем Звездочёта с Генераторов
function dell_zvezd_generators()
local se_obj = alife():object("generators_zvezdochet")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним пёсиков на пути Удава на болотах
function spawn_dog_udav_boloto()
  battle.create_enemies(
    {
      { "dog_weak",vector():set(-200.920,4.329,522.086),115055,3393 },
      { "dog_weak",vector():set(-200.920,4.329,522.086),115055,3393 },
      { "dog_normal",vector():set(-200.920,4.329,522.086),115055,3393 },
      { "dog_normal",vector():set(-200.920,4.329,522.086),115055,3393 },
      { "pseudodog_weak",vector():set(-200.920,4.329,522.086),115055,3393 },
      { "pseudodog_weak",vector():set(-200.920,4.329,522.086),115055,3393 },
    }
  )
end

--' убираем Боцмана с болот
function dell_udav_bolota()
local se_obj = alife():object("marsh_udav")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем вертуху с болот при смерти Боцмана
function dell_marsh_heli_dok()
local se_obj = alife():object("marsh_heli_dok")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем вертуху с дока с генераторов
function dell_generators_heli_dok()
local se_obj = alife():object("generators_heli_dok")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' проверим наличие джойстика
function ander_joystik_say_have() 
  local have = sak.have_item_namber( "pult_anders", 1 ) ~= false
  if have then
    dsh.map_remove_treasure_inv( "pult_anders" )
  end
  return have
end


function metka_gener_udav()
  local obj = alife():object( "generators_udav" )
  if obj then
    level.map_add_object_spot_ser( obj.id, "blue_location", "metka_gener_udav" )
  end
end

function remove_metka_gener_udav()
  local obj = alife():object( "generators_udav" )
  if obj then
    level.map_remove_object_spot( obj.id, "blue_location", "metka_gener_udav" )
  end
  plan_zahvata_sms1()
end


--' отдадим джойстик Боцману
function joystik_otdal(first_speaker, second_speaker)
sak.out_item_namber("pult_anders",1)
end

--' убираем Фрица с Генераторов
function dell_frits()
local se_obj = alife():object("frits")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Фрица2 с Генераторов
function delete_frits2()
local se_obj = alife():object("gener_frits2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем охрану Андерсена 
function delete_ohrana_ander()
local se_obj = alife():object("gener_dok_stalk1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("gener_dok_stalk3")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Сапсана с генеров
function del_gen_komandir()
local se_obj = alife():object("gener_desant_black_komandir")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем тело Пантеры, Дока и Сапсана 
function delete_pebyta_after_proval()
--local se_obj = alife():object("gener_desant_black_komandir")
  --if se_obj then
    --alife():release(se_obj, true)
  --end
local se_obj = alife():object("gener_bl_doktor1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("generators_pantera_dead")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- заспавним ключ от секретки НЗ
function kluch_teleport2_spawn()
  if not has_alife_info( "generators_code_door_unlocked_spawn" ) then
    alife():create(
      "kluch_dell_teleport2",
      vector():set( 172.326, 29.329, -492.119 ), 535422, 3152
    )
--[=[
    battle.create_enemies(
      {
        { "pseudodog_weak",vector():set(172.366,28.740,-493.136),535420,3152 },
        { "dog_normal",vector():set(172.366,28.740,-493.136),535420,3152 },
        { "pseudodog_weak",vector():set(162.445,22.799,-500.679),523880,3152 },
        { "pseudodog_normal",vector():set(162.445,22.799,-500.679),523880,3152 },
        { "dog_weak",vector():set(162.445,22.799,-500.679),523880,3152 },
        { "dog_normal",vector():set(162.445,22.799,-500.679),523880,3152 },
        { "bloodsucker_normal",vector():set(152.704,17.637,-500.195),512486,3152 },
      }
    )
--]=]
    db.actor:give_info_portion( "generators_code_door_unlocked_spawn" )
  end
end


--' убираем Боцмана с Генераторов 
function delete_botsman_gener()
local se_obj = alife():object("generators_udav")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- Получим блокнот Пантеры от Призрака
function take_bloknot_pantera()
  sak.create_items_actor( "bloknot_pantera", 1 )
  dok_podvox_sms1()
end


--' заспавним арт и досье Звездочёта
function dosye_zvez_spawn()
  alife():create("dosye_zvez",vector():set(87.017,24.595,-15.456),437960,3119)
  alife():create("af_spirit_3",vector():set(86.514,24.580,-15.479),437960,3119)
  battle.create_enemies(
    {
      { "chimera_normal",vector():set(90.968,25.641,-61.678),442584,3121 },
      { "chimera_normal",vector():set(46.080,23.543,-23.047),390432,3119 },
    }
  )
end

--' спавним зомбаков на генераторах у деревни
function gener_spawn_zombaki()
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(-127.703,43.418,-549.804),187271,3093 },
      { "zombie_strong",vector():set(-127.703,43.418,-549.804),187271,3093 },
      { "zombie_normal",vector():set(-127.703,43.418,-549.804),187271,3093 },
      { "zombie_normal",vector():set(-130.494,43.038,-543.485),192838,3093 },
      { "zombie_normal",vector():set(-130.494,43.038,-543.485),192838,3093 },
      { "zombie_normal",vector():set(-130.494,43.038,-543.485),192838,3093 },
      { "zombie_normal",vector():set(-121.858,42.962,-546.894),195197,3093 },
      { "zombie_normal",vector():set(-121.857,42.962,-546.894),195197,3093 },
      { "zombie_normal",vector():set(-121.859,42.962,-546.894),195197,3093 },
    }
  )
end

--' убираем Клыка с Бара
function delete_kluk_bar()
local se_obj = alife():object("kluk_bar")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- отдадим досье Клыку
function dosye_zvez_otdal()
  amk_utils.out_items({ "dosye_zvez" })
end


--' заспавним зомби на радаре
function spawn_zombi_padar()
  battle.create_enemies(
    {
      { "zombie_strong",vector():set(-10.776,0.198,-48.988),7089,1960 },
    }
  )
end


-- убираем аллспавновскую куклу у колб на радаре
function dell_radar_kukla()
  local se_obj = alife():object( "radar_kukla" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


-- заспавним куклу на радаре и возьмём её фото
function spawn_kukolka( first_speaker, second_speaker )
  sak.create_items_actor( "foto_kukla", 1 )
  alife():create(
    "kukla_1", vector():set( -10.734, 0.198, -54.009 ), 7084, 1960
  )
  local sobj = alife():create(
    "anomal_pole", vector():set( -10.734, 0.198, -54.009 ), 7084, 1960
  )
  alife():assign_story_id( sobj.id, story_ids.kukla_1_anomal_pole )
end


-- проверим наличие куклы
function muha_kukla_have()
  local res = sak.have_item_namber( "kukla_1", 1 ) ~= false
  if res then
    local sobj = alife():object( "padar_spawn_zombi_kukla_restrictor" )
    if sobj then
      alife():release( sobj )
    end
  end
  return res
end


-- отдадим куклу и фото Мухе
function muha_kukla_done( first_speaker, second_speaker )
  sak.out_item_namber( "kukla_1", 1 )
  second_speaker:set_relation( game_object.friend, first_speaker )
  local sobj = alife():story_object( story_ids.kukla_1_anomal_pole )
  if sobj then
    alife():release( sobj )
  end
end



--' убираем Пантеру и Звездочёта с НЗ 
function delete_aver_vragi()
local se_obj = alife():object("aver_zvezdochet2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("aver_pantera_new")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- спавним записку пилота на чаэс2
function spawn_chaes_pilot_zapiska()
  alife():create(
    "samopisez", vector():set( 152.873, 70.873, 121.853 ), 69353, 2573
  )
  db.actor:give_info_portion( "voronin_samopisez_start" )
end

function spawn_chaes_pilot_zapiska2()
  alife():create(
    "pilot_zapiska", vector():set( 243.750, 20.599, 151.565 ), 78081, 2573
  )
  alife():create(
    "m_inventory_box30", vector():set( 251.823, 11.379, 175.369 ), 88107, 2577
  )
  spawn_teleport_1_chaes2()
end


--' убираем Призрака с ЧАЭС1
function dell_chaes1_prizrak()
local se_obj = alife():object("chaes1_prizrak")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' получим арты от Клёнова
function polt_art_done(first_speaker, second_speaker)
  sak.create_items_actor( "af_part_monolit1", 1 )
  sak.create_items_actor( "af_spiral", 1 )
end


-- отдадим самописец Воронину
function voronin_samopisez_have()
  return sak.have_item_namber( "samopisez", 1 )
end

function voronin_samopisez_done()
  sak.out_item_namber( "samopisez", 1 )
  iz_moskvy_sms1()
end


--' убираем вертуху Пантеры с авера
function dell_pantera_vertuha_aver()
local se_obj = alife():object("pantera_vertuha_aver")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем вертуху Отшельника с авера
function dell_aver_arhara_heli_1()
local se_obj = alife():object("aver_arhara_heli_1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем военных с генер. вертолёта с НЗ 
function dell_muziki_aver()
local se_obj = alife():object("soprov_muha_soldat1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("soprov_muha_soldat2")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- убираем Муху с НЗ 
function dell_devchonka()
  dsh.start_on_spawn_another_level( script_name() .. ".dell_devchonka1" )
end

function dell_devchonka1()
  local se_obj = alife():object( "devchonka" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
end


--' спавним ящик с верта военных на авере
function spawn_general_prezent()
	if not has_alife_info("spawn_general_prezent_info") then
		local se_obj = alife():create("m_inventory_box31", vector():set(-320.174,-8.726,21.975),320365,2889)
		db.actor:give_info_portion("spawn_general_prezent_info")
	end
end

--' заспавним зомби на авере
function aver_spawp_zombiki()
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(51.951,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.951,-13.962,-185.843),958151,2908 },
      { "zombie_strong",vector():set(51.951,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.951,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.951,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9511,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9512,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9513,-13.962,-185.843),958151,2908 },
      { "zombie_weak",vector():set(51.9514,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9515,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9516,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9517,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9518,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.9519,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.95199,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.95199,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.95199,-13.962,-185.843),958151,2908 },
      { "zombie_normal",vector():set(51.95199,-13.962,-185.843),958151,2908 },
    }
  )
end

--' убираем учёных с генераторов 
function dell_lomonosov()
local se_obj = alife():object("solvador")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("andersen")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним вороний глаз
function gener_spawn_eye_voron()
local obj = alife():create("af_eye_voron.af_bio",vector():set(184.070,28.537,-565.312),548909,3137)
local obj = alife():create("af_eye_voron.af_bio",vector():set(195.765,35.845,-573.473),562425,3152)
local obj = alife():create("m_inventory_box32",vector():set(190.773,35.842,-574.642),556868,3152)
local obj = alife():create("mini_antenna1",vector():set(189.175,28.536,-566.536),554518,3137)
local obj = alife():create("mini_antenna2",vector():set(195.494,28.630,-555.928),563238,3143)
local obj = alife():create("mini_antenna3",vector():set(203.440,28.548,-565.897),571113,3143)
local obj = alife():create("mini_antenna4",vector():set(189.671,28.536,-572.527),555297,3137)
local obj = alife():create("mini_antenna5",vector():set(182.885,35.841,-562.001),547286,3152)
end

--' отключаем аномалии на генераторах
function delete_gen_zone_emi1(story_id)
local se_obj = alife():story_object(18104)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_gen_zone_emi1", nil, nil, 20000)
end
end

function checking_taken_item51(obj)
    if obj:section()=="mini_antenna1" then delete_gen_zone_emi1(obj)
 end
end

function delete_gen_zone_emi2(story_id)
local se_obj = alife():story_object(18105)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_gen_zone_emi1", nil, nil, 20000)
end
end

function checking_taken_item52(obj)
    if obj:section()=="mini_antenna2" then delete_gen_zone_emi2(obj)
 end
end

function delete_gen_zone_emi3(story_id)
local se_obj = alife():story_object(18106)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_gen_zone_emi1", nil, nil, 20000)
end
end

function checking_taken_item53(obj)
    if obj:section()=="mini_antenna3" then delete_gen_zone_emi3(obj)
 end
end

function delete_gen_zone_emi4(story_id)
local se_obj = alife():story_object(18107)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_gen_zone_emi1", nil, nil, 20000)
end
end

function checking_taken_item54(obj)
    if obj:section()=="mini_antenna4" then delete_gen_zone_emi4(obj)
 end
end

function delete_gen_zone_emi5(story_id)
local se_obj = alife():story_object(18108)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_gen_zone_emi1", nil, nil, 20000)
end
end

function checking_taken_item55(obj)
    if obj:section()=="mini_antenna5" then delete_gen_zone_emi5(obj)
 end
end

-- убираем псевдотелепорт, Сапсана и свободовца
function gen_dell_tele_sapsan()
  local se_obj = alife():object( "gen_sapsan1" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():story_object( story_ids.gen_imitator_tele_final1 )
  if se_obj then
    alife():release( se_obj )
  end
--[=[
  se_obj = alife():object( "gen_svoboda_parlamenter" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
--]=]
end

--' проверим наличие генераторов помех
function solvador_say_have() 
return new_dialog.item_much("mini_antenna1",1) ~= false and
new_dialog.item_much("mini_antenna2",1) ~= false and
new_dialog.item_much("mini_antenna3",1) ~= false and
new_dialog.item_much("mini_antenna4",1) ~= false and
new_dialog.item_much("mini_antenna5",1) ~= false
end


-- отдадим это барахло Сольвадору
function solvador_say_done()
  sak.out_item_namber( "mini_antenna1", 1 )
  sak.out_item_namber( "mini_antenna2", 1 )
  sak.out_item_namber( "mini_antenna3", 1 )
  sak.out_item_namber( "mini_antenna4", 1 )
  sak.out_item_namber( "mini_antenna5", 1 )
  vitamin_posrednik_sms1()
end


--' убираем копии учёных с Генераторов 
function dell_uchen_gen_povtorno()
local se_obj = alife():object("gen_solvador1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("gen_andersen1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Андерсена1 с генеров 
function dell_uchen_andersen1()
local se_obj = alife():object("gen_andersen1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Сольвадора1 с генеров 
function dell_uchen_solvador1()
local se_obj = alife():object("gen_solvador1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним парочку гигантов у шлагбаума
function gen_shlag_gigantu()
  battle.create_enemies(
    {
      { "gigant_normal",vector():set(71.960,26.516,-96.341),420846,3120 },
      { "gigant_strong",vector():set(71.960,26.516,-96.341),420846,3120 },
    }
  )
end

--' убираем второго Клыка с авера
function dell_new_kluk_nz()
local se_obj = alife():object("new_kluk_nz")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function set_kluk_chaes2()
  local obj = alife():object( "kluk_chaes2" )
  if obj then
    amk.add_spot_on_map( obj.id, "crlc_big", "set_kluk_chaes2" )
  end
end


function remove_kluk_chaes2_metka()
  local obj = alife():object( "kluk_chaes2" )
  if obj then
    level.map_remove_object_spot( obj.id, "crlc_big" )
  end
end


function priz_pamt_sms1()
  local snd = news_manager.send_tip(
    db.actor, "priz_pamt_sms1", nil, nil, 30000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leaves\\leaves_116", true
  )
end


-- получим фото от Клыка на ЧАЭС2
function dal_chaes2_karta()
  sak.create_items_actor( "chaes2_karta_kluk", 1 )
end


-- убираем Клыка с чаэс2 а заодно и Пантеру с генераторов
function dell_kluk_chaes2()
  local se_obj = alife():object( "kluk_chaes2" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "gen_pantera_life" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "chaes2_arhara_beter1" )
  if se_obj then
    alife():release( se_obj )
  end
end


-- заспавним бочки на чаэс2
function chaes2_expl_barrel()
  alife():create("explosive_barrel",vector():set(306.832,-0.347,229.748),112853,2587)
  alife():create("explosive_barrel",vector():set(306.832,-0.347,229.748),112853,2587)
  alife():create("explosive_bomba",vector():set(306.832,-0.347,229.748),112853,2587)
  alife():create("explosive_mobiltank",vector():set(306.832,-0.347,229.748),112853,2587)
  alife():create("explosive_mobiltank",vector():set(306.832,-0.347,229.748),112853,2587)
  alife():create("explosive_mobiltank",vector():set(306.832,-0.347,229.748),112853,2587)
end


--' заспавним моолитовцев на трубе
function mono_chaes2_truba_1()
end

function mono_chaes2_truba_2()
end


--' заспавним makrogenerator
--function spawn_makrogenerator()
--local obj = alife():create("makrogenerator",vector():set(-85.708,38.329,617.077),3905,3066)
--local obj = alife():create("makrogenerator",vector():set(-94.883,46.037,541.781),7496,3063)
--end

--' Оживим Муху
function otsek_ozivlenie()
local obj = alife():create("imitator",vector():set(-94.531,28.299,566.873),1087,3038)
level.add_pp_effector ("blink.ppe", 234, false) 
level.add_pp_effector("snd_shock.ppe", 2008, false)
end

--' убираем труп Мухи из Госпиталя 
function dell_hospital_muha_trup()
local se_obj = alife():object("hospital_muha_trup")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним живую капсулу у Мухи и 3 у дока
function sp_live_kapsula()
local obj = alife():create("caps_mincer_average",vector():set(-95.816,28.425,567.057),843,3038)
local obj = alife():create("caps_mincer_average",vector():set(-95.578,32.454,614.056),868,3038)
local obj = alife():create("caps_mincer_average",vector():set(-95.447,32.558,615.379),1026,3038)
local obj = alife():create("caps_mincer_average",vector():set(-95.606,32.499,614.533),869,3038)
end

--' варим Камень Удачи
function otsek_varka_kamen()
level.add_pp_effector ("blink.ppe", 234, false) 
level.add_pp_effector("snd_shock.ppe", 2008, false)
level.add_pp_effector("teleport.ppe", 2006, false)
end


--' подмена артов в госпитале
function hosp_podmena()
end

function hosp_taik_new_art()
end

function hosp_taik_new_art_sms()
  news_manager.send_tip(
    db.actor, "hosp_taik_new_art_sms", nil, "nano", 5000, nil,
    "characters_voice\\human_03\\stalker\\talk\\leave\\leave_174"
  )
end


--' убираем голограмму ЧД 
function dell_hospital_bl_dok()
local se_obj = alife():object("hospital_bl_dok")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' проверим наличие артов для ЧД
function artu_chd()
  return amk_utils.inventory_search_check({
    [ "af_part_monolit1" ] = 1,
    [ "af_water_flower"  ] = 1,
  })
end


-- убираем отца, Пантеру и Кота
function dell_otez_and_pant()
  local names = { "hosp_father", "hospital_pantera_girl", "kot_hos" }
  for _, n in ipairs( names ) do
    local se_obj = alife():object( n )
    if se_obj then
      dsh.release_mob( se_obj )
    end
  end
end


-- Получим кредитку от ЧД и отдадим Сердце Полтергейста
function chd_dal_kreditku()
  sak.out_item_namber( "af_part_monolit1", 1 )
  sak.create_items_actor( "kreditka", 1 )
end

--' Получим кредитку от ЧД и отдадим Камень Удачи
function chd_otdat_kamen(first_speaker, second_speaker)
sak.out_item_namber("af_kamen_udachy",1)
dialogs.relocate_item_section(second_speaker, "kreditka","in")
end

--' проверим наличие Камня удачи
function af_kamen_est()
return sak.have_item_namber("af_kamen_udachy",1) ~= false
  end


--' убираем Седого с атп
function atp_sedoy_dell()
  local se_obj = alife():object( "atp_mobil_torgovetz" )
  if se_obj then
    -- сначала прерываем диалог
    local obj = level.object_by_id( se_obj.id )
    if obj and obj:is_talking() then
      obj:stop_talk()
      db.actor:stop_talk()
    end
    -- затем удаляем
    ogse_st_mgr.start_timer( nil, 0.2, "arhara_dialog.atp_sedoy_dell2" )
  end
end

function atp_sedoy_dell2()
  local se_obj = alife():object( "atp_mobil_torgovetz" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


--' убираем вертуху Седого с атп
function atp_sedoy_heli_dell()
local se_obj = alife():object("atp_sedoy_heli")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- заспавним имитатор перех. агро-болото
function agro_boloto_imitator()
  local sobj = alife():create(
    "imitator_shar",
    vector():set( -212.539, 2.577, -293.192 ), 23764, 688
  )
end

--' заспавним имитатор перех. кордон-болото
function kopdon_boloto_imitator()
local obj = alife():create("imitator_shar",vector():set(-247.803,-17.371,-204.223),10936,41)
end

--' убираём карту разведчика
function razved_karta_dell()
local se_obj = alife():object("razved_karta")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем дока с Припяти 
function prip_dok_arh_dell()
local se_obj = alife():object("prip_dok_arh")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем 2финальную вертуху с Агры
function dell_agro_final_heli2()
local se_obj = alife():object("agro_final_vert2")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем 1финальную вертуху с Агры
function dell_agro_final_heli1()
local se_obj = alife():object("agro_final_vert1")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем пассажиров 1 финальной вертухи
function delete_ludi_vert1()
local se_obj = alife():object("kapitan_agro")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("kuzhetsov")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_barman")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_saharov")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_klenov")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_voronin")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_petrenko")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_dan")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_borov")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем пассажиров 2 финальной вертухи
function delete_ludi_vert2()
local se_obj = alife():object("final_shade_mono")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_shaxter")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_otshelnik")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_akim")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_holod")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_chimaera")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_kolmogor")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_ara")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_lukash")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_krot")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем финального Архару 
function final_arhara_dell()
local se_obj = alife():object("final_arhara")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем финального Клыка 
function dell_kluk_final()
local se_obj = alife():object("final_kluk")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' заспавним имитатор финал группы
function sp_imit_tele2_final2()
local obj = alife():create("imitator_tele_final1",vector():set(265.387,5.630,-246.141),431101,702)
--local obj = alife():create("imitator_tele_final1",vector():set(265.753,5.494,-246.658),431248,702)
--local obj = alife():create("imitator_tele_final1",vector():set(265.200,5.716,-245.815),431102,702)
local obj = alife():create("imitator_tele_final1",vector():set(265.532,5.796,-245.531),431102,702)
end

--' убираем Призрака
function delete_final_prizrak()
local se_obj = alife():object("final_prizrak")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем дока
function delete_final_dok_arh()
local se_obj = alife():object("final_dok_arh")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Пили
function delete_final_piligrim()
local se_obj = alife():object("final_piligrim")
  if se_obj then
    alife():release(se_obj, true)
  end
end
---------------------------------------------------------------------------------------------------------
local tabl_art_v_buliz = { 
    ["af_armor_1"] = 0.4,
    ["af_armor_2"] = 0.3,
    ["af_armor_3"] = 0.2,
    ["af_armor_4"] = 0.1,
    ["af_babka_1"] = 0.4,
    ["af_babka_2"] = 0.3,
    ["af_babka_3"] = 0.2,
    ["af_babka_4"] = 0.1,
    ["af_cry_1"] = 0.4,
    ["af_cry_2"] = 0.2,
    ["af_cry_3"] = 0.1,
    ["af_dik_1"] = 0.4,
    ["af_dik_2"] = 0.3,
    ["af_dik_3"] = 0.2,
    ["af_dik_4"] = 0.1,
    ["af_kol_1"] = 0.4,
    ["af_kol_2"] = 0.3,
    ["af_kol_3"] = 0.2,
    ["af_kol_4"] = 0.1,
    ["af_pudd_1"] = 0.4,
    ["af_pudd_2"] = 0.3,
    ["af_pudd_3"] = 0.2,  
    ["af_pudd_4"] = 0.1,
    ["af_simbion"] = 0.4,
    ["af_spirit_1"] = 0.4,
    ["af_spirit_2"] = 0.3,
    ["af_spirit_3"] = 0.2,
    ["af_spirit_4"] = 0.1,
    ["af_caterpillar"] = 0.3,
    ["af_eye_voron"] = 0.2,
    ["af_night_star"] = 0.6,
    ["af_gold_fish"] = 0.6,
    ["af_cristall"] = 0.6,
    ["af_soul"] = 0.6,
    ["af_electra_moonlight"] = 0.6,
    ["af_ameba_mica"] = 0.6,
    ["af_dummy_spring"] = 0.6,
    ["af_dummy_pellicle"] = 0.6,
    ["af_dummy_battery"] = 0.6,
    ["af_dummy_dummy"] = 0.6,
    ["af_dummy_glassbeads"] = 0.6,
    ["af_rusty_sea-urchin"] = 0.6,
    ["af_fuzz_kolobok"] = 0.6
    }
local art_v_buliz_virogdeno_count = 0 -- количество вырожденных артефактов

--' радар арты пришли в негодность
function radar_udalyem_art()
    art_v_buliz_virogdeno_count = 0
end
--' получим  булыжники
function taik_bul(first_speaker, second_speaker) 
    for i=1,art_v_buliz_virogdeno_count,1 do
        dialogs.relocate_item_section(second_speaker, "af_buliz","in")
    end
end
------------------------------------------------------------------------------------------------------------------
--' пьём водку
function xrypnem_sto_gramm()
level.add_pp_effector("alcohol.ppe", 3000, false)
end
---------------------------------------------------------------------------------------------------------
local tabl_laba_v_buliz = { 
    ["af_armor_1"] = 1,
    ["af_armor_2"] = 1,
    ["af_armor_3"] = 1,
    ["af_armor_4"] = 1,
    ["af_babka_1"] = 1,
    ["af_babka_2"] = 1,
    ["af_babka_3"] = 1,
    ["af_cry_1"] = 1,
    ["af_cry_2"] = 1,
    ["af_cry_3"] = 1,
    ["af_dik_1"] = 1,
    ["af_dik_2"] = 1,
    ["af_dik_3"] = 1,
    ["af_dik_4"] = 1,
    ["af_kol_1"] = 1,
    ["af_kol_2"] = 1,
    ["af_kol_3"] = 1,
    ["af_kol_4"] = 1,
    ["af_pudd_1"] = 1,
    ["af_pudd_2"] = 1,
    ["af_pudd_3"] = 1,  
    ["af_pudd_4"] = 1,
    ["af_simbion"] = 1,
    ["af_spirit_1"] = 1,
    ["af_spirit_2"] = 1,
    ["af_spirit_3"] = 1,
    ["af_spirit_4"] = 1,
    ["af_caterpillar"] = 1,
    ["af_vyvert_green"] = 1,
    ["af_blood_green"] = 1 
 }
local laba_v_buliz_virogdeno_count = 0 -- количество вырожденных артефактов

--' х18 арты пришли в негодность
function laba_dell_art()
    laba_v_buliz_virogdeno_count = 0
end
--' получим  булыжники
function laba_bul(first_speaker, second_speaker) 
    for i=1,laba_v_buliz_virogdeno_count,1 do
        dialogs.relocate_item_section(second_speaker, "af_buliz","in")
    end
end


local tabl_laba_v_spiral = {
  [ "af_armor_1"     ] = 1,
  [ "af_cry_1"       ] = 1,
  [ "af_dik_1"       ] = 1,
  [ "af_kol_1"       ] = 1,
  [ "af_pudd_1"      ] = 1,
  [ "af_spirit_1"    ] = 1,
  [ "af_caterpillar" ] = 1,
}

--' замена артов в Х-10
function laba_del_artu()
  for a, v in pairs( tabl_laba_v_spiral ) do
    -- если вероятность вырождения "сработала"
    if math_random() < v then
      -- есть такие арты
      if amk_utils.inventory_search( a, 1 ) then
        amk_utils.out_items_number({
          [ a ] = 1,
        })
        break
      end
    end
  end
end


-- получим спиральки
function laba_spir()
  sak.create_items_actor( "af_spiral", 1 )
end


-- замена патронов в кр. лесу
local tabl_forest_v_izom = {
  [ "ammo_12x76_zhekan" ] = 1,
}

function forest_del_pistonu()
  local forest_v_izom_virogdeno_count = 0
  for a, v in pairs( tabl_forest_v_izom ) do
    if math_random() < v then
      local found = amk_utils.out_items({ a }, 5 )
      if found[ a ] then
        forest_v_izom_virogdeno_count = forest_v_izom_virogdeno_count
          + found[ a ]
      end
    end
  end
  if forest_v_izom_virogdeno_count > 0 then
    sak.create_items_actor(
      "ammo_zhekan_izomorf", forest_v_izom_virogdeno_count
    )
  end
  sak.create_items_actor( "psevdokristall", 1 )
  superzhekan_sms()
end


-- замена препластилина
function mozg_del_preplastilin()
  if sak.have_item_namber( "preplastilin", 2 ) then
    sak.out_item_namber( "preplastilin", 2 )
    sak.create_items_actor( "izomorf_plastilin", 2 )
    return true
  end
  return false
end


--' заспавним БПБ в гроте
function bpb_spawn()
local obj = alife():create("recipi_bpb",vector():set(-129.441,22.309,472.120),147706,2973)
end

--' удаляем таймер базы на Генераторах
function del_baza_doza_timer(story_id)
local se_obj = alife():story_object(17017)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "del_baza_doza_timer", nil, nil, 30000)
end
end

--' удаляем таймер подстанции на Генераторах
function del_podstanziy_doza_timer(story_id)
local se_obj = alife():story_object(17018)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "del_podstanziy_doza_timer", nil, nil, 30000)
end
end


function disabl_weapon()
  bind_stalker.hide_weapon( 1000, true )
end

function enabl_weapon()
  bind_stalker.restore_weapon( true )
end


function disabl_karta(actor, npc)
    --db.actor:hide_weapon()
    --level.disable_input()
    --level.hide_indicators()
    --printf("xr_effects <disable_ui>")
end
function enabl_karta(actor, npc)
    --level.show_indicators()
    --level.enable_input()
    --db.actor:restore_weapon()
    --printf("xr_effects <enable_ui>")
end

--' убираем хели-блак с Генераторов
function dell_gener_heli_black()
local se_obj = alife():object("generators_heli_black")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем верт Звездочёта с Генераторов
function dell_gener_heli_zvez()
local se_obj = alife():object("gener_heli_zvez_pobeg")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Отдадим ключ от секретки авера
function otdal_kluch_dell_telep2(first_speaker, second_speaker)
sak.out_item_namber("kluch_dell_teleport2",1)
end

--' проверим наличие ак Стрелка
function adr_est_ak()
return sak.have_item_namber("wpn_ak74_m1",1) ~= false
end

--' проверим наличие финансов для Адреналина
function adren_have_money_30000(actor,npc)
    return actor:money() > 30000
end

--' отдадим бабло
function adr_give_mon_30000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,30000,"out")
end

--' отдадим слом ак и получим новый
function otdat_vzyt_ak(first_speaker, second_speaker)
sak.out_item_namber("wpn_ak74_m1",1)
dialogs.relocate_item_section(second_speaker, "wpn_ak74_m1","in")
end


-- мешок охотника на кордоне
function sp_new_inventory33()
  local se_obj = alife():create("m_inventory_box33", vector():set(-11.449318885803,6.0457949638367,56.734508514404),265783,88)
end


-- проверим наличие запчастей для Захара
function zapchasti_est_vse()
  return amk_utils.inventory_search_check({
    [ "mutant_psevdogigant_hand" ] = 15,
    [ "mutant_fracture_hand"     ] = 20,
    [ "mutant_hand_kontroler"    ] = 10,
    [ "mutant_flesh_eye"         ] = 30,
    [ "mutant_krovosos_jaw"      ] = 15,
  })
end

function zapchasti_not_vse()
  return ( not zapchasti_est_vse() )
end


--' отдадим запчасти Захару
function zaxar_chasti_mutantov(first_speaker, second_speaker)
sak.out_item_namber("mutant_psevdogigant_hand",15)
sak.out_item_namber("mutant_fracture_hand",20)
sak.out_item_namber("mutant_hand_kontroler",10)
sak.out_item_namber("mutant_flesh_eye",30)
sak.out_item_namber("mutant_krovosos_jaw",15)
end


-- получим арбалет и стрелы от Сепатора и спавним мешок
function arbalet_dal()
  sak.create_items_actor( "grenade_f1", 5 )
  -- alife():create(
  --   "m_inventory_box33", vector():set( -8.776, 7.324, 57.807 ), 267145, 88
  -- )
  local ruk = alife():create(
    "dsh_treasure_item", vector():set( -8.776, 7.324, 57.807 ), 267145, 88
  )
  ruk = alife():object( ruk.id )
  ruk:used_ai_locations( false )
  local dsh_rukzak_id = "dsh_rukzak." .. ruk.id
  ogse.save_var( dsh_rukzak_id .. ".zamok", false )
  local items = {
    [ "mutant_flesh_eye" ] = {
      count = 30, game_type = "mutant_part",
    },
    [ "mutant_fracture_hand" ] = {
      count = 20, game_type = "mutant_part",
    },
    [ "mutant_hand_kontroler" ] = {
      count = 10, game_type = "mutant_part",
    },
    [ "mutant_krovosos_jaw" ] = {
      count = 15, game_type = "mutant_part",
    },
    [ "mutant_psevdogigant_hand" ] = {
      count = 15, game_type = "mutant_part",
    },
    [ "wpn_lr300" ] = {
      count =  1, game_type = "weapon",
    },
  }
  local rukzak_items = {}
  for sect, t in pairs( items ) do
    table.insert(
      rukzak_items, dsh_rukzak.make_rukzak_item( sect, t.game_type, t.count )
    )
  end
  dsh_rukzak.save_rukzak( ruk.id, rukzak_items )
end


--' Захар дал арт, СВУ и патроны
function zaxar_kvest_ok()
	sak.create_items_actor("af_eye_voron.af_bio",1)
	sak.create_items_actor("wpn_svu",1)
	sak.create_items_actor("ammo_7.62x54_ap",1)
end

--' убираем Сепатора и Ко
function delete_sepator()
local se_obj = alife():object("esc_hunter_zaschita_2")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("esc_hunter_zaschita_1")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("esc_hunter_zaschita_3")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем хели-батя с Янтаря
function dell_yantar_heli_baty()
local se_obj = alife():object("yantar_heli_baty")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Батю
function delete_yantar_baty()
local se_obj = alife():object("yantar_baty")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Сахар дал спецдетектор
function sah_dal_detektor(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "detektor_baty","in")
end

--' проверим наличие детектора и кассеты
function baty_zadanie_have()
return new_dialog.item_much("video_kasseta",1) ~= false and
new_dialog.item_much("detektor_baty",1) ~= false
end

--' отдадим детектор и кассету и получим миниган
function baty_zadanie_done(first_speaker, second_speaker)
sak.out_item_namber("video_kasseta",1)
sak.out_item_namber("detektor_baty",1)
dialogs.relocate_item_section(second_speaker, "wpn_m_134_baty","in")
end

--' спавним видеокассету
function spawn_videokassete()
local obj = alife():create("video_kasseta",vector():set(-200.300,-0.001,140.272),26777,1367)
end

function checking_taken_item38(obj)
    if obj:section()=="video_kasseta" then delete_dt_zone_zvuk(obj)
 end
end
function delete_dt_zone_zvuk(story_id)
local se_obj = alife():story_object(17019)
if se_obj then
alife():release(se_obj)
news_manager.send_tip(db.actor, "delete_dt_zone_zvuk", nil, nil, 20000)
end
end


-- ГГ друг вояк
function drug_bati(actor, npc)
end

-- сделаем ГГ нейтралом и портим отношения с вояками
function vrag_voyk(actor, npc)
end


--' проверим наличие финансов для Бармена
function dvenadzat_shtuk(actor,npc)
    return actor:money() > 12000
end

--' отдадим деньги за ремонт ПДА
function dengi_remont_otdal(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,12000,"out")
end

-- отдадим сломанный ПДА
function pda_mechenyi_otdal()
  -- sak.out_item_namber( "device_pda", 1 )
end

-- заберём ПДА у Доцента
function dosemt_pda_zabral( first_speaker, second_speaker )
  -- dialogs.relocate_item_section( second_speaker, "device_pda", "in" )
end

--' удаляем таймеры рестрикторов ПДА
function del_pda_timer(story_id)
local se_obj = alife():story_object(19009)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19010)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19011)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19012)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19014)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19015)
if se_obj then
alife():release(se_obj)
end
local se_obj = alife():story_object(19016)
if se_obj then
alife():release(se_obj)
end
end

--' удаляем 1таймер рестрикторов ПДА на баре
function del_kpk_timer_bar(story_id)
local se_obj = alife():story_object(19013)
if se_obj then
alife():release(se_obj)
end
end

--' спавним скелета у монолита
function spawn_skelel_monolit()
  battle.create_enemies(
    {
      { "scelet_strong",vector():set(41.192,57.215,33.114),6321,2417 },
    }
  )
end

--' спавним детектор изоморфов
function spawn_detek_izo()
local obj = alife():create("detektor_amorf",vector():set(68.187,14.302,178.736),56983,3020)
end

--' удаляем первого Призрака с генераторов
function delete_gen_prizrak()
  local se_obj = alife():object("generators_prizrak")
  if se_obj then
    alife():release(se_obj, true)
  end
end


--' спавним блокнот Странника
function spawn_blokn_strann()
local obj = alife():create("strannik_bloknot",vector():set(68.187,14.302,178.736),56983,3020)
end

--' спавним портал в бункере
function spawn_portal_control()
local obj = alife():create("imitator_shar",vector():set(-42.175,-34.479,21.473),54,2509)
local obj = alife():create("imitator_tele_final1",vector():set(-42.175,-34.479,21.473),54,2509)
local obj = alife():create("anomal_pole",vector():set(-42.175,-34.479,21.473),54,2509)
local obj = alife():create("imitator_snezka",vector():set(-42.175,-34.479,21.473),54,2509)
end

--' заспавним немного артов в бункере монолита
function spawn_control_monolit_art()
end

-- парочка бюреров в бункере монолита
function control_monolit_burer()
--[=[
  battle.create_enemies(
    {
      { "burer_strong",vector():set(17.438,-34.483,13.185),2913,2514 },
      { "burer_normal",vector():set(36.405,-34.483,13.768),3837,2480 },
      { "burer_normal",vector():set(36.405,-34.483,13.768),3837,2480 },
    }
  )
--]=]
end

--' спавним псевдышей в Лиме
function spawn_lima_psevdushi()
  battle.create_enemies(
    {
      { "gigant_strong",vector():set(67.401,3.297,285.837),57187,3022 },
      { "gigant_normal",vector():set(57.739,3.310,268.578),54208,3022 },
      { "gigant_normal",vector():set(97.760,2.900,262.609),60715,3022 },
    }
  )
end


-- спавним фоторужьё в Саркофаге
function spawn_fotoruzhy()
  alife():create( "wpn_svd_foto",vector():set(-21.648,69.634,-31.996),598,2417 )
  alife():create( "anomal_pole_foto",vector():set(-21.546,69.630,-31.632),598,2417 )
  alife():create( "bloknot_neizvestnogo",vector():set(-21.546,69.630,-31.632),598,2417 )
end


-- спавним фотографию в Саркофаге
function spawn_fotografiy_mono()
  if db.actor:has_info( "spawn_bandosu_derevny" ) then return end
  sak.create_items_actor( "foto_monolit", 1 )
  local snd = foto_mozg_ok_sms()
  db.actor:give_info_portion( "spawn_bandosu_derevny" )
  -- spawn_imit_tele_foto()
  del_proval_foto_restr()
  dsh.start_on_spawn_another_level(
    script_name() .. ".vopros_k_prizraku_sms", "lost_village"
  )
  dsh.story_sms_timer( snd, "braad_test.sarcofag_derevny" )
end


-- удаляем рестрикторы провала на задание с фото в Саркофаге
function del_proval_foto_restr()
  for sid = 19019, 19021 do
    local se_obj = alife():story_object( sid )
    if se_obj then
      alife():release( se_obj )
    end
  end
end


-- заспавним имитатор фотоперехода
function spawn_imit_tele_foto()
  alife():create("imitator_tele_final1",vector():set(-21.340,69.629,-31.520),598,2417)
end


-- проверяет наличие фотки
function odnonogiy_foto_have()
  return sak.have_item_namber( "foto_monolit", 1 ) ~= false
end


--' проверяет наличие псевдофотки
function psewdofoto_est() 
return sak.have_item_namber("psewdofoto",1) ~= false
  end

--' проверим отсутствие псевдофотки
function psewdofoto_net()
return sak.have_item_namber("psewdofoto",1) ~= true
  end

--' отдадим псевдофото одноногому
function otdal_psewdofoto(first_speaker, second_speaker)
sak.out_item_namber("psewdofoto",1)
end

--' заберём детектор изоморфов
function take_izo_detektor(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "detektor_amorf","in")
end


function metka_semetskiy()
  local obj = alife():object( "stalk_semetskiy" )
  if obj then
    level.map_add_object_spot( obj.id, "blue_location", "metka_semetskiy" )
  end
  dsh.story_sms_timer( 10, script_name() .. ".metka_semetskiy2" )
end

function metka_semetskiy2()
  db.actor:give_info_portion( "semetskiy_lima_spawn_done" )
end


--' отдадим фото Монолита Пилигриму
function otdal_foto_pili(first_speaker, second_speaker)
sak.out_item_namber("foto_monolit",1)
end


-- заберём псевдофото у Пили
function take_psewdofoto_pili()
  sak.create_items_actor( "psewdofoto", 1 )
  dsh.story_sms_timer( 5, script_name() .. ".molniy_posle_foto_sms3" )
end


function spawn_bunker_sekret()
  alife():create(
    "mulyz_bomba", vector():set( 8.089, -23.447, 14.072 ), 7800, 2773
  )
  alife():create(
    "mulyz_bomba", vector():set( 7.608, -23.439, 13.871 ), 7695, 2773
  )
  alife():create(
    "osnova_fotik", vector():set( 8.089, -22.447, 14.072 ), 7800, 2773
  )
  alife():create(
    "neizv_zapiska", vector():set( 8.089, -22.447, 14.072 ), 7800, 2773
  )
end


function mesto_v_bunkere_proval()
  dsh.story_sms_timer( 30, script_name() .. ".mesto_v_bunkere_proval2" )
end

function mesto_v_bunkere_proval2()
  db.actor:give_info_portion( "bun_sp_kluk" )
end


--' удаляем рестриктор оживления радиста
function del_ozh_radista_restr(story_id)
local se_obj = alife():story_object(19023)
if se_obj then
alife():release(se_obj)
end
end

--' удаляем 2рестриктор оживления радиста
function del2_ozh2_radista2_restr2(story_id)
local se_obj = alife():story_object(19027)
if se_obj then
alife():release(se_obj)
end
end

--' кровосос в детском садике
function spawn_sos_sadik()
  battle.create_enemies(
    {
      { "bloodsucker_strong",vector():set(136.796,3.935,-25.153),237691,2242 },
    }
  )
end


-- глобус в детском садике и рюкзачок
function spawn_globus_sadik()
  alife():create("izom_globus",vector():set(132.621,3.935,-52.783),235074,2245)
  alife():create("linza_fotik",vector():set(137.245,3.980,-51.995),238095,2245)
  alife():create("m_inventory_box34", vector():set(134.43992614746,3.9388103485107,-54.601131439209),236350,2245)
end


--' псевдыш после детс. садика
function spawn_gig_sadik()
  battle.create_enemies(
    {
      { "gigant_strong",vector():set(63.161,-2.391,-66.476),174678,2137 },
    }
  )
end

--' убираем Клыка и радиста из бункера
function delete_kluk_and_radist()
local se_obj = alife():object("stalk_radist")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("bunker_kluk")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- убираем Клыка и радиста из Припяти
function delete_kluk_and_radist_pryp()
  for _, n in ipairs({
    "prip_radist2_ozhil", "pripyt_kluk", "radist_after"
  }) do
    local sobj = alife():object( n )
    if sobj then
      dsh.release_mob( sobj )
    end
  end
end


--' убираем forest_lastday_snip1
function dell_forest_last_snip()
local se_obj = alife():object("forest_lastday_snip1")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- проверим наличие частей фотика
function zapchasti_fotik_ok() 
  return amk_utils.inventory_search_check({
    [ "osnova_fotik" ] = 1,
    [ "linza_fotik"  ] = 1,
  })
end


-- отдадим запчасти фотика леснику
function zapchasti_fotik_otdal()
  amk_utils.out_items_number({
    [ "osnova_fotik" ] = 1,
    [ "linza_fotik"  ] = 1,
  })
end


-- Леcник дал фотопистолет
function fotopistolet_have()
  sak.create_items_actor( "wpn_eagle_m3", 1 )
end


--' проверим наличие финансов за снайпера
function lesnik_have_money_50000(actor,npc)
    return actor:money() > 50000
end

--' отдадим деньги Леснику
function lesnik_give_money_50000(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,50000,"out")
end


-- спавним фотик у Лесника
function spawn_pushka_fot()
  -- alife():create(
  --   "pushka_fotik", vector():set( 29.470, 4.654, 25.713 ), 83046, 3263
  -- )
end


--' izomorf_kristal в лесу
function spawn_izomorf_krist()
local obj = alife():create("izomorf_kristal",vector():set(219.859,-7.329,-94.606),139437,3315)
local obj = alife():create("imitator",vector():set(220.545,-11.254,-101.263),139769,3315)
local obj = alife():create("anomal_pole",vector():set(220.545,-11.254,-101.263),139769,3315)
local obj = alife():create("imitator_snezka",vector():set(220.545,-11.254,-101.263),139769,3315)
local obj = alife():create("imitator_holodez",vector():set(220.545,-11.254,-101.263),139769,3315)
end

--' заспавним собачек в кр лесу
function spawn_dog_to_red_forest()
  battle.create_enemies(
    {
      { "pseudodog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "pseudodog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_strong",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_normal",vector():set(198.575,5.418,118.760),129451,3319 },
      { "dog_weak",vector():set(198.575,5.418,118.760),129451,3319 },
    }
  )
end

--' заспавним мины в кр лесу
function spawn_mina_forest()
local obj = alife():create("bomba_mina_b",vector():set(200.102,4.937,117.763),130200,3319)
local obj = alife():create("bomba_mina_n",vector():set(202.781,4.677,117.218),131707,3319)
end

--' заспавним кактус
--function spawn_kaktus_izo()
--local obj = alife():create("kaktus_izomorf",vector():set(14.118,-0.538,23.657),6732,3215)
--end


-- проверим наличие мнимого фотопистолета
function fotopushka_est()
  return sak.have_item_namber( "wpn_eagle_m3", 1 ) ~= false
end

function not_fotopushka_est()
  return not fotopushka_est()
end

-- отдадим фотик Клёнову на модернизацию
function modernizasiy_fotik()
  sak.out_item_namber( "wpn_eagle_m3", 1 )
end

-- Клёнов дал рабочий заряженный фотик и спавн кактуса
function fotopatronu_dal()
  sak.create_items_actor( "wpn_eagle_m2", 1 )
  alife():create(
    "kaktus_izomorf", vector():set( 14.118, -0.538, 23.657 ), 6732, 3215
  )
end


-- получим фотку мозга
function fotka_mozga_have()
  if db.actor:has_info( "fotka_mozga_have" ) then return end
  sak.create_items_actor( "foto_mozg_x16", 1 )
  foto_mozg_ok_sms()
  for _, info in ipairs({
    "fotka_mozga_have",
    "yantar_kontroller_yazva_spawn",
    "spawn_chernomor_zombyk",
  }) do
    db.actor:give_info_portion( info )
  end
  spawn_himera_x16()
  dell_foto_monolitovets()
end


--' ГГ враг зомбарей
function vrag_zombie() end

function vrag_zombie_old()
  db.actor:set_character_community( "stalker", 0, 0 )
  local chkgoodwill = relation_registry.community_goodwill(
    "zombied", db.actor:id()
  )
  if chkgoodwill > 0 then 
    chkgoodwill = chkgoodwill - 6100
    relation_registry.set_community_goodwill(
      "zombied", db.actor:id(), chkgoodwill
    )
  else
    relation_registry.set_community_goodwill(
      "zombied", db.actor:id(), -6100
    )
  end
end


--' убираем foto_monolitovets
function dell_foto_monolitovets()
local se_obj = alife():object("foto_monolitovets")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' спавн живности в х16
function spawn_zivnost_x16()
  battle.create_enemies(
    {
      -- { "burer_normal",vector():set(-108.872,21.564,-23.246),266,1529 },
      { "snork_normal",vector():set(-108.872,21.564,-23.246),266,1529 },
      { "zombie_normal",vector():set(-115.406,21.564,-22.614),202,1529 },
      -- { "burer_normal",vector():set(-115.406,21.564,-22.614),202,1529 },
      -- { "burer_normal",vector():set(-115.406,21.564,-22.614),202,1529 },
      { "zombie_normal",vector():set(-114.772,21.563,-37.471),223,1529 },
      { "zombie_normal",vector():set(-114.772,21.563,-37.471),223,1529 },
      { "zombie_normal",vector():set(-114.772,21.563,-37.471),223,1529 },
      { "snork_normal",vector():set(-109.016,21.564,-37.757),295,1529 },
      -- { "burer_strong",vector():set(-106.343,21.782,-24.075),358,1529 },
    }
  )
end

--' ЭХ в х16
function spawn_himera_x16()
  battle.create_enemies(
    {
      -- { "chimera_normal",vector():set(-124.463,18.768,-21.276),84,1529 },
      { "scelet_strong",vector():set(-223.302,-18.648,-43.821),308,1458 },
    }
  )
end


-- получим фотку аномального контрика
function fotka_kont_yazva_have()
  if db.actor:has_info( "fotka_kont_yazva_have" ) then return end
  sak.create_items_actor( "foto_kontroller_yazva", 1 )
  foto_mozg_ok_sms()
  db.actor:give_info_portion( "fotka_kont_yazva_have" )
end


--' проверим наличие фоток
function izomorf_dialog_have()
return new_dialog.item_much("foto_kontroller_yazva",1) ~= false and
new_dialog.item_much("foto_mozg_x16",1) ~= false
end

--' проверим наличие 1фотоки контрика
function odna_fotka_kontrika()
return new_dialog.item_much("foto_kontroller_yazva",1) ~= false
end

--' проверим наличие 1фотоки мозга
function odna_fotka_mozga()
return new_dialog.item_much("foto_mozg_x16",1) ~= false
end

--' проверим отсутствие фотопистолета
function fotopushka_istin_net()
return sak.have_item_namber("wpn_eagle_m2",1) ~= true
  end

--' проверим отсутствие фоток
function fotok_net_voobsche()
return new_dialog.item_much("foto_kontroller_yazva",1) ~= true and
new_dialog.item_much("foto_mozg_x16",1) ~= true
  end

--' проверим отсутствие фотки контрика
function fotki_net_kontrollera()
return new_dialog.item_much("foto_kontroller_yazva",1) ~= true
  end

--' проверим отсутствие фотки мозга
function fotki_net_mozga()
return new_dialog.item_much("foto_mozg_x16",1) ~= true
  end

--' проверим отсутствие финансов
function net_pyati_shtuk(actor,npc)
    return actor:money() < 50000  
end

--' проверим наличие фотопистолета
function fotopushka_istinnay()
return sak.have_item_namber("wpn_eagle_m2",1) ~= false
  end

-- отдадим фотик Клёнову 
function otdadim_fotik()
  sak.out_item_namber( "wpn_eagle_m2", 1 )
  dsh.story_sms_timer( 5, script_name() .. ".otdadim_fotik2" )
end

function otdadim_fotik2()
  db.actor:give_info_portion( "molniy_after_chernomor_find" )
end

--' отдадим фотки Клёнову 
function otdal_fotki_vse(first_speaker, second_speaker)
sak.out_item_namber("foto_kontroller_yazva",1)
sak.out_item_namber("foto_mozg_x16",1)
end

--' отдадим фотку мозга Клёнову 
function otdal_fotku_mozga(first_speaker, second_speaker)
sak.out_item_namber("foto_mozg_x16",1)
end

--' отдадим фотку контрика Клёнову 
function otdal_fotku_kontroller(first_speaker, second_speaker)
sak.out_item_namber("foto_kontroller_yazva",1)
end

-- Клёнов дал изоморфные патроны
function klen_dal_pistonu()
  sak.create_items_actor( "ammo_5.45x39_izomorf", 1 )
  sak.create_items_actor( "ammo_9x39_izomorf", 1 )
  sak.create_items_actor( "ammo_7.62x54_izomorf", 1 )
  sak.create_items_actor( "ammo_zhekan_izomorf", 1 )
end

--' спавн антизомбина на Янтаре
function spawn_antizombin_yntar()
local obj = alife():create("antizombie",vector():set(111.220,-8.769,-204.768),99041,1472)
local obj = alife():create("antizombie",vector():set(111.194,-8.725,-204.325),99042,1472)
local obj = alife():create("antizombie",vector():set(108.190,-8.870,-209.405),97185,1472)
end

--' проверим наличие антизомбина для Черномора
function antizombin_est()
return sak.have_item_namber("antizombie",2) ~= false
  end

-- отдадим антизомбин
function antiz_otdal()
  sak.out_item_namber( "antizombie", 2 )
  otsek_varka_kamen()
  dsh.story_sms_timer( 1, script_name() .. ".dell_chernomor_zombi" )
end

-- убираем Черномора-зомби
function dell_chernomor_zombi()
  local se_obj = alife():object( "chernomor_zombi" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():object( "chernomor_zombi1" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
  se_obj = alife():story_object( 9626 )
  if se_obj then
    dsh.release_mob( se_obj )
  else
    for id, is_npc in pairs( db.creature ) do
      local obj = level.object_by_id( id )
      if obj:section() == "chernomor_zombi1" then
        local sobj = alife():object( obj:id() )
        if sobj then
          dsh.release_mob( sobj )
        end
        break
      end
    end
  end
  db.actor:give_info_portion( "spawn_cern_stalk" )
  chernom_zvuk()
  dsh.story_sms_timer( 5, script_name() .. ".dell_chernomor_zombi2" )
end

function dell_chernomor_zombi2()
  db.actor:give_info_portion( "dovel_chernomora_start" )
end


-- изоморфы Черномора
function spawn_izomorfy_chernom()
  alife():create("ammo_7.62x54_izomorf",vector():set(-1.365,20.731,-10.072),38622,1525)
  alife():create("ammo_7.62x54_izomorf",vector():set(-1.365,20.731,-10.072),38622,1525)
  alife():create("ammo_7.62x54_izomorf",vector():set(-1.957,20.731,-9.989),38268,1525)
  alife():create("ammo_7.62x54_izomorf",vector():set(-1.957,20.731,-9.989),38268,1525)
  -- alife():create("7.62x54_izomorf",vector():set(-1.365,20.731,-10.072),38622,1525)
  -- alife():create("7.62x54_izomorf",vector():set(-1.957,20.731,-9.989),38268,1525)
  -- alife():create("wa2000_izomorf",vector():set(-1.906,20.731,-8.694),38991,1525)
  dsh.story_sms_timer( 5, script_name() .. ".yntar_sms_k_molnii1" )
end

-- получим снайперку Черномора
function ruzie_chern_have()
  dsh.say_blin()
  battle.create_enemies(
    {
      { "chimera_normal",vector():set(11.763,0.031,-26.645),44985,1503 },
    }
  )
  dsh.story_sms_timer( 40, script_name() .. ".yntar_sms_k_molnii1" )
end


-- заспавним сумку проверяющего
function spawn_chem_piyan()
  alife():create(
    "chemodan_piyan", vector():set( -182.451, 1.144, -305.586 ), 53747, 689
  )
end


-- проверим наличие 10 пузырей
function vodka_desyat_est()
  return sak.have_item_namber( "vodka", 10 )
end


-- отдадим пузыри часовому
function vodka_desyat_otdal()
  sak.out_item_namber( "vodka", 10 )
end


-- проверим наличие водки
function pollitra_est()
  return sak.have_item_namber( "vodka", 1 )
end


-- проверим отсутствие водяры
function pollitra_net()
  return not pollitra_est()
end


-- отдадим водку пьяному кепу
function otdal_odnu_vodku()
  sak.out_item_namber( "vodka", 1 )
end


-- убираем трезвого кепа
function dell_trezv_kapit()
  local se_obj = alife():object( "trezv_kapitan" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


-- Кузя дал 5 бутылок
function vodka_kuzy_dal()
  sak.create_items_actor( "vodka", 5 )
  start_kuzy_artmodifikator_timer()
end


function start_kuzy_artmodifikator_timer()
  ogse_st_mgr.start_gtimer(
    "arhara_dialog.kuzy_artmodifikator_timeout",
    86400,
    "arhara_dialog.kuzy_artmodifikator_timeout"
  )
end


function stop_kuzy_artmodifikator_timer()
  ogse_st_mgr.get_timer(
    "arhara_dialog.kuzy_artmodifikator_timeout"
  ):stop()
end


function kuzy_artmodifikator_timeout()
  if
    db.actor:has_info( "kuzy_artmodifikator_have" )
    or db.actor:has_info( "chasovoy_trezv_say_start" )
  then
    return
  end
  news_manager.send_tip(
    db.actor, "kuzy_artmodifikator_timeout", nil, nil, 25000
  )
  delete_agro_musor()
  db.actor:give_info_portion( "kuzy_artmodifikator_timeout" )
  news_manager.skip_send_task = true
  level_tasks.set_task_state( task.fail, "kuzy_artmodifik", 0 )
  dsh.exec_on_update(
    function() news_manager.skip_send_task = false end
  )
end


-- проверим наличие чумодана для кузи
function kuzy_artmodifikator_have()
  return sak.have_item_namber( "chemodan_piyan", 1 )
end


-- проверим отсутствие чумодана для кузи
function kuzy_artmodifik_net()
  return not kuzy_artmodifikator_have()
end


-- отдадим кейс кузнецову
function otdal_chumodaniscte()
  sak.out_item_namber( "chemodan_piyan", 1 )
end


-- Кузя дал награду
function devays_kuzy_dal_545()
  sak.create_items_actor( "ammo_5.45x39_ap", 10 )
  sak.create_items_actor( "medkit_army",     10 )
end

function devays_kuzy_dal_762()
  sak.create_items_actor( "ammo_7.62x39_ap", 10 )
  sak.create_items_actor( "medkit_army",     10 )
end


-- проверим наличие 25 пузырей водки
function pollitra_dvadtsatpyat()
  return sak.have_item_namber( "vodka", 25 )
end


-- отдадим 25 пузырей водки кузнецову
function otdal_dvadtsatpyat()
  sak.out_item_namber( "vodka", 25 )
end


-- проверим наличие 40 пузырей водки
function pollitra_sorok()
  return sak.have_item_namber( "vodka", 40 )
end


-- отдадим 40 пузырей водки кузнецову
function otdal_sorok( first_speaker, second_speaker )
  sak.out_item_namber( "vodka", 40 )
end


-- убирём с Агры пьяный мусор
function delete_agro_musor()
  for _, n in ipairs({
    "agro_chsovoy_trezv",
    "agro_piyn_soldier1",
    "agro_piyn_soldier2",
    "kep_trezv_piyan_restrictor",
    "narod_napilsy_sms_restrictor",
    "piyan_kapitan",
    "piyan_koncepva1",
    "piyan_psevdoabakan",
    "piyan_psevdoconserva",
    "piyan_psevdokalash",
    "piyan_psevdokolbasa",
    "piyan_psevdovodka",
    "piyan_psevdovodka1",
    "piyan_psevdovodka2",
    "sms_kuznets_restrictor",
    "soldier_v_piyanux_restrictor",
    "trezv_kapitan",
  }) do
    local se_obj = alife():object( n )
    if se_obj then
      alife():release( se_obj, true )
    end
  end
end


--' убираем Пантеру с Кордона
function dell_esc_pantera()
  local se_obj = alife():object( "esc_pantera_bomba" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


function proba_posulki()
local obj = alife():create("af_drops",vector():set(-255.655,-23.377,-134.334),7894,5)
local obj = alife():create("klenov_opisalovo",vector():set(-255.655,-23.377,-134.334),7894,5)
end

function posulka_nomer_dva()
local obj = alife():create("wpn_eagle_m2",vector():set(-255.655,-23.377,-134.334),7894,5)
end


function sp_ploti_svalka()
  local habr = dsh.create_free_monster(
    "flesh_strong", vector():set( -236.463, -1.910, 171.242 ), 13329, 343
  )
  alife():create(
    "mutant_wpn_desert_eagle",
    habr.position, habr.m_level_vertex_id, habr.m_game_vertex_id, habr.id
  )
  alife():create(
    "pisma_stalka",
    habr.position, habr.m_level_vertex_id, habr.m_game_vertex_id, habr.id
                )
  battle.create_enemies(
    {
      { "flesh_strong", vector():set( -236.463, -1.910, 171.242 ), 13329, 343 },
      { "flesh_normal", vector():set( 273.645, 1.435, 147.333), 378180, 257 },
      { "flesh_normal", vector():set( 273.645, 1.435, 147.333 ), 378180, 257 },
      { "flesh_strong", vector():set( 273.645, 1.435, 147.333 ), 378180, 257 },
      { "flesh_strong", vector():set( 210.098, 0.399, -137.657 ), 349493, 401 },
      { "flesh_strong", vector():set( -78.291, -3.818, 197.277 ), 127104, 351 },
      { "flesh_normal", vector():set( -78.291, -3.818, 197.277 ), 127104, 351 },
      { "flesh_normal", vector():set( -78.291, -3.818, 197.277 ), 127104, 351 },
    }
  )
end


--' убираем Пантеру с отцом из Госпиталя
function dell_gospital_pantera2()
local se_obj = alife():object("hos_father_new")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("hos_new_panterka")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' проверим наличие вещей сталкера
function plot_dialog_say_have()
return sak.have_item_namber("pisma_stalka",1) ~= false and
new_dialog.item_much("wpn_desert_eagle",1) ~= false
end

-- отдадим вещи сталкера
function otdal_veschi(first_speaker, second_speaker)
  sak.out_item_namber( "wpn_desert_eagle", 1 )
  sak.out_item_namber( "pisma_stalka", 1 )
  alife():create(
    "m_inventory_box35",
    vector():set( 52.520462036133, -0.035371631383896, -295.6975402832 ),
    221820, 253
  )
  dsh.story_sms_timer( 5, script_name() .. ".pantera_na_kordone_sms" )
end

--' убираем запасного фото с кордона
function dell_zapasnoy_foto_muz()
local se_obj = alife():object("zapasnoy_foto_muzhik")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- убираем основного фото с кордона
function dell_esc_foto_muzhik()
  local se_obj = alife():object( "esc_foto_muzhik" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
end


--' Тушканы для шухера
function suher_tushk()
  battle.create_enemies(
    {
      { "tushkano_normal",vector():set(-215.511,-19.960,-141.083),37916,61 },
      { "tushkano_strong",vector():set(-215.511,-19.960,-141.083),37916,61 },
    }
  )
end


-- получим фотку убийцы с Кордона
function fotka_ubiysu_ok()
  if db.actor:has_info( "chern_foto_dialog_have" ) then return end
  sak.create_items_actor( "shuher", 1 )
  foto_mozg_ok_sms()
  db.actor:give_info_portion( "chern_foto_dialog_have" )
end


--' получим фотку лагеря новисов от Черномора
function fotka_kordon_dal(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "foto_kordon","in")
end

--' проверим наличие фотки убийцы с Кордона
function fotka_ubiysu_esc_est()
return sak.have_item_namber("shuher",1) ~= false
  end

-- отдадим фотку убийцы отцу
function otdal_kartinku()
  sak.out_item_namber( "shuher", 1 )
  sms_otez_poreshil()
end


--' убираем одноногого с Генераторов
function dell_odnonogiy()
  local se_obj = alife():object( "odnonogiy_stalk" )
  if se_obj then
    alife():release( se_obj, true )
  end
  dsh.make_free_prizrak()
end


-- получим фотку убийцы с Милилитари
function fotka_kisluy_ok()
  if db.actor:has_info( "as_ubiysa_have" ) then return end
  sak.create_items_actor( "kisluy", 1 )
  foto_mozg_ok_sms()
  db.actor:give_info_portion( "as_ubiysa_have" )
end


--' убираем military_fotomuzhik
function dell_milit_fotomuzhik()
local se_obj = alife():object("military_fotomuzhik")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем military_fotomuzhik запас
function dell_milit_zapas_fotomuz()
local se_obj = alife():object("milit_zapas_fotomuzhik")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' Тушканы для Кислого
function militar_tushk()
  battle.create_enemies(
    {
      { "tushkano_normal",vector():set(-51.788,-10.182,21.075),257887,1607 },
      { "tushkano_strong",vector():set(-51.788,-10.182,21.075),257887,1607 },
    }
  )
end

--' проверим наличие фотки убийцы с Милитари
function fotka_kisluy_est()
return sak.have_item_namber("kisluy",1) ~= false
  end

--' отдадим фотку Кислому
function vernul_kartinku(first_speaker, second_speaker)
sak.out_item_namber("kisluy",1)
 end


-- рюкзак Злобного
function rukzak_zlobnogo()
  if db.actor:has_info( "proval_strelki" ) then return end
  dsh.story_sms_timer( 5, script_name() .. ".sms_taynik_zlobnuy" )
end

function sms_taynik_zlobnuy()
  dell_aver_zlobn()
  local snd = news_manager.send_tip(
    db.actor, "sms_taynik_zlobnuy", nil, nil, 32000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_97", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_taynik_zlobnuy1" )
end

function sms_taynik_zlobnuy1()
  local snd = news_manager.send_tip(
    db.actor, "sms_taynik_zlobnuy1", nil, nil, 25000, nil,
    "characters_voice\\human_03\\stalker\\talk\\labux\\labux_116", true
  )
  dsh.story_sms_timer( snd, script_name() .. ".sms_taynik_zlobnuy2" )
end

function sms_taynik_zlobnuy2()
  dsh.create_and_map_treasure(
    game.translate_string( "sms_taynik_zlobnuy2_0" ),
    game.translate_string( "sms_taynik_zlobnuy2_1" ),
    "m_inventory_box36",
    vector():set( -170.294, 3.940, -148.568 ), 66879, 559
  )
  db.actor:give_info_portion( "kvest_saxar_teleport_start" )
end


-- убираем Злобного с Авера
function dell_aver_zlobn()
  local se_obj = alife():object( "aver_zlobnuy" )
  if se_obj then
    dsh.release_mob( se_obj )
  end
end


--' удаляем рестриктор стрелки на авере
function del_strelka_mesto_restr(story_id)
local se_obj = alife():story_object(19034)
if se_obj then
alife():release(se_obj)
end
end

--' удаляем рестриктор радиуса провала стрелки на авере
function del_strelka_radius_restr(story_id)
local se_obj = alife():story_object(19035)
if se_obj then
alife():release(se_obj)
end
end

--' проверим наличие фотки жены Сахара
function fotka_zhena_ok()
return sak.have_item_namber("zhena_sahara",1) ~= false
  end

--' отдадим фотку Сахару
function fotka_zhena_vernul(first_speaker, second_speaker)
sak.out_item_namber("zhena_sahara",1)
 end

--' убираем одноногого с Авера
function dell_aver_odnon()
local se_obj = alife():object("aver_odnonogiy")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Сахар-переход, мозг-переход и телепорт
function delete_saxar_perex()
local sim = alife()
	local se_obj = sim:story_object(18111)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(18112)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object( story_ids.m_teleport_nad_mozgom )
	if se_obj then
		sim:release(se_obj )
	end
end

--' проверим наличие пластилина
function plastilin_est()
return sak.have_item_namber("izomorf_plastilin",1) ~= false
  end


-- убираем Молнию
function dell_molniy()
  local sobj = alife():object( "molniy" )
  if sobj then
    dsh.release_mob( sobj )
  end
  sobj = alife():story_object( story_ids.imit_tele_molniy )
  if sobj then
    alife():release( sobj )
  end
end


--' камушки над мозгом
function plastil_spawn()
local obj = alife():create("preplastilin",vector():set(-46.617,27.133,-11.055),7244,1543)
local obj = alife():create("preplastilin",vector():set(-45.184,27.134,-14.642),7099,1543)
--local obj = alife():create("preplastilin",vector():set(-44.196,27.134,-9.118),7244,1543)
--local obj = alife():create("preplastilin",vector():set(-44.837,18.978,-12.184),2892,1530)
local obj = alife():create("nauch_recomend",vector():set(-43.801,27.133,-10.206),7244,1543)
end


-- заспавним имитатор отхода Молнии
function sp_imit_tele_molniy()
  local sobj = alife():create(
    "imitator_tele_final1",
    vector():set( -42.458, -34.478, 21.222 ), 30, 2509
  )
  alife():assign_story_id( sobj.id, story_ids.imit_tele_molniy )
end


--' заспавним поле перехода в подвале Лимы
function spawn_pole_lima(first_speaker, second_speaker)
local obj = alife():create("anomal_pole",vector():set(-52.082,-10.597,-182.625),2891,2993)
end

--' заспавним поле ключа в подвале Лимы
function spawn_pole_kluch(first_speaker, second_speaker)
local obj = alife():create("anomal_pole",vector():set(-51.768,-11.915,-170.309),2891,2993)
end

function checking_taken_item57(obj)
    if obj:section()=="9x39_izomorf" then delete_blok_and_restr(obj)
 end
end

--' защитые мины подвала
function spawn_mina_lima()
--[=[
local obj = alife():create("bomba_mina_b",vector():set(-51.878,-9.562,-148.368),2891,2993)
local obj = alife():create("bomba_mina_b",vector():set(-49.234,-8.562,-148.500),3051,2993)
local obj = alife():create("bomba_mina_b",vector():set(-46.192,-7.561,-149.072),3051,2993)
local obj = alife():create("bomba_mina_b",vector():set(-46.205,-6.353,-153.23),3051,2993)
--]=]
local obj = alife():create("imitator_holodez",vector():set(-56.837,-11.236,-164.933),2375,2993)
local obj = alife():create("imitator_holodez",vector():set(-46.999,-11.197,-165.889),3051,2993)
end

--' выстрел снайпера в красном лесу
function last_snip_zvuk(sound_name)
if sound_name then
if snd_obj and snd_obj:playing() then
snd_obj:stop()
end
snd_obj = xr_sound.get_safe_sound_object("weapons\\svd\\svd_shoot")
if snd_obj then
snd_obj:play_no_feedback(db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0)
else
get_console():execute("load ~~~ SOUND NOT FOUND: "..sound_name)
end
else
get_console():execute("load ~~~ SOUND NOT SET")
end
end

--' удаляем forest_last_snip_proval_restrictor
function del_last_snip_prov_restr(story_id)
local se_obj = alife():story_object(19039)
if se_obj then
alife():release(se_obj)
end
end

--' удаляем red_dolbannay_doska
function del_dolbannay_doska(story_id)
local se_obj = alife():story_object(19040)
if se_obj then
alife():release(se_obj)
end
end


-- превращение Черномора
function chernom_zvuk()
  local snd_obj = xr_sound.get_safe_sound_object(
    "monsters\\zombie\\zombie_die_0"
  )
  if snd_obj then
    snd_obj:play_no_feedback(
      db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0
    )
  end
end


--' сначала убьём, потом удалим - иначе - вылет
function kill_fotosvobodovets(storyid)
	local obj = level_object_by_sid(19044)
	if obj and IAmAStalker[obj:clsid()] and obj:alive() then
		obj:kill(obj)
		return true
	else
		return false
	end
end
function kill_zapas_fotosvobodovets(storyid)
	local obj = level_object_by_sid(19045)
	if obj and IAmAStalker[obj:clsid()] and obj:alive() then
		obj:kill(obj)
		return true
	else
		return false
	end
end

--' сначала убьём, потом удалим - иначе - вылет
function kill_escfoto(storyid)
	local obj = level_object_by_sid(19046)
	if obj and IAmAStalker[obj:clsid()] and obj:alive() then
		obj:kill(obj)
		return true
	else
		return false
	end
end
function kill_escfoto_zapas(storyid)
	local obj = level_object_by_sid(19047)
	if obj and IAmAStalker[obj:clsid()] and obj:alive() then
		obj:kill(obj)
		return true
	else
		return false
	end
end

function zaschita_minka()
local obj = alife():create("bomba_mina_n",vector():set(-45.093,-7.057,32.530),265252,1607)
end

--' рюкзачок с арбалетом Нормана на чердаке
function yzik_norman_spawn()
local se_obj = alife():create("m_inventory_box37", vector():set(-129.12908935547,19.055564880371,83.090309143066),223303,3609)
end


function metka_city_parfumer()
  local sobj = alife():object( "dcity_parfumer" )
  ASSERT( sobj, "[%s]: dcity_parfumer not found", script_name() )
  level.map_add_object_spot_ser(
    sobj.id, "crlc_big", "metka_city_parfumer"
  )
end


function remove_parfumer_metka()
  local sobj = alife():object( "dcity_parfumer" )
  ASSERT( sobj, "[%s]: dcity_parfumer not found", script_name() )
  level.map_remove_object_spot( sobj.id, "crlc_big" )
end


function metka_city_starshoy()
  for a, obj in alife():objects() do
    if obj:name() == "city_starshoy" then 
      amk.add_spot_on_map(obj.id,"crlc_big","metka_city_starshoy") 
      break
    end
  end
end

function remove_city_starshoy_metka()
  for a, obj in alife():objects() do
    if obj:name() == "city_starshoy" then 
      level.map_remove_object_spot(obj.id,"crlc_big")
      break
    end
  end
end

function metka_tema_likvidator()
  for a, obj in alife():objects() do
    if obj:name() == "city_tema_likvidator" then 
      amk.add_spot_on_map(obj.id,"crlc_big","metka_tema_likvidator") 
      break
    end
  end
end
function remove_tema_likvidator_metka()
  for a, obj in alife():objects() do
    if obj:name() == "city_tema_likvidator" then 
      level.map_remove_object_spot(obj.id,"crlc_big")
      break
    end
  end
end

function metka_norman()
  for a, obj in alife():objects() do
    if obj:name() == "dcity_kontr_last2" then 
      amk.add_spot_on_map(obj.id,"crlc_big","metka_norman") 
      break
    end
  end
end
function remove_norman_metka()
  for a, obj in alife():objects() do
    if obj:name() == "dcity_kontr_last2" then 
      level.map_remove_object_spot(obj.id,"crlc_big")
      break
    end
  end
end

--' удаляем зону защиты бандитов
function del_zona_bandosu(story_id)
local se_obj = alife():story_object(17026)
if se_obj then
alife():release(se_obj)
end
end

--' проверим наличие нужных предметов для Старшего
function starshoy_say_one_have() 
return new_dialog.item_much("medkit",10) ~= false and
new_dialog.item_much("wpn_ak74u",2) ~= false and
new_dialog.item_much("vodka",5) ~= false and
new_dialog.item_much("ammo_5.45x39_ap",10) ~= false and
new_dialog.item_much("conserva",20) ~= false
end

-- отдадим всё Старшёму
function starshoy_say_one_done()
  sak.out_item_namber( "medkit", 10 )
  sak.out_item_namber( "wpn_ak74u", 2 )
  sak.out_item_namber( "vodka", 5 )
  sak.out_item_namber( "ammo_5.45x39_ap", 10 )
  sak.out_item_namber( "conserva", 20 )
  parfum_sms_kontrik1()
end

--' заспавним монстриков в Тёмной деревне
function babki_spawn_dsity_hutor()
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(-152.261,9.779,-165.322),185095,3606 },
      { "zombie_normal",vector():set(-152.261,9.779,-165.322),185095,3606 },
      { "bloodsucker_strong",vector():set(-147.065,9.438,-160.811),190266,3606 },
    }
  )
end

--' заспавним там же арты
function artu_spawn_dsity_hutor()
end


-- получим фотку тайника от Нормана
function fotka_norman()
  sak.create_items_actor( "taynik_mg", 1 )
  sak.create_items_actor( "stco", 1 )
  dsh.story_sms_timer( 5, script_name() .. ".sms_obmorok1" )
end


--' убираем защиту центра МГ
function delete_zaschita_zenter_gorod()
local sim = alife()
	local se_obj = sim:story_object(17029)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17030)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17031)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17032)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17033)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17034)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17035)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17036)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17037)
	if se_obj then
		sim:release(se_obj, true)
	end
local sim = alife()
	local se_obj = sim:story_object(17038)
	if se_obj then
		sim:release(se_obj, true)
	end
end


-- убираем 10 минутную защиту центра МГ
function del_zasch_zent_gorod()
  local sim = alife()
  local se_obj = sim:story_object( 17028 )
  if se_obj then
    sim:release( se_obj, true )
  end
  -- удалить временный переход, созданный для побега из МГ
  del_perexodik()
  dsh.story_sms_timer( 60, script_name() .. ".agro_tainik_norman_sms" )
  db.actor:give_info_portion( "spawn_atp_presledovateli" )
end


--' удаляем первичную зону защиты бандитов(Обморок)
function del_zona_gorod_obmorok(story_id)
local se_obj = alife():story_object(17027)
if se_obj then
alife():release(se_obj)
end
end


-- удаляем зону защиты здания с Доком
function del_plendok_doza_timer()
  local se_obj = alife():story_object( 17041 )
  if se_obj then
    alife():release( se_obj )
  end
  se_obj = alife():story_object( 17042 )
  if se_obj then
    alife():release( se_obj )
  end
  dsh.story_sms_timer( 5, script_name() .. ".dcity_iskra_zvonok_sms1" )
end


--' удаляем скриптовый переход МГ-АТП
function del_perexodik()
  for _, sid in ipairs({
    story_ids.dead_city_atpeshka,
    story_ids.dead_city_atpeshka_zone,
  }) do
    local se_obj = alife():story_object( sid )
    if se_obj then
      alife():release( se_obj )
    end
  end
end


-- спавним телепорт в тайник на Агре
function spawn_teleport_agro_norm_taynik()
  spawn_mem_module()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_agro_norm_taynik",
    vector():set( -39.155300140381, 0.77279758453369, 39.892715454102 ),
    203745, 700
  )
  alife():assign_story_id( se_obj.id, 17040 )
  db.actor:give_info_portion( "agro_tainik_norman_start" )
end

function spawn_teleport_vnutri_norm_taynik()
  local sobj = spawn_teleport.create_teleport(
    "m_teleport_vnutri_norm_taynik",
    vector():set( -36.638717651367, -3.8879518508911, 37.493068695068 ),
    200314, 672
  )
end


--' спавним блок включения переходов на агре
function spawn_mem_module()
local obj = alife():create("mem_module",vector():set(-37.030,-3.887,46.352),203086,672)
end


-- портим отношения с вояками
function vrag_speznaza()
  local sobj = alife():object( "val_exit_gate" )
  if sobj then
    alife():release( sobj )
  end
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "l04_darkvalley"
      and sobj:section_name() == "ph_skeleton_object"
      and sobj:name() == ""
      and sobj.m_game_vertex_id == 811
      and sobj.m_level_vertex_id == 316473
    then
      local pk = get_netpk( sobj, 1 )
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      local vis_name = data.visual_name
      if data.visual_name == [[physics\door\door_darkvalley_vorota_01]] then
        table.insert( t, sobj )
        break
      end
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: release %s[%u] (%s)",
      script_name(), sobj:section_name(), sobj.id, sobj.level_name
    )
    alife():release( sobj )
  end
end


function spawn_babki_d_city()
  battle.create_enemies(
    {
      { "zombie_normal",vector():set(59.981,15.624,44.041),416820,3644 },
      { "zombie_normal",vector():set(52.225,10.889,46.796),409618,3644 },
      { "zombie_normal",vector():set(52.225,10.889,46.796),409618,3644 },
      { "zombie_normal",vector():set(52.225,10.889,46.796),409618,3644 },
      { "kontroller_yazva",vector():set(53.321,15.624,45.421),410925,3644 },
    }
  )
end


-- проверим наличие финансов для Дуды
function dengi_dude_est( actor, npc )
  return actor:money() > 150000
end


-- отдадим бабки
function otdal_dengi_dude( t1, t2 )
  local npc = t1
  if npc:id() == db.actor:id() then npc = t2 end
  dialogs.relocate_money( npc, 150000, "out" )
  nachalnik_zvonok_sms1()
end


-- убирём Дуду
function delete_duda()
  local se_obj = alife():object( "last_dokplen_nachalnik" )
  if se_obj then
    alife():release( se_obj, true )
  end
  local se_obj = alife():object( "last_dokplen_ox_dok" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


-- проверим наличие маскировочной экзы
function dok_ekza_est()
  return amk_utils.inventory_search( "meceniy_outfit_new", 1 )
end


-- отдадим маскхалат и кольт доку
function otdadim_doku_exzu()
  amk_utils.out_items_number({
    [ "meceniy_outfit_new" ] = 1,
  })
end


--' убираем видимого Дока из МГ
function dell_dcity_dok_vidim()
local se_obj = alife():object("dcity_dok_bolot")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем невидимого Дока из МГ
function dell_dok_nevidim()
local se_obj = alife():object("dcity_dok_nevidim")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем дока Сак с Припяти 
function prip_dok_sak_dell()
end

--' Вступаем в стрейнджеры
function join_stranger (actor, npc)
    printf ("ACTOR NOW IN stranger COMMUNITY")
    if db.actor then
       db.actor:set_character_community ("stranger", 0, 0)
    end
end
function checking_taken_item58(obj)
local info=nil
if obj:section()=="streyndzher" then join_stranger(obj)
   end
end

--' получим streyndzher
function take_streyndzher(first_speaker, second_speaker)
dialogs.relocate_item_section(second_speaker, "streyndzher","in")
end


--' убираем streyndzher
function dell_streyndzher()
  amk_utils.out_items({ "streyndzher" })
end


--' убираем Муху из госпиталя
function dell_muha_hosp_live()
local se_obj = alife():object("muha_hosp_live")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- получим от Дока маскхалат обратно
function dok_vernul_mashalat()
  sak.create_items_actor( "meceniy_outfit_used", 1 )
end


--' убираем Молнию из МГ
function dell_dcity_molniy()
local se_obj = alife():object("dead_city_molniy")
  if se_obj then
    alife():release(se_obj, true)
  end
end


-- спавним записку Искры
function iskra_listok_spawn()
  alife():create(
    "iskra_listok", vector():set( -109.715, 3.154, 37.802 ), 231506, 3622
  )
end


-- спавним телепорт в ливнёвку МГ
function spawn_tele_dcity_kanaliy()
  local se_obj = spawn_teleport.create_teleport(
    "m_teleport_dcity_kanaliy",
    vector():set( -89.229080200195, 1.1233458518982, -27.065231323242 ),
    254634, 3620
  )
  alife():assign_story_id( se_obj.id, story_ids.m_teleport_dcity_kanaliy )
  imitator_kanaliy_spavn()
end

function spawn_tele_izkanalii_dcity()
  local sobj = spawn_teleport.create_teleport(
    "m_teleport_izkanalii_dcity",
    vector():set( -152.27732849121, -1.6294522285461, 44.664749145508 ),
    219201, 3615
  )
end


function kanaliy_dinamit1 (actor, npc)
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (17044)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end
    if source == nil then
        return
    end
    local h = hit ()
    h.power = 100
    h.direction = vector():set( 1, 0, 0 )
    h.impulse = 60
    h.draftsman = source
    h.type = hit.chemical_burn
    source:hit (h)
end

function kanaliy_dinamit2 (actor, npc)
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (17045)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end
    if source == nil then
        return
    end
    local h = hit ()
    h.power = 200
    h.direction = vector():set( 1, 0, 0 )
    h.impulse = 60
    h.draftsman = source
    h.type = hit.chemical_burn
    source:hit (h)
end

function kanaliy_dinamit_nevid2 (actor, npc)
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (17046)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end
    if source == nil then
        return
    end
    local h = hit ()
    h.power = 200
    h.direction = vector():set( 1, 0, 0 )
    h.impulse = 60
    h.draftsman = source
    h.type = hit.chemical_burn
 --   h.type = hit.fire_wound
    source:hit (h)
end

function kanaliy_dinamit_nevid1 (actor, npc)
    local source = nil
    local sim = alife ()
    if sim then
       local se_obj = sim:story_object (17047)  
       if se_obj then
          source = level.object_by_id(se_obj.id)
       end
    end
    if source == nil then
        return
    end
    local h = hit ()
    h.power = 200
    h.direction = vector():set( 1, 0, 0 )
    h.impulse = 60
    h.draftsman = source
    h.type = hit.chemical_burn
--  h.type = hit.fire_wound
    source:hit (h)
end

function hit_dcity_imitator()
    local h = hit ()
    h.power = 1.5
h.direction = vector_rotate_y(db.actor:direction(), 90)
    h.impulse = 190
h.draftsman = db.actor
   h.type = hit.strike
db.actor:hit(h)
end

function imitator_gener_spavn()
local obj = alife():create("imitator",vector():set(14.1453580856323,46.1324005126953,-174.886108398438),349707,3112)
local obj = alife():create("imitator",vector():set(12.7922649383545,46.1104927062988,-175.030914306641),349707,3112)
local obj = alife():create("imitator",vector():set(13.0828914642334,41.1308479309082,-178.822647094727),351371,3112)
local obj = alife():create("imitator",vector():set(9.48082637786865,41.120964050293,-174.294830322266),347116,3112)
local obj = alife():create("imitator",vector():set(14.1029558181763,41.1306571960449,-170.866104125977),352208,3112)
local obj = alife():create("imitator",vector():set(17.6013641357422,41.1303024291992,-175.369445800781),356617,3112)
local obj = alife():create("imitator",vector():set(13.8957996368408,40.6325912475586,-207.103958129883),352170,3110)
local obj = alife():create("imitator",vector():set(58.6876487731934,45.9572601318359,-260.544982910156),404981,3114)
local obj = alife():create("imitator",vector():set(58.6876487731934,45.9572601318359,-260.544982910156),404981,3114)
local obj = alife():create("imitator",vector():set(56.4247131347656,40.8750076293945,-256.978088378906),402536,3114)
local obj = alife():create("imitator",vector():set(62.013557434082,40.8754501342773,-257.889007568359),409206,3114)
local obj = alife():create("imitator",vector():set(61.2656860351563,40.8751411437988,-263.562530517578),408351,3114)
local obj = alife():create("imitator",vector():set(55.6032638549805,40.8755035400391,-262.710906982422),400910,3114)
local obj = alife():create("imitator",vector():set(45.4872398376465,40.5109367370605,-252.432556152344),387744,3114)
local obj = alife():create("imitator",vector():set(33.3227081298828,40.3606071472168,-243.254913330078),375267,3114)
local obj = alife():create("imitator",vector():set(13.5879325866699,47.8379516601563,-230.732391357422),350469,3110)
end

function imitator_gospilal_spavn()
--hosp_3otsek_snezka_muha1
local obj = alife():create("imitator_snezka",vector():set(-95.15917,28.38907,567.27117),1003,3038)
--hosp_3otsek_snezka_muha2
local obj = alife():create("imitator_snezka",vector():set(-95.60807,28.52086,568.32916),845,3038)
--hosp_3otsek_holodez_krug1
local obj = alife():create("imitator_holodez",vector():set(-95.49827,32.41429,613.68133),1024,3038)
--hosp_3otsek_holodez_krug2
local obj = alife():create("imitator_holodez",vector():set(-96.06416,32.54857,614.63214),869,3038)
--hosp_3otsek_holodez_krug3
local obj = alife():create("imitator_holodez",vector():set(-95.53624,32.58135,615.53179),1026,3038)
--hosp_3otsek_holodez_krug4
local obj = alife():create("imitator_holodez",vector():set(-94.12352,32.463905,615.60363),1104,3038)
--hosp_3otsek_holodez_krug5
local obj = alife():create("imitator_holodez",vector():set(-93.64558,32.35847,614.88037),1171,3038)
--hosp_3otsek_holodez_krug6
local obj = alife():create("imitator_holodez",vector():set(-92.82126,32.22382,614.169372),1378,3038)
--hosp_3otsek_holodez_krug7
local obj = alife():create("imitator_holodez",vector():set(-92.28500,32.23130,614.78918),1638,3038)
--hosp_3otsek_holodez_krug8
local obj = alife():create("imitator_holodez",vector():set(-91.746139,32.26699,615.73327),1972,3038)
--hosp_3otsek_imitator_elektra1
local obj = alife():create("imitator",vector():set(-93.587043,32.309429,614.39288),1171,3038)
--hosp_3otsek_imitator_elektra2
local obj = alife():create("imitator",vector():set(-92.75412,32.16616,613.60137),1637,3038)
--hosp_3otsek_holodez1_muxa
local obj = alife():create("imitator_holodez",vector():set(-94.68213,28.18796,565.45812),1085,3038)
--hosp_3otsek_holodez2_muxa
local obj = alife():create("imitator_holodez",vector():set(-94.73439,28.27208,566.36437),1086,3038)
--hosp_3otsek_holodez3_muxa
local obj = alife():create("imitator_holodez",vector():set(-95.12808,28.32499,566.57604),1002,3038)
--hosp_3otsek_holodez4_muxa
local obj = alife():create("imitator_holodez",vector():set(-95.03950,28.38788,567.38183),1004,3038)
end

function imitator_kanaliy_spavn()
local obj = alife():create("imitator_holodez",vector():set(-96.308708190918,-1.8240934610367,-19.150089263916),247176,3620)
local obj = alife():create("imitator",vector():set(-94.969078063965,-1.824152469635,-20.891218185425),248712,3620)
local obj = alife():create("imitator",vector():set(-95.195724487305,-1.8241112232208,-19.7877368927),248713,3620)
end


--' Ара, паразит, подох раньше времени - будет вылет
function delete_khutor_zone2_restrictor()
local sim = alife()
	local se_obj = sim:story_object(17049)
	if se_obj then
		sim:release(se_obj, true)
	end
end

--' убираем рестриктор вместе с Седым - а то стрёмно...
function sedoy_del_restrictor()
local sim = alife()
	local se_obj = sim:story_object(17050)
	if se_obj then
		sim:release(se_obj, true)
	end
end

--' убираем Парфюмера1 из МГ
function dell_parfuym1()
local se_obj = alife():object("dcity_parfumer")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' убираем Обморока из МГ
function dell_obmorok()
local se_obj = alife():object("dcity_obmorok")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' тайник-ящик у бандосов 3 гулага МГ
function spawn_yzik_3gulag()
local se_obj = alife():create("m_inventory_box40", vector():set(-0.265,4.332,-0.748),357228,3633)
end

--' отдадим бабки за пользование ПДА
function operator_babki_otdat(t1,t2)
local npc=t1
if npc:id()==db.actor:id() then
npc=t2
end
dialogs.relocate_money(npc,3000,"out")
end

--' убираем рестрикторы Бленда
function dell_spawn1_bland1_restr()
local sim = alife()
	local se_obj = sim:story_object(17052)
	if se_obj then
		sim:release(se_obj, true)
	end
end
function dell_spawn_bland_restr()
local sim = alife()
	local se_obj = sim:story_object(17051)
	if se_obj then
		sim:release(se_obj, true)
	end
end


-- Бленд отдал флешку
function bland_otdal_flesh( first_speaker, second_speaker )
  sak.create_items_actor( "bland_flash", 1 )
  local goodwill = second_speaker:general_goodwill( first_speaker )
  if goodwill < 0 then
    second_speaker:change_goodwill( -goodwill, first_speaker )
  end
end


--' убираем Блэнда из ТД
function dell_dark_bland()
local se_obj = alife():object("dark_bland")
  if se_obj then
    alife():release(se_obj, true)
  end
end

--' таракашки в доме МГ
function mg_spawp_tarakashki()
  battle.create_enemies(
    {
      { "tarakan_strong",vector():set(-170.146,15.623,57.121),166135,3599 },
      { "tarakan_normal",vector():set(-170.146,15.623,57.121),166135,3599 },
      { "tarakan_strong",vector():set(-173.322,15.624,54.904),162448,3599 },
      { "tarakan_normal",vector():set(-173.322,15.624,54.904),162448,3599 },
      { "tarakan_strong",vector():set(-166.88,15.624,54.501),169708,3599 },
      { "tarakan_normal",vector():set(-166.88,15.624,54.501),169708,3599 },
      { "tarakan_strong",vector():set(-162.841,15.626,48.662),173338,3600 },
      { "tarakan_normal",vector():set(-162.841,15.626,48.662),173338,3600 },
      { "tarakan_strong",vector():set(-174.055,15.624,40.553),161636,3599 },
      { "tarakan_normal",vector():set(-174.055,15.624,40.553),161636,3599 },
      { "tarakan_strong",vector():set(-179.561,15.623,47.734),156157,3599 },
      { "tarakan_normal",vector():set(-179.561,15.623,47.734),156157,3599 },
      { "tarakan_strong",vector():set(-177.969,15.625,50.948),157710,3599 },
      { "tarakan_normal",vector():set(-177.969,15.625,50.948),157710,3599 },
    }
  )
end


--' заспавним пробного товарища в бункере
function spawn_biblio_bunker()
--не будем ничего спавнить, ибо из-за него вылеты
--local obj = dsh.create_free_mob("tushkano_normal",vector():set(5.312,-19.440,25.189),7347,2768)
end

-- звук библиотекаря
function zvuk_bibliotekar()
  local snd_obj = xr_sound.get_safe_sound_object( "monsters\\alligator" )
  snd_obj:play_no_feedback(
    db.actor, sound_object.s2d, 0, vector():set( 0, 0, 0 ), 1.0
  )
end


function set_sych()
  local obj = alife():story_object( story_ids.stalker_rost_sysh )
  if obj then
    amk.add_spot_on_map( obj.id, "crlc_big", "set_sych" )
  end
end

function remove_sych_metka()
  local obj = alife():story_object( story_ids.stalker_rost_sysh )
  if obj then
    level.map_remove_object_spot( obj.id, "crlc_big" )
  end
end


--' убираем рестриктор видео в Лиманске
function dell_video_finish_restr()
local sim = alife()
	local se_obj = sim:story_object(17053)
	if se_obj then
		sim:release(se_obj, true)
	end
end

--' убираем скриптовый переход лима-МГ
function del_pereod_lima_dcity()
local sim = alife()
	local se_obj = sim:story_object(18113)
	if se_obj then
		sim:release(se_obj, true)
	end
end

--' убираем Нормана и Парфюмера2 из МГ
function dell_dcity_norman()
local se_obj = alife():object("parfumer_dcity_shtab")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("dcity_kontrol_stalk")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function dell_torgov_restr()
local se_obj = alife():object("atp_torgovetz_sms_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function dell_restri()
local se_obj = alife():object("agro_muxa_sms1_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("otshel_chel_dell_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("petrenko_chel_dell_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function delet_otshel()
local se_obj = alife():object("final_otshelnik")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("final_petrenko")
  if se_obj then
    alife():release(se_obj, true)
  end
end

function psev_have()
alife():create('ver', db.actor:position(), db.actor:level_vertex_id(), db.actor:game_vertex_id(), db.actor:id())
end

--' удаляем рестрикторы сходки авторитетов
function dell_sxodnyak()
local se_obj = alife():object("muxa_chel_dell_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("otshel_chel_dell_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
local se_obj = alife():object("petrenko_chel_dell_restrictor")
  if se_obj then
    alife():release(se_obj, true)
  end
end


function nax_poshel()
  local se_obj = alife():object( "chernomor_zombi" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


--' убираем Черномора-зомби
function dell_chernomor_zombi1()
  local se_obj = alife():object( "chernomor_zombi1" )
  if se_obj then
    alife():release( se_obj, true )
  end
end


function del_chern_zombi1()
  local se_obj = alife():story_object( 9626 )
  if se_obj then
    alife():release( se_obj, true )
  end
end


function dell_stanki()
end

function delete_eartquake()
local se_obj = alife():object("aes2_space_restrictor_eartquake")
if se_obj then
alife():release(se_obj, true)
end
end

function semetskiy_obmen_have()
	return 
		new_dialog.item_much("detektor_amorf",1) and
		new_dialog.item_much("stco",1) and
		new_dialog.item_much("red_mozg",1)
end
function semetskiy_obmen_not_have()
	return not semetskiy_obmen_have()
end
function semetskiy_obmen_done()
	db.actor:give_info_portion("biznes_remove_special_item")
	sak.out_item_namber("detektor_amorf",1)
	sak.out_item_namber("stco",1)
	sak.out_item_namber("red_mozg",1)
	db.actor:disable_info_portion("biznes_remove_special_item")
	sak.create_items_actor("det_artefact_super", 1)
end


function klenov_gol_nayti_have()
  return db.actor:has_info( "klenov_gol_nayti_have" )
end


function derevny_zashita_have()
  return db.actor:has_info( "derevny_zashita_have" )
end


function btr_ataka_have()
  return db.actor:has_info( "btr_ataka_have" )
end


function tretiy_kod_dost_start()
  sak.create_items_actor( "af_arhara_globus", 1 )
end
