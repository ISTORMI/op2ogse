-- -*- mode: lua; coding: windows-1251-dos -*-

-- эти объекты будем пересоздавать, т.к. они могут смещаться
local fix_ph_position = {
  [ "jupiter" ] = {
    [ "jup_b205_door_button" ] = 2343, -- кодовый замок на ЗРК "Волхов"
  },
  [ "l04_darkvalley" ] = {
    [ "val_door_nedostroyka" ] = 5713, -- дверь в оружейку бандитов
  },
  [ "l07_military" ] = {
    [ "mil_physic_object0034" ] = 7854, -- дверь в оружейку свободы
    [ "mil_zabor"             ] = 7980, -- взрываемый забор
    [ "mil_zabor_0000"        ] = 7991,
  },
  [ "l08_yantar" ] = {
    -- двери в бункер
    [ "door_trader"      ] = 8775,
    [ "door_trader_0000" ] = 8776,
  },
  [ "l10_radar" ] = {
    [ "rad_code_door" ] = 9857, -- дверь в комнатку с переходом в Варлаб
  },
  [ "peshera" ] = {
    -- вагонетка в начале Пещеры, сразу у перехода
    [ "peshera_arhara_vagonetka1" ] = function( sobj )
      sobj.position = vector():set( -0.405, -2.25, -4.602 )
    end,
  },
}


function attach( sm )
  sm:subscribe({ signal = "on_before_first_update", fun = this.on_first_update })
  sm:subscribe({ signal = "on_before_spawn", fun = this.on_spawn })
end


local processed_info = {}
local vname          = "dsh_fixes.version"

function on_first_update()
  local fixes = {
    all_spawn_fix.respawn_allspawn,
    this.kill_journalist_npc,
    this.skip,
    this.skip,
    this.skip,
    this.skip,
    this.skip,
    this.skip,
    this.remove_ogse_relation_reverse_table,
    this.fix_zone_ameba,
    this.fix_prizrak_wpn,
    this.fix_val_rob_buying,
    this.fix_val_rob_buying,
    this.start_dsh_walking_job,
    this.skip,
    this.fix_gener_spawn_tvari,
    this.fix_rx_wmgr_boxes,
    this.skip,
    this.skip,
    this.skip,
    this.fix_red_psy_dog_phantom,
    this.skip,
    this.skip,
    this.remove_marsh_ameba1,
    this.fix_crow_respawns,
    this.fix_taynik_alexandrych,
    this.skip,
    this.skip,
    this.fix_af_pero,
    this.respawn_gavr_and_co, -- 29
    this.remove_padar_spawn_zombi_kukla_restrictor,
    this.fix_bandit_goodwill,
    this.fix_aes_battle_sounds,
    this.fix_pri_battle_sounds,
    this.fix_ogse_actor_conditions_mgr_cam_inert,
    this.fix_esc_bridge_pass_fire,
    this.respawn_gavr_and_co_2,
    this.fix_detector_suit,
    this.fix_mil_tush1,
    this.fix_grib_respawn,
    this.fix_horrortime_begin,
    this.fix_af_transform_cnt,
    this.fix_trade_dialog_timers,
    this.skip,
    this.fix_stalk_semetskiy,
    this.fix_amk_anoms_generate_art,
    this.skip,
    this.fix_kot_hos,
    this.fix_esc_buldozer22,
    this.fix_gg_need_sleep,
    this.fix_val_zapis,
    this.fix_dead_military_esc,
    this.fix_yantar_arhara_mine1,
    this.fix_horrortime_begin2,
    this.skip,
    this.fix_emb,
    this.fix_dead_military_esc2,
    this.fix_war_door_lab,
    this.fix_find_chip,
    this.fix_dragunov_ohota_talk,
    this.fix_marsh_band_spawn,
    this.fix_bar_arena_door_0000,
    this.fix_aem_admin,
    this.fix_news_check,
    this.fix_show_news,
    this.fix_kotobegemot_bar,
    this.fix_drop_boxes,
    this.fix_running_treasure,
    this.fix_jup_gun_3,
    this.fix_letters,
    this.fix_krest_topor,
    this.fix_sleep_bags,
    this.fix_bar_arena_triger,
    this.fix_wpn_toz34_arena,
    this.fix_explosive_barrel,
    this.fix_tamaz_body2,
    this.fix_gar_dm_novice,
    this.fix_rebind_keys,
    this.fix_podval_btr_nevid1,
    this.fix_spawn_bunker_sekret,
    this.fix_bunker_art_v_spiral_restrictor,
    this.fix_btr_nevid_krusha_kultorg,
    this.fix_yakut_agro,
    this.fix_spawn_monstrov,
    this.fix_marsh_m_car,
    this.fix_gar_no_gravity_vorota,
    this.fix_marsh_havan_restr,
    this.fix_explosive_barrel2,
    this.skip,
    this.skip,
    this.fix_sysh_treasure_box,
    this.fix_zone_ozero,
    this.fix_zat_fireball,
    this.fix_door_hospital_01_l_0003,
    this.fix_mil_physic_object_0001,
    this.fix_dragunov_ohota,
    this.fix_l10u_bunker_codedoor_key_0000,
    this.fix_buusty_kvest_task,
    this.fix_strelok_taynik_pda0,
    this.fix_esc_dinamit_panera,
    this.fix_hamster_kuznec6,
    this.fix_handmade_arts_cnt,
    this.make_free_prizrak,
    this.fix_land_arhara_biliyrd,
    this.fix_se_respawn,
    this.fix_stalker_kisluy,
    this.fix_trade_dialog_maks,
    this.fix_esc_surprise_box_015,
    this.fix_dsh_rukzak_storage,
    this.fix_pseudodog_forest,
    this.fix_l10u_bunker_codedoor_key_0000_2,
    this.fix_dsh_ogse_relations,
    this.skip,
    this.fix_dark_bland,
    this.fix_netpacket_pda,
    this.fix_amk_transmutator,
    this.fix_anim_ph_zone_0004,
    this.fix_sak_flash,
    this.fix_mozg,
    this.fix_wpn_gungauss,
    this.fix_info_restriction,
    this.fix_vasily_chertez_reminder,
    this.fix_prizrak_treasure_box,
    this.fix_dcity_pyatietazhka_yzik1,
    dsh_life_saver.got_life_saver,
    this.fix_explosive_barrel_all,
    this.fix_atp_presled_last,
    this.fix_warlab_sekret_generator5,
    this.fix_yakut_treasure_box,
    this.fix_black_dok_gener_say_done,
    this.fix_dsh_rukzak_access_time,
    this.fix_add_lchanger_location,
    this.fix_foto_ohota_have,
    this.fix_create_sr18,
    this.fix_dcity_stalki_matras_1,
    this.skip,
    this.fix_aver_muha_bazar_sms_restrictor,
    this.fix_val_bandit_krisyk,
    this.fix_dsity_rasstrel_end,
    this.fix_dcity_gg_neytral_restrictor,
    this.fix_dokplen_spawn_one_restrictor,
    this.fix_dcity_lastday,
    this.fix_marsh_udav,
    this.fix_val_borov_dead,
    this.fix_av_peshera_mono2_bunker_niz,
    this.fix_av_peshera_zone_emi1,
    this.skip,
    this.fix_yan_st_stalker3_kamp_1,
    this.fix_pri_dimak,
    this.fix_pripyat_campfires,
    this.fix_x18_campfires,
    this.fix_pripyat_campfires2,
    this.fix_lab_pri1,
    this.fix_jupiter_underground,
    this.fix_lab_under,
    this.fix_labx8,
    this.fix_esc2_smart_stalker_exit_kamp_1,
    this.fix_agr2_st_factory_kamp_1,
    this.fix_l03_agroprom_candles,
    this.fix_l03u_agr_underground_candles,
    this.fix_jupiter,
    this.fix_jupiter_campfires,
    this.fix_warlab_fountain_average1_niz,
    this.fix_aver_zone_emi1,
    this.fix_arm_sklady_rg_box_0033,
    this.fix_marsh_campfires,
    this.fix_zaton,
    this.fix_zaton_campfires,
    this.fix_sherstuk_enemy,
    this.fix_zaton_campfires2,
    this.fix_karta_peschera,
    this.fix_pri1_zaton,
    this.skip,
    this.skip,
    this.skip,
    this.fix_spawn_babki_dcity_restrictor,
    this.fix_esc_akim_lager,
    this.fix_arny_kogot,
    this.fix_haker_soft,
    this.fix_poisk_partizan_spawn,
    this.fix_val_zone_radioactive_average,
    this.fix_esc_dogs_swarm,
    this.fix_add_new_mil_110,
    this.fix_add_new_darkvalley_111,
    this.fix_radar_campfires,
    this.fix_x10_campfires,
    this.fix_poisk_partizan_spawn_2,
    this.skip,
    this.fix_grom_npc,
    this.fix_red_forest_candles,
    this.fix_limansk_campfires,
    this.fix_volazar,
    this.fix_living_dead_code,
    this.fix_fotograf_about,
    this.fix_volna_sak_have,
    this.fix_marsh_campfires2,
    this.fix_zaton_campfires3,
    this.fix_teleport_1_arhara_spawn_restrictor,
    this.fix_vedro_1000,
    this.fix_land_arhara_zimov_voz,
    this.fix_volna_svidetel,
    this.fix_volna_diversya_done,
    this.fix_marsh_kosoi,
    this.fix_val_borov_dead,
    this.fix_green_night_centr,
    this.fix_x16_candles,
    this.fix_karas_npc_dead,
    this.fix_marsh_campfires3,
    this.skip,
    this.fix_weight_upgrade,
    this.skip,
    this.fix_kuzy_artmodifik,
    this.fix_marsh_radioactive_strong,
    this.fix_l12_stancia_campfires,
    this.fix_zaton_campfires4,
    this.fix_agr_zone_radioactive_weak_0005,
    this.fix_av_peshera_campfires,
    this.fix_av_pesh_tuman11_grot,
    this.fix_kap_tele_restrictor,
    this.fix_esc_medkit,
    this.fix_snd_efx,
    this.fix_poddon_0013,
    this.fix_dok_seif,
    this.fix_sak_out_teleport,
    this.fix_zaton_to_escape,
    this.fix_sahar_info,
    this.skip,
    this.fix_peshera_arhara_anom5,
    this.fix_agr_space_restrictor_0001,
    this.fix_surprise_box_815,
    this.fix_aes_soldier_commander,
    this.fix_peshera_go,
    this.fix_peshera_blok_tp,
    this.fix_rosros_cutscene,
    this.fix_agro_final_vert2,
    this.fix_delete_agro_musor,
    this.skip,
    this.fix_level_changer_na_kordon,
    this.fix_puzir_campfires,
    this.fix_overweight_time,
    this.fix_escape_lager_spawn_killers,
    this.fix_sed_village,
    this.fix_add_new_to_peshera2,
    this.skip,
    this.fix_kot_update,
    this.fix_agro_final_vert1,
    this.fix_yakut_agro2,
    this.fix_aes_btr,
    this.fix_aes_space_restrictor_sound_0044,
    this.fix_spawn_teleport1,
    this.fix_clear_personal_relations,
    this.fix_warlab_stalker_oso,
    this.fix_drrr_vibros,
    this.fix_stalker_alexandrych,
    this.fix_esc_hunter_zaschita_2,
    this.fix_bodi_pantera1,
    this.fix_boloto_provodnik,
    this.fix_land_lazaret_stalker2,
    this.fix_land_lazaret_stalker3,
    this.skip,
    this.fix_piligrim,
    this.skip,
    this.skip,
    this.fix_bar_atp_level_changer,
    this.fix_level_changer_na_kordon2,
    this.fix_level_changer_na_pripyat,
    this.fix_exit_to_peshera_from_garbage,
    this.fix_exit_to_peshera_from_agroprom,
    this.fix_exit_to_agr_underground_05,
    this.fix_peshera_arhara_vagonetka2,
    this.fix_perehod_chaes2_na_chaes_restrictor,
    this.fix_space_restrictor_buluzniki,
    this.fix_sms_ot_klenov_restrictor,
    this.skip,
    this.fix_forest_chimera_x_ray2,
    this.fix_agr_ratcatcher_candle,
    this.fix_mil_bolt,
    this.fix_rostok_volkodav_band_mapspot,
    this.fix_yan_vasilyev,
    this.fix_m_teleport_16,
    this.skip,
    this.skip,
    this.fix_zone_flame_small,
    this.fix_rostok_zone_zharka_static_average,
    this.fix_zone_flame_small2,
    this.fix_limansk_campfires2,
    this.fix_m_teleport,
    this.fix_av_pesh_grot_controller,
    this.fix_agr_krot,
    this.fix_bar_ecolog_professor,
    this.fix_esc_find_doctor_done,
    this.fix_kalmyak_marsh_kalmyak_centr,
    this.fix_exit_to_puzir_from_garbage,
    this.fix_darkvalley_les,
    this.fix_lukash_counter_done,
    this.fix_esc_find_doctor_done2,
    this.fix_m_teleport_40,
    this.fix_video_vzlet_gen_restrictor,
    this.fix_video_vzlet_boloto_restrictor,
    this.fix_video_kursk_space_restrictor,
    this.fix_diplomat,
    this.fix_mil_sniper_kill_zone,
    this.fix_rostok_zone_witches_galantine,
    this.fix_upiter_baty_otlet_heli_restrictor,
    this.fix_taler_marsh_vas,
    this.fix_rostok_zone_witches_galantine_0004,
    this.fix_mil_mines_restrictor,
    this.fix_yan_st_stalker3_population_locked,
    this.fix_info_amk_recipt_souls,
    this.fix_klyak_forest_doc_scene,
    this.fix_brat_luis,
    this.fix_kolmogor_sestra_have,
    this.fix_vertuxa_kapitana_space_restrictor,
    this.fix_kolm_stroy_sms_restrictor,
    this.fix_new_arts_count,
    this.fix_spawn_teleport28,
    this.fix_atp_for_test22_campfires,
    this.fix_atp_for_test22_campfires2,
    this.fix_atp_for_test22_candle,
    this.fix_spawn_teleport31,
    this.fix_aver_campfires,
    this.fix_aver_campfires2,
    this.fix_agroprom_campfires,
    this.fix_peshera_campfires,
    this.fix_hospital_campfires,
    this.fix_bar_campfires,
    this.fix_rostok_campfires,
    this.fix_garbage_campfires,
    this.fix_yantar_campfires,
    this.fix_labirint_campfires,
    this.fix_aver_campfires3,
    this.fix_agroprom_campfires2,
    this.fix_marsh_campfires4,
    this.fix_puzir_campfires2,
    this.fix_darkvalley_campfires,
    this.fix_radar_campfires2,
    this.fix_rostok_campfires2,
    this.fix_handmade_arts_exp,
    this.fix_kordon_campfires,
    this.fix_warlab_campfires,
    this.fix_spawn_exhimera_restrictor,
    this.fix_ekza_sarcofag,
    this.fix_control_monolith_campfires,
    this.fix_ratcatcher_out,
    this.fix_military_campfires,
    this.fix_sarcofag_campfires,
    this.fix_stancia_2_campfires,
    this.fix_stancia_2_campfires2,
    this.fix_atp_for_test22_campfires3,
    this.fix_warlab_campfires2,
    this.fix_generators_campfires,
    this.fix_red_forest_campfires,
    this.skip,
    this.fix_zone_ameba2,
    this.fix_m_teleport_25,
    this.fix_udalyem_molniu_restrictor,
    this.fix_atp_for_test22_campfires4,
    this.fix_atp_for_test22_campfires5,
    this.fix_gar_dm_bandit,
    this.fix_m_teleport_24,
    this.fix_av_pesh_tornado1,
    this.fix_av_pesh_tornado2,
    this.fix_av_pesh_tuman1,
    this.fix_labirint_arhara_anom17,
    this.fix_av_pesh_dum1,
    this.fix_labirint_arhara_anom19,
    this.fix_propeller_labirint,
    this.fix_av_peshera_zone_zharka_static_average_0000,
    this.fix_av_pesh_tuman13_grot,
    this.fix_av_pesh_tuman12,
    this.fix_av_pesh_zone_ogon1,
    this.fix_av_pesh_zone_ogon_strong2,
    this.fix_marsh_campfires5,
    this.fix_esc_fanat,
    this.fix_adr_shkatulka,
    this.fix_vertolet_td,
    this.fix_esc_bridge_kill_zone,
    this.fix_kordon_campfires2,
    this.fix_darkvalley_campfires2,
    this.fix_bar_campfires2,
    this.fix_labirint_campfires2,
    this.fix_garbage_campfires2,
    this.fix_amk_embankment_soldat1,
    this.fix_m_teleport_9,
    this.fix_bar_radiation,
    this.fix_agroprom_campfires3,
    this.fix_prizrak_tainiy_talk,
    this.fix_darkvalley_campfires3,
    this.fix_pripyat_campfires3,
    this.fix_warlab_campfires3,
    this.skip,
    this.skip,
    this.fix_rs_mt_texload,
    this.skip,
    this.fix_radar_campfires3,
    this.fix_info_artmod_globus,
    this.fix_spawn_bunker_sekret2,
    this.fix_molniy_posle_foto_restrictor,
    this.fix_space_restrictor_vagonchik,
    this.fix_esc_lager_guard_kill_zone,
    this.fix_val_fireball,
    this.fix_limansk_campfires3,
    this.fix_dcity_tarakanovo_stvol,
    this.fix_perehov_naruzhu_restrictor,
    this.fix_door_hospital_01_r_0001,
    this.fix_video_black_first_restrictor,
    this.fix_spawn_svalka_plot_stalk_restrictor,
    this.skip,
    this.fix_marsh_sniper_respawn,
    this.fix_dead_city_campfires,
    this.fix_playboy,
    this.fix_military_campfires2,
    this.fix_warlab_sms1_space_restrictor,
    this.skip,
    this.fix_rad_code_door_keylock,
    this.fix_gg_pili_sms_restrictor,
    this.fix_yan_pri1,
    this.fix_esc_lager_guard_kill_zone2,
    this.fix_val_wpn_mp5,
    this.fix_voronin_voen_sms_restrictor,
    this.skip,
    this.fix_add_new_radar_106,
    this.fix_bunker_kontr_strong1,
    this.fix_pri1_lab,
    this.fix_contr_forest2,
    this.fix_kat2_m_controller_old_0000,
    this.skip,
    this.fix_a_inventory_box40,
    this.fix_mar_physic_object_0053,
    this.skip,
    this.fix_hud_fov,
    this.fix_snayperka_zombi_restrictor,
    this.fix_r2_ignore_actor_torch,
    this.fix_snd_device,
    this.fix_red_level_changer_to_puzir,
    this.fix_mil_to_red_forest,
    this.fix_land_arhara_sniper_sp,
    this.fix_aver_arhara_mine,
    this.fix_running_treasure2,
    this.fix_l05_bar_sr_gruzovik,
    this.fix_r2_ls_depth_bias,
    this.fix_aes_space_restrictor_timer,
    this.fix_atp_dcity_pobeg_restrictor,
    this.fix_keypress_on_start,
    this.fix_l05_bar_sr_za_garikom,
    this.fix_privyzka_generatorov_restrictor,
    this.fix_aver_m_poltergeist_strong_flame_0001,
    this.fix_aver_wpn_desert_eagle,
    this.fix_door_yantar_u_01,
    this.fix_mil_physic_object_0009,
    this.fix_r2_shader_cache,
    this.fix_r3_dynamic_wet_surfaces_enable_streaks,
    this.fix_marsh_kosoi_shesterka1,
    this.skip,
    this.fix_spawn_teleport3,
    this.skip,
    this.fix_blockpost_case_spawn,
    this.fix_stalk_kluk,
    this.fix_warlab_arhara_matras_3,
    this.fix_body_pantera_talk_start,
    this.fix_warlab_skladu_level_changer,
    this.fix_agro_torgash_heli,
    this.fix_atp_mobil_torgovetz,
    this.fix_exit_to_radar_109,
    this.fix_esc_fox,
    this.fix_esc_tirex,
    this.fix_info_spawn_zver,
    this.fix_warlab_sms2_space_restrictor,
    this.fix_l11_pripyat_campfires,
    this.fix_x18_level_changer_to_warlab,
    this.fix_exit_to_yantar_102,
    this.fix_exit_to_agroprom_103,
    this.skip,
    this.fix_l11_pripyat_campfires2,
    this.fix_l11_pripyat_campfires3,
    this.fix_r3_dynamic_wet_surfaces_sm_res,
    this.skip,
    this.fix_agr_pseudodog_nest1,
    this.fix_agr_dog_nest1,
    this.fix_prapor_box,
    this.fix_grom_npc_spawn,
    this.fix_mil_tonnel_restrictor,
    this.skip,
    this.fix_mil_physic_object_0021,
    this.fix_atp_buldozer,
    this.skip,
    this.fix_kot_lekar_done,
    this.fix_limansk_campfires4,
    this.fix_mil_freedom_wall_restrictor,
    this.fix_red_level_changer_to_atp,
    this.fix_red_level_changer_to_radar,
    this.fix_lim_exit_to_hospital,
    this.fix_skadovsk_radio,
    this.fix_val_phd_stul,
    this.fix_a_inventory_box32,
    this.fix_pri_depot,
    this.fix_esc_dead_tunel_novice,
    this.skip,
    this.fix_dan_flash,
    this.fix_hospital_wooden_board_01_0000,
    this.fix_black_doctor,
    this.fix_kot_find_black_doctor,
    this.fix_on_tunel_restr,
    this.fix_forest_wound,
    this.fix_red_level_changer_to_limansk,
    this.skip,
    this.fix_exit_from_limansk,
    this.fix_kluk_pripyt_derevny_sms,
    this.fix_village_piligrim,
    this.fix_village_pantera_otvet_restrictor,
    this.fix_village_sms_kap_restrictor,
    this.fix_lost_village_heli_1,
    this.fix_forest_pozisiy_na_dome_restrictor,
    this.fix_generators_heli_hit,
    this.fix_pili_zayti_after_antenna_restrictor,
    this.fix_m_teleport_dok_prip_vuhod,
    this.fix_aes2_tr13,
    this.skip,
    this.fix_gener_pripyat_level_changer,
    this.fix_podgotovka_zahvata_restrictor,
    this.fix_spawn_ubludky,
    this.fix_dsh_deadmans,
    this.fix_chaes2_kran_zone_emi1,
    this.fix_kolmo_say_pobeda_sms_restrictor,
    this.fix_klenov_antena_find,
    this.fix_sms_girl3_nachalo_restrictor,
    this.fix_sms_molniy_bar_restrictor,
    this.free_smart_terrains_again,
    this.fix_x16_meshes_brkbl,
    this.fix_warlab_kolmogor_sms_restrictor,
    this.skip,
    this.fix_sim_stalker_fraer,
    this.fix_hud_crosshair_zoom,
    this.fix_dcity_otkl_zona_shtab_restrictor,
    this.fix_dinam_nevid_vzryv_restrictor,
    this.fix_dcity_dok_nevidim,
    this.fix_esc_foto_muzhik,
    this.fix_nevid_monolit,
    this.fix_military_fotomuzhik,
    this.fix_foto_monolitovets,
    this.fix_stul_sak,
    this.fix_sar_zone_radioactive,
    this.fix_snd_targets,
    this.fix_hos_zamena_art_restrictor,
    this.fix_aes2_snork_outdoor,
    this.fix_aes2_stalker_0010,
    this.fix_aes2_snork_strong_0032,
    this.fix_aes2_snork_strong_0033,
    this.fix_aes2_stalker_0039,
    this.fix_aes_space_restrictor_sound_battle1,
    this.fix_aes_monolit_heli_hunter,
    this.fix_aes_soldier_desant_wave_0051,
    this.fix_aes_space_restrictor_sound,
    this.fix_esc_kidalo,
    this.fix_gar_dolg_blokpost,
    this.fix_add_new_radar_to_warlab,
    this.fix_r2_exp_donttest_shad,
    this.fix_ph_frequency,
    this.skip,
    this.fix_chaes1_prizrak_kamp,
    this.fix_sms_doc_letit_restrictor,
    this.fix_chaes1_prizrak,
    this.fix_chaes1_prizrak_way1_restrictor,
    this.fix_tretiy_kod_dost_start,
    this.fix_gener_no_weapon_zone_restrictor,
    this.fix_generators_burer1,
    this.fix_agro_zone_perexod_restrictor,
    this.fix_qeast_q,
    this.fix_aver_kluk0_put0_restrictor,
    this.fix_iz_moskvy_sms_restrictor,
    this.fix_aver_muha_pilot_vzlet_sms_restrictor,
    this.fix_chaes2_arhara_beter2_kluk,
    this.fix_chees2_mono1_za_zdaniem1,
    this.fix_chaes_arh_mine_1,
    this.fix_sleep_bags2,
    this.fix_final_agro_boltobny_restrictor,
    this.fix_final_kluk,
    this.fix_chaes2_truba_art_rukzak,
    this.fix_molniy_tretiy_dialog_restrictor,
    this.fix_strannik_lima_restrictor,
    this.fix_odnonogiy_spawn,
    this.skip,
    this.skip,
    this.fix_mesto_v_bunkere_start,
    this.fix_esc_klenov_posulka_restrictor,
    this.fix_spawn_dialog_foto_restrictor,
    this.fix_warlab_burning_fuzz_strong,
    this.fix_radist_open_door_restrictor,
    this.fix_radist_u_seifa_restrictor,
    this.fix_kluk_sad_after_mina_start,
    this.fix_forest_superzhekan_restrictor,
    this.fix_mil_exit_to_bar,
    this.fix_peshera_m_poltergeist,
    this.fix_a_inventory_box12,
    this.fix_gar_bandit_stroyka,
    this.fix_gar_sniper_in_restrictor,
    this.fix_doctor_drug_faze1,
    this.fix_spawn_cern_stalk_restrictor,
    this.skip,
    this.fix_mozhno_otkrut,
    this.fix_esc_pantera_task,
    this.fix_vse_pantera_umerla_restrictor,
    this.fix_poslednie_sms_pantera_restrictor,
    this.fix_sms_otez_poreshil_ubiysu_restrictor,
    this.fix_strelka_mesto_dialog_restrictor,
    this.fix_aver_level_changer_to_military,
    this.fix_l04_darkvalley_clmbl,
    this.fix_molniya_plastilin,
    this.fix_podval_tornado_strong,
    this.fix_limansk_code_lock,
    this.fix_lim_physic_object_0031,
    this.fix_city_starshoy,
    this.fix_sms_parfumer1_restrictor,
    this.fix_stalkerkills,
    this.fix_dcity_bandit_garazh,
    this.fix_dead_city_campfires2,
    this.fix_spawn_nach_oxran_restrictor,
    this.fix_m_teleport_vnutri_norm_taynik,
    this.fix_m_teleport_izkanalii_dcity,
    this.fix_spawn_military_btr,
    this.fix_add_new_lima_to_dead_city,
    this.fix_dcity_iskra_zvonok_restrictor,
    this.fix_dead_city_campfires3,
    this.fix_dead_city_molniy,
    this.fix_val_escort_ambush_zone,
    this.fix_naemn_shturm_poluch_start,
    this.fix_agr_u_bandits,
    this.fix_dar_control_poltergeist,
    this.fix_tri_tainik_start,
    this.fix_bar_hunter_toz,
    this.fix_gigant_red_strong1,
    this.fix_barrem_talk,
    this.fix_mar_level_changer_to_escape_2,
    this.fix_test_space_restrictor,
    this.skip,
    this.fix_x16_m_controller_e,
    this.skip,
    this.fix_koiot_npc_sr1,
    this.skip,
    this.fix_agr_exit_to_garbage_02,
    this.fix_val_lvl_changer3,
    this.fix_rostok_zone_radioactive_average,
    this.fix_labx8_2,
    this.fix_pripyat_campfires4,
    this.fix_lx8_physic_door,
    this.fix_dark_object_nodywka_1,
    this.fix_pda_dimak,
    this.skip,
    this.fix_upiter_heli_baty,
    this.fix_jup_und_train_vagon_01_open,
    this.fix_gar_exit_to_darkvalley_high,
    this.fix_bar_exit_to_garbage,
    this.fix_gar_exit_to_agroprom_02,
    this.fix_rostok_exit_to_yantar,
    this.fix_sva_chaes2_info,
    this.fix_wpn_aps_sk1_wpn_m79,
    this.fix_gar_seryi_factory_0000,
    this.fix_wpn_mp5,
    this.fix_gar_open_fire,
    this.fix_gar_seryi_open_fire,
    this.fix_gar_bandit_post,
    this.fix_input_exclusive_mode,
    this.skip,
    this.fix_gar_seryi_bandits,
    this.fix_esc_exit_to_garbage_01,
    this.fix_puzir_arhara_vagonchik,
    this.fix_chimaera_visual,
    this.fix_puzir_arhara_helicopter2,
    this.fix_zone_witches_galantine_koleso,
    this.skip,
    this.skip,
    this.fix_mar_level_changer_to_escape_1,
    this.fix_mar_level_changer_to_agroprom_1,
    this.fix_bar_tiran_pda,
    this.fix_taynik_agr_shkaf,
    this.fix_m_teleport_bolota_u_agru,
    this.fix_cleanup_l06_rostok_flame,
    this.fix_val_exit_gate,
    this.fix_dark_btr1_arhara1,
    this.fix_r2_sun_lumscale_amb,
    this.fix_mongol_divan,
    this.fix_marsh_casket,
    this.fix_rostok_arhara_kamaz1,
    this.fix_agr_krot_PDA_free,
    this.fix_esc_agregat,
    this.fix_av_pesh_matras1_grot,
    this.fix_av_pesh_meshok1,
    this.fix_val_escort_captive,
    this.fix_marsh_dan,
    this.fix_marsh_holod,
    this.fix_val_bandit_trader2,
    this.fix_esc_kuznetsov,
    this.fix_sherstuk,
    this.fix_gar_seryi,
    this.fix_yakut_false_prestart,
    this.fix_ucen_talk_preneed,
    this.fix_shax_land_perehod_talk_prestart,
    this.fix_prizrak_tainiy_start,
    this.fix_medik_pribor_1,
    this.fix_r2_disable_hom,
    this.fix_av_peshera_arhara_staloktit_1,
    this.fix_medik_pribor_1_kolby,
    this.fix_medik_pribor_1_karta,
    this.fix_snd_occ_mtl,
  }
  local version = ogse.load_var( vname, 0 )
  log2(
    "[%s]: version = %s, fixes = %s",
    script_name(), version, table.getn( fixes )
  )
  if version < table.getn( fixes ) then
    for i = version + 1, table.getn( fixes ) do
      fixes[ i ]( version )
    end
    ogse.save_var( vname, table.getn( fixes ), "u32" )
  end
  local fixes_on_info = {}
  for k, v in pairs( fixes_on_info ) do
    if db.actor:has_info( k ) and not processed_info[ k ] then
      log2( "[%s]: found fixes for '%s', applying...", script_name(), k )
      for _, f in ipairs( v ) do
        f()
      end
      processed_info[ k ] = true
      local processed = ogse.load_var( "dsh_fixes.processed_info", {} )
      table.insert( processed, k )
      ogse.save_var(
        "dsh_fixes.processed_info", processed, "array_template",
        { "string" }
      )
    end
  end
end

function skip() end


function on_spawn()
  local processed = ogse.load_var_safe( "dsh_fixes.processed_info" ) or {}
  for _, k in ipairs( processed ) do
    processed_info[ k ] = true
  end
  fix_physic_objects()
  fix_bar_barman()
  fix_marsh_barman()
  fix_bar_arena_man()
  fix_yantar_ecolog_general()
  fix_dragunof_npc()
  fix_pri_dimak_pos()
  fix_akill_npc()
  fix_grom_npc_pos()
  -- fix_sak_military_stalker()
  fix_land_sniper_chimaera()
  fix_aver_filin()
  fix_sak_prizrak()
  fix_val_bandit_trader()
  fix_puzir_crest()
end


-- Сделать труп журналиста, который случайно заспаунился живым
function kill_journalist_npc()
  local sobj = alife():story_object( story_ids.journalist_npc )
  if sobj then
    local obj = level.object_by_id( sobj.id )
    if obj then
      obj:kill( obj )
    else
      ogse.kill_offline_npc( sobj )
    end
  end
end


function cleanup_respawners()
  se_respawn.iterate_respawners( function( respawner )
      if respawner.parent then return end
      local ids = {}
      for _, id in ipairs( respawner.spawned_obj ) do
        table.insert( ids, id )
      end
      for _, id in ipairs( ids ) do
        local sobj = alife():object( id )
        if sobj then
          local strn_id
          if ( IsStalker( sobj ) or IsMonster( sobj ) ) and sobj.smart_terrain_id then
            strn_id = sobj:smart_terrain_id()
          else
            strn_id = 65535
          end
          if strn_id ~= 65535 then
            local strn = alife():object( strn_id )
            if strn then
              if
                not smart_terrain.is_same_level_group(
                  object_level_name( strn ),
                  object_level_name( sobj )
                )
              then
                log2(
                  "[cleanup_respawners]: remove %s from %s: smart_terrain %s has different level group: %s and %s",
                  id, respawner:name(), strn:name(),
                  object_level_name( strn ),
                  object_level_name( sobj )
                )
                respawner:remove_spawned( id )
              end
            else
              log2(
                "[cleanup_respawners]: remove %s from %s: smart_terrain %s not found",
                id, respawner:name(), strn_id
              )
              respawner:remove_spawned( id )
            end
          end
        else
          log2( "[cleanup_respawners]: remove %s from %s (%s): not found", id, respawner:name(), tostring( respawner.amk_name ) )
          respawner:remove_spawned( id )
        end
      end
  end )
end


function remove_ogse_relation_reverse_table()
  ogse.delete_var( "ogse_relation_reverse_table" )
end


function fix_prizrak_wpn()
end


function fix_val_rob_buying()
  local strn = smart_terrain.get_smart_terrain_by_name( "val_rob" )
  strn:lock_population( true )
end


function cleanup_rats( ver )
  if ver == 0 then return end
  local levels = {
    [ "atp_for_test22" ] = true,
    [ "av_peshera"     ] = true,
--    [ "aver"           ] = true,
--    [ "dead_city"      ] = true,
    [ "l01_escape"     ] = true,
    [ "l02_garbage"    ] = true,
    [ "l03_agroprom"   ] = true,
    [ "l03u_agr_underground" ] = true,
    [ "l04_darkvalley" ] = true,
    [ "l04u_labx18"    ] = true,
    [ "l05_bar"        ] = true,
    [ "l06_rostok"     ] = true,
    [ "l07_military"   ] = true,
    [ "l08_yantar"     ] = true,
    [ "l10_radar"      ] = true,
    [ "l10u_bunker"    ] = true,
    [ "l11_pripyat"    ] = true,
--    [ "l12_stancia"    ] = true,
--    [ "l12_stancia_2"  ] = true,
--    [ "l12u_control_monolith" ] = true,
--    [ "l12u_sarcofag"  ] = true,
    [ "marsh"          ] = true,
    [ "peshera"        ] = true,
    [ "puzir"          ] = true,
  }
  local t = {}
  for id, sobj in alife():objects() do
    if
      IsMonster( sobj )
      and sobj:smart_terrain_id() == 65535
      and levels[ object_level_name( sobj ) ]
      and not (
        se_respawn.get_respawner_by_npc_id( sobj.id )
        or dsh_respawn.get_respawner_by_npc_id( sobj.id )
      )
    then
      table.insert( t, sobj )
    end
  end
  local sm = ogse_signals.get_mgr()
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: found extra %s on %s",
      script_name(), sobj:name(), object_level_name( sobj )
    )
    alife():release( sobj )
    sm:call( "on_release_npc", sobj.id )
  end
end


function start_dsh_walking_job()
  local next_m = math.random( 0, 59 )
  dsh.start_gtimerDHMS(
    "dsh_walking_stalkers.periodic_job",
    0, 1, next_m, 0,
    "dsh_walking_stalkers.periodic_job"
  )
end


function fix_gener_spawn_tvari()
  local tvari = {
    [ "gener_electro_chim1_podstanziy" ] =  1847,
    [ "gener_electro_chim2_podstanziy" ] =  1848,
    [ "generators_bloodsucker_strong1" ] =  1771,
    [ "gen_bloodsucker_na_krushe"      ] =  1816,
    [ "red_bloodsucker_strong_0002"    ] = 14936,
    [ "red_m_poltergeist_strong_flame" ] = 14943,
    [ "red_m_poltergeist_normal_tele"  ] = 14945,
    [ "red_m_poltergeist_normal_tele_0000" ] = 14946,
  }
  for name, spawn_id in pairs( tvari ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: deleting %s", script_name(), name )
      smart_terrain.unregister_npc( sobj )
      se_respawn.on_release_npc( sobj.id )
      dsh_respawn.on_release_npc( sobj.id )
      alife():release( sobj )
      log2( "[%s]: creating %s, spawn_id = %s", script_name(), name, spawn_id )
      sobj = alife():create( spawn_id )
      ASSERT( name == sobj:name(), "wrong spawn %s ~= %s", name, sobj:name() )
    end
  end
end


function fix_rx_wmgr_boxes( ver )
  if ver == 0 then return end
  local boxes = {}
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "inventory_box"
      and sobj.position.y == -300
    then
      log2(
        "[%s]: found %s on %s",
        script_name(), sobj:name(), object_level_name( sobj )
      )
      boxes[ id ] = sobj
    end
  end
  local t = {}
  for id, sobj in alife():objects() do
    if boxes[ sobj.parent_id ] then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: found %s on %s",
      script_name(), sobj:name(), object_level_name( sobj )
    )
    alife():release( sobj )
  end
  for id, sobj in pairs( boxes ) do
    alife():release( sobj )
  end
end


function fix_red_psy_dog_phantom()
  local sobj = alife():object( "red_psy_dog_phantom" )
  if sobj then
    log2( "[%s]: deleting %s", script_name(), sobj:name() )
    smart_terrain.unregister_npc( sobj )
    se_respawn.on_release_npc( sobj.id )
    dsh_respawn.on_release_npc( sobj.id )
    alife():release( sobj )
  end
end


local bar_walk_fixes = {
--[=[
  [ "bar_bar_drunk_dolg"   ] = {
    path = "bar_bar_visitor_dolg_walk",
    pos  = vector():set(
      134.305435180664, -4.83976221084595, 26.5520305633545
    ),
  },
--]=]
  [ "bar_bar_guard_2"      ] = "bar_bar_guard_walk",
  [ "bar_bar_lisiy"        ] = "bar_bar_square_3_place_1_walk",
  [ "bar_bar_visitor_hunter" ] = {
    path = "bar_bar_visitor_hunter_walk",
    pos  = vector():set(
      129.895431518555, -4.84401607513428, 28.121150970459
    ),
  },
  [ "bar_bar_visitors_2_1" ] = {
    path = "bar_bar_square_2_place_1_walk",
    pos  = vector():set(
      133.679824829102, -4.82401657104492, 29.4379711151123
    ),
  },
  [ "bar_barman"           ] = "bar_barman_hole_walk",
  [ "bar_docent"           ] = "bar_docent_walk_way",
  [ "bar_dolg_bunker_0002" ] = "bar_dolg_bunker_guard_5_walk",
  [ "dolgovazyi"           ] = "dolgovazyi_walk_way",
}

function fix_bar_barman()
  if level.name() == "l05_bar" and db.actor:has_info( "seensak_l05_bar" ) then
    for name, path in pairs( bar_walk_fixes ) do
      local sobj = alife():object( name )
      if sobj then
        local pos
        if type( path ) == "table" then
          pos  = path.pos
          path = path.path
        end
        local patrol = patrol( path )
        alife():teleport_object(
          sobj.id,
          ( pos or patrol:point( 0 ) ),
          patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
        )
      end
    end
  end
end


function remove_marsh_ameba1()
  local sobj = alife():object( "marsh_ameba1" )
  if sobj then
    alife():release( sobj )
  end
end


function fix_crow_respawns()
  local t = {}
  for id, crow in alife():objects() do
    if string.find( crow:name(), "m_crow", 1, true ) then
      table.insert( t, crow )
    end
  end
  local sm = ogse_signals.get_mgr()
  for _, sobj in ipairs( t ) do
    sm:call( "on_release_npc", sobj.id )
    alife():release( sobj )
  end
end


function fix_taynik_alexandrych( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "m_inventory_box_alex_upiter" then
      alife():release( sobj )
      buusty_dialog.taynik_alexandrych_spawn()
      break
    end
  end
end


function fix_af_pero( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "af_pero" then
      log2( "[%s]: found %s", script_name(), sobj:name() )
      local obj = level.object_by_id( sobj.id )
      if obj then
        obj:set_condition( 1 )
      end
      local pk   = get_netpk( sobj, 1 )
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      data.condition = 1
      pk:set( data )
    end
  end
end


function respawn_gavr_and_co()
  local sids = {
    [ 9623 ] = "mil_trader_gavr",
    [ 9624 ] = "mil_gavr_bodyguard1",
    [ 9625 ] = "mil_gavr_bodyguard2",
  }
  for sid, sect in pairs( sids ) do
    while alife():story_object( sid ) do
      local sobj = alife():story_object( sid )
      if sobj then
        log2(
          "[%s]: found %s ( %s, %s )",
          script_name(), sobj:name(), sobj:community(),
          object_level_name( sobj )
        )
        local strn_id = sobj:smart_terrain_id()
        if strn_id ~= 65535 then
          local strn = alife():object( strn_id )
          if strn then
            log2( "[%s]: smart_terrain = %s", script_name(), strn:name() )
            smart_terrain.unregister_npc( sobj )
          end
        end
        ogse_signals.get_mgr():call( "on_release_npc", sobj.id )
        alife():release( sobj )
      end
    end
  end
  if
    db.actor:has_info( "informator_pda_done" )
    and not db.actor:has_info( "info_gavr_dead" )
  then
    new_spawn.bar_informator()
  end
end


function remove_padar_spawn_zombi_kukla_restrictor()
  if db.actor:has_info( "muha_kukla_have" ) then
    local sobj = alife():object( "padar_spawn_zombi_kukla_restrictor" )
    if sobj then
      log2( "[%s]: found %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_aes_battle_sounds()
  local names = {
    "aes_space_restrictor_sound_battle_0000",
    "aes_space_restrictor_sound_battle_0001",
  }
  for _, n in ipairs( names ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_marsh_barman()
  if level.name() == "marsh" then
    local sobj = alife():object( "marsh_barman" )
    if sobj then
      local patrol = patrol( "marsh_barman_walk" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_pri_battle_sounds()
  local names = {
    "pri_ambient_battle_sound_zone_0000",
    "pri_ambient_battle_sound_zone_0001",
    "pri_ambient_battle_sound_zone_0002",
    "pri_ambient_battle_sound_zone_0003",
  }
  for _, n in ipairs( names ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_ogse_actor_conditions_mgr_cam_inert()
  ogse.delete_var( "ogse_actor_conditions_mgr.cam_inert" )
  cmd2( "cam_inert", "0" )
end


function fix_esc_bridge_pass_fire()
  db.actor:disable_info_portion( "esc_bridge_pass_fire" )
  db.actor:disable_info_portion( "sherstuk_enemy" )
end


function respawn_gavr_and_co_2( ver )
  -- выполнять только, если выполнялся respawn_gavr_and_co()
  if ver >= 29 then
    respawn_gavr_and_co()
  end
end


function fix_detector_suit()
  local obj = db.actor:object( "detector_suit" )
  if obj then
    local sobj = alife():object( obj:id() )
    if sobj then
      alife():release( sobj )
    end
  end
end


function fix_mil_tush1()
  local respawners = {
    "av_peshera_rat1",
    "av_peshera_rat2",
    "av_peshera_rat3",
    "av_peshera_rat4",
    "av_peshera_rat5",
    "esc_fracture",
    "dv_sak_1monstr",
    "mil_tush1",
    "mil_himer_family",
  }
  for _, name in ipairs( respawners ) do
    local resp = dsh_respawn.get_respawner( name )
    if resp then
      for _, v in ipairs( resp.spawned_obj ) do
        resp:remove_spawned( v )
      end
    end
  end
end


function fix_grib_respawn()
  braad_test.grib_respawn()
end


function fix_horrortime_begin() end


function fix_af_transform_cnt()
  dsh.reset_af_transform_cnt()
end


function fix_trade_dialog_timers( ver )
  for _, k in ipairs({ "kuznezov", "sherstyk", "voron" }) do
    log2( "[%s]: start_trade_dialog_timer[%s]", script_name(), k )
    dsh.start_trade_dialog_timer( k )
  end
end


function fix_stalk_semetskiy()
  if db.actor:has_info( "odnonogiy_first_start" ) then
    local sobj = alife():object( "stalk_semetskiy" )
    if sobj then
      log2( "[%s]: found %s", script_name(), sobj:name() )
      alife():release( sobj )
      log2( "[%s]: ... removed", script_name() )
    end
  end
end


function fix_amk_anoms_generate_art()
  ogse.delete_var( "amk_anoms.generate_art" )
end


function fix_kot_hos()
  if db.actor:has_info( "we_ne_chmuri" ) then
    local sobj = alife():object( "kot_hos" )
    if sobj then
      log2( "[%s]: found %s", script_name(), sobj:name() )
      alife():release( sobj )
      log2( "[%s]: ... removed", script_name() )
    end
  end
end


function fix_esc_buldozer22()
  local sobj = alife():object( "esc_buldozer22" )
  if sobj then
    log2( "[%s]: found %s", script_name(), sobj:name() )
    alife():release( sobj )
    log2( "[%s]: ... removed", script_name() )
  end
end


function fix_gg_need_sleep() end


function fix_val_zapis( ver )
  if ver == 0 then return end
  local t = {}
  for id, sobj in alife():objects() do
    if string.find( sobj:section_name(), "^val_zapis_" ) then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    log2( "[%s]: found %s, removing ...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_dead_military_esc() end


function fix_yantar_arhara_mine1()
  local sobj = alife():object( "yantar_arhara_mine1" )
  if sobj then
    log2( "[%s]: found %s", script_name(), sobj:name() )
    alife():release( sobj )
    log2( "[%s]: ... removed", script_name() )
  end
end


function fix_horrortime_begin2() end


function fix_emb( ver )
  if ver == 0 then return end
  local idx = amk.load_variable( "emb_idx", 0 )
  if idx > 0 then
    log2( "[%s]: found emb_idx = %s, disabling...", script_name(), idx )
    emb.worker_clean( idx )
    amk.del_variable( "emb_idx" )
    log2( "[%s]: ... done", script_name() )
  end
  local infos = {
    "emb_container_done",
    "embt_vp1_done",
    "emb_kill_tm_done",
    "embt_td1_done",
    "emb_done",
  }
  news_manager.skip_send_task = true
  for _, info in ipairs( infos ) do
    db.actor:give_info_portion( info )
  end
  if
    db.actor:has_info( "ten_monolita_talk_done" )
    and not db.actor:has_info( "tm_find_info_done" )
  then
    level_tasks.set_task_state( task.completed, "tm_find_info", 0 )
    level_tasks.set_task_state( task.completed, "tm_find_info", 1 )
  end
  dsh.timeout( 1, function()
    news_manager.skip_send_task = false
  end )
end


function fix_dead_military_esc2( ver )
  local remove_items = {
    "snp_note1",
    "snp_pda1",
  }
  local t = {}
  for id, sobj in alife():objects() do
    local sect = sobj:section_name()
    if remove_items[ sect ] then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    log2( "[%s]: found %s, deleting...", script_name(), sobj:name() )
    alife():release( sobj )
  end
  local sobj = alife():story_object( 19901 )
  if sobj then
    log2( "[%s]: found %s, deleting...", script_name(), sobj:name() )
  end
  local infos = {
    "snp_borov1_start",
    "snp_find_sniper1_done",
    "snp_borov1_done",
    "snp_find_name1_done",
    "snp_kotobegemot1_done",
    "snpt_dt1_done",
    "snp_kotobegemot2_done",
    "snp_bioradar_parts_done",
  }
  news_manager.skip_send_task = true
  for _, info in ipairs( infos ) do
    db.actor:give_info_portion( info )
  end
  dsh.timeout( 1, function()
    news_manager.skip_send_task = false
  end )
end


function fix_war_door_lab()
  local sobj = alife():object( "war_door_lab" )
  if sobj then
    log2( "[%s]: found %s, respawning...", script_name(), sobj:name() )
    alife():release( sobj )
    alife():create( 14960 )
  end
end


function fix_find_chip( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "find_chip_start" )
    and not db.actor:has_info( "find_chip_have" )
  then
    level_tasks.set_task_state( task.completed, "find_chip", 0 )
    level_tasks.set_task_state( task.completed, "find_chip", 1 )
  end
  if
    db.actor:has_info( "vasily_chertez_start" )
    and not db.actor:has_info( "vasily_chertez_done" )
  then
    level_tasks.set_task_state( task.completed, "vasily_chertez", 0 )
    level_tasks.set_task_state( task.completed, "vasily_chertez", 1 )
  end
  dsh.timeout( 1, function()
    news_manager.skip_send_task = false
  end )
end


function fix_dragunov_ohota_talk( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "dragunov_ohota_start" )
    and not db.actor:has_info( "dragunov_ohota_talk" )
  then
    log2( "[%s]: giving 'dragunov_ohota_talk' info_portion", script_name() )
    db.actor:give_info_portion( "dragunov_ohota_talk" )
  end
end


function fix_bar_arena_door_0000()
  all_spawn_fix.release_allspawn_object( "bar_arena_door_0000" )
end


function fix_marsh_band_spawn()
  if not db.actor:has_info( "marsh_band_spawn" ) then
    log2(
      "[%s]: marsh_band_spawn not found, executing braad_test.marsh_band_spawn()",
      script_name()
    )
    braad_test.marsh_band_spawn()
  end
end


function fix_aem_admin()
  local id = xr_logic.pstor_retrieve( db.actor, "aem_id", 0 )
  if id > 0 then
    local sobj = alife():object( id )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
      db.storage[ db.actor:id() ].pstor[ "aem_id" ] = nil
    end
  end
end


function fix_bar_arena_man()
  local sobj = alife():story_object( story_ids.bar_arena_locator ) -- 571
  if not sobj then
    log2( "[%s]: bar_arena_man not found, respawning...", script_name() )
    alife():create( alife():spawn_id( story_ids.bar_arena_locator ) )
  end
end


function fix_news_check()
  if amk.has_g_timer( "news_check" ) then
    log2( "[%s]: found news_check amk timer, removing...", script_name() )
    amk.remove_timer( "news_check" )
  end
end


function fix_show_news()
  if amk.has_g_timer( "show_news" ) then
    log2( "[%s]: found show_news amk timer, removing...", script_name() )
    amk.remove_timer( "show_news" )
  end
end


function fix_bandit_goodwill() end


function fix_kotobegemot_bar()
  local sobj = alife():story_object( 19901 )
  if sobj then
    log2( "[%s]: found %s, deleting...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_drop_boxes( ver )
  if ver == 0 then return end
  for _, v in ipairs( xr_box_data.def_boxes ) do
    local name, spawn_id = unpack( v )
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, skipping", script_name(), sobj:name() )
    else
      log2( "[%s]: %s not found, respawning...", script_name(), name )
      sobj = alife():create( spawn_id )
      local pk = get_netpk( sobj, 1 )
      ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      data.visual_name = [[physics\box\box_wood_01]]
      data.custom_data:setString(
        "[drop_box]\norig_name = " .. name .. "\ncommunity = def_box\n"
      )
      data.physic_type = 3
      data.mass        = 10
      pk:set( data )
    end
  end
end


function fix_jup_gun_3()
  local items = {
    "jup_gun_2", "jup_gun_3",
    "jup_ammo_1", "jup_ammo_2", "jup_ammo_3", "jup_ammo_4", "jup_ammo_5",
    "jup_ammo_6", "jup_ammo_7",
  }
  for _, n in ipairs( items ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_letters( ver )
  if ver == 0 then return end
  local items = {}
  db.actor:iterate_inventory(
    function( npc, obj )
      if obj:section() == "letter" then
        table.insert( items, obj )
      end
    end,
    db.actor
  )
  for _, obj in ipairs( items ) do
    log2( "[%s]: found %s, removing...", script_name(), obj:name() )
    ogse.remove_item_from_inventory( obj )
  end
end


function fix_krest_topor( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "krest_topor" )
    and not db.actor:has_info( "krest_topor_done" )
  then
    log2( "[%s]: giving 'krest_topor_done' info_portion", script_name() )
    news_manager.skip_send_task = true
    db.actor:give_info_portion( "krest_topor_done" )
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
  end
end


function fix_sleep_bags()
  log2( "[%s]: spawn_physic_sleep_bag", script_name() )
  -- Подушка на диване, в подвале ДН.
  dsh.spawn_physic_sleep_bag(
    vector():set( -214.66897583008,-22.854312896729,-127.25451660156 ),
    39266, 59
  )
  -- На АС, в штабе.
  dsh.spawn_physic_sleep_bag(
    vector():set( -19.310693740845,-3.7826442718506,-21.311328887939 ),
    288157, 1593
  )
  -- У Борова, в ТД.
  dsh.spawn_physic_sleep_bag(
    vector():set( 39.124752044678,4.880298614502,-81.890159606934 ),
    223240, 1100
  )
  -- У ученых в бункере, на Янтаре.
  dsh.spawn_physic_sleep_bag(
    vector():set( 30.377950668335,-10.974708557129,-279.49533081055 ),
    54978, 1480
  )
  -- На Баре, в штабе Долга.
  dsh.spawn_physic_sleep_bag(
    vector():set( 232.12272644043,-5.1097793579102,128.38359069824 ),
    59078, 1200
  )
  -- В Баре, у ремонтников.
  dsh.spawn_physic_sleep_bag(
    vector():set( 113.90551757813,-4.9745478630066,13.434575080872 ),
    33613, 1239
  )
  -- На Агропроме, на втором этаже, над сталкерами.
  dsh.spawn_physic_sleep_bag(
    vector():set( 0.75571030378342,7.836715221405,14.530187606812 ),
    239682, 682
  )
  -- На Свалке, в ангаре.
  dsh.spawn_physic_sleep_bag(
    vector():set( -73.496315002441,-1.8777117729187,16.13635635376 ),
    134381, 330
  )
  -- На Болотах, у охотников.
  dsh.spawn_physic_sleep_bag(
    vector():set( 409.00204467773,3.5339589118958,236.85739135742 ),
    409496, 3546
  )
  -- На Болотах, на базе ЧН.
  dsh.spawn_physic_sleep_bag(
    vector():set( -141.90623474121,1.1168230772018,-318.71026611328 ),
    75332, 3374
  )
  -- На Генераторах, в развалинах дома.
  dsh.spawn_physic_sleep_bag(
    vector():set( -122.82690429688,38.734680175781,-522.4990234375 ),
    194439, 3089
  )
  -- В Красном Лесу, у моста.
  dsh.spawn_physic_sleep_bag(
    vector():set( -119.96662902832,0.89263081550598,-256.01147460938 ),
    9112, 3241
  )
  -- В Красном Лесу, в вогончике у сталкеров.
  dsh.spawn_physic_sleep_bag(
    vector():set( 14.4216381073,1.4473948478699,-46.648189544678 ),
    74929, 3290
  )
  -- На АТП, рядом с Калининым.
  dsh.spawn_physic_sleep_bag(
    vector():set( -173.61164855957,3.5274684429169,225.39572143555 ),
    125764, 2799
  )
  -- На Неразведанной Земле, в домике у Отшельника.
  dsh.spawn_physic_sleep_bag(
    vector():set( -344.14367675781,-8.6550722122192,-7.5538892745972 ),
    277313, 2889
  )
  log2( "[%s]:   done", script_name() )
end


function fix_bar_arena_triger()
  local bad_sr = {
    "bar_arena_triger",
    "bar_arena_comment_1",
    "bar_arena_comment_1_0000",
    "bar_arena_comment_1_0001",
    "bar_arena_rank_checker",
    "bar_arena_check_death",
    "bar_arena_comment_1_0002",
    "bar_arena_comment_1_0003",
    "bar_arena_comment_1_0004",
    "bar_arena_comment_1_0005",
    -- "bar_arena_restrictor",
  }
  for _, n in ipairs( bad_sr ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_wpn_toz34_arena( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if isMagazinedWeapon( sobj ) then
      local ammo = parse_names(
        get_string( sobj:section_name(), "ammo_class", "" )
      )
      local pk = get_netpk( sobj, 1 )
      if pk:isOk() then
        local data      = pk:get()
        local ammo_type = data.ammo_type
        if ammo_type >= table.getn( ammo ) then
          log2(
            "[%s]: found wrong ammo_type: %s: %s >= %s",
            script_name(), sobj:name(), ammo_type, table.getn( ammo )
          )
          data.ammo_type = 0
          pk:set( data )
        end
      end
    end
  end
end


function fix_explosive_barrel( ver )
  local loc  = {
    [ "atp_for_test22" ] = true,
    [ "aver"           ] = true,
    [ "dead_city"      ] = true,
    [ "generators"     ] = true,
    [ "hospital"       ] = true,
    [ "l01_escape"     ] = true,
    [ "l02_garbage"    ] = true,
    [ "l03_agroprom"   ] = true,
    [ "l04_darkvalley" ] = true,
    [ "l05_bar"        ] = true,
    [ "l06_rostok"     ] = true,
    [ "l07_military"   ] = true,
    [ "l08_yantar"     ] = true,
    [ "l10_radar"      ] = true,
    [ "l11_pripyat"    ] = true,
    [ "limansk"        ] = true,
    [ "lost_village"   ] = true,
    [ "marsh"          ] = true,
    [ "peshera"        ] = true,
    [ "red_forest"     ] = true,
    [ "warlab"         ] = true,
  }
  local sect = {
    [ "explosive_barrel"    ] = true,
    [ "explosive_fuelcan"   ] = true,
    [ "explosive_mobiltank" ] = true,
  }
  local t = {}
  for id, sobj in alife():objects() do
    if
      sect[ sobj:section_name() ]
      and loc[ object_level_name( sobj ) ]
    then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: found %s on %s, removing",
      script_name(), sobj:name(), object_level_name( sobj )
    )
    alife():release( sobj )
  end
end


function fix_tamaz_body2()
  local sobj = alife():object( "tamaz_body2" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_gar_dm_novice( ver )
  if ver == 0 then return end
  local names = {
    [ "gar_dm_novice"   ] = 3970,
    [ "gar_seryi_drug2" ] = 4032,
    [ "gar_seryi_drug3" ] = 4051,
  }
  for name, spawn_id in pairs( names ) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: found %s, recreating and teleporting...",
        script_name(), sobj:name()
      )
      local pos = sobj.position
      local lvid, gvid = sobj.m_level_vertex_id, sobj.m_game_vertex_id
      alife():release( sobj )
      sobj = alife():create( spawn_id )
      alife():teleport_object( sobj.id, pos, lvid, gvid )
    end
  end
end


function fix_rebind_keys( ver )
  if ver == 0 then return end
  local keys = {
    [ "night_vision" ] = "ogse_nv_bind",
    [ "scores"       ] = "ogse_antirad_bind",
    [ "cam_4"        ] = "ogse_energy_drink_bind",
    [ "cam_3"        ] = "ogse_yod_bind",
    [ "torch"        ] = "ogse_bipsizon_bind",
    [ "drop"         ] = "ogse_handradio_bind",
    [ "buy_menu"     ] = "ogse_quicksave_bind",
  }
  local data = dsh_cfg.get_data()
  for k, v in pairs( keys ) do
    local dik = get_console():get_integer( v )
    if v then
      local kn = dik_to_keyname( dik )
      if kn then
        log2( "[%s]: rebind %s to %s", script_name(), k, kn )
        data[ k ] = kn
        cmd2( "bind", k .. " " .. kn )
      end
    end
  end
  dsh_cfg.save()
end


function fix_podval_btr_nevid1( var )
  for _, name in ipairs({ "podval_btr_nevid1", "podval_btr_nevid2" }) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_spawn_bunker_sekret( ver )
  if ver == 0 then return end
end


function fix_bunker_art_v_spiral_restrictor( ver )
  local sobj = alife():object( "bunker_art_v_spiral_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_btr_nevid_krusha_kultorg( ver )
  local sobj = alife():object( "btr_nevid_krusha_kultorg" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_yantar_ecolog_general( ver )
  if level.name() == "l08_yantar" then
    local sobj = alife():object( "yantar_ecolog_general" )
    if sobj then
      local patrol = patrol( "yan_ucheniy_walk_talk" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_spawn_monstrov( ver )
  if ver == 0 then return end
  local t = {}
  for id, sobj in alife():objects() do
    if
      IsMonster( sobj ) and sobj:clsid() == clsid.zombie_s
      and sobj:smart_terrain_id() == 65535
      and object_level_name( sobj ) == "l01_escape"
      and not (
        se_respawn.get_respawner_by_npc_id( sobj.id )
        or dsh_respawn.get_respawner_by_npc_id( sobj.id )
      )
    then
      table.insert( t, sobj )
    end
  end
  local sm = ogse_signals.get_mgr()
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: found extra %s on %s",
      script_name(), sobj:name(), object_level_name( sobj )
    )
    alife():release( sobj )
    sm:call( "on_release_npc", sobj.id )
  end
end


function fix_marsh_m_car( ver )
  local cars = { "veh_car_baggi", "mar_zil130" }
  for _, name in ipairs( cars ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_gar_no_gravity_vorota( ver )
  local sobj = alife():object( "gar_no_gravity_vorota" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_marsh_havan_restr( ver )
  local sobj = alife():object( "marsh_havan_restr" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_explosive_barrel2( ver )
  if ver == 0 then return end
  fix_explosive_barrel( ver )
end


function fix_sysh_treasure_box()
  if
    not (
      db.actor:has_info( "treasure_sysh_start" )
      or db.actor:has_info( "treasure_sysh_have" )
    )
  then
    local sobj = alife():story_object( story_ids.sysh_treasure_box ) -- 9663
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_zone_ozero( ver )
  local sobj = amk_anoms.spawn_anomaly(
    "zone_ozero",
    vector():set( 58.848209381104, 1.0079244375229, 367.44982910156 ),
    276095, 3760,
    { shtype = 0, radius = 1, center = { 0, 0, 0 } }
  )
  log2( "[%s]: created %s", script_name(), sobj:name() )
end


function fix_zat_fireball( ver )
  if ver == 0 then return end
  local anoms = {
    [ "zat_fireball_1" ] = 15603,
    [ "zat_fireball_2" ] = 15604,
    [ "zat_psychic_1"  ] = 15606,
    [ "zat_psychic_2"  ] = 15607,
    [ "zat_psychic_3"  ] = 15608,
    [ "zat_psychic_4"  ] = 15609,
    [ "zat_psychic_5"  ] = 15610,
    [ "zat_psychic_6"  ] = 15611,
    [ "zat_psychic_7"  ] = 15612,
    [ "zat_psychic_8"  ] = 15613,
    [ "zat_psychic_9"  ] = 15614,
    [ "zat_psychic_10" ] = 15615,
    [ "zat_psychic_11" ] = 15616,
    [ "zat_psychic_12" ] = 15617,
    [ "zat_psychic_13" ] = 15618,
    [ "zat_fireball_3" ] = 15626,
    [ "zat_elecball_4" ] = 15627,
    [ "pri_acidball"   ] = 14293,
    [ "pri_fireball_1" ] = 14294,
    [ "pri_acidball_2" ] = 14295,
    [ "pri_elecball_3" ] = 14296,
    [ "jup_elecball"   ] = 2774,
  }
  for name, spawn_id in pairs( anoms ) do
    local sobj = alife():object( name )
    if not sobj then
      log2( "[%s]: %s not found, creating %s", script_name(), name, spawn_id )
      alife():create( spawn_id )
    end
  end
end


function fix_door_hospital_01_l_0003( ver )
  local names = {
    "door_hospital_01_r_0003",
    "door_hospital_01_l_0003",
  }
  for _, n in ipairs( names ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_mil_physic_object_0001( ver )
  local sobj = alife():object( "mil_physic_object_0001" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_dragunov_ohota( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "dragunov_ohota_start" )
    and not db.actor:has_info( "tm_find_info_done" )
  then
    log2( "[%s]: completing 'dragunov_ohota' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "dragunov_ohota", i )
    end
  end
  if
    db.actor:has_info( "koloda_kuznec_start" )
    and not db.actor:has_info( "koloda_kuznec_done" )
  then
    log2( "[%s]: completing 'koloda_kuznec' task", script_name() )
    for i = 0, 3 do
      level_tasks.set_task_state( task.completed, "koloda_kuznec", i )
    end
  end
  if
    db.actor:has_info( "hamster_kuznec8_start" )
    and not db.actor:has_info( "taynik10_kuznec" )
  then
    log2( "[%s]: completing 'hamster_kuznec8' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "hamster_kuznec8", i )
    end
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_l10u_bunker_codedoor_key_0000( ver ) end
function fix_l10u_bunker_codedoor_key_0000_2( ver )
  for id, sobj in alife():objects() do
    if
      sobj:name() == "codedoor_key_0000"
      and object_level_name( sobj ) == "l10u_bunker"
    then
      log2(
        "[%s]: found %s on %s, rewrite custom data",
        script_name(), sobj:name(), object_level_name( sobj )
      )
      alife():release( sobj )
      sobj = alife():create( 10000 )
      local pk = get_netpk( sobj, 1 )
      ASSERT(
        pk:isOk(), "[%s]: can't parse netpk: %s",
        script_name(), sobj:name()
      )
      local data = pk:get()
      data.custom_data:setString(
        "[collide]\nignore_static\n\n[logic]\ncfg = dsh\\logic\\l10u_bunker\\codedoor_key_0000.ltx\n"
      )
      pk:set( data )
      break
    end
  end
end


function fix_buusty_kvest_task( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "buusty_kvest_start" )
    and not db.actor:has_info( "buusty_kvest_done" )
  then
    log2( "[%s]: completing 'buusty_kvest_task' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "buusty_kvest_task", i )
    end
    db.actor:disable_info_portion( "buusty_kvest_have" )
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_strelok_taynik_pda0( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "strelok_taynik_pda0_start" )
    and not db.actor:has_info( "strelok_taynik_pda0_done" )
  then
    log2( "[%s]: completing 'strelok_taynik_pda0' task", script_name() )
    for i = 0, 1 do
      level_tasks.set_task_state( task.completed, "strelok_taynik_pda0", i )
    end
    db.actor:disable_info_portion( "strelok_taynik_pda0_start" )
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_esc_dinamit_panera( ver )
  local sobj = alife():story_object( story_ids.esc_dinamit_panera )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_hamster_kuznec6( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "hamster_kuznec6_start" )
    and not db.actor:has_info( "taynik6_kuznec" )
  then
    log2( "[%s]: completing 'hamster_kuznec6' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "hamster_kuznec6", i )
    end
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_handmade_arts_cnt( ver )
  if ver == 0 then return end
  local value = db.actor:has_info( "acv_art" )
    and 100 or amk.load_variable( "acv_art", 0 )
  log2( "[%s]: initializing dsh.handmade_arts_cnt = %s", script_name(), value )
  dsh.handmade_arts_cnt( value )
end


function make_free_prizrak( ver )
  if ver == 0 then return end
  if db.actor:has_info( "posulku_poluchil" ) then
    log2( "[%s]: call dsh.make_free_prizrak()", script_name() )
    dsh.make_free_prizrak()
  end
end


function fix_land_arhara_biliyrd( ver )
  for _, name in ipairs({
    "land_arhara_biliyrd", "land_arhara_zimov_pulemet"
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_se_respawn( ver )
  se_respawn.startup_respawners()
end


function fix_stalker_kisluy( ver )
  if ver == 0 then return end
  if db.actor:has_info( "spawn_strelochniki" ) then
    arhara_dialog.del_stalker_kisluy()
  end
end


function fix_trade_dialog_maks( ver )
  if ver == 0 then return end
  local tname1 = "dsh.has_trade_dialog.maks"
  local tname2 = "dsh.hasnt_trade_dialog.maks"
  for _, t in ipairs({ tname1, tname2 }) do
    if ogse_st_mgr.timer_exists( t ) then
      ogse_st_mgr.get_timer( t ):stop()
      log2( "[%s]: stop timer %s", script_name(), t )
    end
  end
  ogse.delete_var( tname1 .. ".cnt" )
  db.actor:disable_info_portion( "price_maks" )
end


function fix_esc_surprise_box_015( ver )
  dsh.del_2soldier_outfits()
end


function fix_dsh_rukzak_storage( ver )
  if ver == 0 then return end
  for k, _ in pairs( ogse_unist.get_all_vars() ) do
    local id = string.match( k, "^dsh_rukzak%.([^.]+)%.sections$" )
    if id then
      id = tonumber( id )
      local items = dsh_rukzak.load_rukzak( id )
      log2(
        "[%s]: change storage type of dsh_rukzak: %s",
        script_name(), id
      )
      dsh_rukzak.save_rukzak( id, items )
    end
  end
end


function fix_pseudodog_forest()
  local sobj = alife():object( "pseudodog_forest" )
  if sobj then
    log2( "[%s]: move %s", script_name(), sobj:name() )
    alife():teleport_object(
      sobj.id,
      vector():set( -3.7275488376617,-1.1764014959335,-303.84091186523 ),
      65240, 3274
    )
  end
end


function fix_dsh_ogse_relations( ver )
  if ver == 0 then return end
  log2( "[%s]: clear dsh_ogse_relations", script_name() )
  ogse.delete_var( "dsh_ogse_relations"         )
  ogse.delete_var( "dsh_ogse_relations.chunks"  )
  ogse.delete_var( "dsh_ogse_relations.records" )
end


function fix_dark_bland( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.dark_bland )
  if sobj then
    log2( "[%s]: respawn %s", script_name(), sobj:name() )
    alife():release( sobj )
    sobj = alife():create( alife():spawn_id( story_ids.dark_bland ) )
  end
end


function fix_netpacket_pda( ver )
  if ver == 0 then return end
  local t = {}
  amk_utils.inventory_iterate_section(
    "netpacket_pda",
    function( obj )
      table.insert( t, obj )
    end
  )
  if table.getn( t ) > 0 then
    log2(
      "[%s]: found %s netpacket_pda, deleting...",
      script_name(), table.getn( t )
    )
    for _, obj in ipairs( t ) do
      ogse.remove_item_from_inventory( obj )
    end
  end
  amk.del_variable( "have_netpacket_pda" )
end


function fix_amk_transmutator( ver )
  if ver == 0 then return end
  local obj = db.actor:object( "amk_transmutator" )
  if not obj then return end
  log2( "[%s]: found %s, deleting...", script_name(), obj:name() )
  ogse.remove_item_from_inventory( obj )
  sak.create_items_actor( "ammo_5.45x39_ap",  5 )
  sak.create_items_actor( "ammo_7.62x39_ap",  5 )
  sak.create_items_actor( "medkit_army",     10 )
end


function fix_anim_ph_zone_0004( ver )
  local sobj = alife():object( "anim_ph_zone_0004" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_sak_flash( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "sak_reward_outfit_have" )
    or db.actor:has_info( "sak_reward_outfit_done" )
  then
    return
  end
  if db.actor:has_info( "sak_reward_outfit_start" ) then
    local found = false
    for id, sobj in alife():objects() do
      if sobj:section_name() == "disk_flash" then
        found = true
        break
      end
    end
    if not found then
      log2( "[%s]: disk_flash not found, spawning...", script_name() )
      sak_dialog.take_sak_reward_outfit()
    end
  end
end


function fix_mozg( ver )
  if ver == 0 then return end
  if not db.actor:has_info( "svoboda_lukash_start" ) then return end
  local found = {}
  for id, sobj in alife():objects() do
    if sobj:section_name() == "mozg" then
      found[ object_level_name( sobj ) ] = true
    end
  end
  if
    not (
      db.actor:has_info( "svoboda_lukash_done" )
      or found.atp_for_test22
    )
  then
    log2(
      "[%s]: mozg on atp_for_test22 not found, spawning...", script_name()
    )
    arhara_dialog.mozg_atp_for_test22()
  end
  if not found.l12_stancia_2 then
    log2(
      "[%s]: mozg on l12_stancia_2 not found, spawning...", script_name()
    )
    arhara_dialog.mozg_l12_stancia_2()
  end
end


function fix_wpn_gungauss( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "wpn_gungauss" then
      log2(
        "[%s]: clearing UsefulForAI flag for %s...",
        script_name(), sobj:name()
      )
      dsh.clear_useful_for_ai( sobj )
    end
  end
end


function fix_info_restriction( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "arhara_shaxter_start" )
    and not db.actor:has_info( "info_restriction" )
  then
    log2( "[%s]: fixing info_restriction...", script_name() )
    spawn_teleport.spawn_teleport5()
    spawn_teleport.spawn_teleport7()
    spawn_teleport.spawn_teleport9()
    spawn_restrictor.create_sr1()
    -- spawn_restrictor.create_sr2()
    -- spawn_teleport.spawn_item1()
    db.actor:give_info_portion( "info_restriction" )
  end
end


function fix_vasily_chertez_reminder( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "vasily_chertez_start" )
    and not db.actor:has_info( "vasily_chertez_reminder" )
  then
    log2( "[%s]: fixing vasily_chertez_reminder...", script_name() )
    db.actor:give_info_portion( "vasily_chertez_reminder" )
  end
end


function fix_prizrak_treasure_box( ver )
  if db.actor:has_info( "treasure_ecolog_start" ) then return end
  local sobj = alife():story_object( story_ids.prizrak_treasure_box ) -- 9662
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_dcity_pyatietazhka_yzik1( ver )
  local sobj = alife():object( "dcity_pyatietazhka_yzik1" )
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_explosive_barrel_all( ver )
  if ver == 0 then return end
  fix_explosive_barrel( ver )
end


function fix_atp_presled_last( ver )
  -- типки в маскировочных экзоскелетах, каким-то чудом обогнавшие ГГ
  -- и прячущиеся за кустами впереди.
  for i  = 1, 3 do
    local n = "atp_presled_last" .. i
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_warlab_sekret_generator5( ver )
  for i = 5, 7 do
    local n = "warlab_sekret_generator" .. i
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_yakut_treasure_box( ver )
  if db.actor:has_info( "yakut_treasure_start" ) then return end
  local sobj = alife():story_object( story_ids.yakut_treasure_box ) -- 9661
  if sobj then
    log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_black_dok_gener_say_done( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "udav_vstrecha_start" )
    and not db.actor:has_info( "black_dok_gener_say_done" )
  then
    log2( "[%s]: found lost 'black_dok_gener_say_done' info", script_name() )
    db.actor:give_info_portion( "black_dok_gener_say_done" )
  end
end


function fix_dsh_rukzak_access_time( ver )
  if ver == 0 then return end
  for k, _ in pairs( ogse_unist.get_all_vars() ) do
    local id = string.match( k, "^dsh_rukzak%.([^.]+)%.sections$" )
    if id then
      id = tonumber( id )
      if id then
        local name = "dsh_rukzak." .. id .. ".access_time"
        ogse.save_var( name, { game.get_game_time():get() }, "time" )
        log2( "[%s]: fix %s", script_name(), name )
      end
    end
  end
end


function fix_add_lchanger_location( ver )
  if ver == 0 then return end
  log2( "[%s]: fix add_lchanger_location", script_name() )
  level_tasks.add_lchanger_location()
end


function fix_foto_ohota_have( ver )
  if ver == 0 then return end
  if db.actor:has_info( "foto_anomaly_done" ) then
    log2( "[%s]: fix foto_ohota_have", script_name() )
    news_manager.skip_send_task = true
    db.actor:give_info_portion( "foto_ohota_done" )
    db.actor:give_info_portion( "foto_ohota_have" )
    db.actor:give_info_portion( "foto_ohota_end"  )
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
  end
end


function fix_dcity_stalki_matras_1( ver )
  local names = {
    [ "dcity_stalki_matras_1" ] = 1137,
    [ "dcity_stalki_matras_2" ] = 1138,
    [ "dcity_stalki_matras_3" ] = 1139,
  }
  for k, v in pairs( names ) do
    local sobj = alife():object( k )
    if sobj then
      log2( "[%s]: found %s, recreate", script_name(), sobj:name() )
      alife():release( sobj )
      sobj = alife():create( v )
      local pk = get_netpk( sobj, 1 )
      ASSERT(
        ( pk and pk:isOk() ), "[%s]: can't parse netpk: %s",
        script_name(), sobj:name()
      )
      local data = pk:get()
      data.custom_data:setString(
        "[collide]\nignore_static\n\n[logic]\ncfg = scripts\\esc_sleep.ltx\n"
      )
      pk:set( data )
    end
  end
end


function fix_aver_muha_bazar_sms_restrictor( ver )
  local sobj = alife():object( "aver_muha_bazar_sms_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_val_bandit_krisyk( ver )
  local sobj = alife():object( "val_bandit_krisyk" )
  if sobj then
    log2(
      "[%s]: teleport %s to bandit_krisyk_walk",
      script_name(), sobj:name()
    )
    local patrol = patrol( "bandit_krisyk_walk" )
    alife():teleport_object(
      sobj.id, patrol:point( 0 ),
      patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
    )
  end
end


function fix_dragunof_npc()
  if level.name() == "l11_pripyat" then
    local sobj = alife():story_object( story_ids.dragunof_npc ) -- 21003
    if sobj then
      alife():teleport_object(
        sobj.id,
        vector():set( 191.67535400391, 2.8055994510651, 212.01971435547 ),
        260495, 2219
      )
    end
  end
end


function fix_dsity_rasstrel_end( ver )
  if ver == 0 then return end
  if db.actor:has_info( "uhod_iz_mg_done" ) then
    log2( "[%s]: fix dsity_rasstrel_end", script_name() )
    db.actor:give_info_portion( "dsity_rasstrel_end"  )
  end
end


function fix_dcity_gg_neytral_restrictor( ver )
  local sobj = alife():object( "dcity_gg_neytral_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_dokplen_spawn_one_restrictor( ver )
  local their_names = {
    "dokplen_spawn_one_restrictor",
      "last1_dokplen_spawn_one1",
      "last2_dokplen_spawn_one2",
    "dokplen_spawn_two_restrictor",
      "last1_dokplen_spawn_two1",
      "last2_dokplen_spawn_two2",
      "last3_dokplen_spawn_two3",
    "actor_chely_shtab_restrictor",
      "dcity_sniper1_shtab",
      "dcity_sniper2_shtab",
    "chely1_shtab1_lestnisa_restrictor",
      "dcity_sniper3_shtab",
      "dcity_sniper4_shtab",
    "sniper1_spawn_krusha1_restrictor",
      "sniper1_krusha1",
    "sniper2_spawn_krusha2_restrictor",
      "sniper2_1_krusha1",
      "sniper2_2_krusha1",
    "kanaliy_dinamit1_vzryv_restrictor",
    "kanaliy_dinamit2_vzryv_restrictor",
    "kanaliy_dinamit_nevid_vzryv_restrictor",
    "kanaliy_imitator_hit_restrictor",
  }
  for _, n in ipairs( their_names ) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_dcity_lastday( ver )
  local dcity_lastday_mems = {
    "shtab_chasovoy_pered1",
    "shtab_chasovoy_pered2",
    "shtab_chasovoy_zad1",
    "shtab_chasovoy_zad2",
    "chasovoy_kultorg_pered",
    "kultorg_kemper1",
    "kultorg_vxod_bok",
    "kultorg_2etazh",
    "stab_1etazh2",
    "stab_vnutr_ohrana1",
    "stab_vnutr_ohrana2",
    "kultorg_kemper2",
    "shtab_fontan1",
    "patrul_kultorg_pered",
    "patrul_lenin",
    "vxod_kultorg_zad",
    "kultorg_1etazh",
    "stab_1etazh1",
    "stab_vnutr_ohrana3",
  }
  dsh.shuffle( dcity_lastday_mems )
  local sm = ogse_signals.get_mgr()
  for i = 1, math.floor( table.getn( dcity_lastday_mems ) / 2 ) do
    local sobj = alife():object( dcity_lastday_mems[ i ] )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      smart_terrain.unregister_npc( sobj )
      alife():release( sobj )
      sm:call( "on_release_npc", sobj.id )
    end
  end
end


function fix_marsh_udav( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "spawn_marsh_udav" )
    and not db.actor:has_info( "udav_vstrecha_start" )
  then
    local sobj = alife():story_object( story_ids.marsh_udav )
    if sobj then
      log2( "[%s]: found %s, respawn", script_name(), sobj:name() )
      alife():release( sobj )
      alife():create( alife():spawn_id( story_ids.marsh_udav ) )
    end
  end
end


function fix_val_borov_dead( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "val_borov_dead" ) then return end
  local sobj = alife():story_object( story_ids.val_borov )
  if sobj and sobj:alive() then
    log2(
      "[%s]: found %s alive, disable val_borov_dead info",
      script_name(), sobj:name()
    )
    db.actor:disable_info_portion( "val_borov_dead" )
  end
end


function fix_av_peshera_mono2_bunker_niz( ver )
  local names = {
    "av_bunker_lestn_mina",
    "av_peshera_bunker_zharka_lestn",
    "av_peshera_bunker_zharka_sklad",
    "av_peshera_bunker_zharka_vuxod",
    "av_peshera_mono2_bunker_niz",
    "av_peshera_mono7_bunker_presklad1",
    "av_peshera_mono9_bunker_sklad1",
  }
  local sm = ogse_signals.get_mgr()
  for _, name in ipairs( names ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      local is_npc = IsStalker( sobj )
      if is_npc then smart_terrain.unregister_npc( sobj ) end
      alife():release( sobj )
      if is_npc then sm:call( "on_release_npc", sobj.id ) end
    end
  end
end


function fix_av_peshera_zone_emi1( ver )
  local names = {
    "av_peshera_zone_emi1",
    "av_peshera_zone_emi2",
    "av_peshera_zone_emi3",
    "av_peshera_zone_emi4",
    "av_peshera_zone_emi5",
  }
  local sm = ogse_signals.get_mgr()
  for _, name in ipairs( names ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


-- пересоздать физические объекты
function fix_physic_objects()
  if
    not (
      dsh_lc_fixes.has_level_changed()
      and fix_ph_position[ level.name() ]
    )
  then
    return
  end
  for name, spawn_id in pairs( fix_ph_position[ level.name() ] ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: release %s", script_name(), name )
      dsh_alife.release( sobj )
    end
    on_create = false
    if type( spawn_id ) ~= "number" then
      if type( spawn_id ) == "function" then
        on_create = spawn_id
      end
      spawn_id = alife():spawn_id( name )
    end
    log2( "[%s]: create %s, spawn_id = %s", script_name(), name, spawn_id )
    sobj = alife():create( spawn_id )
    if on_create then on_create( sobj ) end
  end
end


function fix_yan_st_stalker3_kamp_1( ver )
  local p = patrol( "yan_st_stalker3_kamp_1" )
  dsh.create_campfire(
    p:point( 0 ), p:level_vertex_id( 0 ), p:game_vertex_id( 0 ),
    "objects\\koster_negorit", 0.7
  )
end


function fix_pri_dimak( ver )
  dsh.create_campfire(
    vector():set( 135.7427520752,4.9046115875244,-200.63697814941 ),
    363725, 3765,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.spawn_physic_sleep_bag(
    vector():set( 136.0898, 4.9049, -204.6948 ), 363716, 3765,
    "objects\\matras", 10, "bone01"
  )
end


function fix_pripyat_campfires( ver )
  -- в книгах, в зале за неактивными дверями
  dsh.create_campfire(
    vector():set( -181.8752746582, 0.64074690341949, -348.90435791016 ),
    33816, 3753,
    nil, 0.7
  )
  -- светлячок
  dsh.create_campfire(
    vector():set( -49.654216766357,-0.30959591269493,-354.38177490234 ),
    139219, 3753,
    "objects\\koster_palki_nastil", 0.7
  )
  -- универсам
  dsh.create_campfire(
    vector():set( -102.80925750732,0.49736765027046,-253.93940734863 ),
    89097, 3751,
    "objects\\koster_palki_nastil", 0.7
  )
  -- в госпитале, на втором этаже
  dsh.create_campfire(
    vector():set( 232.21240234375,4.4478893280029,26.575832366943 ),
    451530, 3768,
    "objects\\koster_palki_nastil", 0.7
  )
  -- речвокзал
  dsh.create_campfire(
    vector():set( 296.4831237793,0.68390381336212,237.0193939209 ),
    476945, 3769,
    nil, 0.7
  )
end


function fix_x18_campfires( ver )
  dsh.create_campfire(
    vector():set( -13.629398345947,4.1883325576782,8.7058591842651 ),
    1347, 1126,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( 14.393134117126,4.1887907981873,-13.240303993225 ),
    4991, 1117,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( 40.255779266357,-10.815406799316,4.6903095245361 ),
    7489, 1136,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( -5.8372869491577,-11.854700088501,-14.30740070343 ),
    2009, 1133,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -40.928089141846,-10.815729141235,6.7639007568359 ),
    218, 1148,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_pripyat_campfires2( ver )
  dsh.create_campfire(
    vector():set( -104.06401824951,4.2089171409607,-101.97599029541 ),
    88109, 3759,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( 59.20983505249,0.48721626400948,177.9935760498 ),
    276725, 3761,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( 15.989818572998,4.4941573143005,288.72909545898 ),
    218595, 3760,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( 65.979499816895,0.32861027121544,370.88909912109 ),
    286400, 3760,
    nil, 0.7
  )
end


function fix_pri_dimak_pos()
  if level.name() == "pripyat" then
    local sobj = alife():story_object( story_ids.pri_dimak )
    if sobj then
      alife():teleport_object(
        sobj.id,
        vector():set(135.55590820313,4.9057364463806,-202.5612487793),
        363721, 3765
      )
    end
  end
end


function fix_akill_npc()
  if level.name() == "pripyat" then
    local sobj = alife():story_object( story_ids.akill_npc )
    if sobj then
      alife():teleport_object(
        sobj.id,
        vector():set( 133.15174865723,4.904456615448,-196.60328674316 ),
        360302, 3765
      )
    end
  end
end


function fix_lab_pri1( ver )
  if ver == 0 then return end
  if db.actor:has_info( "pri1_lab_info" ) then
    db.actor:give_info_portion( "lab_pri1_info" )
  end
end


function fix_jupiter_underground( ver )
  dsh.create_campfire(
    vector():set( 5.0671792030334,8.0631856918335,436.82061767578 ),
    16640, 3791,
    "objects\\koster_palki_nastil", 0.7
  )

  -- дверь во вторую секцию Путепровода
  local sobj = alife():object( "jund_pas_b400_physic_door" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2875 )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  local cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_physic_door.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  dsh.create_campfire(
    vector():set( 32.446899414063,8.0051937103271,258.47036743164 ),
    30336, 3799,
    "objects\\koster_palki_nastil", 0.7
  )

  -- дверь в третью секцию Путепровода
  sobj = alife():object( "jund_pas_b400_door_track" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2876 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_track.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  -- дверь после лестницы
  sobj = alife():object( "jund_pas_b400_door_downstairs" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2878 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_downstairs.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  dsh.create_campfire(
    vector():set( 51.964504241943,-0.00018477439880371,183.92384338379 ),
    36201, 3818,
    "objects\\koster_palki_nastil", 0.7
  )

  -- дверь в круглой комнате
  sobj = alife():object( "jund_pas_b400_door_control_down" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2884 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_control_down.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  -- дверь в круглой комнате наверху
  sobj = alife():object( "jund_pas_b400_door_control_up" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2885 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_control_up.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  -- выход из круглого зала
  sobj = alife():object( "jund_pas_b400_door_hall" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2883 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_hall.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  -- выход в тоннель
  sobj = alife():object( "jund_pas_b400_door_way" )
  if sobj then
    alife():release( sobj )
  end
  sobj = alife():create( 2886 )
  pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  cd   = data.custom_data:getTable()
  cd.logic = {
    [ "cfg" ] = "dsh\\logic\\jupiter_underground\\jund_pas_b400_door_way.ltx"
  }
  data.custom_data:setTable( cd )
  pk:set( data )

  dsh.create_campfire(
    vector():set( 68.955108642578,4.3204076194763,-198.29489135742 ),
    39728, 3823,
    nil, 0.7
  )

  dsh.create_campfire(
    vector():set( -15.413643836975,0.0026839673519135,-74.39421081543 ),
    6469, 3778,
    "objects\\koster_palki", 0.8
  )

  if ver == 0 then return end
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "under_tele_1"
      or sobj:section_name() == "under_tele_2"
      or sobj:section_name() == "under_tele_3"
    then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    alife():release( sobj )
  end
end


function fix_lab_under( ver )
  if ver == 0 then return end
  if db.actor:has_info( "info_lab_under" ) then
    db.actor:disable_info_portion( "info_lab_under" )
    local sobj = alife():story_object( 130022 )
    if sobj then
      alife():release( sobj )
    end
    braad_test.lab_under()
  end
end


function fix_labx8( ver )
  dsh.create_campfire(
    vector():set( -71.871772766113,-20.165414810181,60.047252655029 ),
    4814, 3847,
    "objects\\koster_palki", 0.8
  )

  dsh.create_campfire(
    vector():set( -74.475860595703,-15.93800163269,109.57129669189 ),
    4541, 3846,
    "objects\\koster_negorit", 0.7
  )

  dsh.create_campfire(
    vector():set( -98.806762695313,-28.484575271606,95.178497314453 ),
    860, 3832,
    "objects\\koster_negorit", 0.7
  )
end


function fix_esc2_smart_stalker_exit_kamp_1( ver )
  local p = patrol( "esc2_smart_stalker_exit_kamp_1" )
  dsh.create_campfire(
    p:point( 0 ), p:level_vertex_id( 0 ), p:game_vertex_id( 0 ),
    "objects\\koster_palki", 0.8
  )
end


function fix_agr2_st_factory_kamp_1( ver )
  local p = patrol( "agr2_st_factory_kamp_1" )
  dsh.create_campfire(
    p:point( 0 ), p:level_vertex_id( 0 ), p:game_vertex_id( 0 ),
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_l03_agroprom_candles( ver )
  dsh.create_candle(
    vector():set( 24.21443939209,-0.65411001443863,-224.57250976563 ),
    263673, 436, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -134.34451293945,1.0590002536774,-203.86309814453 ),
    106220, 649, "physics\\decor\\gas_burner"
  )
end


function fix_l03u_agr_underground_candles( ver )
  dsh.create_candle(
    vector():set( -72.679161071777,-5.5085163116455,-75.402770996094 ),
    172, 703, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -113.21365356445,-14.993812561035,-22.003011703491 ),
    373, 759, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -40.954113006592,-3.9868292808533,0.92165052890778 ),
    4623, 730, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -104.44459533691,-15.592901229858,-101.30113220215 ),
    1214, 707, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -86.779090881348,-2.4215745925903,-145.2272644043 ),
    2361, 806, "physics\\decor\\gas_burner"
  )
end


function fix_jupiter( ver )
  dsh.create_candle(
    vector():set( -456.72171020508,1.2916003465652,-379.55160522461 ),
    13, 3702, "physics\\decor\\gas_burner"
  )
  dsh.create_campfire(
    vector():set( -415.30389404297,0.28906974196434,-374.18865966797 ),
    23677, 3702,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -388.431640625,0.26377919316292,-368.14733886719 ),
    59256, 3702,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -349.82049560547,3.7115612030029,407.80383300781 ),
    125006, 3703,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -364.34149169922,-2.0552632808685,-221.31158447266 ),
    100054, 3700,
    "objects\\koster_negorit", 0.7
  )
  dsh.create_candle(
    vector():set( -184.28823852539,1.534478187561,-280.98773193359 ),
    404370, 3710, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 50.910606384277,28.873067855835,-177.61737060547 ),
    802934, 3727, "physics\\decor\\gas_burner"
  )
  local sobj = alife():object( "jup_b207_ph_depot_cover" )
  if sobj then
    alife():release( sobj )
  end
  dsh.create_candle(
    vector():set( 171.15382385254,-7.3061528205872,209.61605834961 ),
    806559, 3727, "physics\\decor\\gas_burner"
  )
  dsh.create_campfire(
    vector():set( 139.52857971191,1.3363538980484,213.60955810547 ),
    954311, 3732,
    "objects\\koster_palki", 0.8
  )
  dsh.create_candle(
    vector():set( -394.66690063477,12.327070236206,9.9700231552124 ),
    52657, 3708, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 75.020805358887,-0.073683269321918,330.75927734375 ),
    841970, 3725, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 419.34759521484,5.3461313247681,-69.73876953125 ),
    1379516, 3744, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 264.33728027344,28.613309860229,-220.83633422852 ),
    1156923, 3739, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 387.98413085938,28.888719558716,-240.80683898926 ),
    1327755, 3743, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 314.18075561523,35.632732391357,-232.91732788086 ),
    1222905, 3743, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 356.04510498047,35.87947845459,-274.70642089844 ),
    1280754, 3743, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 399.4762878418,40.958679199219,-223.52084350586 ),
    1345451, 3743, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 431.31747436523,27.63756942749,-280.28659057617 ),
    1397841, 3747, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 449.58462524414,28.219541549683,-459.07278442383 ),
    1432577, 3745, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 387.58331298828,32.704139709473,-387.31915283203 ),
    1327691, 3745, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 418.05975341797,32.373275756836,-359.85699462891 ),
    1378098, 3745, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 340.3821105957,28.581056594849,-361.26431274414 ),
    1375989, 3745, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 322.42385864258,28.581056594849,-303.2526550293 ),
    1233545, 3745, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 223.59820556641,-9.1206064224243,167.29113769531 ),
    1098712, 3732, "physics\\decor\\gas_burner"
  )
  sobj = dsh.spawn_physic_sleep_bag(
    vector():set( -7.0397539138794,23.981300354004,243.9365234375 ),
    702881, 3725
  )
  sobj.angle = vector():set( 0, 1.5, 0 )
  dsh.create_candle(
    vector():set( -7.6468667984009,24.057189941406,248.24877929688 ),
    702885, 3725, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -44.494304656982,4.707426071167,193.2515411377 ),
    643161, 3717, "physics\\decor\\gas_burner"
  )
end


function fix_jupiter_campfires( ver )
  dsh.create_campfire(
    vector():set( 391.43432617188,3.6243424415588,359.54635620117 ),
    1333722, 3746,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -194.5772857666,-13.736262321472,348.19024658203 ),
    387604, 3711,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -199.89437866211,3.4886932373047,-440.23831176758 ),
    377348, 3710,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( -96.119010925293,26.827522277832,-491.59298706055 ),
    560416, 3714,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -78.920791625977,23.890998840332,-317.45986938477 ),
    588425, 3720,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 226.54385375977,28.131425857544,-456.9111328125 ),
    1103798, 3734,
    "objects\\koster_negorit", 0.7
  )
  dsh.create_campfire(
    vector():set( -29.801790237427,3.1251952648163,-27.338813781738 ),
    667549, 3722,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -63.728164672852,-0.38933688402176,-147.5732421875 ),
    613464, 3722,
    "objects\\koster_negorit", 0.7
  )
  dsh.create_candle(
    vector():set( -338.67367553711,2.0852909088135,262.83532714844 ),
    664105, 3722, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -396.39767456055,14.629031181335,353.58963012695 ),
    52090, 3701, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 197.33331298828,36.721054077148,-442.89245605469 ),
    1054046, 3734, "physics\\decor\\gas_burner"
  )
end


function fix_warlab_fountain_average1_niz( ver )
  local sobj = alife():object( "warlab_fountain_average1_niz" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_aver_zone_emi1( ver )
  local sobj = alife():object( "aver_zone_emi1" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_arm_sklady_rg_box_0033( ver )
  if db.actor:has_info( "mil_freedom_cook_rg6_ask" ) then return end
  local sobj = alife():object( "arm_sklady_rg_box_0033" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_marsh_campfires( ver )
  dsh.create_campfire(
    vector():set( 458.09130859375,1.6140428781509,364.29473876953 ),
    445396, 3556,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 252.95385742188,1.3613117933273,307.6279296875 ),
    296617, 3509,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -57.793064117432,1.2502099275589,283.86331176758 ),
    109085, 3402,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -38.188804626465,0.73232710361481,137.62239074707 ),
    121273, 3404,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -276.74185180664,1.0221917629242,29.46337890625 ),
    7984, 3351,
    "objects\\koster_negorit", 0.7
  )
  dsh.create_campfire(
    vector():set( -158.93927001953,0.74808788299561,-138.91970825195 ),
    65649, 3373,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -22.687511444092,0.69377851486206,-138.26379394531 ),
    129606, 3398,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -67.653182983398,0.7159229516983,-82.172805786133 ),
    103473, 3394,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -61.387626647949,0.65357208251953,-85.00154876709 ),
    106367, 3395,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -26.17787361145,0.92761254310608,-68.31128692627 ),
    127258, 3405,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 36.142570495605,1.467332482338,-114.54546356201 ),
    157407, 3438,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 230.60270690918,0.72740268707275,-169.86502075195 ),
    280238, 3502,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 134.5712890625,0.77103698253632,39.570140838623 ),
    216669, 3471,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -98.953170776367,0.69491696357727,-9.0444831848145 ),
    92746, 3394,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 88.085998535156,0.76024651527405,179.85174560547 ),
    187634, 3455,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 196.25061035156,1.249173283577,171.82080078125 ),
    255480, 3489,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 278.9377746582,3.9308686256409,66.913078308105 ),
    316751, 3527,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 291.505859375,0.30063316226006,-43.003772735596 ),
    324986, 3526,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 372.67031860352,1.2184270620346,-126.99787139893 ),
    382011, 3541,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 507.08331298828,2.5428190231323,-187.2353515625 ),
    484171, 3563,
    nil, 0.7
  )
end


function fix_zaton( ver )
  dsh.create_campfire(
    vector():set( 136.311447143555, -2.17291688919067, 184.950607299805 ),
    1201550, 3686,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -360.17041015625,40.009124755859,-330.41522216797 ),
    1198116, 3686,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -127.9182434082,24.12681388855,-399.7236328125 ),
    256210, 3667,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -349.04962158203,18.124147415161,345.01776123047 ),
    682138, 3678,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 229.8557434082,6.7983055114746,-26.677629470825 ),
    265925, 3667,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 329.4140625,-5.9950556755066,-215.42510986328 ),
    1364144, 3688,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -20.664440155029,18.170932769775,-345.89096069336 ),
    1508711, 3688,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -2.5512528419495,-0.50655382871628,37.053302764893 ),
    938434, 3677,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 169.45251464844,10.545687675476,-259.51513671875 ),
    1012149, 3679,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( 287.17340087891,18.270143508911,146.01721191406 ),
    1258154, 3683,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -360.23968505859,23.215049743652,-184.85073852539 ),
    1453888, 3692,
    nil, 0.7
  )
  dsh.create_campfire(
    vector():set( -199.84281921387,-1.9452344179153,27.235654830933 ),
    543658, 3668,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -183.22811889648,6.9624252319336,124.56703948975 ),
    574980, 3670,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -0.33878067135811,25.331405639648,382.45880126953 ),
    944343, 3682,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 291.97778320313,18.554203033447,529.12426757813 ),
    1464332, 3687,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -172.55172729492,-2.9075605869293,352.66174316406 ),
    595408, 3675,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( -315.75332641602,-7.271092414856,138.46153259277 ),
    317483, 3666,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 145.94494628906,27.700189590454,-378.53717041016 ),
    1214632, 3683,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 430.32049560547,11.916608810425,-166.33573913574 ),
    1672066, 3693,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 419.83862304688,36.263305664063,-5.0698523521423 ),
    1654367, 3691,
    "objects\\koster_palki", 0.8
  )
  dsh.create_candle(
    vector():set( -395.98434448242,12.49892616272,-1.715663433075 ),
    186036, 3663, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -446.34466552734,6.1867060661316,47.369243621826 ),
    186037, 3663, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -312.98968505859,14.282513618469,428.57781982422 ),
    188164, 3663, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -165.07073974609,20.933296203613,-162.63577270508 ),
    612214, 3672, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 236.97570800781,34.614776611328,-331.14566040039 ),
    1464417, 3690, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 322.71325683594,42.837917327881,-405.13616943359 ),
    1507603, 3690, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 413.63241577148,40.346862792969,-4.6024670600891 ),
    1643588, 3693, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 149.77096557617,-5.8977656364441,-139.7918548584 ),
    1631369, 3693, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 125.15361785889,-6.120653629303,176.60772705078 ),
    1182876, 3686, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 411.03454589844,-2.5122284889221,232.81530761719 ),
    1204864, 3686, "physics\\decor\\gas_burner"
  )
  local sobj = alife():object( "station_priemnik_gorizont_01" )
  if sobj then
    alife():release( sobj )
  end
  sobj = dsh.spawn_physic_sleep_bag(
    vector():set( -4.8281245231628,-0.25045183300972,31.31383895874 ),
    934235, 3677
  )
  sobj = dsh.spawn_physic_sleep_bag(
    vector():set( 0.71345752477646,-0.44785210490227,42.127014160156 ),
    944008, 3677
  )
  sobj.angle = vector():set( 0, 1.5, 0 )
  sobj = dsh.spawn_physic_sleep_bag(
    vector():set( 110.6895904541,-2.3550486564636,181.17868041992 ),
    1157643, 3686
  )
  sobj.angle = vector():set( 0, 1.5, 0 )
end


function fix_zaton_campfires( ver )
  dsh.create_campfire(
    vector():set( -342.17193603516,39.530136108398,-284.18402099609 ),
    268853, 3664,
    nil, 0.7
  )
  dsh.create_candle(
    vector():set( -427.03213500977,40.903762817383,-390.75357055664 ),
    138100, 3664, "physics\\decor\\gas_burner"
  )
end


function fix_sherstuk_enemy( ver )
  db.actor:disable_info_portion( "sherstuk_enemy" )
end


function fix_zaton_campfires2( ver )
  -- костер в пещере с Барретом, где в ЗП контроллер говорит "уходи отсюда"
  dsh.create_campfire(
    vector():set( 21.981126785278,3.9355320930481,368.60858154297 ),
    988517, 3682,
    nil, 0.7
  )
end


function fix_karta_peschera( ver )
  if ver == 0 then return end
  local obj = db.actor:object( "karta_peschera" )
  if not obj then return end
  log2( "[%s]: found %s, deleting...", script_name(), obj:name() )
  dsh.karta_peschera( obj )
end


function fix_pri1_zaton( ver )
  if ver == 0 then return end
  if db.actor:has_info( "info_pri1_zaton" ) then
    db.actor:disable_info_portion( "info_pri1_zaton" )
    local sobj = alife():story_object( 130026 )
    if sobj then
      alife():release( sobj )
    end
    braad_test.pri1_zaton()
  end
end


function fix_spawn_babki_dcity_restrictor( ver )
  local sobj = alife():object( "spawn_babki_dcity_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_esc_akim_lager( ver )
  for _, n in ipairs({ "esc_akim_lager", "escape_buusty_team" }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_arny_kogot( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "arny_kogot_start" )
    and not db.actor:has_info( "arny_kogot_have" )
  then
    log2( "[%s]: completing 'arny_kogot' task", script_name() )
    for i = 0, 1 do
      level_tasks.set_task_state( task.completed, "arny_kogot", i )
    end
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_haker_soft( ver )
  if ver == 0 then return end
  news_manager.skip_send_task = true
  if
    db.actor:has_info( "haker_soft_start" )
    and not db.actor:has_info( "haker_soft_done" )
  then
    log2( "[%s]: completing 'haker_soft' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "haker_soft", i )
    end
  end
  dsh.exec_on_update( function()
    news_manager.skip_send_task = false
  end )
end


function fix_poisk_partizan_spawn( ver )
  -- см. fix_poisk_partizan_spawn_2()
end


function fix_val_zone_radioactive_average( ver )
  local sobj = alife():object( "val_zone_radioactive_average" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_esc_dogs_swarm( ver )
  if ver > 0 then return end
  local badnames = {
    "esc_dog_swarm_0001",
    "esc_dog_swarm_0002",
    "esc_dog_swarm_0004",
    "esc_dog_swarm_0007",
    -- esc2_dogs_exit
    "esc_dog_weak_0017",
    "esc_dog_weak_0018",
    "esc_dog_weak_0019",
    "esc_dog_weak_0020",
    "esc_dog_weak_0021",
    "esc_dog_weak_0022",
    "esc_dog_weak_0023",
    "esc_dog_weak_0024",
  }
  for _, name in ipairs( badnames ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      dsh.release_mob( sobj )
    end
  end
end


function fix_add_new_mil_110( ver )
  if ver == 0 then return end
  if not db.actor:has_info( "info_way110a" ) then return end
  local sobj = alife():story_object( story_ids.exit_to_mil_110 )
  if sobj then
    log2( "[%s]: found %s, moving", script_name(), sobj:name() )
    alife():teleport_object(
      sobj.id, vector():set( -66.320304870605, 1.0114997625351, 80.36954498291 ),
      96736, 899
    )
  end
end


function fix_add_new_darkvalley_111( ver )
  if ver == 0 then return end
  if not db.actor:has_info( "info_way111a" ) then return end
  local sobj = alife():story_object( story_ids.exit_to_darkvalley_111 )
  if sobj then
    log2( "[%s]: found %s, fixing", script_name(), sobj:name() )
    local pk = get_netpk( sobj, 1 )
    ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
    local data = pk:get()
    data.dest_game_vertex_id  = 899
    data.dest_level_vertex_id = 97547
    data.dest_position        = vector():set( -65.978820800781, 0.65926766395569, 76.747947692871 )
    pk:set( data )
  end
end


function fix_radar_campfires( ver )
  dsh.create_candle(
    vector():set( 306.26342773438,-38.353088378906,-22.537864685059 ),
    69058, 1930, "physics\\decor\\gas_burner"
  )
  dsh.create_campfire(
    vector():set( 276.66918945313,-50.808666229248,-137.66340637207 ),
    56916, 2088,
    "objects\\koster_palki", 0.8
  )
  dsh.create_campfire(
    vector():set( 288.43316650391,-49.388702392578,-297.61456298828 ),
    60449, 2075,
    "objects\\koster_palki", 0.8
  )
  dsh.create_candle(
    vector():set( 136.52418518066,-8.0612897872925,-25.320762634277 ),
    51915, 1975, "physics\\decor\\gas_burner"
  )
end


function fix_x10_campfires( ver )
  dsh.create_candle(
    vector():set( -5.8233556747437,-6.7167258262634,-64.019966125488 ),
    4764, 2662, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -28.574440002441,-8.9861993789673,4.1149482727051 ),
    2408, 2778, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -11.185073852539,-8.1736927032471,38.302978515625 ),
    2663, 2778, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 14.992925643921,-7.6343841552734,24.79235458374 ),
    8377, 2687, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 6.132426738739,-7.7942810058594,-12.193786621094 ),
    7643, 2693, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -29.416610717773,-22.121513366699,-17.641241073608 ),
    2313, 2707, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -54.639232635498,-21.890470504761,12.031219482422 ),
    664, 2719, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -67.023880004883,-20.682132720947,34.055320739746 ),
    26, 2726, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -1.3078932762146,-18.04984664917,24.910585403442 ),
    5987, 2768, "physics\\decor\\gas_burner"
  )
end


function fix_poisk_partizan_spawn_2( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "poisk_partizan_start" )
    and not db.actor:has_info( "poisk_partizan_have" )
  then
    local found = false
    for id, sobj in alife():objects() do
      if sobj:section_name() == "partizan_npc" then
        found = true
        break
      end
    end
    if not found then
      log2( "[%s]: respawn partizan_npc", script_name() )
      akill.poisk_partizan_spawn()
    end
  end
end


function fix_grom_npc( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.grom_npc )
  if sobj then
    log2( "[%s]: found %s, respawn", script_name(), sobj:name() )
    alife():release( sobj )
    akill.grom_npc_spawn()
  end
end


function fix_red_forest_candles( ver )
  dsh.create_candle(
    vector():set( 26.942028045654,5.219012260437,23.353260040283 ),
    82160, 3263, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -120.14569091797,1.3644961118698,-256.76080322266 ),
    80548, 3263, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 178.89344787598,1.3003035783768,-207.21725463867 ),
    119157, 3309, "physics\\decor\\gas_burner"
  )
end


function fix_limansk_campfires( ver )
  dsh.create_campfire(
    vector():set( -36.813842773438,-4.711784362793,-151.49208068848 ),
    7178, 2993
  )
  dsh.create_campfire(
    vector():set( 34.613452911377,14.0,190.72259521484 ),
    44841, 3010
  )
  dsh.create_campfire(
    vector():set( 27.007537841797,20.887487411499,195.97515869141 ),
    40250, 3003
  )
  dsh.create_candle(
    vector():set( -32.880226135254,-3.0803685188293,-257.22930908203 ),
    9308, 3001, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -53.555999755859,-0.34261658787727,-182.75198364258 ),
    2492, 2991, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( -58.217575073242,-11.197783470154,-173.62608337402 ),
    2492, 2991, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 32.140037536621,3.6697955131531,-61.358688354492 ),
    43375, 3014, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 27.539840698242,-1.5200437307358,45.100280761719 ),
    40855, 3015, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 79.950454711914,8.2537813186646,250.22091674805 ),
    40855, 3015, "physics\\decor\\gas_burner"
  )
end


function fix_volazar( ver )
  local bad_objects = {
    "restr_tel_mg_1",
    "restr_ozersky_check_1",
    "restr_ozersky_check_2",
    "restr_ozersky_check_3",
    "restr_ozersky_check_4",
    "restr_ozersky_check_6",
    "restr_fly_jup_1",
    "ozersky",
    "restr_tel_put_1",
    "restr_sidor_delo",
    "restr_sidor_delo_2",
    "restr_tel_x16_1",
    "restr_tel_chs1_1",
    "restr_tel_chs_1",
    "restr_tel_x8_1",
    "restr_tel_lim_1",
    "restr_tel_pri_1",
    "restr_tel_war_1",
    "restr_tel_zat_1",
  }
  for _, name in ipairs( bad_objects ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_living_dead_code( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "living_dead_done" )
    and db.actor:dont_has_info( "living_dead_code" )
  then
    log2(
      "[%s]: found living_dead_done, giving living_dead_code", script_name()
    )
    db.actor:give_info_portion( "living_dead_code" )
  end
end


function fix_fotograf_about( ver )
  if ver == 0 then return end
  if db.actor:has_info( "fotograf_pobeg_start" ) then
    log2(
      "[%s]: found fotograf_pobeg_start, giving fotograf_about", script_name()
    )
    db.actor:give_info_portion( "fotograf_about" )
  end
end


function fix_volna_sak_have( ver )
  if ver == 0 then return end
  if db.actor:has_info( "volna_sak_test" ) then
    log2(
      "[%s]: found volna_sak_test, giving volna_sak_have", script_name()
    )
    db.actor:give_info_portion( "volna_sak_have" )
  end
end


function fix_marsh_campfires2( ver )
  dsh.create_campfire(
    vector():set( 357.1725769043,1.3454269170761,125.54545593262 ),
    369755, 3538
  )
  dsh.create_campfire(
    vector():set( 428.85186767578,0.81956124305725,-43.843982696533 ),
    422652, 3548
  )
end


function fix_zaton_campfires3( ver )
  dsh.create_candle(
    vector():set( 107.65385437012,-2.7387399673462,178.65463256836 ),
    1150630, 3686, "physics\\decor\\gas_burner"
  )
end


function fix_teleport_1_arhara_spawn_restrictor( ver )
  local sobj = alife():object( "teleport_1_arhara_spawn_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_vedro_1000( ver )
  local sobj = alife():object( "vedro_1000" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_land_arhara_zimov_voz( ver )
  local sobj = alife():object( "land_arhara_zimov_voz" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_volna_svidetel( ver )
  local sobj = alife():story_object( story_ids.volna_svidetel )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    dsh.release_mob( sobj )
  end
  sobj = alife():object( "bar_volna_svidetel" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_volna_diversya_done( ver )
  if
    db.actor:has_info( "volna_diversya_done" )
    and db.actor:dont_has_info( "volna_diversya_start" )
  then
    log2(
      "[%s]: found volna_diversya_done, giving volna_diversya_start",
      script_name()
    )
    db.actor:give_info_portion( "volna_diversya_start" )
  end
end


function fix_marsh_kosoi( ver )
  local sobj = alife():object( "marsh_kosoi" )
  if sobj then
    log2(
      "[%s]: found %s, assign story_id %s",
      script_name(), sobj:name(), story_ids.marsh_kosoi
    )
    alife():assign_story_id( sobj.id, story_ids.marsh_kosoi )
  end
end


function fix_green_night_centr( ver )
  dsh.create_campfire(
    vector():set( 148.91195678711,-0.18885134160519,-181.64988708496 ),
    107140, 3304,
    "objects\\koster_palki", 0.8
  )
end


function fix_x16_candles( ver )
  dsh.create_candle(
    vector():set( -43.40425491333,20.744737625122,9.7714805603027 ),
    2394, 1532, "physics\\decor\\gas_burner"
  )
end


function fix_karas_npc_dead( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "karas_npc_dead" )
    and db.actor:dont_has_info( "dragunov_aks_have" )
  then
    log2( "[%s]: found karas_npc_dead, fixing", script_name() )
    ogse.spawn_item_in_inv( "wpn_aks74m_kalibr_ves_m1" )
  end
end


function fix_marsh_campfires3( ver )
  dsh.create_campfire(
    vector():set( -96.973251342773,3.1313118934631,-214.44738769531 ),
    92841, 3389
  )
end


function fix_grom_npc_pos()
  if level.name() == "l08_yantar" then
    local sobj = alife():story_object( story_ids.grom_npc ) -- 21008
    if sobj then
      alife():teleport_object(
        sobj.id,
        vector():set( 27.641338348389, -10.942045211792, -280.30341186523 ),
        54978, 1480
      )
    end
  end
end


function fix_weight_upgrade( ver )
  if ver == 0 then return end
  if amk.game_days() > 15 then
    log2( "[%s]: set weight_upgrade = 20", script_name() )
    dsh_weight_control.set_weight_upgrade( 20 )
  end
end


function fix_kuzy_artmodifik( ver )
  if ver == 0 then return end
  if
    db.actor:dont_has_info( "kuzy_artmodifikator_start" )
    or db.actor:has_info( "kuzy_artmodifikator_have" )
  then
    return
  end
  log2( "[%s]: fix kuzy_artmodifik", script_name() )
  arhara_dialog.start_kuzy_artmodifikator_timer()
end


function fix_marsh_radioactive_strong( ver )
  local sobj = alife():object( "marsh_radioactive_strong" )
  local sr   = sobj:get_space_restrictor()
  log2(
    "[%s]: fix %s.m_space_restrictor_type: %s -> %s",
    script_name(), sobj:name(),
    sr.restrictor_type, global_flags.eRestrictorTypeNone
  )
  sr.restrictor_type = global_flags.eRestrictorTypeNone
end


function fix_l12_stancia_campfires( ver )
  dsh.create_candle(
    vector():set( 273.16381835938,0.83222997188568,-215.98658752441 ),
    113133, 2350, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 857.390625,0.21647170186043,-64.473579406738 ),
    373949, 2307, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 921.12762451172,0.95080649852753,12.910362243652 ),
    405809, 2276, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 987.57312011719,1.4254273176193,-27.511878967285 ),
    442527, 2279, "physics\\decor\\gas_burner"
  )
end


function fix_zaton_campfires4( ver )
  dsh.create_candle(
    vector():set( 295.14944458008,34.266929626465,-391.41479492188 ),
    1468719, 3690, "physics\\decor\\gas_burner"
  )
  dsh.create_candle(
    vector():set( 345.66006469727,39.380439758301,-402.92276000977 ),
    1538404, 3690, "physics\\decor\\gas_burner"
  )
end


function fix_agr_zone_radioactive_weak_0005( ver )
  local sobj = alife():object( "agr_zone_radioactive_weak_0005" )
  local sr   = sobj:get_space_restrictor()
  log2(
    "[%s]: fix %s.m_space_restrictor_type: %s -> %s",
    script_name(), sobj:name(),
    sr.restrictor_type, global_flags.eRestrictorTypeNone
  )
  sr.restrictor_type = global_flags.eRestrictorTypeNone
end


function fix_av_peshera_campfires( ver )
  dsh.create_campfire(
    vector():set( -127.64, 22.40, 471.39 ),
    148242, 2973
  )
end


function fix_av_pesh_tuman11_grot( ver )
  local bad_objects = {
    "av_pesh_tuman11_grot",
    --"av_pesh_tuman13_grot",
    "av_pesh_tuman14_grot",
  }
  for _, name in ipairs( bad_objects ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_kap_tele_restrictor( ver )
  local sobj = alife():object( "kap_tele_restrictor" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


-- удалить аптечку, которая лежит рядом с тем местом, где будет лежать
-- раненый Толик. Позже аптечка там будет заспаунена.
function fix_esc_medkit( ver )
  if ver == 0 then
    local sobj = alife():object( "esc_medkit" )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_snd_efx( ver )
  cmd2( "snd_efx", "off" )
end


function fix_poddon_0013( ver )
  local sobj = alife():object( "poddon_0013" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_dok_seif( ver )
  if db.actor:has_info( "doktor_book" ) then
    ogse.spawn_item_in_inv( "wpn_b94" )
  else
    local sobj = alife():object( "dok_seif" )
    if not sobj then return end
    for id, sobj2 in alife():objects() do
      if sobj2:section_name() == "wpn_v94" and sobj2.parent_id == sobj.id then
        log2( "[%s]: found %s, replacing...", script_name(), sobj2:name() )
        alife():release( sobj2 )
        alife():create(
          "wpn_b94",
          sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id,
          sobj.id
        )
        break
      end
    end
  end
end


function fix_sak_out_teleport( ver )
  if ver == 0 then return end
  local sid = { 9121, 9122, 9123, 9124, 9125 }
  for _, sidlc in ipairs( sid ) do
    local obj = alife():story_object( sidlc )
    if obj then
      log2( "[%s]: found %s, removing...", script_name(), obj:name() )
      alife():release( obj )
    end
  end
  local objt = amk.load_variable( "sak_teleport", 0 )
  if objt ~= 0 then
    local sobj = alife():object( objt )
    if sobj then
      log2( "[%s]: found %s, removing...", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
  amk.del_variable( "sak_teleport" )
end


function fix_zaton_to_escape( ver )
  local sobj = alife():object( "zaton_to_escape" )
  if sobj then
    log2(
      "[%s]: found %s, creating zone_teleport", script_name(), sobj:name()
    )
    amk_anoms.spawn_anomaly(
      "zone_teleport",
      sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id,
      { shtype = 0, radius = 1, center = { 0, 0, 0 } }
    )
  end
end


function fix_sahar_info( ver )
  local bad_objects = {
    "arhara_ecolog_guard1",
    "arhara_ecolog_guard2",
  }
  for _, name in ipairs( bad_objects ) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_peshera_arhara_anom5( ver )
  local sobj = alife():object( "peshera_arhara_anom5" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_agr_space_restrictor_0001( ver )
  local sobj = alife():object( "agr_space_restrictor_0001" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_surprise_box_815( ver )
  local sobj = alife():object( "surprise_box_815" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
  if
    db.actor:dont_has_info( "yurik_pomer_pivo_start" )
    or db.actor:has_info( "yurik_pomer_pivo_have" )
  then
    return
  end
  log2( "[%s]: respawn surprise_box_815", script_name() )
  dsh.respawn_surprise_box_815()
end


function fix_sak_military_stalker()
  if level.name() == "l03_agroprom" then
    local sobj = alife():object( "sak_military_stalker" )
    if sobj then
      local patrol = patrol( "sak_military_stalker_day_walk" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_aes_soldier_commander( ver )
  local sobj = alife():object( "aes_soldier_commander" )
  if sobj then
    log2(
      "[%s]: found %s, assign story_id %s",
      script_name(), sobj:name(), story_ids.aes_soldier_commander
    )
    alife():assign_story_id( sobj.id, story_ids.aes_soldier_commander )
  end
end


function fix_peshera_go( ver )
  if ver == 0 then return end
  if db.actor:has_info( "peshera_go" ) and level.name() ~= "peshera" then
    log2( "[%s]: found peshera_go", script_name() )
    db.actor:disable_info_portion( "peshera_go" )
  end
end


function fix_peshera_blok_tp( ver )
  if ver == 0 then return end
  if
    db.actor:dont_has_info( "peshera_go" )
    and ogse.load_var_safe( "kostya_dialog.peshera_clear" )
  then
    log2( "[%s]: found kostya_dialog.peshera_clear", script_name() )
    ogse.delete_var( "kostya_dialog.peshera_clear" )
    kostya_dialog.delete_teleport( "peshera_blok_tp" )
  end
end


function fix_rosros_cutscene( ver )
  local sobj = alife():object( "rosros_cutscene" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_agro_final_vert2( ver )
  if db.actor:has_info( "final_agro_say_ok_start" ) then return end
  local sobj = alife():object( "agro_final_vert2" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_delete_agro_musor( ver )
  if db.actor:dont_has_info( "kuzy_artmodifikator_timeout" ) then return end
  log2( "[%s]: found kuzy_artmodifikator_timeout", script_name() )
  arhara_dialog.delete_agro_musor()
end


function fix_puzir_campfires( ver )
  -- где запорожец
  dsh.create_campfire(
    vector():set( 213.92, 6.46, 182.9 ), 359809, 2885
  )
end


function fix_overweight_time( ver )
  if ver == 0 then return end
  local v = ogse.load_var_safe( "dsh_weight_control.overweight_time" )
  if v then
    local weight_upgrade = v / 86400
    log2(
      "[%s]: convert overweight_time = %s to weight_upgrade = %s",
      script_name(), v, weight_upgrade
    )
    dsh_weight_control.set_weight_upgrade( weight_upgrade )
    ogse.delete_var( "dsh_weight_control.overweight_time" )
  end
end


function fix_escape_lager_spawn_killers( ver )
  if ver == 0 then return end
  if db.actor:has_info( "escape_lager_help" ) then
    db.actor:give_info_portion( "escape_lager_spawn_killers" )
  end
end


function fix_sed_village( ver )
  if ver == 0 then return end
  braad_test.remove_dyak()
  braad_test.remove_village()
end


function fix_add_new_to_peshera2( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.escape_to_marsh )
  if sobj then
    log2( "[%s]: found %s, moving", script_name(), sobj:name() )
    alife():teleport_object(
      sobj.id, vector():set( -254.01,-16.35,-205.71 ), 8329, 41
    )
  end
end


function fix_kot_update( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "kot_need_next_done" )
    and db.actor:dont_has_info( "bkot_spawn" )
  then
    log2( "[%s]: kot_update_start()", script_name() )
    braad_test.kot_update_start()
  end
end


function fix_agro_final_vert1( ver )
  if db.actor:has_info( "final_agro_say_ok_start" ) then return end
  local sobj = alife():object( "agro_final_vert1" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_yakut_agro( ver ) end

function fix_yakut_agro2( ver )
  if ver == 0 then return end
  for _, info in ipairs({
    "system_ecolog_done", "yakut_treasure_start", "koloda_arhara"
  }) do
    if db.actor:dont_has_info( info ) then return end
  end
  dsh.free_yakut_agro()
end


function fix_aes_btr( ver )
  for _, n in ipairs({
    "aes_btr", "aes_btr_0001", "aes_m_car", "aes_btr_0002", "aes_btr_0000",
    "aes_btr_act"
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_aes_space_restrictor_sound_0044( ver )
  local sobj = alife():object( "aes_space_restrictor_sound_0044" )
  if sobj then
    log2( "[%s]: found %s, removing", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_spawn_teleport1( ver )
  if ver == 0 then return end
  kostya_dialog.delete_teleport( "m_teleport_1" )
  kostya_dialog.delete_teleport( "m_teleport_2" )
  if db.actor:has_info( "kostya_x18_taynik_done" ) then
    kostya_dialog.delete_teleport( "m_teleport_8" )
  end
end


function fix_clear_personal_relations( ver )
  if ver == 0 then return end
  local except = {
    [ "val_escort_bandit_halfdead" ] = true,
  }
  local friends_comm = {
    [ "ecolog"  ] = true,
    [ "dolg"    ] = true,
    [ "freedom" ] = true,
    [ "green"   ] = true,
    [ "nebo"    ] = true,
    [ "stalker" ] = true,
    [ "trader"  ] = true,
  }
  for id = 1, 65534 do
    local sobj = alife():object( id )
    if sobj then
      if IsStalker( sobj ) then
        if sobj:alive() and not except[ sobj:name() ] then
          local comm = sobj:community()
          local p_gw = relation_registry.get_personal_goodwill( sobj.id, db.actor:id() )
          if
            ( ( not friends_comm[ comm ] ) and p_gw > 0 )
            or ( friends_comm[ comm ] and p_gw < 0 )
          then
            log2(
              "[%s]: fix strange personal relation of %s (%s): goodwill = %s",
              script_name(), sobj:name(), comm, p_gw
            )
            relation_registry.clear_personal_goodwill( sobj.id, db.actor:id() )
          end
        end
      elseif not IsMonster( sobj ) then
        relation_registry.clear_personal_relations( id )
      end
    else
      relation_registry.clear_personal_relations( id )
    end
  end
end


function fix_warlab_stalker_oso( ver )
  local sobj = alife():object( "warlab_stalker_oso" )
  if sobj then
    log2(
      "[%s]: found %s, assign story_id %s",
      script_name(), sobj:name(), story_ids.warlab_stalker_oso
    )
    alife():assign_story_id( sobj.id, story_ids.warlab_stalker_oso )
  end
end


function fix_drrr_vibros( ver )
  for _, n in ipairs({
    "esc_novisy_moroz_restrictor", "esc_moroz_sms_restrictor",
    "svalka_moroz_restrictor", "military_moroz_restrictor",
    "yantar_moroz_restrictor", "pripyat_moroz_restrictor",
    "village_moroz_restrictor", "marsh_moroz_restrictor",
    "red_forest_moroz_restrictor"
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: found %s, removing", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_stalker_alexandrych( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "stalker_alexandrych" then
      log2(
        "[%s]: found %s, assign story_id %s",
        script_name(), sobj:name(), story_ids.alexandrych_marsh
      )
      alife():assign_story_id( sobj.id, story_ids.alexandrych_marsh )
      return
    end
  end
end


function fix_esc_hunter_zaschita_2( ver )
  if db.actor:has_info( "atak_larger_done" ) then return end
  local sobj = alife():object( "esc_hunter_zaschita_2" )
  if sobj and sobj:alive() then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.esc_hunter_zaschita_2, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.esc_hunter_zaschita_2 )
  end
end


function fix_bodi_pantera1( ver )
  local sobj = alife():object( "bodi_pantera1" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.bodi_pantera1, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.bodi_pantera1 )
  end
end


function fix_boloto_provodnik( ver )
  local sobj = alife():object( "boloto_provodnik" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.boloto_provodnik, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.boloto_provodnik )
  end
end


function fix_land_lazaret_stalker2( ver )
  local sobj = alife():object( "land_lazaret_stalker2" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.land_lazaret_stalker2, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.land_lazaret_stalker2 )
  end
end


function fix_land_lazaret_stalker3( ver )
  local sobj = alife():object( "land_lazaret_stalker3" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.land_lazaret_stalker3, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.land_lazaret_stalker3 )
  end
end


function fix_piligrim( ver )
  local sobj = alife():object( "piligrim" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.piligrim, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.piligrim )
  end
end


function fix_bar_atp_level_changer( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_bar_atp" ) then return end  
  local sobj = alife():object( "bar_atp_level_changer" )
  if sobj then
    log2( "[%s]: fixing %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
  sak.add_new_bar_to_atp()
end


function fix_level_changer_na_kordon( ver ) end

function fix_level_changer_na_kordon2( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_atp_kordon" ) then return end  
  local sobj = alife():object( "level_changer_na_kordon" )
  if sobj then
    log2( "[%s]: fixing %s", script_name(), sobj:name() )
    for id, sobj2 in alife():objects() do
      if
        sobj2.level_name == sobj.level_name
        and sobj2.m_level_vertex_id == sobj.m_level_vertex_id
        and sobj2:section_name() == "zone_teleport"
      then
        log2( "[%s]:   release %s", script_name(), sobj2:name() )
        alife():release( sobj2 )
        break
      end
    end
    alife():release( sobj )
  end
  sak.add_new_atp_to_kordon()
end


function fix_level_changer_na_pripyat( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "med_dok_start" )
    and db.actor:dont_has_info( "med_dok_done" )
  then
    return
  end
  log2( "[%s]: arhara_dialog.med_dok_del_lc()", script_name() )
  arhara_dialog.med_dok_del_lc()
end


function fix_exit_to_peshera_from_garbage( ver )
  if ver == 0 then return end
  for _, sid in ipairs({
    story_ids.exit_to_peshera_from_garbage, story_ids.peshera_to_svalka
  }) do
    local sobj = alife():story_object( sid )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_exit_to_peshera_from_agroprom( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.exit_to_peshera_from_agroprom )
  if sobj then
    log2( "[%s]: fix %s", script_name(), sobj:name() )
    alife():release( sobj )
    sobj = alife():story_object( story_ids.peshera_to_agroprom )
    if sobj then
      log2( "[%s]:   release %s", script_name(), sobj:name() )
      sobj = alife():story_object( story_ids.peshera_to_agroprom )
    end
    sak.add_new_to_peshera1()
  end
end


function fix_exit_to_agr_underground_05( ver )
  if db.actor:has_info( "agr_krot_band_done" ) then return end
  local sobj = alife():object( "exit_to_agr_underground_05" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_peshera_arhara_vagonetka2( ver )
  local sobj = alife():object( "peshera_arhara_vagonetka2" )
  if sobj then
    log2( "[%s]: fix %s", script_name(), sobj:name() )
    alife():release( sobj )
    sobj = alife():create( 13848 )
    local pk = get_netpk( sobj, 1 )
    ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
    local data = pk:get()
    data.mass        = 1000
    data.fixed_bones = "root1"
    pk:set( data )
  end
end


function fix_perehod_chaes2_na_chaes_restrictor( ver )
  local sobj = alife():object( "perehod_chaes2_na_chaes_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_space_restrictor_buluzniki( ver )
  for _, n in ipairs({
    "space_restrictor_buluzniki", "restrictor_art_buluz_aver",
    "restrictor_art_buluz_generators", "restrictor_art_buluz_sarcofag",
    "restrictor_art_buluz_bolota"
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_sms_ot_klenov_restrictor( ver )
  for _, n in ipairs({
    "sms_ot_klenov_restrictor", "village_pantera_kamp_restrictor"
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_forest_chimera_x_ray2( ver )
  for _, n in ipairs({ "forest_chimera_x_ray2", "forest_chimera_strong3" }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      dsh.release_mob( sobj )
    end
  end
end


function fix_agr_ratcatcher_candle( ver )
  dsh.create_candle(
    vector():set( -197.72071838379,2.4979434013367,87.654266357422 ),
    39581, 678, "physics\\decor\\gas_burner"
  )
end


function fix_mil_bolt( ver )
  local sobj = alife():object( "mil_bolt" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.mil_bolt, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.mil_bolt )
  end
end


function fix_rostok_volkodav_band_mapspot( ver )
  local sobj = alife():story_object( story_ids.rostok_banda_volkodava )
  if sobj then
    log2( "[%s]: clear %s", script_name(), sobj:name() )
    sobj.custom_data = ""
  end
end


function fix_yan_vasilyev( ver )
  if db.actor:has_info( "yan_find_vasilyev_start" ) then return end
  local sobj = alife():story_object( story_ids.yan_vasilyev )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_m_teleport_16( ver )
  if ver == 0 then return end
  for i = 16, 17 do
    local sobj = alife():story_object( story_ids[ "m_teleport_" .. i ] )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_zone_flame_small( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "zone_flame_small" then
      local sr = sobj:get_space_restrictor()
      if sr.restrictor_type == global_flags.eDefaultRestrictorTypeNone then
        local pk = get_netpk( sobj, 1 )
        ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
        local data   = pk:get()
        local shapes = data.shapes:getTable()
        if data.shapes:count() == 1 then
          local shape1 = data.shapes:get( 1 )
          if shape1.type == 0 and shape1.radius < 0.11 then
            log2(
              "[%s]: fix radius of %s: %s, %s",
              script_name(), sobj:name(), shape1.radius, sr.restrictor_type
            )
            shape1.radius = 1
            pk:set( data )
            sr.restrictor_type = global_flags.eRestrictorTypeNone
          end
        end
      end
    end
  end
end


function fix_rostok_zone_zharka_static_average( ver )
  for _, n in ipairs({
    "",
    "_0001", "_0003", "_0006", "_0007", "_0008", "_0009", "_0010", "_0011",
    "_0012", "_0013", "_0014", "_0015", "_0016", "_0017", "_0019", "_0020",
    "_0018", "_0021", "_0022",
  }) do
    local sobj = alife():object( "rostok_zone_zharka_static_average" .. n )
    if sobj then
      local sr = sobj:get_space_restrictor()
      log2(
        "[%s]: fix %s.m_restrictor_type: %s -> %s",
        script_name(), sobj:name(), sr.restrictor_type,
        global_flags.eDefaultRestrictorTypeNone
      )
      sr.restrictor_type = global_flags.eDefaultRestrictorTypeNone
    end
  end
end


function fix_zone_flame_small2( ver )
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "zone_flame_small"
      or sobj:section_name() == "zone_flame_candle"
    then
      local sr = sobj:get_space_restrictor()
      if sr.restrictor_type == global_flags.eDefaultRestrictorTypeNone then
        log2(
          "[%s]: fix %s.m_restrictor_type: %s -> %s",
          script_name(), sobj:name(), sr.restrictor_type,
          global_flags.eRestrictorTypeNone
        )
        sr.restrictor_type = global_flags.eRestrictorTypeNone
      end
    end
  end
end


function fix_limansk_campfires2( ver )
  dsh.create_campfire( vector():set( 6.61, 0.28, -376.26 ), 29069, 3006 )
end


function fix_m_teleport( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    local sr = sobj:get_space_restrictor()
    if
      sr and sr.restrictor_type == global_flags.eDefaultRestrictorTypeNone
      and get_string( sobj:section_name(), "script_binding" ) == "bind_mteleport.bind"
      and get_bool( sobj:section_name(), "teleport" )
    then
      local pk = get_netpk( sobj, 1 )
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      if data.shapes:count() == 0 then
        data.shapes:addSphere( 1, vector():set( 0, 0, 0 ) )
        log2( "[%s]: fix %s", script_name(), sobj:name() )
        pk:set( data )
        sr.restrictor_type = global_flags.eRestrictorTypeNone
      end
    end
  end
end


function fix_av_pesh_grot_controller( ver )
  local sobj = alife():object( "av_pesh_grot_controller" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    dsh.release_mob( sobj )
  end
end


function fix_agr_krot( ver )
  if ver == 0 then return end
  if db.actor:has_info( "agr_krot_PDA_done" ) then return end
  local sobj = alife():story_object( story_ids.agr_krot )
  if sobj and sobj:alive() then return end
  log2( "[%s]: respawn %s", script_name(), sobj:name() )
  alife():release( sobj )
  db.actor:disable_info_portion( "agr_krot_umer" )
  dsh.make_agr_krot_alive()
end


function fix_bar_ecolog_professor( ver )
  if ver == 0 then return end
  for n, spawn_id in pairs({
    [ "rostok_volkodav_fire_sound"     ] = 7326,
    [ "rostok_volkodav_fire_sound_end" ] = 7325,
  }) do
    if not alife():object( n ) then
      log2( "[%s]: respawn %s", script_name(), n )
      alife():create( spawn_id )
    end
  end
  if db.actor:dont_has_info( "bar_rescue_research_done" ) then return end
  log2( "[%s]: dsh.clean_bar_ecolog_professor()", script_name() )
  dsh.clean_bar_ecolog_professor()
end


function fix_kalmyak_marsh_kalmyak_centr( ver )
  local p = patrol( "kalmyak_marsh_kalmyak_centr" )
  log2( "[%s]: create candle for kalmyak_marsh_kalmyak_centr", script_name() )
  dsh.create_candle(
    p:point( 0 ), p:level_vertex_id( 0 ), p:game_vertex_id( 0 ),
    "physics\\decor\\gas_burner"
  )
end


function fix_exit_to_puzir_from_garbage( ver )
  local sobj = alife():story_object( story_ids.exit_to_puzir_from_garbage )
  ASSERT( sobj, "[%s]: exit_to_puzir_from_garbage not found", script_name() )
  amk_anoms.spawn_anomaly(
    "zone_teleport",
    sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id,
    { shtype = 0, radius = 1, center = { 0, 0, 0 } }
  )
end


function fix_darkvalley_les( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.darkvalley_les )
  if sobj then
    log2(
      "[%s]: found %s, creating zone_teleport", script_name(), sobj:name()
    )
    amk_anoms.spawn_anomaly(
      "zone_teleport",
      sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id,
      { shtype = 0, radius = 1, center = { 0, 0, 0 } }
    )
  end
end


function fix_lukash_counter_done( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "lukash_counter_done" ) then return end
  log2( "[%s]: spawn wpn_m110_m1", script_name() )
  ogse.spawn_item_in_inv( "wpn_m110_m1" )
end


function fix_esc_find_doctor_done() end

function fix_esc_find_doctor_done2( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "esc_find_doctor_done" ) then return end
  log2( "[%s]: my_name_is_strelok()", script_name() )
  dsh.my_name_is_strelok()
end


function fix_create_sr18() end

function fix_m_teleport_40( ver )
  if ver == 0 then return end
  if db.actor:has_info( "net_teleport6" ) then
    for i = 35, 54 do
      local n  = "m_teleport_" .. i
      local id = xr_logic.pstor_retrieve( db.actor, n, 0 )
      if id > 0 then
        log2( "[%s]: release %s", script_name(), n )
        kostya_dialog.delete_teleport( n )
      end
    end
  end
end


function fix_video_vzlet_gen_restrictor( ver )
  local sobj = alife():object( "video_vzlet_gen_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_video_vzlet_boloto_restrictor( ver )
  local sobj = alife():object( "video_vzlet_boloto_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_video_kursk_space_restrictor( ver )
  local sobj = alife():object( "video_kursk_space_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_diplomat( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "fanat_teleport_05_start" )
    and db.actor:dont_has_info( "fanat_teleport_05_have" )
  then
    for id, sobj in alife():objects() do
      if
        sobj:section_name() == "diplomat"
        and sobj.level_name == "l08u_brainlab"
        and sobj.parent_id == 65535
      then
        log2( "[%s]: respawn %s", script_name(), sobj:section_name() )
        alife():release( sobj )
        alife():create(
          "taynik_diplomat",
          vector():set( -100.60708618164, 22.614040374756, -24.21527671814 ),
          505, 1529
        )
        break
      end
    end
  end
end


function fix_mil_sniper_kill_zone( ver )
  for _, n in ipairs({
    "mil_explosive_dinamit", "mil_freedom_restrictor", "mil_sniper_kill_zone"
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_rostok_zone_witches_galantine( ver )
  for _, n in ipairs({
    "", "_0000", "_0001", "_0002", "_0003", "_0006", "_0011", "_0012", "_0015",
    "_0022",
  }) do
    local sobj = alife():object( "rostok_zone_witches_galantine" .. n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_upiter_baty_otlet_heli_restrictor( ver )
  for _, n in ipairs({
    "baty_otlet_heli_restrictor", "upiter_baty_otlet_heli_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_taler_marsh_vas( ver )
  local sobj = alife():create(
    "physic_object",
     vector():set( -136.14, 4.21, -305.36 ),
     77674, 3374
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.custom_data:setString(
    "[collide]\nignore_static\n" ..
    "[logic]\ncfg = scripts\\taler\\marsh_vas.ltx\n" ..
    "[ph_heavy]\n"
  )
  data.visual_name = "equipments\\mafon"
  data.physic_type = 3
  data.mass        = 10
  data.fixed_bones = "link"
  pk:set( data )
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
end


function fix_rostok_zone_witches_galantine_0004( ver )
  for _, n in ipairs({
    "_0004", "_0005", "_0013", "_0014", "_0016", "_0020"
  }) do
    local sobj = alife():object( "rostok_zone_witches_galantine" .. n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_mil_mines_restrictor( ver )
  for _, n in ipairs({
    "mil_mines_restrictor", "mil_freedom_gulag_defense_res", "mil_sr_sleep_1",
    "mil_sound_dolg_res_0000", "mil_sound_dolg_res_0001",
    "mil_sound_dolg_res_0002", "mil_sound_dolg_res_0003",
    "mil_sound_dolg_res_0004", "mil_sound_dolg_res_0005",
    "mil_sound_dolg_res_0006", "mil_sound_dolg_res_0007",
    "mil_sound_dolg_res_0008", "mil_sound_dolg_res_0009",
    "mil_sound_dolg_res_0010", "mil_sound_dolg_res_0011",
    "mil_sound_dolg_res_0012", "mil_sound_dolg_res_0013",
    "mil_sound_dolg_res_0014", "mil_sound_dolg_res_0015",
    "mil_scull_message1_restrictor", "mil_scull_message2_restrictor"
  }) do
    local sobj = alife():object( "rostok_zone_witches_galantine" .. n )
    if sobj then
      log2( "[%s]: release %s", script_name(), sobj:name() )
      alife():release( sobj )
    end
  end
end


function fix_yan_st_stalker3_population_locked( ver )
  if ver == 0 then return end
  local tname = "smart_terrain.yan_st_stalker3.population_locked"
  if ogse_st_mgr.timer_exists( tname ) then
    log2( "[%s]: fix %s", script_name(), tname )
    local t = ogse_st_mgr.get_timer( tname )
    t:stop()
    t:taction()
  end
end


function fix_info_amk_recipt_souls( ver )
  if ver == 0 then return end
  for _, info in ipairs({
     "info_amk_recipt_soul_bengal",
     "info_amk_recipt_soul_cristal",
     "info_amk_recipt_soul_fire",
     "info_amk_recipt_soul_drops",
     "info_amk_recipt_souls"
  }) do
    if db.actor:has_info( info ) then
      log2( "[%s]: fix %s", script_name(), info )
      db.actor:disable_info_portion( info )
    end
  end
end


function fix_klyak_forest_doc_scene( ver )
  if ver == 0 then return end
  if db.actor:has_info( "klyak_forest_doc_next" ) then
    log2( "[%s]: fix klyak_forest_doc_scene", script_name() )
    db.actor:give_info_portion( "klyak_forest_doc_scene" )
  end
end


function fix_brat_luis( ver )
  local sobj = alife():object( "brat_luis" )
  if sobj then
    log2(
      "[%s]: assign story_id %s to %s",
      script_name(), story_ids.brat_luis, sobj:name()
    )
    alife():assign_story_id( sobj.id, story_ids.brat_luis )
  end
end


function fix_kolmogor_sestra_have( ver )
  if ver == 0 then return end
  if db.actor:has_info( "kolmogor_sestra_done" ) then
    log2( "[%s]: fix kolmogor_sestra_have", script_name() )
    db.actor:give_info_portion( "kolmogor_sestra_have" )
  end
end


function fix_vertuxa_kapitana_space_restrictor( ver )
  local sobj = alife():object( "vertuxa_kapitana_space_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_kolm_stroy_sms_restrictor( ver )
  local sobj = alife():object( "kolm_stroy_sms_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_new_arts_count( ver )
  if ver == 0 then return end
  local cnt = ogse_surge_mgr.get_blowout_count() * 3
  log2( "[%s]: fix amk_anoms.new_arts_count -> %s", script_name(), cnt )
  ogse.save_var( "amk_anoms.new_arts_count", cnt, "u32" )
end


function fix_spawn_teleport28( ver )
  if ver == 0 then return end
  if db.actor:has_info( "kostya_agroprom_taynik_done" ) then
    for _, id in ipairs({ 4, 8, 10, 11 }) do
      log2( "[%s]: fix m_teleport_%s", script_name(), id )
      kostya_dialog.delete_teleport( "m_teleport_" .. id )
    end
  end
end


function fix_atp_for_test22_campfires( ver )
  -- за камнями у перехода на Бар
  dsh.create_campfire(
    vector():set( -86.55, -3.20, -355.80 ), 251888, 2807,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_atp_for_test22_campfires2( ver )
  -- где Гонец ждет
  dsh.create_campfire(
    vector():set( 435.92, -4.60, 78.97 ), 1003076, 2854,
    "objects\\koster_palki", 0.8
  )
  -- где тиски для Шурупа
  dsh.create_campfire(
    vector():set( 115.41, -9.55, -300.09 ), 543510, 2831,
    "objects\\koster_palki", 0.8
  )
end


function fix_atp_for_test22_candle( ver )
  dsh.create_candle(
    vector():set( 325.9821472168,-4.3444385528564,-295.47161865234 ),
    842304, 2847, "physics\\decor\\gas_burner"
  )
end


function fix_spawn_teleport31( ver )
  if ver == 0 then return end
  if db.actor:has_info( "kostya_yantar_taynik_done" ) then
    for id = 31, 34 do
      log2( "[%s]: fix m_teleport_%s", script_name(), id )
      kostya_dialog.delete_teleport( "m_teleport_" .. id )
    end
  end
end


function fix_aver_campfires( ver )
  -- Костер у перехода НЗ-Свалка
  dsh.create_campfire(
    vector():set( -334.33, 1.30, -363.78 ), 294154, 2890,
    "objects\\koster_palki", 0.8
  )
  -- У озера костер
  dsh.create_campfire(
    vector():set( 95.73, -4.98, -131.04 ), 1036962, 2902,
    "objects\\koster_palki", 0.8
  )
  -- у дороги
  dsh.create_campfire(
    vector():set( 162.00, 25.30, 36.88 ), 1153922, 2902,
    "objects\\koster_palki", 0.8
  )
  -- Переход НЗ-Склады
  dsh.create_campfire(
    vector():set( 294.42, -40.76, 344.01 ), 1391902, 2904,
    "objects\\koster_palki", 0.8
  )
  -- На холме у собак
  dsh.create_campfire(
    vector():set( 312.60, 43.53, -167.81 ), 1424640, 2903,
    "objects\\koster_palki", 0.8
  )
end


function fix_aver_campfires2( ver )
  -- На холме у камней.
  dsh.create_campfire(
    vector():set( -108.2456817627, 22.444784164429, 185.12399291 ),
    683790, 2895,
    "objects\\koster_negorit", 0.7
  )
  -- По дороге к отшельнику
  dsh.create_campfire(
    vector():set( -263.08203125, -22.394952774048, 264.811279296 ),
    419178, 2891,
    "objects\\koster_negorit", 0.7
  )
  -- У Мухи
  dsh.create_campfire(
    vector():set( -352.84078979492, 50.764701843262, 390.65811157227 ),
    263076, 2887,
    "objects\\koster_negorit", 0.7
  )
  -- Около оврага, перед переходом НЗ-ТД
  dsh.create_campfire(
    vector():set( 316.8115234375, -6.1223282814026, -295.1236877 ),
    1432326, 2903,
    "objects\\koster_negorit", 0.7
  )
end


function fix_agroprom_campfires( ver )
  -- Между запорожцем и буханкой
  dsh.create_campfire(
    vector():set( 241.28851318359, 0.30859336256981, -7.9018211364746 ),
    424354, 416,
    "objects\\koster_palki", 0.8
  )
end


function fix_peshera_campfires( ver )
  for _, name in ipairs({
    "peshera_arhara_ogon26", "peshera_arhara_lights38"
  }) do
    local sobj = alife():object( name )
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
  -- На входе
  dsh.create_campfire(
    vector():set( -0.10579995065928, -2.4897689819336, -0.19467321038246 ),
    32298, 2880,
    "objects\\koster_palki", 0.8
  )
  -- По пути к Шахтеру
  dsh.create_campfire(
    vector():set( -58.814769744873, 2.4607825279236, 24.895915985107 ),
    26512, 2870,
    "objects\\koster_negorit", 0.7
  )
  -- В большом помещении
  dsh.create_campfire(
    vector():set( -109.28817749023, 2.4989724159241, 17.134912490845 ),
    13276, 2870,
    "objects\\koster_negorit", 0.7
  )
  -- Сразу при спуске вниз стоит
  dsh.create_campfire(
    vector():set( -54.36344909668, -12.102569580078, 23.3752784729 ),
    27287, 2876,
    "objects\\koster_palki", 0.8
  )
  -- По пути в Лабиринт 2
  dsh.create_campfire(
    vector():set( -74.896995544434, -12.653991699219, 39.79866027832 ),
    22833, 2874,
    "objects\\koster_palki", 0.8
  )
  -- По пути в Лабиринт, от этого костра виден свет в конце туннеля
  dsh.create_campfire(
    vector():set( -115.18489074707, -12.651738166809, 57.598197937012 ),
    11670, 2869,
    "objects\\koster_palki", 0.8
  )
  -- Перед самым переходом в Лабиринт
  dsh.create_campfire(
    vector():set( -71.072334289551, 2.5603904724121, -66.580276489258 ),
    23650, 2880,
    "objects\\koster_negorit", 0.7
  )
  -- На повороте к кладу
  dsh.create_campfire(
    vector():set( -37.88591003418, -2.4764969348907, -23.934000015259 ),
    30317, 2879,
    "objects\\koster_palki", 0.8
  )
  -- И собственно там, где лежит клад
  dsh.create_campfire(
    vector():set( -86.369125366211, -2.4979219436646, -32.334972381592 ),
    19953, 2875,
    "objects\\koster_negorit", 0.7
  )
end


function fix_hospital_campfires( ver )
  -- кострище рядом с Котом
  dsh.create_campfire(
    vector():set( -94.976486206055,24.525949478149,754.30767822266 ),
    1282, 3043
  )
  -- Во второй секции. На ящике справа
  dsh.create_candle(
    vector():set( -84.361267089844, 33.14, 678.05303955078 ),
    4617, 3055, "physics\\decor\\gas_burner"
  )
  -- Перед спуском к ЧД
  dsh.create_candle(
    vector():set( -95.92, 33.27, 633.49 ),
    6247, 3060, "physics\\decor\\gas_burner"
  )
  -- Перед Черным доктором.
  dsh.create_candle(
    vector():set( -88.559799194336, 32.84, 612.48657226563 ),
    2799, 3038, "physics\\decor\\gas_burner"
  )
end


function fix_bar_campfires( ver )
  -- В бункере, южный блокпост
  dsh.create_candle(
    vector():set( 216.12, -1.00129294395, -16.17 ),
    52991, 1264, "physics\\decor\\gas_burner"
  )
  -- В Баре, у дерева. Там еще плоти с кабанами бегают
  dsh.create_campfire(
    vector():set( 410.62921142578, 16.404262542725, -304.19931030273 ),
    97072, 1288,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_rostok_campfires( ver )
  -- В плитах
  dsh.create_candle(
    vector():set( -41.14, 1.3675847053528, 148.5 ),
    60515, 1417, "physics\\decor\\gas_burner"
  )
  -- Где наемники, там еще безопасная зона.
  dsh.create_candle(
    vector():set( -87.475, 4.27, 145.15875244141 ),
    47032, 1421, "physics\\decor\\gas_burner"
  )
end


function fix_garbage_campfires( ver )
  -- В леске
  dsh.create_campfire(
    vector():set( 261.38613891602, -9.8359708786011, -135.32502746582 ),
    373345, 404,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_yantar_campfires( ver )
  -- В бункере ученых.
  dsh.create_candle(
    vector():set( 28.93, -10.673, -280.96 ),
    54978, 1480, "physics\\decor\\gas_burner"
  )
end


function fix_labirint_campfires( ver )
  -- Костер перед телепортом ведущим на верх к месту появления из Пещеры.
  dsh.create_campfire(
    vector():set( -191.56080627441, 56.098415374756, 190.05912780762 ),
    124136, 2987,
    "objects\\koster_negorit", 0.7
  )
  -- На самом верху
  dsh.create_campfire(
    vector():set( -376.43499755859, 92.560127258301, 132.79019165039 ),
    6107, 2915,
    "objects\\koster_negorit", 0.7
  )
  -- Рядом с переходом на НЗ
  dsh.create_campfire(
    vector():set( -342.99554443359, 96.800224304199, 300.13656616211 ),
    22244, 2919,
    "objects\\koster_negorit", 0.7
  )
  -- Проходим мост, который патрулирует монолит и там справа будет костер
  dsh.create_campfire(
    vector():set( -181.56199645996, 96.190032958984, 236.97673034668 ),
    131758, 2966,
    "objects\\koster_negorit", 0.7
  )
  -- В конце этого коридора, перед тем как выйти на открытое пространство
  dsh.create_campfire(
    vector():set( -309.50112915039, 84.513481140137, 295.91613769531 ),
    41737, 2933,
    "objects\\koster_negorit", 0.7
  )
  -- Дальше спускаясь
  dsh.create_campfire(
    vector():set( -191.29684448242, 78.307777404785, 279.9248046875 ),
    125062, 2964,
    "objects\\koster_negorit", 0.7
  )
  -- Костер
  dsh.create_campfire(
    vector():set( -209.01864624023, 73.818832397461, 154.25215148926 ),
    111420, 2959,
    "objects\\koster_negorit", 0.7
  )
  -- Если идти по коридорам, то выйдем на второй уровень, где монолитвцы сидят.
  -- Вот перед выходом и стоит костер
  dsh.create_campfire(
    vector():set( -323.25323486328, 61.970874786377, 88.527626037598 ),
    32194, 2923,
    "objects\\koster_negorit", 0.7
  )
  -- Выход на второй уровень только с другой стороны
  dsh.create_campfire(
    vector():set( -233.66055297852, 64.741668701172, 28.124681472778 ),
    94678, 2952,
    "objects\\koster_negorit", 0.7
  )
  -- Если пройти монолитовцев на втором уровне, то там дальше в коридоре
  dsh.create_campfire(
    vector():set( -356.03997802734, 50.406196594238, 303.01431274414 ),
    15626, 2917,
    "objects\\koster_negorit", 0.7
  )
  -- Костер
  dsh.create_campfire(
    vector():set( -386.08435058594, 50.618629455566, 135.30680847168 ),
    3819, 2916,
    "objects\\koster_negorit", 0.7
  )
  -- Костер
  dsh.create_campfire(
    vector():set( -297.31887817383, 36.436157226563, 307.30261230469 ),
    50722, 2953,
    "objects\\koster_negorit", 0.7
  )
  -- Выход на самый нижний уровень
  dsh.create_campfire(
    vector():set( -315.78814697266, 16.350595474243, 103.4658203125 ),
    37053, 2922,
    "objects\\koster_negorit", 0.7
  )
  -- В коридоре, который ведет к переходу в Пещеру
  dsh.create_campfire(
    vector():set( -221.88545227051, 16.812040328979, 245.45404052734 ),
    103565, 2956,
    "objects\\koster_negorit", 0.7
  )
  -- И у самого перехода в Пещеру
  dsh.create_campfire(
    vector():set( -124.87013244629, 15.85954284668, 368.12268066406 ),
    148876, 2974,
    "objects\\koster_negorit", 0.7
  )
  -- И лампадку поставил туда где Нежить лежит
  dsh.create_candle(
    vector():set( -81.085006713867, 42.8, 470.27020263672 ),
    153419, 2987, "physics\\decor\\gas_burner"
  )
end


function fix_aver_campfires3( ver )
  -- Лампадка в убежище Пилигрима
  dsh.create_candle(
    vector():set( 20.670686721802, -20, -162.7 ),
    902989, 2908, "physics\\decor\\gas_burner"
  )
end


function fix_agroprom_campfires2( ver )
  -- Вагончик у базы вояк. Лампадка.
  dsh.create_candle(
    vector():set( -27.408317565918, -1.2073531150818, -182.32540893555 ),
    212326, 676, "physics\\decor\\gas_burner"
  )
end


function fix_marsh_campfires4( ver )
  -- За Калмыком. Лампадка.
  dsh.create_candle(
    vector():set( -4.6799998283386, 4.4499998092651, 13.942704200745 ),
    136576, 3418, "physics\\decor\\gas_burner"
  )
end


function fix_puzir_campfires2( ver )
  -- Костер около выхода из ТД
  dsh.create_campfire(
    vector():set( 210.49024963379, 0.018180936574936, -195.66641235352 ),
    356891, 2884,
    "objects\\koster_negorit", 0.7
  )
  -- Переходим со Свалки и костер справа.
  dsh.create_campfire(
    vector():set( -219.95938110352, -0.66063165664673, 201.09297180176 ),
    14296, 2881,
    "objects\\koster_negorit", 0.7
  )
end


function fix_darkvalley_campfires( ver )
  -- В вагончике рядом с лабораторией. Лампадка
  dsh.create_candle(
    vector():set( 36.675930023193, 1.6330000162125, -221.92742919922 ),
    220359, 856, "physics\\decor\\gas_burner"
  )
  -- В вагончике у мельницы. лампадка
  dsh.create_candle(
    vector():set( 130.9469909668, 1.5716868638992, -192.66131591797 ),
    332424, 926, "physics\\decor\\gas_burner"
  )
end


function fix_radar_campfires2( ver )
  -- Лампадка у Сяка на столе.
  dsh.create_candle(
    vector():set( 37.234481811523, -2.461, -39.74543762207 ),
    22708, 1997, "physics\\decor\\gas_burner"
  )
end


function fix_rostok_campfires2( ver )
  -- В вагончике. лампадка.
  dsh.create_candle(
    vector():set( -253.55575561523, 1.5218100547791, 7.8703355789185 ),
    8494, 1424, "physics\\decor\\gas_burner"
  )
end


function fix_handmade_arts_exp( ver )
  if ver == 0 then return end
  local cnt = ogse.load_var( "dsh.handmade_arts_cnt", 0 )
  if cnt > 0 then
    local max_exp = math.floor( math.min( 100, cnt ) / 2 )
    if max_exp > 0 then
      log2(
        "[%s]: initialize dsh.handmade_arts_exp: %s -> %s",
        script_name(), cnt, max_exp
      )
      dsh.handmade_arts_exp( max_exp )
      actor_stats.add_points(
        "exp", "exp_art_begin", math.min( 20, max_exp ), 1
      )
      if max_exp > 20 then
        actor_stats.add_points(
          "exp", "exp_art0", math.min( 20, max_exp - 20 ), 1
        )
      end
      if max_exp > 40 then
        actor_stats.add_points(
          "exp", "exp_art1", math.min( 20, max_exp - 40 ), 1
        )
      end
      if max_exp > 60 then
        actor_stats.add_points(
          "exp", "exp_art2", math.min( 20, max_exp - 60 ), 1
        )
      end
      if max_exp > 80 then
        actor_stats.add_points(
          "exp", "exp_art3", math.min( 20, max_exp - 80 ), 1
        )
      end
      if max_exp >= 100 then
        actor_stats.add_points( "exp", "exp_art_abs", 1, 1 )
      end
    end
  end
end


function fix_kordon_campfires( ver )
  -- Кордон. Лампадка
  dsh.create_candle(
    vector():set( -12.86932182312, 3.9099335670471, 59.85 ),
    264404, 88, "physics\\decor\\gas_burner"
  )
end


function fix_warlab_campfires( ver )
  -- На батарее лампадка.
  dsh.create_candle(
    vector():set( 5.2, 2.0772776603699, -7.74 ),
    5337, 3210, "physics\\decor\\gas_burner"
  )
end


function fix_spawn_exhimera_restrictor( ver )
  local sobj = alife():object( "spawn_exhimera_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_ekza_sarcofag( ver )
  if ver == 0 then return end
  if
    db.actor:dont_has_info( "svoboda_lukash_done" )
    or dsh.actor_was_here( "l12u_sarcofag" )
  then
    return
  end
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "meceniy_outfit_new"
      and sobj.level_name == "l12u_sarcofag"
    then
      return
    end
  end
  log2( "[%s]: fix arhara1_dialog1.ekza_sarcofag()", script_name() )
  arhara1_dialog1.ekza_sarcofag()
end


function fix_control_monolith_campfires( ver )
  -- Возле перехода в Саркофаг. Лампадка.
  dsh.create_candle(
    vector():set( -12.79111289978, -34.568405151367, -9.0430097579956 ),
    1341, 2484, "physics\\decor\\gas_burner"
  )
  -- Перед дверью с колбами.
  dsh.create_candle(
    vector():set( -10.731477737427, -31.542512893677, 24.054378509521 ),
    1474, 2511, "physics\\decor\\gas_burner"
  )
  -- Лампадка по пути к Молнии 2
  dsh.create_candle(
    vector():set( -38.851234436035, -34.05, -23.717 ),
    164, 2504, "physics\\decor\\gas_burner"
  )
  -- Лампадка на верхней трубе
  dsh.create_candle(
    vector():set( 41.274, -32.947204589844, -26.954219818115 ),
    3973, 2494, "physics\\decor\\gas_burner"
  )
  -- Лампадка у Молнии.
  dsh.create_candle(
    vector():set( -40.96516418457, -34.474315643311, 17.95 ),
    71, 2509, "physics\\decor\\gas_burner"
  )
end


function fix_ratcatcher_out( ver )
  if ver == 0 then return end
  if db.actor:has_info( "ratcatcher_out" ) then
    log2( "[%s]: fix dsh.free_agr_ratcatcher()", script_name() )
    dsh.free_agr_ratcatcher()
  end
end


function fix_military_campfires( ver )
  -- Лампадка напротив Скряги
  dsh.create_candle(
    vector():set( -26.478313446045, -6.6213655471802, -31.297927856445 ),
    281944, 1593, "physics\\decor\\gas_burner"
  )
end


function fix_sarcofag_campfires( ver )
  -- На трубе напротив появления с ЧАЭС-1
  dsh.create_candle(
    vector():set( -30.38282585144, 1.4284448623657, 32.371856689453 ),
    42, 2404, "physics\\decor\\gas_burner"
  )
  -- На трубе. На повороте.
  dsh.create_candle(
    vector():set( -3.36, 1.2275735139847, -14.085498809814 ),
    1129, 2420, "physics\\decor\\gas_burner"
  )
  -- После разлома.
  dsh.create_candle(
    vector():set( 27.280473709106, 1.2858287096024, 41.109085083008 ),
    5783, 2426, "physics\\decor\\gas_burner"
  )
  -- Перед лестницей на верх
  dsh.create_candle(
    vector():set( 74.565460205078, 1.0409843921661, 13.559132575989 ),
    10519, 2431, "physics\\decor\\gas_burner"
  )
  -- Наверхнем этаже.
  dsh.create_candle(
    vector():set( 54.486843109131, 13.619017601013, -13.756328582764 ),
    9199, 2415, "physics\\decor\\gas_burner"
  )
  -- Перед лесницец ведущей в БУМ
  dsh.create_candle(
    vector():set( 16.008008956909, 13.200799942017, 28.465339660645 ),
    4383, 2442, "physics\\decor\\gas_burner"
  )
  -- В коридоре, который ведет в БУМ
  dsh.create_candle(
    vector():set( 22.813680648804, 18.024221420288, 26.152797698975 ),
    5067, 2459, "physics\\decor\\gas_burner"
  )
end


function fix_stancia_2_campfires( ver )
  -- На первом подьеме.
  dsh.create_campfire(
    vector():set( 99.307830810547, 38.513229370117, 141.42538452148 ),
    59843, 2563,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер
  dsh.create_campfire(
    vector():set( 173.99159240723, 21.803104400635, 156.40786743164 ),
    71220, 2568,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Лампадка перед первым телепортом
  dsh.create_candle(
    vector():set( 66.72883605957, 18.248352050781, 305.14019775391 ),
    53420, 2555, "physics\\decor\\gas_burner"
  )
  -- Костер
  dsh.create_campfire(
    vector():set( 282.08309936523, 16.824642181396, 74.279998779297 ),
    99458, 2594,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер после телепорта
  dsh.create_campfire(
    vector():set( 400.94995117188, 36.877490997314, 85.373794555664 ),
    136194, 2600,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер между двух цистерн
  dsh.create_campfire(
    vector():set( 427.42517089844, 8.5088405609131, 164.43589782715 ),
    143617, 2599,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер около телепорта, та еще ЗЛ спавнятся
  dsh.create_campfire(
    vector():set( 572.75183105469, 9.0803508758545, 172.54479980469 ),
    170554, 2631,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер между двух вентиляционных шахт.
  dsh.create_campfire(
    vector():set( 183.73274230957, 70.332641601563, 136.79661560059 ),
    73983, 2573,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Лампадка на изогнутой трубе
  dsh.create_candle(
    vector():set( 414.79083251953, 17.791389465332, 435.96060180664 ),
    140653, 2608, "physics\\decor\\gas_burner"
  )
  -- Лампадка на кране.
  dsh.create_candle(
    vector():set( 241.36293029785, 51.331790924072, 137.6595916748 ),
    86579, 2574, "physics\\decor\\gas_burner"
  )
  -- Лампадка после телепорта, на ящике
  dsh.create_candle(
    vector():set( 496.65, 19.106645584106, 280.21112060547 ),
    157899, 2617, "physics\\decor\\gas_burner"
  )
  -- Лампадка на бочке.
  dsh.create_candle(
    vector():set( 728.03735351563, 20.649839401245, 86.06583404541 ),
    198145, 2633, "physics\\decor\\gas_burner"
  )
  -- Костер после предпоследнего телепорта
  dsh.create_campfire(
    vector():set( 883.92395019531, 8.2236700057983, 214.30130004883 ),
    231286, 2637,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Костер перед самым последним телепортом
  dsh.create_campfire(
    vector():set( 879.62823486328, 15.09543800354, 116.62133789063 ),
    229539, 2635,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_stancia_2_campfires2( ver )
  -- Рядом с Клыком
  dsh.create_campfire(
    vector():set( 506.14730834961, -0.00045672059059143, 212.41636657715 ),
    160502, 2622,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Лампадка 1
  dsh.create_candle(
    vector():set( 203.51306152344, 17.005815505981, 345.59652709961 ),
    78352, 2580, "physics\\decor\\gas_burner"
  )
  -- Лампадка 2
  dsh.create_candle(
    vector():set( 264.18435668945, 17.005012512207, 422.61309814453 ),
    93967, 2579, "physics\\decor\\gas_burner"
  )
end


function fix_atp_for_test22_campfires3( ver )
  -- поставил лампадку на пианино, там у столба еще выброс вроде можно
  -- переждать
  dsh.create_candle(
    vector():set( 172.68702697754, -5.4679832458496, -13.5406064 ),
    624374, 2835, "physics\\decor\\gas_burner"
  )
  -- Добавил еще лампадку в здание у автобуса
  dsh.create_candle(
    vector():set( 192.91567993164, -6.1103401184082, 12.93704414 ),
    652945, 2836, "physics\\decor\\gas_burner"
  )
end


function fix_warlab_campfires2( ver )
  -- Лампадка на батарее, напротив Пантеры
  dsh.create_candle(
    vector():set( -6.5373558998108, -6.1884579658508, 9.1 ),
    3221, 3172, "physics\\decor\\gas_burner"
  )
end


function fix_generators_campfires( ver )
  -- Выход с ЧАЭС-1
  dsh.create_campfire(
    vector():set( 230.1005859375, 20.042957305908, -98.981475830078 ),
    602495, 3147,
    "objects\\koster_negorit", 0.7
  )
  -- Перед границей излучения, когда провожаем Боцмана.
  dsh.create_campfire(
    vector():set( 30.630863189697, 24.924663543701, -461.58782958984 ),
    371723, 3113,
    "objects\\koster_negorit", 0.7
  )
  -- Костер где встречаем Пантеру
  dsh.create_campfire(
    vector():set( -25.756090164185, 34.102603912354, -246.74572753906 ),
    305217, 3105,
    "objects\\koster_negorit", 0.7
  )
  -- около палатки одноногого
  for _, n in ipairs({
    "gener_vertel_vedro", "gener_zone_campfire_grill",
    "gener_vertel_vedro_lights"
  }) do
    local sobj = alife():object( n )
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
  dsh.create_campfire(
    vector():set( -217.627212524414, 33.2275352478027, -132.006591796875 ),
    85880, 3085,
    "objects\\koster_negorit", 0.7
  )
end


function fix_red_forest_campfires( ver )
  -- Лампадка в остановке.
  dsh.create_candle(
    vector():set( -7.75, -0.076030097901821, -327.69915771484 ),
    61049, 3273, "physics\\decor\\gas_burner"
  )
end


function fix_zone_ameba() end

function fix_zone_ameba2( ver )
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "zone_ameba"
      and sobj.level_name ~= "peshera"
    then
      table.insert( t, sobj )
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_m_teleport_25( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.m_teleport_25 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "m_inventory_box13" then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
      break
    end
  end
end


function fix_udalyem_molniu_restrictor( ver )
  local sobj = alife():object( "udalyem_molniu_restrictor" )
  if sobj then
    log2( "[%s]: release %s", script_name(), sobj:name() )
    alife():release( sobj )
  end
end


function fix_atp_for_test22_campfires4( ver )
  -- Костер на пригорке, если идти от стоянки Калинина к переходу на
  -- Свалку
  dsh.create_campfire(
    vector():set( 183.5510559082, 1.5516208410263, 211.54194641113 ),
    639343, 2839,
    "objects\\koster_negorit", 0.7
  )
  -- Лампадка в сарае около стоянки Калинина
  dsh.create_candle(
    vector():set( -60.832855224609, -1.71, 203.92419433594 ),
    290372, 2806, "physics\\decor\\gas_burner"
  )
end


function fix_atp_for_test22_campfires5( ver )
  -- у экскаватора
  dsh.create_campfire(
    vector():set( -198.99807739258, -4.0888004302979, -26.858318328857 ),
    88585, 2796,
    "objects\\koster_negorit", 0.7
  )
end


function fix_gar_dm_bandit( ver )
  local visuals = {
    "stalker_2_ochki",
    "stalker_2_rozh1",
    "stalker_4_rozh3",
    "stalker_neytral_balon_8",
    "stalker_neytral_hood_uzor",
  }
  for sid = 101, 103 do
    local sobj = alife():story_object( sid )
    if sobj and sobj:alive() then
      log2( "[%s]: fix %s", script_name(), sobj:name() )
      local pk = get_netpk( sobj, 1 )
      ASSERT(
        ( pk and pk:isOk() ),
        "[%s]: can't read netpacket of %s", script_name(), sobj:name()
      )
      local data = pk:get()
      data.visual_name = "actors\\neytral\\"
        .. visuals[ math.random( table.getn( visuals ) ) ]
      pk:set( data )
    end
  end
end


function fix_m_teleport_24( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "kostya_svalka_taynik_done" ) then return end
  local sobj = alife():story_object( story_ids.m_teleport_24 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_tornado1( ver )
  local sobj = alife():object( "av_pesh_tornado1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_tornado2( ver )
  for i = 2, 5 do
    local sobj = alife():object( "av_pesh_tornado" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_av_pesh_tuman1( ver )
  for i = 1, 10 do
    local sobj = alife():object( "av_pesh_tuman" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_labirint_arhara_anom17( ver )
  for i = 17, 18 do
    local sobj = alife():object( "labirint_arhara_anom" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_av_pesh_dum1( ver )
  local sobj = alife():object( "av_pesh_dum1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_labirint_arhara_anom19( ver )
  local sobj = alife():object( "labirint_arhara_anom19" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_propeller_labirint( ver )
  local sobj = alife():object( "propeller_labirint" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_peshera_zone_zharka_static_average_0000( ver )
  local sobj = alife():object( "av_peshera_zone_zharka_static_average_0000" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_tuman13_grot( ver )
  local sobj = alife():object( "av_pesh_tuman13_grot" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_tuman12( ver )
  local sobj = alife():object( "av_pesh_tuman12" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_zone_ogon1( ver )
  local sobj = alife():object( "av_pesh_zone_ogon1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_av_pesh_zone_ogon_strong2( ver )
  local sobj = alife():object( "av_pesh_zone_ogon_strong2" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_marsh_campfires5( ver )
  dsh.create_campfire(
    vector():set( 138.86770629883,0.39024665951729,-52.323390960693 ),
    219201, 3472,
    nil, 0.7
  )
end


function fix_esc_fanat( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "escape_lager_complete" ) then return end
  local sobj = alife():story_object( story_ids.esc_lager_leader )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
    alife():create( alife():spawn_id( story_ids.esc_lager_leader ) )
  end
end


function fix_adr_shkatulka( ver )
  local sobj = alife():create(
    "physic_object",
     vector():set( -115.33219146729,26.656785964966,449.97320556641 ),
     150247, 2973
  )
  sobj.angle = vector():set( 0, 0, 1 )
  pk = get_netpk( sobj, 1 )
  ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
  data = pk:get()
  data.custom_data:setString( "[collide]\nignore_static\n[ph_heavy]\n" )
  data.visual_name = "objects\\vagonetka\\vagonetka_01"
  data.physic_type = 3
  data.mass        = 1000
  data.fixed_bones = "root1"
  pk:set( data )
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )

  if ver > 0 then
    dsh.alife_find_and_release({ "m_teleport_labirint1" })
  end
  sobj = spawn_teleport.create_teleport(
    "m_teleport_labirint1",
    vector():set( -78.003311157227, 51.731468200684, 490.76654052734 ),
    153807, 2987
  )
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
end


function fix_vertolet_td( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "borov_11_done" ) then return end
  local sobj = alife():object( "vertolet_td" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_esc_bridge_kill_zone( ver )
  local sobj = alife():object( "esc_bridge_kill_zone" )
  local pk   = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 2, -1 do
    log2(
      "[%s]: fix %s (%s): remove shape %d",
      script_name(), sobj:name(), sobj.level_name, i
    )
    data.shapes:remove( i )
  end
  pk:set( data )

  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "zone_radioactive_killing"
      and sobj.level_name == "l01_escape"
    then
      local sr = sobj:get_space_restrictor()
      log2(
        "[%s]: fix %s.m_restrictor_type: %s -> %s",
        script_name(), sobj:name(), sr.restrictor_type,
        global_flags.eRestrictorTypeNone
      )
      sr.restrictor_type = global_flags.eRestrictorTypeNone
    end
  end

  sobj = alife():create(
    "zone_radioactive_killing",
    vector():set( 6.57999992370605, 22.1800003051758, 157.169998168945 ),
    51068, 58
  )
  pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 36, 0, 0 ),
    vector():set(  0, 7, 0 ),
    vector():set(  0, 0, 9 ),
    vector():set(  0, 0, 0 )
  )
  pk:set( data )
  sobj = alife():object( sobj.id )
  local sr = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eRestrictorTypeNone
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )

  sobj = alife():create(
    "zone_radioactive_killing",
    vector():set( 202.812103271484, 22.8399963378906, 195.573654174805 ),
    499167, 148
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 110, 0,  0 ),
    vector():set(   0, 7,  0 ),
    vector():set(   0, 0, 13 ),
    vector():set(   0, 0,  0 )
  )
  pk:set( data )
  sobj.angle = vector():set( 0, 0.499599993228912, 0 )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eRestrictorTypeNone
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )

  sobj = alife():create(
    "zone_radioactive_killing",
    vector():set( 135.8759765625, 21.5040016174316, 162.806121826172 ),
    440393, 241
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 40, 0,  0 ),
    vector():set(  0, 7,  0 ),
    vector():set(  0, 0, 12 ),
    vector():set(  0, 0,  0 )
  )
  pk:set( data )
  sobj.angle = vector():set( 0, 0.265599995851517, 0 )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eRestrictorTypeNone
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )

  sobj = alife():create(
    "zone_radioactive_killing",
    vector():set( 104.275238037109, 21.7239933013916, 157.380081176758 ),
    430680, 240
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 27, 0,  0 ),
    vector():set(  0, 7,  0 ),
    vector():set(  0, 0, 10 ),
    vector():set(  0, 0,  0 )
  )
  pk:set( data )
  sobj.angle = vector():set( 0, 0.109999999403954, 0 )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eRestrictorTypeNone
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
end


function fix_kordon_campfires2( ver )
  -- У Сидора
  dsh.create_candle(
    vector():set( -245.7477722168, -23.893182754517, -133.40132141113 ),
    12073, 4, "physics\\decor\\gas_burner"
  )
end


function fix_darkvalley_campfires2( ver )
  -- У Борова на столе
  dsh.create_candle(
    vector():set( 41.209213256836, 5.4473195075989, -84.081413269043 ),
    226112, 1100, "physics\\decor\\gas_burner"
  )
end


function fix_bar_campfires2( ver )
  -- У Бармена
  dsh.create_candle(
    vector():set( 127.75353240967, -3.6054322719574, 22.033689498901 ),
    35659, 1238, "physics\\decor\\gas_burner"
  )

  -- За Ворониным лампадка
  dsh.create_candle(
    vector():set( 226.54, -4.3441295623779, 132.79783630371 ),
    57240, 1198, "physics\\decor\\gas_burner"
  )
end


function fix_labirint_campfires2( ver )
  -- Костер в Лабиринте, перед телепортом по шкатулке.
  dsh.create_campfire(
    vector():set( -74.173973083496, 48.984378814697, 490.6999206543 ),
    154067, 2987,
    "objects\\koster_negorit", 0.7
  )
end


function fix_garbage_campfires2( ver )
  -- под плитами, где бандиты тусовались
  dsh.create_campfire(
    vector():set( 71.731178283691,0.32807714343071,-150.93124389648 ),
    242846, 289,
    "objects\\fireplace\\fireplace_3"
  )
end


function fix_amk_embankment_soldat1( ver )
  for i = 1, 5 do
    local sobj = alife():object( "amk_embankment_soldat" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_m_teleport_9( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_amk_recipt_sopl_dikoobraz" ) then return end
  local sobj = alife():story_object( story_ids.m_teleport_9 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.remove_m_teleport_9()
  end
end


function fix_bar_radiation( ver )
  local sobj = alife():create(
    "zone_radioactive_killing",
    vector():set( 356.699005126953, 11.3539953231812, -139.671401977539 ),
    62100, 1266
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 50,  0,  0 ),
    vector():set(  0, 10,  0 ),
    vector():set(  0,  0, 10 ),
    vector():set(  0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( 9.69666862487793,-2.14969778060913,-1.16335988044739 ),
    vector():set( 1.51507592201233,6.83407163619995,-1.30385142682599e-008 ),
    vector():set( 1.13578355312347,-0.251796901226044,9.93209838867188 ),
    vector():set( -26.5826721191406,0.0097808837890625,0.692352294921875 )
  )
  data.shapes:addBox(
    vector():set( 22.1610069274902,-4.91297292709351,-10.4762773513794 ),
    vector():set( 1.51507592201233,6.83407163619995,-1.30385142682599e-008 ),
    vector():set( 4.09117889404297,-0.906991839408875,9.07962608337402 ),
    vector():set( -38.5344848632813,2.00593566894531,4.99144744873047 )
  )
  data.shapes:addBox(
    vector():set( 25.5069446563721,-5.65474843978882,-23.2898998260498 ),
    vector():set( 1.51507592201233,6.83407163619995,-1.30385142682599e-008 ),
    vector():set( 6.49652481079102,-1.44024360179901,7.46463966369629 ),
    vector():set( -60.808349609375,6.71858596801758,20.8742904663086 )
  )
  data.shapes:addBox(
    vector():set( 4.27758598327637,-0.948317110538483,-8.98904514312744 ),
    vector():set( 1.51507592201233,6.83407163619995,-1.30385142682599e-008 ),
    vector():set( 7.89837217330933,-1.75102543830872,3.94329929351807 ),
    vector():set( -74.8192749023438,9.44574356079102,34.7203063964844 )
  )
  data.shapes:addBox(
    vector():set( -3.01771378517151,0.66901046037674,32.8549194335938 ),
    vector():set( 1.51507592201233,6.83407163619995,-1.30385142682599e-008 ),
    vector():set( -9.72003841400146,2.15487909317017,-0.936661303043365 ),
    vector():set( -78.2279052734375,9.65446472167969,54.191577911377 )
  )
  pk:set( data )
  sobj.angle = vector():set( 0, -0.0957999974489212, -0.218165993690491 )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eRestrictorTypeNone
  log2(
    "[%s]: spawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
end


function fix_agroprom_campfires3( ver )
  -- у труб недалеко от автобуса
  local sobj = dsh.create_campfire(
    vector():set( 78.9400024414063, 0.0469999983906746, -0.91100001335144 ),
    314480, 587,
    "objects\\fireplace\\fireplace_2"
  )
  sobj.angle = vector():set( 0, -1.24000000953674, 0 )
end


function fix_prizrak_tainiy_talk( ver )
  if ver == 0 then return end
  if db.actor:has_info( "prizrak_tainiy_start" ) then
    log2( "[%s]: fix prizrak_tainiy_start", script_name() )
    db.actor:give_info_portion( "prizrak_tainiy_talk" )
  end
end


function fix_darkvalley_campfires3( ver )
  -- Лампадка в ТД на сейфе
  dsh.create_candle(
    vector():set( 94.628120422363, 5.7238764762878, -13.476240158081 ),
    289430, 986, "physics\\decor\\gas_burner"
  )
end


function fix_pripyat_campfires3( ver )
  -- Лампадка в Припяти, где сейф стоит
  dsh.create_candle(
    vector():set( -80.235313415527, 0.0050496384501457, 269.44299316406 ),
    53489, 2164, "physics\\decor\\gas_burner"
  )
end


function fix_warlab_campfires3( ver )
  -- лампадка у Лентяя
  dsh.create_candle(
    vector():set( 24.4187431335449,-4.99438858032227,11.1213130950928 ),
    7465, 3218, "physics\\decor\\gas_burner"
  )
end


function fix_rs_mt_texload( ver )
  cmd2( "rs_mt_texload", "off" )
end


function fix_radar_campfires3( ver )
  -- Лампадка в комнатке под вышкой
  dsh.create_candle(
    vector():set( -30.075981140137, 1.181572675705, -47.75163269043 ),
    667, 1961, "physics\\decor\\gas_burner"
  )
end


function fix_info_artmod_globus( ver )
  if ver == 0 then return end
  if db.actor:has_info( "info_artmod_globus" ) then
    log2( "[%s]: fix info_artmod_globus", script_name() )
    db.actor:disable_info_portion( "info_artmod_globus" )
  end
end


function fix_spawn_bunker_sekret() end

function fix_spawn_bunker_sekret2( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "mesto_v_bunkere_start" )
    and db.actor:dont_has_info( "mesto_v_bunkere_done" )
  then
    local t = {}
    for id, sobj in alife():objects() do
      if
        sobj:section_name() == "mulyz_bomba"
        or sobj:section_name() == "osnova_fotik"
        or sobj:section_name() == "neizv_zapiska"
      then
        table.insert( t, sobj )
      end
    end
    for _, sobj in ipairs( t ) do
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end  
end


function fix_molniy_posle_foto_restrictor( ver )
  local sobj = alife():object( "molniy_posle_foto_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_space_restrictor_vagonchik( ver )
  local sobj = alife():object( "space_restrictor_vagonchik" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_val_fireball( ver )
  local sobj = alife():object( "val_fireball" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_limansk_campfires3( ver )
  dsh.create_campfire(
    vector():set( 23.96201133728,-2.9830753803253,39.603073120117 ),
    39658, 3015
  )
end


function fix_dcity_tarakanovo_stvol( ver )
  for _, name in ipairs({ "dcity_tarakanovo_stvol", "red_wpn_rg-6" }) do
    local sobj = alife():object( name )
    if sobj and sobj.parent_id == 65535 then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_perehov_naruzhu_restrictor( ver )
  for _, name in ipairs({
    "perehov_naruzhu_restrictor", "ynt_after_perexod_sms_restrictor"
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_door_hospital_01_r_0001( ver )
  for _, name in ipairs({
    "door_hospital_01_r_0001",
    "door_hospital_01_l_0001",
    "door_hospital_01_r_0002",
    "door_hospital_01_l_0002",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_video_black_first_restrictor( ver )
  local sobj = alife():object( "video_black_first_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_spawn_svalka_plot_stalk_restrictor( ver )
  local sobj = alife():object( "spawn_svalka_plot_stalk_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_marsh_sniper_respawn( ver )
  if ver == 0 then return end
  local resp = alife():object( "marsh_sniper_respawn" )
  if not resp then return end
  local ids = {}
  for _, id in ipairs( resp.spawned_obj ) do
    table.insert( ids, id )
  end
  for _, id in ipairs( ids ) do
    local sobj = alife():object( id )
    if sobj then
      local strn_id = sobj:smart_terrain_id()
      if strn_id == 65535 and not resp:is_waiting_register_npc( id ) then
        log2(
          "[%s]: remove %s (%s) from %s",
          script_name(), sobj:name(), sobj.level_name, resp:name()
        )
        resp:remove_spawned( id )
        dsh.release_mob( sobj )
      end
    end
  end
  log2(
    "[%s]: %s left in %s",
    script_name(), table.getn( resp.spawned_obj ), resp:name()
  )
end


function fix_dead_city_campfires( ver )
  -- Лампадка на чердаке деревянного дома.
  dsh.create_candle(
    vector():set( 24.168851852417, 12.1722240448, -134.13114929199 ),
    383176, 3646, "physics\\decor\\gas_burner"
  )
  -- Костер под мостом
  dsh.create_campfire(
    vector():set( -253.77249145508, 0.35326644778252, -135.44525146484 ),
    92912, 3594,
    "objects\\koster_palki_nastil", 0.7
  )
  -- Лампадка на подоконнике в Темном хуторе
  dsh.create_candle(
    vector():set( -115.93145751953, 9.8273801803589, -178.63050842285 ),
    222975, 3614, "physics\\decor\\gas_burner"
  )
  -- Лампадка слева от Парфюмера
  dsh.create_candle(
    vector():set( -217.18643188477, 2.13938331604, 95.826728820801 ),
    120155, 3600, "physics\\decor\\gas_burner"
  )
  -- Лампадка на чердаке дома, откуда надо стрелять.
  dsh.create_candle(
    vector():set( -129.25788879395, 19.346429824829, 92.497634887695 ),
    209385, 3604, "physics\\decor\\gas_burner"
  )
end


function fix_playboy( ver )
  local t = {
    [ "playboy1"  ] = { vector():set( 138.57, -3.5, 22.0 ), 37466, 1237 },
    [ "playboy2"  ] = { vector():set( 112.87, -1.94, 1.6 ), 413895, 117 },
    [ "playboy3"  ] = { vector():set( -212.99, -22.51, -126.06 ), 40605, 59 },
    -- Агропром
    [ "playboy4"  ] = { vector():set( -156.23, 1.54, -162.05 ), 82783, 669 },
    [ "playboy5"  ] = { vector():set( -19.52, -3.22,-19.91 ), 287481, 1593 },
    [ "playboy6"  ] = { vector():set( -52.11, -10.52, 35.31 ), 257284, 1608 },
    [ "playboy7"  ] = { vector():set( 41.4, 5.45, -84.15 ), 226116, 1100 },
    [ "playboy8"  ] = { vector():set( -135.57, 1.29, -523.72 ), 22097, 832 },
    [ "playboy9"  ] = { vector():set( -6.19, -4.21, 201.42 ), 94368, 2195 },
    -- для Петренко
    [ "playboy10" ] = {
      vector():set( 305.24737548828, -38.332670593262, -20.833980560303 ),
      68330, 1930
    },
    -- у Сяка
    [ "playboy11" ] = {
      vector():set( 30.862739562988, -2.3824664592743, -41.449520111084 ),
      20510, 1997
    },
    [ "playboy12" ] = {
      vector():set( 139.89819335938, -6.5692377090454, -72.478149414063 ),
      577165, 2830
    },
    [ "playboy13" ] = {
      vector():set( 292.20834350586, 13.639252662659, -155.84591674805 ),
      325954, 3531
    },
  }
  if ver > 0 then
    local found, keep = {}, {}
    for _, sobj in alife():objects() do
      local args = t[ sobj:section_name() ]
      if args and sobj.parent_id == 65535 then
        local pos, lvid, gvid = unpack( args )
        if sobj.m_game_vertex_id == gvid then
          keep[ sobj:section_name() ] = true
          table.insert( found, sobj )
        end
      end
    end
    for sect, _ in pairs( t ) do
      if not keep[ sect ] then
        t[ sect ] = nil
      end
    end
    for _, sobj in ipairs( found ) do
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
  for sect, v in pairs( t ) do
    local sobj = alife():create( sect, unpack( v ) )
    sobj = alife():object( sobj.id )
    sobj:used_ai_locations( false )
    log2( "[%s]: create %s (%s)", script_name(), sobj:name(), sobj.level_name )
  end
end


function fix_military_campfires2( ver )
  -- Лампадка напротив Повара
  dsh.create_candle(
    vector():set( -76.6162109375,-11.350047111511,26.8508644104 ),
    236284, 1595, "physics\\decor\\gas_burner"
  )
end


function fix_warlab_sms1_space_restrictor( ver )
  for _, name in ipairs({
    "warlab_sms1_space_restrictor",
    "spawn_sklad_space_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_rad_code_door_keylock( ver )
  local sobj = alife():object( "rad_code_door_keylock" )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local ini = sobj:spawn_ini()
    ini.readonly = false
    ini:w_bool( "collide", "ignore_dynamic", true )
    ini:w_bool( "collide", "ignore_ragdoll", true )
    ini:w_bool( "collide", "ignore_static",  true )
    sobj:save_spawn_ini()
  end
end


function fix_gg_pili_sms_restrictor( ver )
  for _, name in ipairs({
    "gg_pili_sms_restrictor",
    "pili_gg_otvet_sms_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_yan_pri1( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "yan_pri1_info" ) then return end  
  local sobj = alife():story_object( story_ids.exit_yan_pri1 )
  if sobj then
    log2(
      "[%s]: fixing exit_yan_pri1[%s][%s]",
      script_name(), sobj:name(), sobj.level_name
    )
    for id, sobj2 in alife():objects() do
      if
        sobj2.level_name == sobj.level_name
        and sobj2.m_level_vertex_id == sobj.m_level_vertex_id
        and sobj2:section_name() == "zone_teleport"
      then
        log2( "[%s]:   release %s", script_name(), sobj2:name() )
        alife():release( sobj2 )
        break
      end
    end
    alife():release( sobj )
  end
  braad_test.yan_pri1()
end


function fix_esc_lager_guard_kill_zone( ver ) end

function fix_esc_lager_guard_kill_zone2( ver )
  if ver == 0 then return end
  local sobj = alife():object( "esc_lager_guard_kill_zone" )
  if not sobj then
    log2( "[%s]: respawn esc_lager_guard_kill_zone", script_name() )
    sobj = alife():create( 3056 )
  end
end


function fix_val_wpn_mp5( ver )
  for _, name in ipairs({
    "val_wpn_mp5",
    "val_wpn_mp5_0000",
    "mar_wpn_mp5",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_voronin_voen_sms_restrictor( ver )
  for _, name in ipairs({
    "voronin_voen_sms_restrictor",
    "chaes_spawn_vse_restrictor",
    "chaes2_kluk_sms_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
  if
    db.actor:has_info( "voronin_samopisez_start" )
    and db.actor:dont_has_info( "chaes_spawn_vse" )
  then
    log2( "[%s]: arhara_spawn_chaes_pilot_zapiska()", script_name() )
    arhara_dialog.spawn_chaes_pilot_zapiska()
  end
end


function fix_add_new_radar_106( ver )
  if db.actor:has_info( "info_way106a" ) then
    log2( "[%s]: start timer sak.remove_new_radar_106", script_name() )
    ogse_st_mgr.start_gtimer(
      "sak.remove_new_radar_106", math.random( 12, 20 ) * 3600,
      "sak.remove_new_radar_106"
    )
  end
end


function fix_bunker_kontr_strong1( ver )
  for _, name in ipairs({
    "bunker_kontr_strong1",
    "bunker_kontr_strong2",
    "bunker_kontr_strong3",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_pri1_lab( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.exit_pripyat_to_labx8 )
  if sobj and level.map_has_object_spot( sobj.id, "level_changer3" ) == 0 then
    log2(
      "[%s]: assing level_changer3 to %s (%s)",
      script_name(), sobj:name(), sobj.level_name
    )
    level.map_add_object_spot_ser(
      sobj.id, "level_changer3", "to_x8"
    )
  end
end


function fix_contr_forest2( ver )
  for _, name in ipairs({
    "contr_forest2",
    "red_m_controller_old",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_kat2_m_controller_old_0000( ver )
  local sobj = alife():object( "kat2_m_controller_old_0000" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_a_inventory_box40( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "a_inventory_box40" then
      log2(
        "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
      akill.sherstuk_mayak_spawn()
      break
    end
  end
end


function fix_mar_physic_object_0053( ver )
  for _, name in ipairs({
    "mar_physic_object_0053",
    "mar_physic_object_0054",
    "mar_physic_object_0077",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_hud_fov( ver )
  log2( "[%s]: fix hud_fov", script_name() )
  cmd2( "fov", "75." )
  cmd2( "hud_fov", "30." )
end


function fix_snayperka_zombi_restrictor( ver )
  local sobj = alife():object( "snayperka_zombi_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_r2_ignore_actor_torch( ver )
  log2( "[%s]: fix r2_ignore_actor_torch", script_name() )
  cmd2( "r2_ignore_actor_torch", "on" )
end


function fix_snd_device( ver )
  log2( "[%s]: fix snd_device", script_name() )
  cmd2( "snd_device", "OpenAL Soft" )
end


function fix_red_level_changer_to_puzir( ver )
  local sobj = alife():story_object( story_ids.red_level_changer_to_puzir )
  log2(
    "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
  lc   = sobj:get_level_changer()
  lc.dest_game_vertex_id  = 1848
  lc.dest_level_vertex_id = 420
  lc.dest_position        = vector():set( -381.280364990234,-14.0306663513184,398.204193115234 )
  lc.dest_direction       = vector():set( 0, -1.5, 0 )
  if ver > 0 then
    level.map_change_spot_hint(
      sobj.id, "level_changer2", "to_military"
    )
  else
    level.map_add_object_spot_ser(
      sobj.id, "level_changer2", "to_military"
    )
  end
end


function fix_mil_to_red_forest( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.radar_to_red_forest )
  if not sobj then return end
  log2(
    "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
  alife():release( sobj )
  if dsh.actor_was_here( "red_forest" ) then
    local sobj = dsh.respawn_exit_to_rostok_105()
    log2(
      "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
  else
    log2( "[%s]: create atp_to_red_forest", script_name() )
    sak.add_new_radar_na_red_forest()
  end
end


function fix_land_sniper_chimaera()
  if level.name() == "aver" then
    local sobj = alife():object( "land_sniper_chimaera" )
    if sobj then
      local patrol = patrol( "sniper_chimaera_walk" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_land_arhara_sniper_sp( ver )
  for i = 1, 8 do
    local sobj = alife():object( "land_arhara_sniper_sp_" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_aver_arhara_mine( ver )
  for i = 1, 17 do
    local sobj = alife():object( "aver_arhara_mine_" .. i )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_aver_filin()
  if level.name() == "aver" then
    local sobj = alife():object( "aver_filin" )
    if sobj then
      local patrol = patrol( "aver_filin_walk" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_running_treasure()
end

function fix_running_treasure2( ver )
  local tn = "dsh_running_treasure.clear_rnd_treasure"
  if ver > 0 and ogse_st_mgr.timer_exists( tn ) then return end
  log2( "[%s]: fix %s", script_name(), tn )
  dsh.start_gtimerDHMS(
    tn,
    0, math.random( 20, 24 * 7 ), 0, 0,
    "dsh_running_treasure.spawn_rnd_treasure"
  )
end


function fix_l05_bar_sr_gruzovik( ver )
  local sobj = alife():create(
    "space_restrictor",
    vector():set( 384.278594970703, 18.2006683349609, -252.488967895508 ),
    86030, 1287
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 4, 0, 0 ),
    vector():set( 0, 8, 0 ),
    vector():set( 0, 0, 8 ),
    vector():set( 0, 0, 0 )
  )
  pk:set( data )
  sobj.angle = vector():set(
    -0.025184690952301, -0.000285975984297693, -0.0113558657467365
  )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eDefaultRestrictorTypeIn
  alife():assign_story_id( sobj.id, story_ids.l05_bar_sr_gruzovik )
  log2(
    "[%s]: spawn l05_bar_sr_gruzovik: %s (%s)",
    script_name(), sobj:name(), sobj.level_name
  )
end


function fix_r2_ls_depth_bias( ver )
  log2( "[%s]: fix r2_ls_depth_bias", script_name() )
  cmd2( "r2_ls_depth_bias", "-0.0003" )
end


function fix_aes_space_restrictor_timer( ver )
  for _, name in ipairs({
    "aes_space_restrictor_timer",
    "aes_space_restrictor_sound_0050",
    "aes_space_restrictor_sound_0051",
    "aes_space_restrictor_sound_0052",
    "aes_space_restrictor_sound_0053",
    "aes_space_restrictor_weather",
    "aes2_space_restrictor_death_0000",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_atp_dcity_pobeg_restrictor( ver )
  for _, name in ipairs({
    "atp_dcity_pobeg_restrictor",
    "sms_zlobnomu_rasstrel_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_keypress_on_start( ver )
  log2( "[%s]: fix keypress_on_start", script_name() )
  cmd2( "keypress_on_start", "off" )
end


function fix_l05_bar_sr_za_garikom( ver )
  local sobj = alife():create(
    "space_restrictor",
    vector():set( 125.060050964355, -4.82401561737061, 22.1461448669434 ),
    86030, 1287
  )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.shapes:addBox(
    vector():set( 3.5, 0, 0 ),
    vector():set( 0,   7, 0 ),
    vector():set( 0,   0, 1 ),
    vector():set( 0,   0, 0 )
  )
  pk:set( data )
  sobj.angle = vector():set(
    -5.04716581417597e-006, -1.19628983063743e-015, -2.41580200288638e-010
  )
  sobj = alife():object( sobj.id )
  sr   = sobj:get_space_restrictor()
  sr.restrictor_type = global_flags.eDefaultRestrictorTypeIn
  alife():assign_story_id( sobj.id, story_ids.l05_bar_sr_za_garikom )
  log2(
    "[%s]: spawn l05_bar_sr_za_garikom: %s (%s)",
    script_name(), sobj:name(), sobj.level_name
  )
end


function fix_privyzka_generatorov_restrictor( ver )
  local sobj = alife():object( "privyzka_generatorov_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_aver_m_poltergeist_strong_flame_0001( ver )
  for i, name in ipairs({
    "aver_m_poltergeist_strong_flame_0001",
    "aver_m_poltergeist_strong_flame_0002",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_aver_wpn_desert_eagle( ver )
  for i, name in ipairs({
    "aver_wpn_desert_eagle",
    "aver_wpn_g36",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_door_yantar_u_01( ver )
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "l08u_brainlab"
      and sobj.m_level_vertex_id == 365
    then
      local ini = sobj:spawn_ini()
      if ini:section_exist( "logic" ) then
        local cfg = get_string( "logic", "cfg", nil, ini )
        if cfg == "scripts\\yan\\yan_grate.ltx" then
          log2(
            "[%s]: release %s (%s)", script_name(),
            sobj:name(), sobj.level_name
          )
          dsh_alife.release( sobj )
          break
        end
      end
    end
  end
end


function fix_mil_physic_object_0009( ver )
  -- таскаемый сейф рядом со Скрягой, в углу
  local sobj = alife():object( "mil_physic_object_0009" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_r2_shader_cache( ver )
  log2( "[%s]: fix r2_shader_cache", script_name() )
  cmd2( "r2_shader_cache", "off" )
  log2( "[%s]: fix r3_msaa_alphatest", script_name() )
  cmd2( "r3_msaa_alphatest", "st_opt_atest_msaa_dx10_1" )
  cmd2( "r3_use_dx10_1", "on" )
end


function fix_r3_dynamic_wet_surfaces_enable_streaks( ver )
  log2( "[%s]: fix r3_dynamic_wet_surfaces_enable_streaks", script_name() )
  cmd2( "r3_dynamic_wet_surfaces_enable_streaks", "0" )
end


function fix_marsh_kosoi_shesterka1( ver )
  for i, name in ipairs({
    "marsh_kosoi_shesterka1",
    "marsh_kosoi_shesterka2",
    "marsh_kosoi_shesterka3",
    "marsh_kosoi_shesterka4",
    "marsh_kosoi_shesterka5",
    "marsh_kosoi_shesterka7",
    "marsh_sych_stalk3",
    "marsh_sych_stalk4",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_spawn_teleport3( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "kostya_art_start" ) then
    kostya_dialog.delete_teleport( "m_teleport_3" )
  else
    local t = {}
    for id, sobj in alife():objects() do
      if sobj:section_name() == "m_teleport_3" then
        table.insert( t, sobj )
      end
    end
    if db.actor:dont_has_info( "kostya_art_done" ) then
      table.remove( t, 1 )
    end
    for _, sobj in ipairs( t ) do
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_blockpost_case_spawn( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "escape_blockpost_case_done" )
    or db.actor:dont_has_info( "escape_blockpost_case" )
  then
    return
  end
  local sid = story_ids.Escape_blockpost_case
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "quest_case_01"
      and sobj.level_name == "l01_escape"
    then
      log2(
        "[%s]: found %s (%s), assign story_id %s",
        script_name(), sobj:name(), sobj.level_name, sid
      )
      alife():assign_story_id( sobj.id, sid )
      break
    end
  end
end


function fix_stalk_kluk( ver )
  if ver > 0 then
    local sobj = alife():object( "stalk_kluk" )
    if sobj then
      dsh_alife.release( sobj )
      sobj = alife():create( 992 )
      log2(
        "[%s]: respawned %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
    end
  end
  local sobj = alife():object( "kluk_sklad" )
  if sobj then
    dsh.release_mob( sobj )
    sobj = alife():create( 7596 )
    local sid = story_ids.stalk_kluk
    log2(
      "[%s]: respawned %s (%s), assign story_id %s",
      script_name(), sobj:name(), sobj.level_name, sid
    )
    alife():assign_story_id( sobj.id, sid )
  end
end


function fix_warlab_arhara_matras_3( ver )
  local sobj = alife():object( "warlab_arhara_matras_3" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_body_pantera_talk_start( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "body_pantera_talk_start" )
    and db.actor:dont_has_info( "body_pantera_talk_done" )
  then
    news_manager.skip_send_task = true
    log2( "[%s]: complete 'body_pantera' task", script_name() )
    for i = 0, 2 do
      level_tasks.set_task_state( task.completed, "body_pantera", i )
    end
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
    for id, sobj in alife():objects() do
      if
        sobj:section_name() == "chuchelo_body"
        and sobj.level_name == "l07_military"
      then
        log2(
          "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh_alife.release( sobj )
        break
      end
    end
  end
end


function fix_warlab_skladu_level_changer( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.warlab_skladu_level_changer )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_agro_torgash_heli( ver )
  for i, name in ipairs({
    "agro_torgash_heli",
    "agro_torgash_sms_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
  local sobj = alife():object( "agro_mobil_torgash" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_atp_mobil_torgovetz( ver )
  for i, name in ipairs({
    "atp_sedoy_delete_restrictor",
    "atp_sedoy_heli",
    "atp_torgovetz_sms_restrictor",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
  local sobj = alife():object( "atp_mobil_torgovetz" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_exit_to_radar_109( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.exit_to_radar_109 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_esc_fox( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "esc_fox_medkit_done" )
    and db.actor:has_info( "fox_kriss_done" )
  then
    return
  end
  local sobj = alife():object( "esc_fox" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
  sobj = alife():create(
    alife():spawn_id( story_ids.Escape_stalker_from_raid )
  )
  log2(
    "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
end


function fix_esc_tirex( ver )
  local sobj = alife():object( "esc_tirex" )
  if sobj then
    local sid = story_ids.esc_tirex
    log2(
      "[%s]: found %s (%s), assign story_id %s",
      script_name(), sobj:name(), sobj.level_name, sid
    )
    alife():assign_story_id( sobj.id, sid )
  end
end


function fix_info_spawn_zver( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "prizrak_finalzver_start" )
    and db.actor:dont_has_info( "info_spawn_zver" )
  then
    log2( "[%s]: new_spawn.spawn_zver()", script_name() )
    new_spawn.spawn_zver()
  end
end


function fix_warlab_sms2_space_restrictor( ver )
  local sobj = alife():object( "warlab_sms2_space_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_l11_pripyat_campfires( ver )
  -- Лампадка в гостинице
  dsh.create_candle(
    vector():set( 99.788520812988,4.9,123.02146911621 ),
    210923, 2183, "physics\\decor\\gas_burner"
  )
end


function fix_x18_level_changer_to_warlab( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.x18_level_changer_to_warlab )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
    db.actor:disable_info_portion( "info_way_arhara_x18_warlab" )
  end
end


function fix_exit_to_yantar_102( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.exit_to_yantar_102 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
    db.actor:disable_info_portion( "info_way102a" )
  end
end


function fix_exit_to_agroprom_103( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.exit_to_agroprom_103 )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
    db.actor:disable_info_portion( "info_way103a" )
  end
end


function fix_l11_pripyat_campfires2( ver )
  -- костер для Доктора
  local sobj = dsh.create_campfire(
    vector():set( -87.506500244141,-0.57698035240173,263.14660644531 ),
    23506, 2151,
    "objects\\fireplace\\fireplace_2"
  )
end


function fix_l11_pripyat_campfires3( ver )
  -- костер для сталкеров у перехода на Радар
  local sobj = dsh.create_campfire(
    vector():set( 0.676797747612,-2.39053916931152,-270.284240722656 ),
    102686, 2161,
    "objects\\fireplace\\fireplace_2"
  )
end


function fix_r3_dynamic_wet_surfaces_sm_res( ver )
  log2( "[%s]: fix r3_dynamic_wet_surfaces_sm_res", script_name() )
  cmd2( "r3_dynamic_wet_surfaces_sm_res", "1024" )
end


function fix_agr_pseudodog_nest1( ver )
  for i, name in ipairs({
    "agr_pseudodog_weak",
    "agr_pseudodog_weak_0000",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_agr_dog_nest1( ver )
  for i, name in ipairs({
    "agr_dog_weak",
    "agr_dog_weak_0000",
    "agr_dog_normal",
    "agr_dog_normal_0000",
    "agr_dog_normal_0001",
    "agr_dog_normal_0002",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_prapor_box( ver )
  for i, name in ipairs({
    "prapor_mafon",
    "prapor_box",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_grom_npc_spawn( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "raritet_ivancov" )
    and db.actor:dont_has_info( "raritet_saharov" )
  then
    log2( "[%s]: akill.grom_npc_spawn()", script_name() )
    akill.grom_npc_spawn()
  end
end


function fix_mil_tonnel_restrictor( ver )
  local sobj = alife():object( "mil_tonnel_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_mil_physic_object_0021( ver )
  local sobj = alife():object( "mil_physic_object_0021" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_atp_buldozer( ver )
  local sobj = alife():object( "atp_buldozer" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_kot_lekar_done( ver )
  if ver == 0 then return end
  if
    (
      db.actor:has_info( "kot_kalmyak_lekar_done" )
      or db.actor:has_info( "kot_holod_lekar_done" )
    )
    and db.actor:dont_has_info( "kot_lekar_done" )
  then
    log2( "[%s]: give kot_lekar_done", script_name() )
    db.actor:give_info_portion( "kot_lekar_done" )
  end
end


function fix_limansk_campfires4( ver )
  -- Лампадка для свободовцев в штабе
  dsh.create_candle(
    vector():set( -29.630199432373,-4.4216833114624,-261.187133789063 ),
    10606, 3001, "physics\\decor\\gas_burner"
  )
end


function fix_mil_freedom_wall_restrictor( ver )
  local sobj = alife():object( "mil_freedom_wall_restrictor" )
  local sr   = sobj:get_space_restrictor()
  log2(
    "[%s]: fix %s.m_restrictor_type: %s -> %s",
    script_name(), sobj:name(), sr.restrictor_type,
    global_flags.eDefaultRestrictorTypeIn
  )
  sr.restrictor_type = global_flags.eDefaultRestrictorTypeIn
end


function fix_red_level_changer_to_atp( ver )
  local sobj = alife():story_object( story_ids.red_level_changer_to_atp )
  log2(
    "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
  local lc = sobj:get_level_changer()
  lc.dest_game_vertex_id  = 2799
  lc.dest_level_vertex_id = 107571
  lc.dest_position        = vector():set( -186.009765625,-0.24552899599075,334.00936889648 )
  lc.dest_direction       = vector():set( 0, 3, 0 )
end


function fix_red_level_changer_to_radar( ver )
  local sobj = alife():story_object( story_ids.red_level_changer_to_radar )
  local lc   = sobj:get_level_changer()
  local old_mode = lc.silent_mode
  lc.silent_mode = 2
  log2(
    "[%s]: fix %s.silent_mode: %s -> %s",
    script_name(), sobj:name(), old_mode, lc.silent_mode
  )
  if ver == 0 then return end
  level.map_remove_object_spot( sobj.id, "level_changer1" )
end


function fix_lim_exit_to_hospital( ver )
  if db.actor:has_info( "nebo_kurier_done" ) then return end
  local sobj = alife():story_object( story_ids.lim_exit_to_hospital )
  local lc   = sobj:get_level_changer()
  local old_mode = lc.silent_mode
  lc.silent_mode = 2
  log2(
    "[%s]: fix %s.silent_mode: %s -> %s",
    script_name(), sobj:name(), old_mode, lc.silent_mode
  )
end


function fix_skadovsk_radio( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "skadovsk_radio"
      and sobj.level_name == "zaton"
    then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      break
    end
  end
end


function fix_val_phd_stul( ver )
  for i, name in ipairs({
    "val_phd_stul_0000",
    "val_phd_stul_0001",
    "val_phd_stul_0002",
    "val_phd_stul_0003",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_a_inventory_box32( ver )
  if ver == 0 then return end
  if db.actor:has_info( "taynik_bandit_x18_start" ) then
    for id, sobj in alife():objects() do
      if
        sobj:section_name() == "a_inventory_box32"
        and sobj.level_name == "l04_darkvalley"
      then
        log2(
          "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh_alife.release( sobj )
        akill.taynik_grom_spawn()
        break
      end
    end
  end
end


function fix_pri_depot( ver )
  for i, name in ipairs({
    "pri_depot_controller1",
    "pri_depot_controller2",
    "pri_depot_controller3",
    "pri_depot_pseudodog_normal_0000",
    "pri_depot_pseudodog_normal_0001",
    "pri_depot_pseudodog_normal_0002",
    "pri_depot_pseudodog_normal_0003",
    "pri_depot_pseudodog_normal_0004",
    "pri_depot_pseudodog_strong_0000",
    "pri_depot_pseudodog_strong_0001",
    "pri_depot_pseudodog_strong_0002",
    "pri_depot_psydog_0000",
  }) do
    local sobj = alife():object( name )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_esc_dead_tunel_novice( ver )
  if db.actor:has_info( "esc_find_railroad_passage_start" ) then return end
  local sobj = alife():story_object( story_ids.esc_dead_tunel_novice )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_dan_flash( ver )
  if db.actor:has_info( "dan_flash_done" ) then return end
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "nauch_flash"
      and sobj.level_name == "l04u_labx18"
    then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      break
    end
  end
  if db.actor:has_info( "dan_flash_start" ) then
    log2( "[%s]: fix dan_flash_start", script_name() )
    new_dialog.dan_flash_start()
  end
end


function fix_hospital_wooden_board_01_0000( ver )
  local sobj = alife():object( "hospital_wooden_board_01_0000" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_black_doctor( ver )
  if ver > 0 and db.actor:has_info( "black_doctor_finish_dialog" ) then
    return
  end
  local sobj = alife():story_object( story_ids.black_doctor )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local patrol = patrol( "black_first_doctor_walk" )
    alife():teleport_object(
      sobj.id, patrol:point( 0 ),
      patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
    )
  end
end


function fix_kot_find_black_doctor( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "kot_find_rabi_done" )
    and db.actor:dont_has_info( "black_doctor_finish_dialog" )
  then
    log2( "[%s]: fix kot_find_black_doctor", script_name() )
    news_manager.skip_send_task = true
    db.actor:give_info_portion( "kot_find_black_doctor_start" )
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
  end
end


function fix_on_tunel_restr( ver )
  local sobj = alife():object( "on_tunel_restr" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_forest_wound( ver )
  local sobj = alife():object( "forest_wound" )
  if sobj then
    local sid = story_ids.forest_wound
    log2(
      "[%s]: found %s (%s), assign story_id %s",
      script_name(), sobj:name(), sobj.level_name, sid
    )
    alife():assign_story_id( sobj.id, sid )
  end
end


function fix_red_level_changer_to_limansk( ver )
  local sobj = alife():story_object( story_ids.red_level_changer_to_limansk )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():teleport_object(
      sobj.id, vector():set( -195, 2.24, -305 ), 525, 3224
    )
  end
end


function fix_exit_from_limansk( ver )
  local sobj = alife():story_object( story_ids.exit_to_red_forest_from_limansk )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local lc = sobj:get_level_changer()
    lc.dest_game_vertex_id  = 3232
    lc.dest_level_vertex_id = 1574
    lc.dest_position        = vector():set( -193.24174499512, 0.1369616985321, -300.38729858398 )
  end
end


function fix_kluk_pripyt_derevny_sms( ver )
  local sobj = alife():object( "kluk_pripyt_derevny_sms" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_village_piligrim( ver )
  local sobj = alife():object( "village_piligrim" )
  if sobj then
    local sid = story_ids.village_piligrim
    log2(
      "[%s]: found %s (%s), assign story_id %s",
      script_name(), sobj:name(), sobj.level_name, sid
    )
    alife():assign_story_id( sobj.id, sid )
  end
  if ver == 0 then return end
  if
    db.actor:has_info( "village_piligrim_spawn" )
    and db.actor:dont_has_info( "derevny_plen_start" )
    and db.actor:dont_has_info( "village_piligrim_find" )
  then
    log2( "[%s]: fix village_piligrim_find", script_name() )
    news_manager.skip_send_task = true
    db.actor:give_info_portion( "village_piligrim_find" )
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
  end
end


function fix_village_pantera_otvet_restrictor( ver )
  local sobj = alife():object( "village_pantera_otvet_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_village_sms_kap_restrictor( ver )
  for _, n in ipairs({
    "limansk_kluk_vopros1_sms",
    "marsh_kluk_perexod_derevny",
    "village_sms_kap_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
  if ver == 0 then return end
  if
    db.actor:has_info( "kolmogor_obsledovanie_done" )
    and db.actor:dont_has_info( "boloto_provod_spawn" )
  then
    arhara_dialog.kluk_perexod_derevny()
  end
end


function fix_lost_village_heli_1( ver )
  if db.actor:has_info( "village_heli_go" ) then return end
  for _, n in ipairs({
    "lost_village_heli_1",
    "lost_village_heli_2",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_forest_pozisiy_na_dome_restrictor( ver )
  if db.actor:has_info( "village_heli_go" ) then return end
  for _, n in ipairs({
    "del_forest_last_snip_restrictor",
    "forest_last_snip_proval_restrictor",
    "forest_pozisiy_na_dome_restrictor",
    "forest_zapiska_trup_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_generators_heli_hit( ver )
  for _, n in ipairs({
    "generators_heli_hit",
    "vert_sbit_timer_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_pili_zayti_after_antenna_restrictor( ver )
  for _, n in ipairs({
    "otsroch_sms_pantera_restrictor",
    "pili_zayti_after_antenna_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_m_teleport_dok_prip_vuhod( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "m_teleport_dok_prip_vuhod" then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      break
    end
  end
  if
    db.actor:has_info( "dok_arh_say_start" )
    and db.actor:has_info( "seensak_l11_pripyat" )
  then
    local sobj = alife():story_object( story_ids.m_teleport_prip_dok_vxod )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_aes2_tr13( ver )
  for _, n in ipairs({ "aes2_tr13", "aes2_gaz66" }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_gener_pripyat_level_changer( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_gener_pripyat" ) then return end
  local sobj = alife():story_object( story_ids.gener_pripyat_level_changer )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
    sak.add_new_gener_to_pripyat()
  end
end


function fix_podgotovka_zahvata_restrictor( ver )
  local sobj = alife():object( "podgotovka_zahvata_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_spawn_ubludky( ver )
  local ubludky = {
    "generators_monolit1_vushka1",
    "generators_monolit2_vushka2",
    "generators_monolit3_krusha",
    "generators_monolit4_krusha",
    "generators_monolit5_meshki1",
    "generators_monolit6_meshki2",
    "generators_monolit7_kamper1",
    "generators_monolit8_kamper2",
    "generators_monolit9_chas_bunker",
    "generators_monolit10_chas_budka",
    "generators_monolit11_chas_vorota",
    "generators_monolit12_perimetr1",
    "generators_monolit13_perimetr2",
    "generators_monolit14_perimetr3",
    "generators_monolit15_transform",
    "generators_monolit16_oxran_ekolog",
    "generators_monolit19_bunker1",
    "generators_monolit20_bunker2",
  }
  dsh.shuffle( ubludky )
  for i = 1, math.floor( table.getn( ubludky ) / 2 ) do
    local sobj = alife():object( ubludky[ i ] )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_dsh_deadmans( ver )
  if ver == 0 then return end
  for _, v in ipairs({
    "dsh_deadmans.deadmans_table", "ogse.deadmans_table"
  }) do
    log2( "[%s]: delete var %s", script_name(), v )
    ogse.delete_var( v )
  end
end


function fix_chaes2_kran_zone_emi1( ver )
  for _, n in ipairs({
    "chaes_arhara_heli_truba_ogon1",
    "chaes_arhara_heli_truba_ogon2",
    "chaes_arhara_heli_truba_ogon3",
    "chaes_arhara_heli_truba_ogon4",
    "chaes2_kran_zone_emi1",
    "mono_chaes2_truba_2_restrictor",
    "mono_kabina_truba_spawn_restrictor",
    "stancia2_ogon1_truba_niz",
    "stancia2_ogon2_truba_verh",
    "stancia2_tornado_truba_verh",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
  for _, n in ipairs({
    "monolit_kran_zad",
    "monolit_kran_kabina",
    "monolit_truba",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_kolmo_say_pobeda_sms_restrictor( ver )
  local sobj = alife():object( "kolmo_say_pobeda_sms_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_klenov_antena_find( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "derevny_zashita_done" )
    and db.actor:has_info( "black_doctor_finish_dialog" )
    and db.actor:dont_has_info( "klenov_antena_start" )
  then
    log2( "[%s]: fix klenov_antena_find", script_name() )
    news_manager.skip_send_task = true
    db.actor:give_info_portion( "klenov_antena_find" )
    dsh.exec_on_update( function()
      news_manager.skip_send_task = false
    end )
  end
end


function fix_sms_girl3_nachalo_restrictor( ver )
  local sobj = alife():object( "sms_girl3_nachalo_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_sms_molniy_bar_restrictor( ver )
  local sobj = alife():object( "sms_molniy_bar_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function free_smart_terrain( name, skip_npc )
  log2( "[%s]: make smart_terrain %s free", script_name(), name )
  local skip_npc_keys = {}
  if skip_npc then
    for _, v in ipairs( skip_npc ) do
      skip_npc_keys[ v ] = true
    end
  end
  local npcs = {}
  local strn = smart_terrain.get_smart_terrain_by_name( name )
  for id, v in pairs( strn.npc_info ) do
    local sobj = alife():object( id )
    if v.exclusive and not skip_npc_keys[ sobj:name() ] then
      npcs[ id ] = true
    else
      log2(
        "[%s]:   keep %s, exclusive[%s]",
        script_name(), sobj:name(), tostring( v.exclusive )
      )
    end
  end
  for _, t in pairs({ se_monster.monsters, se_stalker.stalkers }) do
    for id, sobj in pairs( t ) do
      local strn_id = sobj.waiting_smart_terrain
      if strn_id and strn_id == strn.id then
        if not skip_npc_keys[ sobj:name() ] then
          npcs[ id ] = true
        else
          log2( "[%s]:   keep %s", script_name(), sobj:name() )
        end
      end
    end
  end
  for id, _ in pairs( npcs ) do
    local sobj = alife():object( id )
    log2( "[%s]:   free %s", script_name(), sobj:name() )
    local pk = get_netpk( sobj, 1 )
    ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
    local data = pk:get()
    data.base_out_restrictors = ""
    local cd = data.custom_data:getTable()
    cd.logic          = nil
    cd.smart_terrains = nil
    cd.spawner        = nil
    data.custom_data:set( cd )
    pk:set( data )
    smart_terrain.unregister_npc( sobj )
    dsh.clear_smart_terrain_conditions( sobj )
    sobj.cached_spawner = nil
    sobj.spawner        = nil
    -- sobj:brain():update()
  end
end


function free_smart_terrains_again( ver )
  local smarts = {
    "aver_hunter",
    "aver_otshelnik",
    "bandit_zaton1",
    "bar_visitors",
    "freedom_limansk",
    "generators_svoboda",
    "green_forest",
    "hospital_black",
    "lost_village_bandit",
    "podzemka_karlushy",
    "podzemka_polterburer",
    "podzemka_karliki",
    "pri_kogots",
    "pri_zanoza",
    "pri_chimera",
    "snork_zaton_katakomb",
    "stalker_forest_bashya",
    "upiter_gigants",
    "upiter_bibliotekars",
    "upiter_kogots",
    "upi_zanoza",
    "upi_pryguny",
    "upi_zombie",
    "village_gulag_big",
    "village_gulag_small",
    "warlab_svobodovzu",
    "x_laba_karlushy",
    "x_laba_polterburer",
    "zaton_boars_flesh_izumr",
    "zaton_raton_lair_1",
    "zaton_raton_lair_2",
    "zaton_raton_lair_3",
    "zaton_ukamney_lager",
  }
  for _, n in ipairs( smarts ) do
    free_smart_terrain( n );
  end
  free_smart_terrain( "bar_ohotnik", { "stalker_green_zahar" } );
  free_smart_terrain( "kalmyak_marsh", { "kalmyak" } );
  free_smart_terrain( "marsh_exit_nebo", { "dyak", "esc_saha" } );
  free_smart_terrain( "marsh_hunters", { "marsh_dan" } );
  free_smart_terrain( "generators_orly", { "zemlyk" } );
  free_smart_terrain(
    "marsh_baza_nebo", { "clear_scy_leader", "agr_nebo_trader" }
  );
end


function fix_x16_meshes_brkbl( ver )
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "l08u_brainlab"
      and string.find( sobj:name(), "brkbl" )
    then
      table.insert( t, sobj )
      if table.getn( t ) == 2 then break end
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_warlab_kolmogor_sms_restrictor( ver )
  local sobj = alife():object( "warlab_kolmogor_sms_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
  if
    db.actor:has_info( "derevny_zashita_done" )
    and db.actor:has_info( "black_doctor_finish_dialog" )
    and db.actor:dont_has_info( "village_after_razborka" )
  then
    if level.name() == "warlab" then
      arhara_dialog.warl_kolmogor_sms2()
    else
      arhara_dialog.warl_kolmogor_sms()
    end
  end
end


function fix_sim_stalker_fraer( ver )
  local sobj = alife():object( "sim_stalker_fraer" )
  if sobj then
    local sid = story_ids.stalker_fraer
    log2(
      "[%s]: found %s (%s), assign story_id %s",
      script_name(), sobj:name(), sobj.level_name, sid
    )
    alife():assign_story_id( sobj.id, sid )
  end
end


function fix_hud_crosshair_zoom( ver )
  log2( "[%s]: hud_crosshair_zoom on", script_name() )
  cmd2( "hud_crosshair_zoom", "on" )
  cmd2( "hud_crosshair", "on" )
end


function fix_dcity_otkl_zona_shtab_restrictor( ver )
  local sobj = alife():object( "dcity_otkl_zona_shtab_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_dinam_nevid_vzryv_restrictor( ver )
  local sobj = alife():object( "dinam_nevid_vzryv_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_dcity_dok_nevidim()
  local sobj = alife():object( "dcity_dok_nevidim" )
  if sobj and sobj:alive() then
    local pk = get_netpk( sobj, 1 )
    ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
    local data = pk:get()
    local vis_name   = data.visual_name
    data.visual_name = "new\\supernevidimka_orig"
    log2(
      "[%s]: %s (%s): fix visual %s -> %s",
      script_name(), sobj:name(), sobj.level_name, vis_name, data.visual_name
    )
    pk:set( data )
  end
end


function fix_esc_foto_muzhik( ver )
  for _, n in ipairs({
    "esc_foto_muzhik",
    "zapasnoy_foto_muzhik",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end

  for _, n in ipairs({
    "kontrol_fotogr_restrictor",
    "mesto2_fotografir2_restrictor",
    "udalim_esc_fotomuzhik_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_nevid_monolit( ver )
  local sobj = alife():object( "nevid_monolit" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end

  for _, n in ipairs({
    "foto_spawn_perexod_restrictor",
    "odnonogiy1_proval1_restrictor",
    "odnonogiy_proval_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_military_fotomuzhik( ver )
  for _, n in ipairs({
    "milit_zapas_fotomuzhik",
    "military_fotomuzhik",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end

  local sobj = alife():object( "mil_zapas_mesto_fotografir_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_foto_monolitovets( ver )
  local sobj = alife():object( "foto_monolitovets" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_sak_prizrak()
  if level.name() == "l10_radar" then
    local seats = get_numbers( "dsh.xr_kamp.sak_kamp", "preferred_seats" )
    dsh.shuffle( seats )
    local sids = { story_ids.Sak }
    if db.actor:has_info( "yakut_true_done" ) then
      table.insert( sids, story_ids.new_prizrak )
    end
    for i = 1, table.getn( sids ) do
      local sobj = alife():story_object( sids[ i ] )
      if sobj and sobj:can_be_spawned() then
        local lvid = seats[ i ]
        local pos  = level.vertex_position( lvid )
        local gvid = cross_table():vertex( lvid ):game_vertex_id()
        alife():teleport_object( sobj.id, pos, lvid, gvid )
      end
    end
  end
end


function fix_stul_sak( ver )
  for _, n in ipairs({ "sak_physic_object0100",  "stul_sak_0000" }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_sar_zone_radioactive( ver )
  local t = {
    [ "sar_zone_radioactive_average" ] = "sar_zone_radioactive_weak",
    [ "sar_zone_radioactive_killing" ] = "sar_zone_radioactive_average",
    [ "sar_zone_radioactive_strong"  ] = "sar_zone_radioactive_average",
    [ "sar_zone_radioactive_weak"    ] = "sar_zone_radioactive_weak",
  }
  for n, sect in pairs( t ) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      local angle = sobj.angle
      local pos   = sobj.position
      local lvid  = sobj.m_level_vertex_id
      local gvid  = sobj.m_game_vertex_id

      local sr = sobj:get_space_restrictor()
      local restrictor_type = sr.restrictor_type

      local pk = get_netpk( sobj, 1 )
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      local data   = pk:get()
      local shapes = data.shapes.shapes
      dsh_alife.release( sobj )

      sobj = alife():create( sect, pos, lvid, gvid )
      pk   = get_netpk( sobj, 1 )
      data = pk:get()
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      data.shapes.shapes = shapes
      pk:set( data )

      sobj.angle = angle
      sobj = alife():object( sobj.id )
      local sr = sobj:get_space_restrictor()
      sr.restrictor_type = restrictor_type

      alife():assign_story_id( sobj.id, story_ids[ n ] )
      ASSERT(
        alife():story_object( story_ids[ n ] ),
        "[%s] story_ids.%s not found in alife()", script_name(), n
      )
    end
  end
end


function fix_snd_targets( ver )
  for k, v in pairs({
    [ "snd_cache_size" ] = 64,
    [ "snd_targets"    ] = 256,
  }) do
    log2( "[%s]: %s %s", script_name(), k, v )
    cmd2( k, tostring( v ) )
  end
end


function fix_hos_zamena_art_restrictor( ver )
  for _, n in ipairs({
    "hos_zamena_art_restrictor",
    "podlovim_chiterov1_restrictor",
    "podlovim_chiterov_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_aes2_snork_outdoor( ver )
  local sobj = alife():object( "aes2_snork_outdoor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_aes2_stalker_0010( ver )
  local sobj = alife():object( "aes2_stalker_0010" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
  if db.actor:has_info( "aes2_rpg_ambush3" ) then
    log2( "[%s]: fix aes2_rpg_ambush4", script_name() )
    db.actor:give_info_portion( "aes2_rpg_ambush4" )
  end
end


function fix_aes2_snork_strong_0032( ver )
  local sobj = alife():object( "aes2_snork_strong_0032" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_aes2_snork_strong_0033( ver )
  local sobj = alife():object( "aes2_snork_strong_0033" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_aes2_stalker_0039( ver )
  local sobj = alife():object( "aes2_stalker_0039" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
  if db.actor:has_info( "aes2_rpg_ambush3" ) then
    log2( "[%s]: fix aes2_rpg_ambush4", script_name() )
    db.actor:give_info_portion( "aes2_monolit_ambush4" )
  end
end


function fix_aes_space_restrictor_sound_battle1( ver )
  for _, n in ipairs({
    "aes_space_restrictor_sound_battle_0000",
    "aes_space_restrictor_sound_battle_0001",
    "aes_space_restrictor_sound_battle1",
    "aes_space_restrictor_sound_battle2",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_aes_monolit_heli_hunter( ver )
  for _, n in ipairs({
    "aes_monolit_heli_hunter",
    "aes_stalker_0002",
    "aes_stalker_0009",
    "aes_stalker_0011",
    "aes_monolit_stalker_0012",
    "aes_monolit_stalker_0034",
    "aes_monolit_stalker_0041",
    "aes_stalker_0012",
    "aes_monolit_stalker_0014",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_aes_soldier_desant_wave_0051( ver )
  for _, n in ipairs({
    "aes_soldier_desant_wave_0051",
    "aes_soldier_desant_wave_0052",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_aes_space_restrictor_sound( ver )
  for _, n in ipairs({
    "aes_space_restrictor_sound_0000",
    "aes_space_restrictor_sound_0001",
    "aes_space_restrictor_sound_0002",
    "aes_space_restrictor_sound_0003",
    "aes_space_restrictor_sound_0004",
    "aes_space_restrictor_sound_0005",
    "aes_space_restrictor_sound_0006",
    "aes_space_restrictor_sound_0007",
    "aes_space_restrictor_sound_0008",
    "aes_space_restrictor_sound_0009",
    "aes_space_restrictor_sound_0010",
    "aes_space_restrictor_sound_0011",
    "aes_space_restrictor_sound_0012",
    "aes_space_restrictor_sound_0013",
    "aes_space_restrictor_sound_0014",
    "aes_space_restrictor_sound_0015",
    "aes_space_restrictor_sound_0016",
    "aes_space_restrictor_sound_0017",
    "aes_space_restrictor_sound_0018",
    "aes_space_restrictor_sound_0019",
    "aes_space_restrictor_sound_0020",
    "aes_space_restrictor_sound_0021",
    "aes_space_restrictor_sound_0022",
    "aes_space_restrictor_sound_0023",
    "aes_space_restrictor_sound_0024",
    "aes_space_restrictor_sound_0025",
    "aes_space_restrictor_sound_0026",
    "aes_space_restrictor_sound_0027",
    "aes_space_restrictor_sound_0028",
    "aes_space_restrictor_sound_0029",
    "aes_space_restrictor_sound_0030",
    "aes_space_restrictor_sound_0031",
    "aes_space_restrictor_sound_0032",
    "aes_space_restrictor_sound_0033",
    "aes_space_restrictor_sound_0034",
    "aes_space_restrictor_sound_0035",
    "aes_space_restrictor_sound_0036",
    "aes_space_restrictor_sound_0037",
    "aes_space_restrictor_sound_0038",
    "aes_space_restrictor_sound_0039",
    "aes_space_restrictor_sound_0040",
    "aes_space_restrictor_sound_0041",
    "aes_space_restrictor_sound_0042",
    "aes_space_restrictor_sound_0043",
    "aes_space_restrictor_sound_0044",
    "aes_space_restrictor_sound_0045",
    "aes_space_restrictor_sound_0046",
    "aes_space_restrictor_sound_0047",
    "aes_space_restrictor_sound_0048",
    "aes_space_restrictor_sound_0049",
    "aes_space_restrictor_sound_0050",
    "aes_space_restrictor_sound_0051",
    "aes_space_restrictor_sound_0052",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_esc_kidalo( ver )
  local sobj = alife():object( "esc_kidalo" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
  sobj = alife():object( "esc_gg_razvod_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end

  if ver == 0 then return end
  if
    db.actor:has_info( "escape_razvod_sey" )
    and db.actor:dont_has_info( "escape_razvod_sey_done" )
  then
    log2( "[%s]: fix esc_razvod", script_name() )
    db.actor:give_info_portion( "escape_razvod_sey_done" )
  end

  if
    db.actor:has_info( "esc_fox_medkit_done" )
    and db.actor:dont_has_info( "za_bablom_ksidoru" )
  then
    log2( "[%s]: fix det_artefact_indy", script_name() )
    sak.create_items_actor( "det_artefact_indy", 1 )
  end
end


function fix_gar_dolg_blokpost( ver )
  free_smart_terrain(
    "gar_dolg_blokpost",
    {
      "gar_dolg_blokpost_4",
      "val_sacrifice_victim",
      "val_escort_captive",
      "val_escort_nap1",
      "val_prisoner_captive",
    }
  );
end


function fix_add_new_radar_to_warlab( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_radar_warlab" ) then
    return
  end
  local sids = {
    story_ids.radar_level_changer_to_warlab,
    story_ids.exit_warlab_to_l10_radar,
  }
  local notfound = false
  for _, sid in ipairs( sids ) do
    local sobj = alife():story_object( sid )
    if not sobj then
      notfound = true
      break
    end
  end
  if notfound then
    for _, sid in ipairs( sids ) do
      local sobj = alife():story_object( sid )
      if sobj then
        log2(
          "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh_alife.release( sobj )
      end
    end
    sak.add_new_radar_to_warlab()
  end
end


function fix_r2_exp_donttest_shad( ver )
  log2( "[%s]: fix r2_exp_donttest_shad", script_name() )
  cmd2( "r2_exp_donttest_shad", "off" )
end


function fix_ph_frequency( ver )
  log2( "[%s]: ph_frequency 200", script_name() )
  cmd2( "ph_frequency", "200" )
  log2( "[%s]: ph_iterations 20", script_name() )
  cmd2( "ph_iterations", "20" )
end


function fix_chaes1_prizrak_kamp( ver )
  -- костер для Призрака на ЧАЭС-1
  local sobj = dsh.create_campfire(
    vector():set( -65.06029510498,-0.00056874752044678,-83.41088104248 ),
    2612, 2371,
    "objects\\fireplace\\fireplace_2"
  )
end


function fix_sms_doc_letit_restrictor( ver )
  for _, n in ipairs({
    "boloto_letchik_sms2_restrictor",
    "boloto_sms_k_doku_restrictor",
    "dok_ot_andersena_restrictor",
    "sms_doc_letit_restrictor",
    "vert_bandosu_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_chaes1_prizrak( ver )
  local sobj = alife():object( "chaes1_prizrak" )
  if sobj then
    log2(
      "[%s]: teleport %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local pos = vector():set( 273, -0.0023, -218.399994 )
    alife():teleport_object( sobj.id, pos, 113131, 2350 )
  end
end


function fix_chaes1_prizrak_way1_restrictor( ver )
  for _, n in ipairs({
    "chaes1_prizrak_way1_restrictor",
    "chaes1_prizrak_way2_restrictor",
    "chaes1_prizrak_way3_restrictor",
    "dok_otlet_gen_restrictor",
    "dok_podvox_restrictor",
    "gener_prizrak_way_restrictor",
    "gener_prizrak1_way1_restrictor",
    "idu_na_nz_restrictor",
    "kluk_shuher_restrictor",
    "mu_opozdaly_restrictor",
    "plan_zahvata_restrictor",
    "posadka_pantera_restrictor",
    "spasibo_frits_restrictor",
    "udav_1antenna_restrictor",
    "udav_2antenna_restrictor",
    "udav_othod_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_tretiy_kod_dost_start( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "tretiy_kod_dost_start" )
    and db.actor:dont_has_info( "ten_monolita_talk_done" )
  then
      log2( "[%s]: fix tretiy_kod_dost_start()", script_name() )
    arhara_dialog.tretiy_kod_dost_start()
  end
end


function fix_gener_no_weapon_zone_restrictor( ver )
  local sobj = alife():object( "gener_no_weapon_zone_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_generators_burer1( ver )
  local sobj = alife():object( "generators_burer1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_agro_zone_perexod_restrictor( ver )
  local sobj = alife():object( "agro_zone_perexod_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_qeast_q( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "otdan_q" )
    and db.actor:dont_has_info( "doc_otdan_s" )
  then
    log2( "[%s]: fix otdan_q", script_name() )
    sak.create_items_actor( "wpn_ak103", 1 )
  end
  if
    db.actor:has_info( "doc_otdan_s" )
    and db.actor:dont_has_info( "otdan_q" )
  then
    log2( "[%s]: fix doc_otdan_s", script_name() )
    sak.create_items_actor( "wpn_ak74_m2", 1 )
  end
end


function fix_aver_kluk0_put0_restrictor( ver )
  for _, n in ipairs({
    "aver_kluk0_put0_restrictor",
    "aver_kluk1_put1_restrictor",
    "aver_kluk2_put2_restrictor",
    "aver_kluk3_put3_restrictor",
    "aver_kluk4_put4_restrictor",
    "ona_mehy_dostala_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_val_bandit_trader()
  if level.name() == "l04_darkvalley" then
    local sobj = alife():object( "val_bandit_trader" )
    if sobj then
      local patrol = patrol( "mongol_walk_way" )
      alife():teleport_object(
        sobj.id, patrol:point( 0 ),
        patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
      )
    end
  end
end


function fix_iz_moskvy_sms_restrictor( ver )
  local sobj = alife():object( "iz_moskvy_sms_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_aver_muha_pilot_vzlet_sms_restrictor( ver )
  for _, n in ipairs({
    "after_die_muha_restrictor",
    "anders_put_warlab_restrictor",
    "aver_muha_pilot_vzlet_sms_restrictor",
    "kluk_pogib_restrictor",
    "mono_netu_restrictor",
    "ona_mehy_dostala_restrictor",
    "poshel_bazar_otsek_restrictor",
    "reakshon_vzruv_sms_restrictor",
    "saps_forever_restrictor",
    "sapsan1_othod_restrictor",
    "solvador_put_warlab_restrictor",
    "sv_chern_peregovor_restrictor",
    "vitamin_posrednik_restrictor",
    "vzruv_aver_vert_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_chaes2_arhara_beter2_kluk( ver )
  local sobj = alife():object( "chaes2_arhara_beter2_kluk" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_chees2_mono1_za_zdaniem1( ver )
  for _, n in ipairs({
    "chees2_mono1_za_zdaniem1",
    "chees2_mono2_za_zdaniem2",
    "chees2_mono3_pod_truboy1",
    "chees2_mono3_krusha1",
    "chees2_mono4_krusha2",
    "chees2_mono5_krusha_verh",
    "chees2_mono6_za_uglom",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: teleport %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():teleport_object(
        sobj.id,
        vector():set( 879.200012, -0.099319, 90.300003 ), 229255, 2634
      )
    end
  end
end


function fix_chaes_arh_mine_1( ver )
  for _, n in ipairs({
    "chaes_arh_mine_1",
    "chaes_arh_mine_2",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_sleep_bags2()
  -- подушка в Лиманске
  local sobj = dsh.spawn_physic_sleep_bag(
    vector():set( 26.7528553009033,-1.76729047298431,45.3328552246094 ),
    40457, 3015
  )
  sobj.angle = vector():set( 0, 1.57, 0 )
  log2(
    "[%s]: fix_sleep_bags2: create %s (%s)",
    script_name(), sobj:name(), sobj.level_name
  )
end


function fix_final_agro_boltobny_restrictor( ver )
  for _, n in ipairs({
    "arh_dell_restrictor",
    "arh2_dell2_restrictor",
    "fin_dok_dell_restrictor",
    "fin_pili_dell_restrictor",
    "fin_priz_dell_restrictor",
    "final_agro_boltobny_restrictor",
    "otshel_chel_dell_restrictor",
    "muxa_chel_dell_restrictor",
    "petrenko_chel_dell_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_final_kluk( ver )
  local sobj = alife():object( "dell_kluk_final_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
  if ver == 0 then return end
  if db.actor:dont_has_info( "shodka_agro_end" ) then return end
  sobj = alife():object( "final_kluk" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_chaes2_truba_art_rukzak( ver )
  if db.actor:has_info( "voronin_samopisez_have4" ) then
    local t = sak.create_items_actor( "arhara_tele", 1 )
    local sobj = t[ 1 ]
    log2( "[%s]: create %s", script_name(), sobj:name() )
  else
    local sobj = alife():object( "chaes2_truba_art_rukzak" )
    if sobj then
      local sobj2 = alife():create(
        "arhara_tele",
        sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id,
        sobj.id
      )
      log2(
        "[%s]: create %s -> %s (%s)",
        script_name(), sobj2:name(), sobj:name(), sobj.level_name
      )
--[=[
      if level.object_by_id( sobj.id ) then
        alife():set_switch_online(  sobj.id, false )
        alife():set_switch_offline( sobj.id, true  )
        amk.convert_npc_timer( sobj.id, 1 ):start()
      end
--]=]
    end
  end
end


function fix_molniy_tretiy_dialog_restrictor( ver )
  for _, n in ipairs({
    "control_dver_open_restrictor",
    "molniy_tretiy_dialog_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_strannik_lima_restrictor( ver )
  for _, n in ipairs({
    "sms_after_semetskiy_restrictor",
    "sms_preduprezhd_odnonogogo_restrictor",
    "sms_preduprezhd1_odnonogogo1_restrictor",
    "sms_preduprezhd2_odnonogogo2_restrictor",
    "strannik_lima_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_odnonogiy_spawn( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "semetskiy_vstrecha_start" )
    and db.actor:dont_has_info( "odnonogiy_first_start" )
  then
    log2( "[%s]: fix odnonogiy_spawn", script_name() )
    db.actor:give_info_portion( "odnonogiy_spawn" )
  end
end


function fix_mesto_v_bunkere_start( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "pili_psevdofoto_ok_start" )
    and db.actor:dont_has_info( "mesto_v_bunkere_start" )
  then
    dsh.story_sms_timer( 5, "arhara_dialog.molniy_posle_foto_sms3" )
  end
end


function fix_esc_klenov_posulka_restrictor( ver )
  for _, n in ipairs({
    "esc_klenov_posulka_restrictor",
    "klenov_posulku_poluchil_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_spawn_dialog_foto_restrictor( ver )
  for _, n in ipairs({
    "bun_sp_kluk_restrictor",
    "pili_sdelal_psevdofoto_restrictor",
    "spawn_dialog_foto_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_warlab_burning_fuzz_strong( ver )
  local sobj = alife():object( "level_prefix_zone_burning_fuzz_strong" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_radist_open_door_restrictor( ver )
  for _, n in ipairs({
    "ozhivil_radista_restrictor",
    "radist_open_door_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_radist_u_seifa_restrictor( ver )
  for _, n in ipairs({
    "ozhivil2_radista2_restrictor",
    "posle_smerti_say_restrictor",
    "radist_pogib_sadik_restrictor",
    "radist_u_seifa_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_kluk_sad_after_mina_start( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "kluk_sad_after_mina_start" )
    and db.actor:dont_has_info( "lesnik_say_snip_done" )
  then
    log2( "[%s]: fix kluk_sad_after_mina_start", script_name() )
    local task = CGameTask()
    task:load( "lesnik_say" )
    db.actor:give_task( task, 0, true )
  end
end


function fix_forest_superzhekan_restrictor( ver )
  local sobj = alife():object( "forest_superzhekan_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_mil_exit_to_bar( ver )
  local sobj = alife():story_object( story_ids.Mil_Exit_to_Bar )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 2,  0,  0 ),
    vector():set( 0, 10,  0 ),
    vector():set( 0,  0, 30 ),
    vector():set( 0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( 14.4888877868652, 0.203183174133301, -3.87696599960327 ),
    vector():set( -0.225575685501099, 9.99235439300537, -0.319338023662567 ),
    vector():set( 0.773502588272095, 0.11002803593874, 2.8964786529541 ),
    vector():set( 7.29244995117188, 1.15754318237305, -11.5781860351563 )
  )
  data.shapes:addBox(
    vector():set( 19.3185176849365, 0.270910888910294, -5.16928768157959 ),
    vector():set( -0.449434667825699, 9.92236423492432, -1.15960562229156 ),
    vector():set( 0.764661073684692, 0.370876729488373, 2.8771071434021 ),
    vector():set( 10.4434509277344, -0.00774955749511719, 7.40866851806641 )
  )
  data.shapes:addBox(
    vector():set( 12.9903812408447, 0.392519772052765, -7.48972225189209 ),
    vector():set( -9.3132266343332e-009, 9.98629570007324, 0.523359656333923 ),
    vector():set( 1.50000023841858, -0.135972827672958, 2.59451580047607 ),
    vector():set( 20.9267272949219, 1.35838508605957, -17.490650177002 )
  )
  data.shapes:addBox(
    vector():set( 14.4888877868652, 0.203183174133301, -3.87696599960327 ),
    vector():set( -9.3132266343332e-009, 9.98629570007324, 0.523359656333923 ),
    vector():set( 0.776457190513611, -0.151657968759537, 2.89380645751953 ),
    vector():set( 34.82470703125, 1.69389724731445, -23.8926162719727 )
  )
  data.shapes:addBox(
    vector():set( 14.9429206848145, -0.0684206783771515, 1.30554449558258 ),
    vector():set( -9.3132266343332e-009, 9.98629570007324, 0.523359656333923 ),
    vector():set( -0.261467218399048, -0.156410425901413, 2.98448848724365 ),
    vector():set( 49.6487121582031, 1.72440910339355, -24.4748420715332 )
  )
  data.shapes:addBox(
    vector():set( 16.3830413818359, 0.600373506546021, -11.4558076858521 ),
    vector():set( -0.996005177497864, 9.90902614593506, -0.905084669589996 ),
    vector():set( 1.69458770751953, 0.393571257591248, 2.44406938552856 ),
    vector():set( 28.5507507324219, 1.46322059631348, -0.978561401367188 )
  )
  data.shapes:addBox(
    vector():set( 7.87846231460571, 0.0727043673396111, -1.38728177547455 ),
    vector():set( -9.3132266343332e-009, 9.98629570007324, 0.523359656333923 ),
    vector():set( 0.520944595336914, -0.154622584581375, 2.95037460327148 ),
    vector():set( 40.4443054199219, 1.79086303710938, -7.23038482666016 )
  )
  pk:set( data )
  sobj.position = vector():set( -414, -16.6599998474121, 6.17999982833862 )
  sobj.angle    = vector():set( 0.0523598790168762, 0.174532935023308, 0 )
end


function fix_peshera_m_poltergeist( ver )
  for _, n in ipairs({
    "peshera_m_poltergeist_normal_tele",
    "peshera_m_poltergeist_strong_flame",
    "peshera_m_poltergeist_strong_flame_0000",
    "peshera_m_poltergeist_strong_flame_0001",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_a_inventory_box12( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "taynik_kuznec_bonus" )
    and db.actor:dont_has_info( "koloda_kuznec_have" )
  then
    for id, sobj in alife():objects() do
      if sobj:section_name() == "a_inventory_box12" then
        log2(
          "[%s]: teleport %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        alife():teleport_object(
          sobj.id,
          vector():set( 1064.844, 0.15, -28.661 ), 474183, 2280
        )
        return
      end
    end
  end
end


function fix_gar_bandit_stroyka( ver )
  for _, n in ipairs({
    "gar_bandit_stroyka1",
    "gar_bandit_stroyka2",
    "gar_bandit_stroyka3",
    "gar_bandit_stroyka4",
    "gar_bandit_stroyka5",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_gar_sniper_in_restrictor( ver )
  local sobj = alife():object( "gar_sniper_in_restrictor" )
  local sr   = sobj:get_space_restrictor()
  log2(
    "[%s]: fix %s.m_space_restrictor_type: %s -> %s",
    script_name(), sobj:name(),
    sr.restrictor_type, global_flags.eRestrictorTypeNone
  )
  sr.restrictor_type = global_flags.eRestrictorTypeNone
end


function fix_doctor_drug_faze1( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "doctor_drug_have" )
    and db.actor:dont_has_info( "doctor_drug_done" )
  then
    log2( "[%s]: fix doctor_drug_faze1", script_name() )
    db.actor:give_info_portion( "doctor_drug_faze1" )
  end
end


function fix_spawn_cern_stalk_restrictor( ver )
  local sobj = alife():object( "spawn_cern_stalk_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_mozhno_otkrut( ver )
  if ver == 0 then return end
  if db.actor:has_info( "podval_lima_nayti" ) then
    log2( "[%s]: fix mozhno_otkrut", script_name() )
    db.actor:give_info_portion( "mozhno_otkrut" )
  end
end


function fix_esc_pantera_task( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "plot_dialog_say_done" )
    and db.actor:dont_has_info( "father_esc_dialog_start" )
  then
    log2( "[%s]: fix esc_pantera_task", script_name() )
    db.actor:give_info_portion( "esc_pantera_task" )
  elseif
    db.actor:has_info( "svalka_plot_stalk_spawn" )
    and db.actor:dont_has_info( "plot_dialog_say_start" )
  then
    log2( "[%s]: fix plot_dialog", script_name() )
    local task = CGameTask()
    task:load( "plot_dialog" )
    db.actor:give_task( task, 0, true )
  end
end


function fix_vse_pantera_umerla_restrictor( ver )
  for _, n in ipairs({
    "esc_pantera_stop_sms_restrictor",
    "vse_pantera_umerla_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_poslednie_sms_pantera_restrictor( ver )
  local sobj = alife():object( "poslednie_sms_pantera_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_sms_otez_poreshil_ubiysu_restrictor( ver )
  local sobj = alife():object( "sms_otez_poreshil_ubiysu_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
  if ver == 0 then return end
  if
    db.actor:has_info( "father_after_deaf_done" )
    and db.actor:dont_has_info( "as_ubiysa_have" )
  then
    if level.name() == "l07_military" then
      log2( "[%s]: fix sms_otez_poreshil1", script_name() )
      arhara_dialog.sms_otez_poreshil1()
    else
      log2( "[%s]: fix sms_otez_poreshil", script_name() )
      arhara_dialog.sms_otez_poreshil()
    end
  end
end


function fix_strelka_mesto_dialog_restrictor( ver )
  for _, n in ipairs({
    "sms_taynik_zlobnuy_restrictor",
    "strelka_mesto_dialog_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_aver_level_changer_to_military( ver )
  local sobj = alife():story_object( story_ids.aver_level_changer_to_military )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local lc = sobj:get_level_changer()
    lc.dest_game_vertex_id  = 1591
    lc.dest_level_vertex_id = 359991
    lc.dest_position        = vector():set( 61.8530693054199, -5.95387744903564, -68.7197113037109 )
    lc.dest_direction       = vector():set( 0, 1.73000001907349, 0 )
  end
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_military_earth" ) then
    return
  end
  sobj = alife():story_object( story_ids.exit_to_aver_from_as )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
  sobj = sak.add_new_td_to_earth2()
  log2(
    "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
  )
end


function fix_l04_darkvalley_clmbl( ver )
  local t = {
    [ "clmbl#38" ] = vector():set( 126.85, 5.25, -74.8 ),
    [ "clmbl#39" ] = vector():set( 116.24, 5.23, -62.1 ),
  }
  local cnt = 2
  for id, sobj in alife():objects() do
    if t[ sobj:name() ] and sobj.level_name == "l04_darkvalley" then
      log2(
        "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():teleport_object(
        sobj.id, t[ sobj:name() ], sobj.m_level_vertex_id,
        sobj.m_game_vertex_id
      )
      cnt = cnt - 1
      if cnt == 0 then return end
    end
  end
end


function fix_molniya_plastilin( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "nashel_plastilin_say_start" )
    and db.actor:dont_has_info( "molniya_plastilin_ok_start" )
  then
    log2( "[%s]: fix molniya_plastilin", script_name() )
    local task = CGameTask()
    task:load( "molniya_plastilin" )
    db.actor:give_task( task, 0, true )
  end
end


function fix_podval_tornado_strong( ver )
  for _, n in ipairs({
    "del_blok_and_restr_restrictor",
    "podval_tornado_strong",
    "tele_na_vuxpod_restrictor",
    "teleport_podval_ok_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_limansk_code_lock( ver )
  local sobj = alife():object( "limansk_code_lock" )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local ini = sobj:spawn_ini()
    ini.readonly = false
    ini:w_bool( "collide", "ignore_ragdoll", true )
    ini:w_bool( "collide", "ignore_static",  true )
    sobj:save_spawn_ini()
  end
end


function fix_lim_physic_object_0031( ver )
  local sobj = alife():object( "lim_physic_object_0031" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_city_starshoy( ver )
  if ver == 0 then return end
  local sobj = alife():object( "city_starshoy" )
  if sobj then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local sobj2 = alife():create(
      "wpn_akm_sk2", sobj.position, sobj.m_level_vertex_id,
      sobj.m_game_vertex_id, sobj.id
    )
  end
end


function fix_sms_parfumer1_restrictor( ver )
  for _, n in ipairs({
    "agro_tainik_norman_ok_restrictor",
    "dcity_duda_zvonok_restrictor",
    "dcity_nachalnik_zvonok_restrictor",
    "dcity_otvet_ok_obmor_restrictor",
    "parfum_sms_kontrik_restrictor",
    "sms_obmorok_restrictor",
    "sms_parfumer1_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_stalkerkills( ver )
  if ver == 0 then return end
  local points = actor_stats.get_points( "stalkerkills" )
  for _, comm in ipairs({
    "dolg", "ecolog", "freedom", "green", "nebo", "neutral"
  }) do
    for _, rank in ipairs({ "novice", "experienced", "veteran", "master" }) do
      actor_stats.remove_points( "stalkerkills", comm .. "_" .. rank )
    end
  end
  log2(
    "[%s]: fix stalkerkills: %s -> %s",
     script_name(), points, actor_stats.get_points( "stalkerkills" )
  )
end


function fix_dcity_bandit_garazh( ver )
  if db.actor:has_info( "agro_tainik_norman_done" ) then return end
  for _, n in ipairs({
    "dcity_bandit_garazh1",
    "dcity_bandit_garazh2",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh.release_mob( sobj )
    end
  end
end


function fix_dead_city_campfires2( ver )
  -- костры на хуторах
  dsh.create_campfire(
    vector():set( 18.199982, 8.527973, -152.599991 ),
    376925, 3646,
    "objects\\koster_palki_nastil", 0.7
  )
  dsh.create_campfire(
    vector():set( -142.57029724121, 8.9735546112061, -167.76081848145 ),
    195509, 3610,
    "objects\\koster_palki_nastil", 0.7
  )
  -- лампадка в палатке
  dsh.create_candle(
    vector():set( -60.196, -9.361, -251.651 ),
    287348, 3619, "physics\\decor\\gas_burner"
  )
  -- костер под мостом, после перехода из Лиманска
  dsh.create_campfire(
    vector():set( -233.19561767578, -5.3848667144775, 293.45458984375 ),
    106201, 3593,
    "objects\\koster_palki_nastil", 0.7
  )
  -- костер рядом с ливневкой, где Парфюмера встречаем
  dsh.create_campfire(
    vector():set( 51.12712097168, -8.1368522644043, 199.40612792969 ),
    408473, 3651,
    "objects\\koster_palki_nastil", 0.7
  )
end


function fix_spawn_nach_oxran_restrictor( ver )
  for _, n in ipairs({
    "spawn_nach_oxran_restrictor",
    "pomoshnik_timer_zenter_doza_restrictor",
    "pomoshnik1_timer_zenter1_doza_restrictor",
    "pomoshnik2_timer_zenter2_doza_restrictor",
    "pomoshnik3_timer_zenter3_doza_restrictor",
    "pomoshnik4_timer_zenter4_doza_restrictor",
    "pomoshnik_timer_plendok_doza_restrictor",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_m_teleport_vnutri_norm_taynik( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "m_teleport_vnutri_norm_taynik" then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      return
    end
  end
end


function fix_m_teleport_izkanalii_dcity( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if sobj:section_name() == "m_teleport_izkanalii_dcity" then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      return
    end
  end
end


function fix_spawn_military_btr( ver )
  if ver == 0 then return end
  if db.actor:has_info( "esc_btr_killed" ) then return end
  local t = {}
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "l01_escape"
      and sobj:section_name() == "vehicle_btr"
    then
      table.insert( t, sobj )
      if table.getn( t ) == 2 then break end
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_add_new_lima_to_dead_city( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "info_way_arhara_lima_dcity" ) then return end
  for _, n in ipairs({ "lima_to_dead_city", "dcity_to_limansk" }) do
    local sobj = alife():story_object( story_ids[ n ] )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
  sak.add_new_dcity()
end


function fix_dcity_iskra_zvonok_restrictor( ver )
  local sobj = alife():object( "dcity_iskra_zvonok_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_dead_city_campfires3( ver )
  -- лампадка у Дуды
  dsh.create_candle(
    vector():set( -60.431, 7.175, -34.581 ),
    287605, 3620, "physics\\decor\\gas_burner"
  )
end


function fix_dead_city_molniy( ver )
  local sobj = alife():object( "dead_city_molniy" )
  if sobj then
    log2(
      "[%s]: teleport %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local patrol = patrol( "dead_city_molniy_walk" )
    alife():teleport_object(
      sobj.id, patrol:point( 0 ),
      patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
    )
  end
end


function fix_val_escort_ambush_zone( ver )
  local sobj = alife():object( "val_escort_ambush_zone" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_naemn_shturm_poluch_start( ver )
  if db.actor:has_info( "naemn_shturm_poluch_done" ) then return end
  local npcs = {
    {
      "bar_killer_attackers_1",
      "bar_killer_attackers_2",
      "bar_killer_attackers_3",
      "bar_killer_attackers_4",
      "bar_killer_attackers_5",
      "bar_killer_attackers_6",
      "bar_killer_attackers_7",
      "bar_killer_attackers_8",
      "bar_killer_attackers_9",
      "bar_killer_attackers_10",
      "bar_killer_attackers_11",
      "bar_killer_attackers_12",
      "bar_killer_attackers_13",
      "bar_killer_attackers_14",
      "bar_killer_attackers_16",
      "bar_killer_attackers_17",
      "bar_killer_attackers_18",
      "bar_killer_attackers_19",
      "bar_killer_attackers_20",
      "bar_killer_attackers_21",
      "bar_killer_attackers_22",
      "bar_killer_attackers_23",
    },
    {
      "bar_dolg_attackers_stop1",
      "bar_dolg_attackers_stop2",
      "bar_dolg_attackers_stop3",
      "bar_dolg_attackers_stop4",
      "bar_dolg_attackers_stop5",
      "bar_dolg_attackers_stop6",
      "bar_dolg_attackers_stop7",
      "bar_dolg_attackers_stop8",
    },
  }
  for _, t in ipairs( npcs ) do
    dsh.shuffle( t )
    for i = 1, math.floor( table.getn( t ) / 2 ) do
      local sobj = alife():object( t[ i ] )
      if sobj then
        log2(
          "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh.release_mob( sobj )
      end
    end
  end
end


function fix_agr_u_bandits( ver )
  local t = {
    "kat_bandit",
    "kat_bandit_0000",
    "kat_bandit_0001",
    "kat_bandit_0002",
    "kat_bandit_0003",
    "kat_bandit_0004",
    "kat_bandit_0005",
  }
  dsh.shuffle( t )
  local sobj = alife():object( t[ 1 ] )
  if sobj and sobj:alive() then
    log2(
      "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    sak.make_nepis_free( sobj )
  end
end


function fix_dar_control_poltergeist( ver )
  local sobj = alife():object( "dar_m_poltergeist_normal_flame_0000" )
  if sobj and sobj:alive() then
    log2(
      "[%s]: teleport %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    local patrol = patrol( "dar_control_poltergeist_walk_1" )
    alife():teleport_object(
      sobj.id, patrol:point( 0 ),
      patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
    )
  end
end


function fix_tri_tainik_start( ver )
  if db.actor:has_info( "tri_tainik_start" ) then return end
  for i = 1, 3 do
    local sid  = "new_prizrak_treasure" .. i
    local sobj = alife():story_object( story_ids[ sid ] )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_bar_hunter_toz( ver )
  if db.actor:has_info( "bar_bar_hunter_quest_start" ) then return end
  local sobj = alife():story_object( story_ids.bar_hunter_toz )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_gigant_red_strong1( ver )
  local sobj = alife():object( "gigant_red_strong1" )
  if sobj then
    local sid = story_ids.gigant_red_strong1
    log2(
      "[%s]: assign story_id %s to %s (%s)",
      script_name(), sid, sobj:name(), sobj.level_name
    )
    alife():assign_story_id( sobj.id, sid )
  end
end


function fix_barrem_talk( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "barrem_talk_need" )
    and db.actor:dont_has_info( "barrem_talk_est" )
  then
    log2( "[%s]: fix barrem_talk", script_name() )
    db.actor:give_info_portion( "barrem_talk_est" )
    db.actor:give_info_portion( "ara_pda_need" )
  end
end


function fix_mar_level_changer_to_escape_2( ver )
  local sobj = alife():object( "mar_level_changer_to_escape_2" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_test_space_restrictor( ver )
  local sobj = alife():object( "test_space_restrictor" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_x16_m_controller_e( ver )
  local sobj = alife():object( "x16_m_controller_e" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh.release_mob( sobj )
  end
end


function fix_koiot_npc_sr1( ver )
  if ver == 0 then return end
  if
    db.actor:dont_has_info( "hamster_kuznec5_start" )
    or db.actor:has_info( "koiot_npc_dead" )
  then
    return
  end
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "l06_rostok"
      and sobj:section_name() == "space_restrictor"
      and sobj.m_game_vertex_id == 1435
      and sobj.m_level_vertex_id == 41790
    then
      log2( "[%s]: release %s (%s) custom_data:", script_name(), sobj:name(), sobj.level_name )
      log1( sobj.custom_data )
      dsh_alife.release( sobj )
      if level.name() == "l06_rostok" then
        log2( "[%s]: start_on_spawn_another_level xr_effects.koiot_npc_spawn", script_name() )
        dsh.start_on_spawn_another_level( "xr_effects.koiot_npc_spawn" )
      else
        log2( "[%s]: xr_effects.koiot_npc_spawn", script_name() )
        xr_effects.koiot_npc_spawn()
      end
      return
    end
  end
end


function fix_agr_exit_to_garbage_02( ver )
  local sobj = alife():story_object( story_ids.agr_exit_to_garbage_02 )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 6,  0,  0 ),
    vector():set( 0, 10,  0 ),
    vector():set( 0,  0,  1 ),
    vector():set( 0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( -0.999998211860657, 0.00192213035188615, -3.03983688354492e-006 ),
    vector():set( 0.0192213151603937, 9.99994373321533, -0.0274345614016056 ),
    vector():set( -4.4703483581543e-005, -0.0548691377043724, -19.9999237060547 ),
    vector():set( 5.94609069824219, 0.137861251831055, -11.7826995849609 )
  )
  data.shapes:addBox(
    vector():set( -0.999998211860657, 0.00192213035188615, -3.03983688354492e-006 ),
    vector():set( 0.0192213151603937, 9.99994373321533, -0.0274345614016056 ),
    vector():set( -4.4703483581543e-005, -0.0548691377043724, -19.9999237060547 ),
    vector():set( -7.69921875, 0.16685152053833, -10.7760314941406 )
  )
  data.shapes:addBox(
    vector():set( -0.992545187473297, 0.00157347321510315, -0.12186735868454 ),
    vector():set( 0.0192213151603937, 9.99994373321533, -0.0274345614016056 ),
    vector():set( 3.65587329864502, -0.0887174755334854, -29.7762775421143 ),
    vector():set( 8.01405334472656, 0.0668106079101563, -36.2319641113281 )
  )
  data.shapes:addBox(
    vector():set( -0.992545187473297, 0.00157347321510315, -0.12186735868454 ),
    vector():set( 0.0192213151603937, 9.99994373321533, -0.0274345614016056 ),
    vector():set( 3.65587329864502, -0.0887174755334854, -29.7762775421143 ),
    vector():set( -5.59164428710938, 0.096707820892334, -34.866943359375 )
  )
  data.shapes:addBox(
    vector():set( -0.997562766075134, 0.00172608729917556, -0.0697547197341919 ),
    vector():set( 0.0230655781924725, 11.9999332427979, -0.0329214707016945 ),
    vector():set( 2.44123792648315, -0.100479662418365, -34.9146118164063 ),
    vector():set( 11.7855072021484, -0.0275530815124512, -67.9852905273438 )
  )
  data.shapes:addBox(
    vector():set( -0.992545187473297, 0.00157347321510315, -0.12186735868454 ),
    vector():set( 0.0230655781924725, 11.9999332427979, -0.0329214707016945 ),
    vector():set( 4.26518535614014, -0.103503726422787, -34.7389907836914 ),
    vector():set( -0.910614013671875, 0.00100851058959961, -66.4696960449219 )
  )
  data.shapes:addBox(
    vector():set( -0.984804749488831, 0.00236933608539402, 0.173649042844772 ),
    vector():set( 0.0230655781924725, 11.9999332427979, -0.0329214707016945 ),
    vector():set( -2.08385467529297, -0.028415909036994, -11.817645072937 ),
    vector():set( 12.0570220947266, -3.79245758056641, -91.4453735351563 )
  )
  data.shapes:addBox(
    vector():set( -0.999998211860657, 0.00192214269191027, 1.49011611938477e-006 ),
    vector():set( 0.0230655781924725, 11.9999332427979, -0.0329214707016945 ),
    vector():set( -8.08238983154297e-005, -0.0329213812947273, -11.9999551773071 ),
    vector():set( 1.0738525390625, -5.06755256652832, -90.059814453125 )
  )
  data.shapes:addBox(
    vector():set( -0.173654526472092, -0.00236799265258014, -0.984803795814514 ),
    vector():set( 0.0288319736719131, 14.9999160766602, -0.0411518402397633 ),
    vector():set( 9.84804821014404, -0.023693360388279, -1.7364901304245 ),
    vector():set( 6.04568481445313, -4.69500207901001, -96.5823364257813 )
  )
  pk:set( data )
  sobj.position = vector():set( 285.096374511719, 4.81838512420654, 9.07176685333252 )
  sobj.angle    = vector():set( -0.0027434597723186, 2.26892948150635, -0.00192214001435786 )
  sobj.custom_data = ""
end


function fix_val_lvl_changer3( ver )
  local sobj = alife():story_object( story_ids.val_lvl_changer3 )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 8,  0,  0 ),
    vector():set( 0,  7,  0 ),
    vector():set( 0,  0,  2 ),
    vector():set( -6.54999923706055, -1, 38.0700073242188 )
  )
  data.shapes:addBox(
    vector():set( 2,  0,  0 ),
    vector():set( 0, 10,  0 ),
    vector():set( 0,  0, 75 ),
    vector():set( 0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( 1.73205077648163, 0, 1 ),
    vector():set( 0, 10,  0 ),
    vector():set( -7.5, 0, 12.9903812408447 ),
    vector():set( 5.46000289916992, 0, -43.5 )
  )
  data.shapes:addBox(
    vector():set( 2,  0,  0 ),
    vector():set( 0, 10,  0 ),
    vector():set( 0,  0, 12 ),
    vector():set( 9.09000205993652, 0, -56.1400146484375 )
  )
  data.shapes:addBox(
    vector():set( -0.347296386957169, 0, 1.96961545944214 ),
    vector():set( 0, 10,  0 ),
    vector():set( -19.6961555480957, 0, -3.47296380996704 ),
    vector():set( 0.390003204345703, -2, -64.739990234375 )
  )
  data.shapes:addBox(
    vector():set( 1.73205077648163, 0, 1 ),
    vector():set( 0, 10,  0 ),
    vector():set( -10, 0, 17.3205070495605 ),
    vector():set( -13.3099975585938, -2, -56.9400024414063 )
  )
  data.shapes:addBox(
    vector():set( 1.99725902080536, 0, -0.10467191785574 ),
    vector():set( 0, 10,  0 ),
    vector():set( 4.50089263916016, 0, 85.8821411132813 ),
    vector():set( -16.3399963378906, 0, -5.57000732421875 )
  )
  pk:set( data )
  sobj.position = vector():set( -38.0800018310547, 5, -586.070007324219 )
  sobj.angle    = vector():set( 0, 0, 0 )
  sobj.custom_data = ""
end


function fix_rostok_zone_radioactive_average( ver )
  for _, n in ipairs({
    "rostok_zone_radioactive_average",
    "rostok_zone_radioactive_average_0001",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_labx8_2( ver )
  dsh.create_candle(
    vector():set( -79.5, -16, 67.13 ),
    3349, 3848, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -42.78, -19.54, 67.97 ),
    6770, 3850, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -68.78, -26.33, 79.3 ),
    5233, 3840, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -86.8, -31.17, 80.34 ),
    2086, 3840, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -81.63, -23.14, 90.46 ),
    2952, 3839, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -53.73, -20.97, 91.51 ),
    6461, 3840, "physics\\decor\\gas_burner"
  )
end


function fix_pripyat_campfires4( ver )
  -- лампадки в Юбилейном, на каждом этаже
  dsh.create_candle(
    vector():set( -67.86, 1.41, 95.4 ),
    122427, 3754, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -62.28, 5.4, 81.11 ),
    127415, 3755, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -44.71, 9.5, 87.4 ),
    144317, 3755, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -52.37, 14.3, 105.33 ),
    138425, 3755, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -65.99, 17.71, 87.13 ),
    125196, 3755, "physics\\decor\\gas_burner"
  )

  dsh.create_candle(
    vector():set( -78.79, 22.29, 101.32 ),
    110965, 3755, "physics\\decor\\gas_burner"
  )
end


function fix_lx8_physic_door( ver )
  local sobj = alife():object( "lx8_physic_door" )
  if not sobj then return end
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  alife():release( sobj )
  sobj = alife():create( 12451 )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.visual_name = "physics\\door\\codedoor_left"
  pk:set( data )
  sobj.position = vector():set( -77.0005416870117, -13.7705745697021, 74.5281372070313 )
  sobj.angle    = vector():set( 0, 8.94069671630859e-008, 0 )
end


function fix_dark_object_nodywka_1( ver )
  for _, n in ipairs({
    "dark_object_nodywka_1",
    "val_physic_destroyable_object_0013",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_pda_dimak( ver )
  if
    db.actor:dont_has_info( "dimak_pda_start" )
    or db.actor:has_info( "aaz_note_start" )
  then
    return
  end
  for id, sobj in alife():objects() do
    if
      sobj:section_name() == "pda_dimak" and sobj.level_name == "jupiter"
      and sobj.parent_id == 65535
    then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
      return
    end
  end
end


function fix_upiter_heli_baty( ver )
  for _, n in ipairs({
    "upiter_heli_baty",
    "upi_heli_sdelka",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_jup_und_train_vagon_01_open( ver )
  if ver == 0 then return end
  for id, sobj in alife():objects() do
    if
      sobj.level_name == "jupiter_underground"
      and sobj.m_game_vertex_id == 3785
      and sobj.m_level_vertex_id == 17403
    then
      local pk = get_netpk( sobj, 1 )
      ASSERT( pk and pk:isOk(), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      if data.visual_name == "objects\\train\\train_vagon_01_open" then
        log2(
          "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh_alife.release( sobj )
        break
      end
    end
  end
end


function fix_gar_exit_to_darkvalley_high( ver )
  local sobj = alife():story_object( story_ids.gar_exit_to_darkvalley_high )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 2,  0,  0 ),
    vector():set( 0, 20,  0 ),
    vector():set( 0,  0, 74 ),
    vector():set( 0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( 3,  0,  0 ),
    vector():set( 0, 20,  0 ),
    vector():set( 0,  0, 74 ),
    vector():set( 25.8999633789063, 1, 0 )
  )
  pk:set( data )
  sobj.position = vector():set( 293, 8, 147 )
  sobj.angle    = vector():set( 0, 0, 0 )
  sobj.custom_data = ""
end


function fix_bar_exit_to_garbage( ver )
  local sobj = alife():story_object( story_ids.bar_exit_to_garbage )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 75,  0, 0 ),
    vector():set(  0, 15, 0 ),
    vector():set(  0,  0, 1 ),
    vector():set(  0,  0, 0 )
  )
  data.shapes:addBox(
    vector():set( 33.8074035644531, 0, 9.05866622924805 ),
    vector():set( 0, 10, 0 ),
    vector():set( -0.517638087272644, 0, 1.9318516254425 ),
    vector():set( -5.57077026367188, -0.600000381469727, -64.0153198242188 )
  )
  pk:set( data )
  sobj.position = vector():set( 376, 12.3000001907349, -451 )
  sobj.angle    = vector():set( 0, -0.279252678155899, 0 )
  sobj.custom_data = ""
end


function fix_gar_exit_to_agroprom_02( ver )
  for _, sid in ipairs({
    story_ids.gar_exir_to_escape,
    story_ids.gar_exit_to_agroprom_02,
    story_ids.gar_exit_to_bar,
  }) do
    local sobj = alife():story_object( sid )
    log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
    sobj.custom_data = ""
  end
end


function fix_rostok_exit_to_yantar( ver )
  local sobj = alife():story_object( story_ids.rostok_exit_to_yantar )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 60,  0,  0 ),
    vector():set(  0, 25,  0 ),
    vector():set(  0,  0,  2 ),
    vector():set(  0,  0,  0 )
  )
  data.shapes:addBox(
    vector():set( 24.6929016113281, -5.06418943405151, -75.9250717163086 ),
    vector():set( 1.30660569667816, 24.9351119995117, -1.23822391033173 ),
    vector():set( 4.74867582321167, -0.17157194018364, 1.55584275722504 ),
    vector():set( -29.0713195800781, 5.29796981811523, 35.1026000976563 )
  )
  data.shapes:addBox(
    vector():set( 54.4455490112305, -1.51905870437622, 7.64035034179688 ),
    vector():set( 0.545610725879669, 19.9923686981201, 0.086841806769371 ),
    vector():set( -0.138982385396957, -0.000508628785610199, 0.990294814109802 ),
    vector():set( -16.9845352172852, 6.91400909423828, 74.6051635742188 )
  )
  data.shapes:addBox(
    vector():set( 15.9727611541748, -0.62992799282074, -12.019739151001 ),
    vector():set( 6.98492019779451e-009, 14.9794445037842, -0.785039484500885 ),
    vector():set( 0.601811647415161, 0.0417974926531315, 0.797543585300446 ),
    vector():set( 17.6705017089844, 11.8896789550781, 72.9862060546875 )
  )
  data.shapes:addBox(
    vector():set( 4.18686580657959, -4.18113946914673, -79.7808837890625 ),
    vector():set( 1.30660593509674, 24.9351100921631, -1.23822367191315 ),
    vector():set( 4.98630475997925, -0.247644752264023, 0.274657607078552 ),
    vector():set( 19.7001495361328, 5.18633460998535, 32.9725036621094 )
  )
  pk:set( data )
  sobj.position = vector():set( -157.149932861328, -5, -369.700012207031 )
  sobj.angle    = vector():set( -0.0523598790168762, -0.13962633907795, 0 )
  sobj.custom_data = ""
end


function fix_sva_chaes2_info( ver )
  if ver == 0 then return end
  if db.actor:has_info( "pri1_zaton_info" ) then
    log2( "[%s]: fix sva_chaes2_info", script_name() )
    db.actor:give_info_portion( "sva_chaes2_info" )
  end
end


function fix_wpn_aps_sk1_wpn_m79( ver )
  local known = {
    [ "wpn_aps_sk1" ] = true,
    [ "wpn_m79"     ] = true,
  }
  local t = {}
  for id, sobj in alife():objects() do
    if known[ sobj:section_name() ] then
      local p_sobj = alife():object( sobj.parent_id )
      if p_sobj and IsInventoryBox( p_sobj ) then
        table.insert( t, sobj )
      end
    end
  end
  for _, sobj in ipairs( t ) do
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    dsh_alife.release( sobj )
  end
end


function fix_gar_seryi_factory_0000( ver )
  for _, n in ipairs({
    "gar_seryi_factory_0000",
    "gar_fake_spot4",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_wpn_mp5( ver )
  for _, n in ipairs({ "gar_dm_bandit_2", "gar_sniper_bandit" }) do
    local p_sobj = alife():object( n )
    if p_sobj then
      local sobj_wpn = alife():create(
        "wpn_ak74u", p_sobj.position, p_sobj.m_level_vertex_id,
        p_sobj.m_game_vertex_id, p_sobj.id
      )
      local sobj_ammo = alife():create_ammo(
        "ammo_5.45x39_fmj", p_sobj.position, p_sobj.m_level_vertex_id,
        p_sobj.m_game_vertex_id, p_sobj.id, 30
      )
      log2(
        "[%s]: create %s, %s -> %s (%s)",
        script_name(), sobj_wpn:name(), sobj_ammo:name(), p_sobj:name(),
        p_sobj.level_name
      )
    end
  end
end


function fix_gar_open_fire( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "gar_bandits_raid" ) then
    for _, info in ipairs({ "gar_counter_fire", "gar_open_fire" }) do
      if db.actor:has_info( info ) then
        log2( "[%s]: fix %s", script_name(), info )
        db.actor:disable_info_portion( info )
      end
    end
  end
end


function fix_gar_seryi_open_fire( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "gar_seryi_actor_enter" ) then
    for _, info in ipairs({ "gar_seryi_counter_fire", "gar_seryi_open_fire" }) do
      if db.actor:has_info( info ) then
        log2( "[%s]: fix %s", script_name(), info )
        db.actor:disable_info_portion( info )
      end
    end
  end
end


function fix_gar_bandit_post( ver )
  for i = 1, 7 do
    local sobj = alife():object( "gar_bandit_post_" .. i )
    if sobj and sobj:alive() then
      log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
      dsh.release_mob( sobj )
    end
  end
end


function fix_input_exclusive_mode( ver )
  log2( "[%s]: input_exclusive_mode on", script_name() )
  cmd2( "input_exclusive_mode", "on" )
end


function fix_gar_seryi_bandits( ver )
  if ver == 0 then return end
  if db.actor:has_info( "gar_seryi_actor_enter" ) then
    return
  end
  local strn = smart_terrain.get_smart_terrain_by_name( "gar_seryi_bandits" )
  log2( "[%s]: fix %s (%s)", script_name(), strn:name(), strn.level_name )
  strn.gulag:changeState( 0, true )
  strn.gulag:update()
end


function fix_esc_exit_to_garbage_01( ver )
  local sobj = alife():story_object( story_ids.esc_exit_to_garbage_01 )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 35,  0, 0 ),
    vector():set(  0, 15, 0 ),
    vector():set(  0,  0, 2 ),
    vector():set(  0,  0, 0 )
  )
  data.shapes:addBox(
    vector():set(  1,  0, 0 ),
    vector():set(  0,  4, 0 ),
    vector():set(  0,  0, 3 ),
    vector():set( 5.10000610351563, -5.40000152587891, -22.39990234375 )
  )
  pk:set( data )
  sobj.position = vector():set( 23.4615230560303, 23.8000030517578, 708.213439941406 )
  sobj.angle    = vector():set( 0, 0, 0 )
  sobj.custom_data = ""
end


function fix_puzir_arhara_vagonchik( ver )
  local k = "puzir_arhara_vagonchik"
  local fixed_bones = "root"
  local sobj = alife():object( k )
  if sobj then
    log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
    dsh_alife.release( sobj )
  end
  sobj = alife():create( alife():spawn_id( k ) )
  log2( "[%s]: create %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.custom_data:setString( "[collide]\nignore_static\n[ph_heavy]\n" )
  data.fixed_bones = fixed_bones
  pk:set( data )
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
end


function fix_chimaera_visual( ver )
  if ver == 0 then return end
  for _, n in ipairs({ "final_chimaera", "land_sniper_chimaera" }) do
    local sobj = alife():object( n )
    if sobj and sobj:alive() then
      local pk = get_netpk( sobj, 1 )
      ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
      local data = pk:get()
      local vis_name = data.visual_name
      data.visual_name = "new\\holo_plash"
      log2(
        "[%s]: %s (%s): fix visual %s -> %s",
        script_name(), sobj:name(), sobj.level_name, vis_name, data.visual_name
      )
      pk:set( data )
    end
  end
end


function fix_puzir_arhara_helicopter2( ver )
  local k = "puzir_arhara_helicopter2"
  local fixed_bones = "root"
  local sobj = alife():object( k )
  if sobj then
    log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
    dsh_alife.release( sobj )
  end
  sobj = alife():create( alife():spawn_id( k ) )
  log2( "[%s]: create %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( pk:isOk(), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.custom_data:setString( "[collide]\nignore_static\n[ph_heavy]\n" )
  data.fixed_bones = fixed_bones
  pk:set( data )
  sobj.position = vector():set( -41.047790527344, 10.750370407104, -198.1163482666 )
  sobj.angle    = vector():set( 0, 0, 0.1 )
  sobj.m_game_vertex_id  = 2882
  sobj.m_level_vertex_id = 154202
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
end


function fix_zone_witches_galantine_koleso( ver )
  for i = 1, 20 do
    local sobj = alife():object(
      string.format( "pri_zone_witches_galantine_koleso_%04d", i )
    )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      dsh_alife.release( sobj )
    end
  end
end


function fix_mar_level_changer_to_escape_1( ver )
  local sobj = alife():story_object( story_ids.mar_level_changer_to_escape_1 )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.dest_game_vertex_id  = 41
  data.dest_level_vertex_id = 10036
  data.dest_position        = vector():set( -249.71600341797,-16.43124961853,-202.36882019043 )
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 1, 0, 0 ),
    vector():set( 0, 5, 0 ),
    vector():set( 0, 0, 8 ),
    vector():set( 0, 0, 0 )
  )
  data.shapes:addBox(
    vector():set( -2.9630651473999, 0, -0.469303339719772 ),
    vector():set( 0, 10, 0 ),
    vector():set( 7.82172250747681, 0, -49.3844184875488 ),
    vector():set( -50.5322875976563, 1.60000014305115, 23.0791778564453 )
  )
  pk:set( data )
  sobj.position = vector():set( 564.092834472656, 3.90000033378601, -180.523040771484 )
  sobj.angle    = vector():set( 0, 2.9845130443573, 0 )
  sobj.custom_data = ""
end


function fix_mar_level_changer_to_agroprom_1( ver )
  local sobj = alife():story_object( story_ids.mar_level_changer_to_agroprom_1 )
  log2( "[%s]: fix %s (%s)", script_name(), sobj:name(), sobj.level_name )
  local pk = get_netpk( sobj, 1 )
  ASSERT( ( pk and pk:isOk() ), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  for i = data.shapes:count(), 1, -1 do
    data.shapes:remove( i )
  end
  data.shapes:addBox(
    vector():set( 10, 0, 0 ),
    vector():set(  0, 5, 0 ),
    vector():set(  0, 0, 1 ),
    vector():set(  0, 0, 0 )
  )
  data.shapes:addBox(
    vector():set( 32.0000038146973, 0, 0 ),
    vector():set( 0, 15, 0 ),
    vector():set( 0, 0, 1.00000011920929 ),
    vector():set( 2.68466186523438, 0, 32.732177734375 )
  )
  pk:set( data )
  sobj.position = vector():set( 174.69270324707, 10.5000028610229, 587.935791015625 )
  sobj.angle    = vector():set( 0, 0.436332315206528, 0 )
  sobj.custom_data = ""
end


function fix_bar_tiran_pda( ver )
  if ver == 0 then return end
  local parent = alife():object( "marsh_dan" );
  if not parent then return end
  local pda_sobj;
  dsh_alife.iterate_items(
    function( sobj )
      if sobj:section_name() == "bar_tiran_pda" then
        pda_sobj = sobj
        return true
      end
    end,
    parent.id
  )
  if pda_sobj then
    log2(
      "[%s]: release %s from %s (%s)",
      script_name(), pda_sobj:name(), parent:name(), parent.level_name
    )
    dsh_alife.release( pda_sobj )
  end
end


function fix_taynik_agr_shkaf( ver )
  local sobj = alife():create(
    "taynik_agr_shkaf",
    vector():set( -150.123, 10.113, -203.958 ), 88744, 628
  )
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
  log2( "[%s]: create %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_m_teleport_bolota_u_agru( ver )
  if ver == 0 then return end
  log2( "[%s]: release m_teleport_bolota_u_agru", script_name() )
  dsh.alife_find_and_release({ "m_teleport_bolota_u_agru" })
end


local puzir_walk_fixes = {
  [ "himik_zl"       ] = "puzir_crest_walk",
  [ "prigorshnya_zl" ] = {
    [ "on_info" ] = "prigorshnya_stop",
    [ "path"    ] = "puzir_crest_walk",
  },
  [ "puzir_crest"    ] = "puzir_crest_walk",
}

function fix_puzir_crest()
  if level.name() == "puzir" then
    for name, path in pairs( puzir_walk_fixes ) do
      local sid  = story_ids[ name ]
      local sobj = alife():story_object( sid )
      if sobj then
        local need_teleport = true
        local pos
        if type( path ) == "table" then
          pos  = path.pos
          path = path.path
          if path.on_info and db.actor:dont_has_info( path.on_info ) then
            need_teleport = false
          end
        end
        if need_teleport then
          local patrol = patrol( path )
          alife():teleport_object(
            sobj.id,
            ( pos or patrol:point( 0 ) ),
            patrol:level_vertex_id( 0 ), patrol:game_vertex_id( 0 )
          )
        end
      end
    end
  end
end


function fix_cleanup_l06_rostok_flame( ver )
  if ver == 0 then return end
  if db.actor:has_info( "seensak_l06_rostok" ) then
    log2( "[%s]: fix dsh.cleanup_l06_rostok_flame", script_name() )
    dsh.cleanup_l06_rostok_flame()
  end
end


function fix_val_exit_gate( ver )
  if ver == 0 then return end
  if db.actor:has_info( "dark_btr_prespawn" ) then
    log2( "[%s]: fix val_exit_gate", script_name() )
    arhara_dialog.vrag_speznaza()
  end
end


function fix_dark_btr1_arhara1( ver )
  for _, n in ipairs({ "dark_btr1_arhara1", "dark_btr2_arhara2" }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_r2_sun_lumscale_amb( ver )
  log2( "[%s]: r2_sun_lumscale_amb 1.2", script_name() )
  cmd2( "r2_sun_lumscale_amb", "1.2" )
  dsh_cfg.update_cfg_data( "r2_sun_lumscale_amb", 1.2 )
  dsh_underground.on_mm_return_game()
end


function fix_mongol_divan( ver )
  local sobj = alife():object( "mongol_divan" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_marsh_casket( ver )
  for _, n in ipairs({
    "marsh_casket",
    "marsh_casket_lid",
    "marsh_cross_1",
    "marsh_cross_2",
  }) do
    local sobj = alife():object( n )
    if sobj then
      log2(
        "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
      alife():release( sobj )
    end
  end
end


function fix_rostok_arhara_kamaz1( ver )
  local sobj = alife():object( "rostok_arhara_kamaz1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_agr_krot_PDA_free( ver )
  if ver == 0 then return end
  if db.actor:has_info( "agr_krot_PDA_done" ) then
    log2( "[%s]: fix agr_krot_PDA_free", script_name() )
    db.actor:give_info_portion( "agr_krot_PDA_free" )
  end
end


function fix_esc_agregat( ver )
  log2( "[%s]: create esc_agregat", script_name() )
  local sobj = alife():create(
    "esc_agregat",
    vector():set( -242.183502197266, -24.7912712097168, -135.199996948242 ),
    12815, 4
  )
  sobj.angle = vector():set( 0, -1.89999997615814, 0 )
  local pk   = get_netpk( sobj, 1 )
  ASSERT( pk and pk:isOk(), "can't read netpacket of %s", sobj:name() )
  local data = pk:get()
  data.fixed_bones = "bone01"
  data.physic_type = 3
  data.mass        = 100
  data.skeleton_name = "agregat"
  pk:set( data )
  sobj = alife():object( sobj.id )
  sobj:used_ai_locations( false )
end


function fix_av_pesh_matras1_grot( ver )
  for _, name in ipairs({ "av_kamera_kovrik", "av_pesh_matras1_grot" }) do
    local sobj = alife():object( name )
    if sobj then
      log2( "[%s]: found %s, recreate", script_name(), sobj:name() )
      alife():release( sobj )
      sobj = alife():create( alife():spawn_id( name ) )
      local pk = get_netpk( sobj, 1 )
      ASSERT(
        ( pk and pk:isOk() ), "[%s]: can't parse netpk: %s",
        script_name(), sobj:name()
      )
      local data = pk:get()
      data.custom_data:setString(
        "[collide]\nignore_static\n\n[logic]\ncfg = scripts\\esc_sleep.ltx\n"
      )
      pk:set( data )
    end
  end
end


function fix_av_pesh_meshok1( ver )
  local sobj = alife():object( "av_pesh_meshok1" )
  if sobj then
    log2( "[%s]: found %s, recreate", script_name(), sobj:name() )
    alife():iterate_object(
      sobj.id,
      function( sobj )
        log2( "[%s]:   release %s", script_name(), sobj:name() )
        alife():release( sobj )
      end
    )
    local args = {
      sobj.position, sobj.m_level_vertex_id, sobj.m_game_vertex_id, sobj.id
    }
    log2( "[%s]:   create energy_drink = 1", script_name() )
    alife():create( "energy_drink", unpack( args ) )
    for _, sect in ipairs({
      "bandage",
      "batt_torch",
      "conserva",
      "flaska",
      "matches",
      "medkit",
      "sigaret",
    }) do
      local cnt = math.random( 2, 10 )
      log2( "[%s]:   create %s = %d", script_name(), sect, cnt )
      for i = 1, cnt do
        alife():create( sect, unpack( args ) )
      end
    end
  end
end


function fix_val_escort_captive( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "doctor_drug_done" )
    and db.actor:dont_has_info( "val_pula_boar_leg_done" )
  then
    local sobj = alife():object( "val_escort_captive" )
    if ( sobj and sobj.m_story_id == INVALID_STORY_ID ) or not sobj then
      if sobj then
        log2(
          "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
        )
        dsh.release_mob( sobj )
      end
      sobj = alife():create( alife():spawn_id( story_ids.val_escort_captive ) )
      log2(
        "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name
      )
    end
  end
end


function fix_marsh_dan( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.marsh_dan )
  if not sobj then return end
  log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
  dsh.release_mob( sobj )
  sobj = alife():create( alife():spawn_id( story_ids.marsh_dan ) )
  log2( "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_marsh_holod( ver )
  if ver == 0 then return end
  local sobj = alife():story_object( story_ids.marsh_barman )
  if not sobj then return end
  log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
  dsh.release_mob( sobj )
  sobj = alife():create( alife():spawn_id( story_ids.marsh_barman ) )
  log2( "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_val_bandit_trader2( ver )
  if ver == 0 then return end
  local sid  = story_ids.val_bandit_trader
  local sobj = alife():story_object( sid )
  if not sobj then return end
  log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
  dsh.release_mob( sobj )
  sobj = alife():create( alife():spawn_id( sid ) )
  log2( "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_esc_kuznetsov( ver )
  if ver == 0 then return end
  local sid  = story_ids.esc_kuznetsov
  local sobj = alife():story_object( sid )
  if not sobj then return end
  log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
  dsh.release_mob( sobj )
  sobj = alife():create( alife():spawn_id( sid ) )
  log2( "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_sherstuk( ver )
  if ver == 0 then return end
  local sid  = story_ids[ "Sherstuk" ]
  local sobj = alife():story_object( sid )
  if not sobj then return end
  log2( "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name )
  dsh.release_mob( sobj )
  sobj = alife():create( alife():spawn_id( sid ) )
  log2( "[%s]: respawn %s (%s)", script_name(), sobj:name(), sobj.level_name )
end


function fix_gar_seryi( ver )
  if ver == 0 then return end
  if db.actor:dont_has_info( "val_pula_ammo_done" ) then return end
  local sobj = alife():object( "gar_seryi" )
  if sobj and sobj:alive() then
    log2( "[%s]: free %s (%s)", script_name(), sobj:name(), sobj.level_name )
    sak.make_nepis_free( sobj )
  end
end


function fix_yakut_false_prestart( ver )
  if ver == 0 then return end
  if not dsh.can_yakut_first_prizrak() then return end
  if db.actor:dont_has_info( "yakut_true_start" ) then
    log2( "[%s]: give yakut_false_prestart", script_name() )
    db.actor:give_info_portion( "yakut_false_prestart" )
  end
end


function fix_ucen_talk_preneed( ver )
  if ver == 0 then return end
  if not dsh.can_sahar_speak_group() then return end
  if db.actor:dont_has_info( "ucen_talk_need" ) then
    log2( "[%s]: give ucen_talk_preneed", script_name() )
    db.actor:give_info_portion( "ucen_talk_preneed" )
  end
end


function fix_shax_land_perehod_talk_prestart( ver )
  if ver == 0 then return end
  if not dsh.can_shax_land_perehod_talk() then return end
  if db.actor:dont_has_info( "ginekolog_lekarstvo_nayti_start" ) then
    log2( "[%s]: give shax_land_perehod_talk_prestart", script_name() )
    db.actor:give_info_portion( "shax_land_perehod_talk_prestart" )
  end
end


function fix_prizrak_tainiy_start( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "prizrak_tainiy_talk" )
    and db.actor:dont_has_info( "prizrak_tainiy_start" )
  then
    log2( "[%s]: give prizrak_tainiy_start", script_name() )
    db.actor:give_info_portion( "prizrak_tainiy_start" )
  end
end


function fix_medik_pribor_1( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "otsh_pda_nayti_done" )
    and db.actor:dont_has_info( "medik_pribor_1_nayti_start" )
  then
    log2( "[%s]: fix medik_pribor_1", script_name() )
    local task = CGameTask()
    task:load( "medik_pribor_1" )
    db.actor:give_task( task, 0, true )
  end
end


function fix_r2_disable_hom( ver )
  log2( "[%s]: r2_disable_hom on", script_name() )
  cmd2( "r2_disable_hom", "on" )
end


function fix_av_peshera_arhara_staloktit_1( ver )
  local sobj = alife():object( "av_peshera_arhara_staloktit_1" )
  if sobj then
    log2(
      "[%s]: release %s (%s)", script_name(), sobj:name(), sobj.level_name
    )
    alife():release( sobj )
  end
end


function fix_medik_pribor_1_kolby( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "medik_pribor_1_nayti_done" )
    and db.actor:dont_has_info( "akkum_and_mikposx_nayti_start" )
  then
    log2( "[%s]: fix medik_pribor_1_kolby", script_name() )
    local task = CGameTask()
    task:load( "medik_pribor_1_kolby" )
    db.actor:give_task( task, 0, true )
  end
end


function fix_medik_pribor_1_karta( ver )
  if ver == 0 then return end
  if
    db.actor:has_info( "medik_pribor_1_nayti_done" )
    and db.actor:dont_has_info( "medik_pribor_1_nayti_karta" )
  then
    log2( "[%s]: fix medik_pribor_1_karta_start", script_name() )
    db.actor:give_info_portion( "medik_pribor_1_karta_start" )
  end
end


function fix_snd_occ_mtl( ver )
  log2( "[%s]: fix snd_occ_mtl -> 0.4", script_name() )
  cmd2( "snd_occ_mtl", "0.4" )
end
